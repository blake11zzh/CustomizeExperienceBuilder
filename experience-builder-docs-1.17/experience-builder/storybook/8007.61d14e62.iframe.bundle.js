(self.webpackChunkarcgis_experience_builder_design_system=self.webpackChunkarcgis_experience_builder_design_system||[]).push([[8007],{"../jimu-icons/svg/outlined/data/braces.svg":module=>{module.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M0 0h16v16H0z" opacity=".01"></path><path fill="#000" d="M2 7.527q.65 0 .984-.457t.333-1.293V3.971q0-.552.15-.93.15-.379.4-.6a1.4 1.4 0 0 1 .567-.33Q4.767 2 5.118 2h1.05v.851h-.8q-.3 0-.5.126a.76.76 0 0 0-.284.3 1.3 1.3 0 0 0-.133.426q-.034.236-.034.457v1.806q0 .569-.183.962a1.9 1.9 0 0 1-.417.615 1.7 1.7 0 0 1-.483.33q-.25.095-.4.111v.032q.15.015.4.126.25.094.483.331.25.22.417.615.183.378.183.946v1.806q0 .221.034.457.033.237.133.426a.76.76 0 0 0 .284.3q.2.126.5.126h.8V14h-1.05q-.351 0-.684-.11a1.4 1.4 0 0 1-.567-.331 1.54 1.54 0 0 1-.4-.6q-.15-.378-.15-.93v-1.806q0-.835-.333-1.293Q2.65 8.473 2 8.473zM14 8.473q-.65 0-.984.457t-.333 1.293v1.806q0 .552-.15.93-.15.379-.4.6a1.4 1.4 0 0 1-.584.33q-.316.111-.667.111h-1.05v-.851h.8q.3 0 .484-.126a.73.73 0 0 0 .3-.3q.1-.189.133-.426a3 3 0 0 0 .034-.457v-1.806q0-.568.166-.946.183-.395.417-.615.25-.237.5-.331.25-.111.4-.126v-.032q-.15-.015-.4-.11a2 2 0 0 1-.5-.331 2.3 2.3 0 0 1-.417-.615q-.166-.394-.167-.962V4.16q0-.221-.033-.457a1.3 1.3 0 0 0-.133-.426.73.73 0 0 0-.3-.3.84.84 0 0 0-.484-.126h-.8V2h1.05q.35 0 .667.11.334.095.584.331.25.221.4.6.15.378.15.93v1.806q0 .836.333 1.293.334.457.984.457z"></path></svg>'},"../jimu-icons/svg/outlined/data/code.svg":module=>{module.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M0 0h16v16H0z" opacity=".01"></path><path fill="#000" fill-rule="evenodd" d="m9.603 3-4.175 9.642.97.358 4.174-9.642zm1.897 8.233-.738-.681L13.524 8l-2.762-2.552.738-.681L15 8zm-7-6.466.738.681L2.476 8l2.762 2.552-.738.681L1 8z" clip-rule="evenodd"></path></svg>'},"../jimu-icons/svg/outlined/data/text-page.svg":module=>{module.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.707 1H2v14h1V2h6.293L12 4.707V14H5v1h8V4.293zM5 5h4V4H5zm6 3H5V7h6zm-6 3h4v-1H5z" clip-rule="evenodd"></path></svg>'},"../jimu-ui/advanced/expression-builder.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{KN:()=>expression_builder,Os:()=>expression_builder_popup,yP:()=>ExpressionBuilderType,zl:()=>expression_input,vD:()=>ExpressionInputType,n2:()=>expression_builder_ExpressionBuilder,fE:()=>expression_builder_popup_ExpressionBuilderPopup});var styles_namespaceObject={};__webpack_require__.r(styles_namespaceObject),__webpack_require__.d(styles_namespaceObject,{ExpressionBuilder:()=>expressionBuilderStyles,ExpressionEditor:()=>expressionEditorStyles,ExpressionInput:()=>expressionInputStyles});var jimu_core=__webpack_require__("../jimu-core/index.tsx");function expressionBuilderStyles(props){const theme=props.theme;return jimu_core.AHW`
    .component-expression-builder{
      .w-33{
        width: 33% !important;
      }
      .w-85{
        width: 85%;
      }
      .fixed-at-bottom{
        width: 100%;
        height: ${jimu_core.PLL.rem(64)};
        border-top: 1px solid ${theme.ref.palette.neutral[700]};
        position: fixed;
        bottom: 0;
        left: 0;
        background-color: ${theme.ref.palette.neutral[400]};
      }
      .expression-builder-tab{
        padding-top: 1rem;
        padding-bottom: 1rem;
        overflow: hidden;
        width: 100%;
        height: 100%;
      }
      .common-tab{
        .option-label{
          font-size: ${jimu_core.PLL.rem(13)};
          font-weight: 500;
          color: ${theme.ref.palette.neutral[900]};
        }
        .data-option{
          padding-left: 1rem;
          padding-right: 1rem;
        }
      }
      .field-selector-container{
        height: 100%;
      }
      .expression-editor-container{
        height: calc(100% - 90px);
      }
      .expression-editor-helper{
        height: calc(100% - 130px);
        .tab-content{
          margin: 0 -1rem;
        }
      }
      .exp-editor-helper-tab{
        height: calc(100% - 20px);
      }
      .field-selector-container, .expression-editor-container{
        width: 100%;
      }
      .expression-insert-btn{
        width: ${jimu_core.PLL.rem(180)};
      }
      .stat-inter-btn{
        max-width: 100%;
      }
    }

  `}function expressionEditorStyles(props){const theme=props.theme;return jimu_core.AHW`
    .component-expression-editor{
      .mt-18{
        margin-top: 18px;
      }
      .jimu-nav.nav.nav-pills.nav-fill{
        border-top: 0;
        border-left: 0;
        border-right: 0;
      }
      .expression-editor-input{
        -webkit-user-select: text !important;
        user-select: text !important;
        font-size: 13px;
        font-weight: 400;
        overflow-x: hidden;
        overflow-y: auto;
        min-height: ${jimu_core.PLL.rem(48)};
        max-height: ${jimu_core.PLL.rem(100)};
        user-select: none;
        border: 0;
        outline: none;
        background-color: ${theme.ref.palette.neutral[300]};
        padding: 1px;
        .expression-editor-input-content-editable:focus{
          border-color: ${theme.sys.color.primary.dark};
          outline: none;
        }
        .expression-editor-input-content-editable{
          border: 1px solid ${theme.ref.palette.neutral[300]};
          min-height: ${jimu_core.PLL.rem(48)};
          max-height: ${jimu_core.PLL.rem(100)};
          border-radius: 2px;
          outline: none;
        }
        p{
          min-height: 100%;
        }
        .break-all{
          word-break: break-all;
        }
        span.error-exp{
          color: ${theme.sys.color.error.light};
        }
        .field-exp{
          color: ${theme.sys.color.warning.light};
        }
        .function-exp{
          color: ${theme.sys.color.primary.light};
        }
        .number-exp{
          color: ${theme.sys.color.info.main};
        }
        .string-exp{
          color: ${theme.sys.color.success.light};
        }
        .operator-exp{
          color: ${theme.ref.palette.neutral[1100]};
        }
        .order-exp{
          color: ${theme.ref.palette.success[500]};
        }
        .unknown-exp{
          color: ${theme.sys.color.error.light};
        }
        .ds-disabled-exp{
          color: ${theme.sys.color.error.light};
        }
      }

      .error-border{
        border: 1px solid #FF5066;
        outline: none;
        .expression-editor-input-content-editable{
          outline: none;
          border: 0;
        }
      }

      .expression-editor-function-item{
        border: 1px solid transparent;
        cursor: pointer;
        background-color: ${theme.ref.palette.neutral[500]};
        user-select: none;
      }
      .expression-editor-function-item-selected{
        border: 1px solid ${theme.sys.color.primary.main};
      }
      .expression-editor-function-item:hover{
        background-color: ${theme.ref.palette.neutral[500]};
      }
      .expression-editor-function-item:active.expression-editor-function-item:hover{
        background-color: ${theme.ref.palette.white};
      }

      .exp-editor-helper{
        user-select: none;
      }
      .with-error-message .exp-editor-helper .component-field-selector .field-list{
        height: calc(100% - 185px);
      }
      .exp-editor-helper-tab{
        margin-left: -16px;
        margin-right: -16px;
      }

      .error-message{
        height: 20px;
        line-height: 20px;
      }

      .exp-popper{
        background-color: ${theme.ref.palette.neutral[300]};
        border: 1px solid ${theme.ref.palette.neutral[700]};
        font-size: 13px;
        width: ${jimu_core.PLL.rem(200)};
        z-index: 1;
        padding: 0 !important;
        box-shadow: 0 0 8px 0 ${jimu_core.PLL.rgba(theme.ref.palette.white,.5)};
        .exp-popper-item{
          padding-left: 8px;
          padding-right: 8px;
        }
        .jimu-popper--arrow::after {
          border-bottom-color: ${theme.ref.palette.neutral[300]} !important;
        }
      }
      .exp-popper-selected-item, .exp-popper-item:hover{
        background-color: ${theme.sys.color.secondary.main};
        cursor: pointer;
      }

    }

  `}function expressionInputStyles(props){const theme=props.theme;return jimu_core.AHW`
    .component-expression-input{
      font-size: ${theme.ref.typeface.fontSize};
      .input-wrapper{
        height: ${jimu_core.PLL.rem(26)};
        padding-top: 0;
        padding-bottom: 0;
      }
      .disabled-input-cover{
        width: 100%;
        height: 100%;
        position: relative;
        top: -100%;
        &.ds-disabled{
          background-color: transparent;
        }
      }
      .ds-disabled{
        background-color: ${theme.ref.palette.neutral[300]};
        cursor: pointer;
        border: 0;
        >span.error-wrapper{
          color: ${theme.ref.palette.neutral[1200]};
          background-color: ${jimu_core.PLL.rgba(theme.sys.color.error.main,.5)};
          vertical-align: sub;
          margin-left: 5px;
          margin-right: 5px;
        }
      }
      .ds-placeholder{
        >span{
          color: ${theme.ref.palette.neutral[900]};
          background-color: transparent;
        }
      }
      .expression-builder-trigger{
        cursor: pointer;
        width: 26px;
        height: 26px;
        padding: 0;
        .dropdown-button-content{
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .expression-builder-trigger-dropdown{
          padding: 0;
          .trigger-dropdown-toggle{
            background: ${theme.ref.palette.neutral[600]};
            border-radius: 2px 0 0 2px;
            border-color: ${theme.ref.palette.neutral[600]};
          }
        }
      }
      .expression-input{
        height: ${jimu_core.PLL.rem(26)};
        .jimu-input, .ds-placeholder{
          border-radius: 0 2px 2px 0;
        }
      }
    }

  `}var ExpressionBuilderType,FromStatic,jimu_theme=__webpack_require__("../jimu-theme/index.ts"),jimu_ui=__webpack_require__("../jimu-ui/index.tsx");!function(ExpressionBuilderType){ExpressionBuilderType.Attribute="ATTRIBUTE",ExpressionBuilderType.Statistics="STATISTICS",ExpressionBuilderType.Expression="EXPRESSION"}(ExpressionBuilderType||(ExpressionBuilderType={})),function(FromStatic){FromStatic.Static="STATIC"}(FromStatic||(FromStatic={}));const ExpressionInputType=Object.assign(Object.assign({},FromStatic),ExpressionBuilderType);function getWhetherUseDssMatchExpDss(part,useDataSources){const dsManager=jimu_core.zAk.getInstance();if(part&&part.dataSourceId&&useDataSources){if(part.dataSourceId.split("-").reverse()[0]===jimu_core.aH5.W7){const ds=jimu_core.zAk.getInstance().getDataSource(part.dataSourceId),mainDs=ds&&ds.getMainDataSource(),mainDataSourceId=mainDs&&mainDs.id;return useDataSources.some((u=>(null==u?void 0:u.mainDataSourceId)===mainDataSourceId))}return!!(useDataSources.some((u=>(null==u?void 0:u.dataSourceId)===part.dataSourceId))&&dsManager&&dsManager.getDataSource(part.dataSourceId))}return!0}function getExpressionFromString(from,intl){if(!from)return"";switch(from){case ExpressionInputType.Attribute:return intl.formatMessage({id:"attribute",defaultMessage:jimu_ui.defaultMessages.attribute});case ExpressionInputType.Statistics:return intl.formatMessage({id:"statistics",defaultMessage:jimu_ui.defaultMessages.statistics});case ExpressionInputType.Expression:return intl.formatMessage({id:"expression",defaultMessage:jimu_ui.defaultMessages.expression});case ExpressionInputType.Static:return intl.formatMessage({id:"static",defaultMessage:jimu_ui.defaultMessages.static});default:return""}}function isPercentileFunction(func){return func===jimu_core.CIK.PercentileContinuous||func===jimu_core.CIK.PercentileDiscrete}function getSupportedUseDataSources(selectedFunction,useDataSources){return isPercentileFunction(selectedFunction)?null==useDataSources?void 0:useDataSources.map((u=>{var _a,_b,_c;return(null===(_c=null===(_b=null===(_a=jimu_core.zAk.getInstance().getDataSource(u.dataSourceId))||void 0===_a?void 0:_a.getCapabilities)||void 0===_b?void 0:_b.call(_a))||void 0===_c?void 0:_c.getQueryCapabilities().supportsPercentileStatistics)||(u=u.set("dataSourceId",jimu_core.zAk.getInstance().getDataViewDataSourceId(u.mainDataSourceId,jimu_core.aH5.W7)).set("dataViewId",jimu_core.aH5.W7)),u})):useDataSources}var server_browser=__webpack_require__("../node_modules/react-dom/server.browser.js"),react_contenteditable=__webpack_require__("../node_modules/react-contenteditable/lib/react-contenteditable.js"),react_contenteditable_default=__webpack_require__.n(react_contenteditable);var ExpSelectionType,PopoverType;!function(ExpSelectionType){ExpSelectionType.Part="PART",ExpSelectionType.Char="CHAR"}(ExpSelectionType||(ExpSelectionType={})),function(PopoverType){PopoverType.Field="FIELD",PopoverType.DataSource="DATA_SOURCE",PopoverType.Function="FUNCTION",PopoverType.Order="ORDER"}(PopoverType||(PopoverType={}));class ExpBase extends jimu_core.q_G.PureComponent{render(){return jimu_core.q_G.createElement("span",{className:this.props.className,contentEditable:!!this.props.isEditable,suppressContentEditableWarning:!0,id:this.props.id,style:this.props.style,title:this.props.title||null,tabIndex:this.props.tabIndex||null},this.props.exp)}}try{expbase.displayName="expbase",expbase.__docgenInfo={description:"",displayName:"expbase",props:{exp:{defaultValue:null,description:"",name:"exp",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},tabIndex:{defaultValue:null,description:"",name:"tabIndex",required:!1,type:{name:"number"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},renderComma:{defaultValue:null,description:"",name:"renderComma",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/exp-base.tsx#expbase"]={docgenInfo:expbase.__docgenInfo,name:"expbase",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/exp-base.tsx#expbase"})}catch(__react_docgen_typescript_loader_error){}class FieldExp extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.getDsLabel=()=>{const dsManager=jimu_core.zAk.getInstance(),ds=dsManager&&dsManager.getDataSource(this.props.dataSourceId);return ds?ds.getLabel():null}}render(){return jimu_core.q_G.createElement(ExpBase,Object.assign({},this.props,{className:(0,jimu_core.xWm)("field-exp",{[this.props.className]:!!this.props.className,"error-exp":this.props.isError,"ds-disabled-exp":this.props.isDsDisabled}),style:this.props.style,title:this.getDsLabel(),tabIndex:0}))}}try{fieldexp.displayName="fieldexp",fieldexp.__docgenInfo={description:"",displayName:"fieldexp",props:{exp:{defaultValue:null,description:"",name:"exp",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},isError:{defaultValue:null,description:"",name:"isError",required:!0,type:{name:"boolean"}},isDsDisabled:{defaultValue:null,description:"",name:"isDsDisabled",required:!0,type:{name:"boolean"}},dataSourceId:{defaultValue:null,description:"",name:"dataSourceId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/field-exp.tsx#fieldexp"]={docgenInfo:fieldexp.__docgenInfo,name:"fieldexp",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/field-exp.tsx#fieldexp"})}catch(__react_docgen_typescript_loader_error){}class StringExp extends jimu_core.q_G.PureComponent{render(){return jimu_core.q_G.createElement(ExpBase,Object.assign({},this.props,{className:"string-exp",tabIndex:0}))}}try{stringexp.displayName="stringexp",stringexp.__docgenInfo={description:"",displayName:"stringexp",props:{exp:{defaultValue:null,description:"",name:"exp",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/string-exp.tsx#stringexp"]={docgenInfo:stringexp.__docgenInfo,name:"stringexp",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/string-exp.tsx#stringexp"})}catch(__react_docgen_typescript_loader_error){}class FunctionExp extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.getFunctionTooltip=exp=>{if(!exp)return null;const func=this.props.exp;switch(func){case jimu_core.CIK.Average:return"Average ( fieldName ) returns  { Number }";case jimu_core.CIK.Count:return"Count ( fieldName ) returns  { Number }";case jimu_core.CIK.Sum:return"Sum ( fieldName ) returns  { Number }";case jimu_core.CIK.Max:return"Max ( fieldName ) returns  { Number }";case jimu_core.CIK.Min:return"Min ( fieldName ) returns  { Number }";case jimu_core.CIK.StandardDeviation:return"Standard deviation ( fieldName ) returns  { Number }";case jimu_core.CIK.PercentileContinuous:return"Percentile continuous ( fieldName, value, order ) returns  { Number }";case jimu_core.CIK.PercentileDiscrete:return"Percentile discrete ( fieldName, value, order ) returns  { Number }";default:throw new Error(`Unhandled case: ${func}`)}}}render(){return jimu_core.q_G.createElement(ExpBase,{exp:this.props.exp,isEditable:!!this.props.isEditable,id:this.props.id,title:this.getFunctionTooltip(this.props.exp),className:(0,jimu_core.xWm)("function-exp",{[this.props.className]:!!this.props.className,"ds-disabled-exp":this.props.isDsDisabled})})}}try{functionexp.displayName="functionexp",functionexp.__docgenInfo={description:"",displayName:"functionexp",props:{exp:{defaultValue:null,description:"",name:"exp",required:!0,type:{name:"string"}},dataSourceIds:{defaultValue:null,description:"",name:"dataSourceIds",required:!0,type:{name:"ImmutableArray<string>"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},externalId:{defaultValue:null,description:"",name:"externalId",required:!0,type:{name:"string"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},isDsDisabled:{defaultValue:null,description:"",name:"isDsDisabled",required:!0,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/function-exp.tsx#functionexp"]={docgenInfo:functionexp.__docgenInfo,name:"functionexp",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/function-exp.tsx#functionexp"})}catch(__react_docgen_typescript_loader_error){}class NumberExp extends jimu_core.q_G.PureComponent{render(){return jimu_core.q_G.createElement(ExpBase,Object.assign({},this.props,{className:(0,jimu_core.xWm)("number-exp",{[this.props.className]:!!this.props.className}),style:this.props.style,tabIndex:0}))}}try{numberexp.displayName="numberexp",numberexp.__docgenInfo={description:"",displayName:"numberexp",props:{exp:{defaultValue:null,description:"",name:"exp",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/number-exp.tsx#numberexp"]={docgenInfo:numberexp.__docgenInfo,name:"numberexp",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/number-exp.tsx#numberexp"})}catch(__react_docgen_typescript_loader_error){}class ErrorExp extends jimu_core.q_G.PureComponent{render(){return jimu_core.q_G.createElement(ExpBase,Object.assign({},this.props,{className:"unknown-exp"}))}}try{unknownexp.displayName="unknownexp",unknownexp.__docgenInfo={description:"",displayName:"unknownexp",props:{exp:{defaultValue:null,description:"",name:"exp",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/unknown-exp.tsx#unknownexp"]={docgenInfo:unknownexp.__docgenInfo,name:"unknownexp",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/unknown-exp.tsx#unknownexp"})}catch(__react_docgen_typescript_loader_error){}class Operator extends jimu_core.q_G.PureComponent{render(){return jimu_core.q_G.createElement(ExpBase,Object.assign({},this.props,{className:"operator-exp"}))}}try{operatorexp.displayName="operatorexp",operatorexp.__docgenInfo={description:"",displayName:"operatorexp",props:{exp:{defaultValue:null,description:"",name:"exp",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/operator-exp.tsx#operatorexp"]={docgenInfo:operatorexp.__docgenInfo,name:"operatorexp",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/operator-exp.tsx#operatorexp"})}catch(__react_docgen_typescript_loader_error){}class ExpPopover extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.itemHeight=25,this.popoverItemStyle={lineHeight:`${this.itemHeight}px !important`},this.getTarget=(id,containerNode)=>id&&containerNode?containerNode.querySelector(`#${id}`):null,this.state={targetNode:this.getTarget(this.props.targetNodeId,this.props.containerNode)}}componentDidUpdate(prevProps){if(this.props.selectedItemIndex!==prevProps.selectedItemIndex&&this.props.selectedItemIndex&&this.root){let scrollTop;if(parseInt(this.props.selectedItemIndex)>parseInt(prevProps.selectedItemIndex))if(parseInt(this.props.selectedItemIndex)===this.props.items.length-1)scrollTop=this.root.scrollHeight-this.root.offsetHeight;else{const maxIndexInScreen=Math.floor((this.root.scrollTop+this.root.offsetHeight)/this.itemHeight)-1;scrollTop=parseInt(this.props.selectedItemIndex)>=maxIndexInScreen?this.root.scrollTop+this.itemHeight:this.root.scrollTop}else if(0===parseInt(this.props.selectedItemIndex))scrollTop=0;else{const minIndexInScreen=Math.floor(this.root.scrollTop/this.itemHeight);scrollTop=parseInt(this.props.selectedItemIndex)<=minIndexInScreen?this.root.scrollTop-this.itemHeight:this.root.scrollTop}this.root.scrollTo(null,scrollTop)}this.props.expSelection===prevProps.expSelection&&this.props.targetNodeId===prevProps.targetNodeId&&this.props.containerNode===prevProps.containerNode||this.setState({targetNode:this.getTarget(this.props.targetNodeId,this.props.containerNode)})}render(){return this.state.targetNode&&this.props.items&&0!==this.props.items.length?(0,jimu_core.Yac)(jimu_ui.Popper,{reference:this.state.targetNode,open:this.props.isOpen,autoFocus:!1,placement:"bottom",className:"exp-popper",offsetOptions:5,arrowOptions:!0,disablePortal:!0},(0,jimu_core.Yac)("div",{style:{width:"200px",maxHeight:"200px",overflow:"auto"},ref:n=>{this.root=n}},this.props.items.map(((item,index)=>(0,jimu_core.Yac)("div",{key:index,onClick:()=>{this.props.onClick&&this.props.onClick(item,this.props.targetNodeId)},className:(0,jimu_core.xWm)("text-break exp-popper-item",{"exp-popper-selected-item":`${index}`===this.props.selectedItemIndex}),title:item.content,css:(0,jimu_core.AHW)(this.popoverItemStyle)},item.content))))):null}}try{exppopover.displayName="exppopover",exppopover.__docgenInfo={description:"",displayName:"exppopover",props:{items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"PopoverItem[]"}},selectedItemIndex:{defaultValue:null,description:"",name:"selectedItemIndex",required:!0,type:{name:"string"}},targetNodeId:{defaultValue:null,description:"",name:"targetNodeId",required:!0,type:{name:"string"}},containerNode:{defaultValue:null,description:"",name:"containerNode",required:!0,type:{name:"HTMLElement"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},theme:{defaultValue:null,description:"",name:"theme",required:!0,type:{name:"IMThemeVariables"}},expSelection:{defaultValue:null,description:"",name:"expSelection",required:!0,type:{name:"ExpSelection"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(item: PopoverItem, target: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/exp-popover.tsx#exppopover"]={docgenInfo:exppopover.__docgenInfo,name:"exppopover",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/exp-popover.tsx#exppopover"})}catch(__react_docgen_typescript_loader_error){}var ExpEditorHelperTabs,layout_runtime=__webpack_require__("../jimu-layouts/layout-runtime.tsx");function getNodeByPartId(partId,container){return partId?container?container.querySelector(`#${partId}`):document&&document.querySelector(`#${partId}`):null}function getPartIdByChildNode(externalId,node){if(!node||function getWhetherNodeIsParentOfParts(id){if(!id)return!1;const t=id.split("-");return!(!t.length||2!==t.length||"expression"!==t[0]||!/^\d+$/.test(t[1]))}(node.id))return null;for(;node&&!getWhetherIsPartId(externalId,node.id);)node=node.parentElement;return node?node.id:null}function getPartIdByIndex(externalId,index){return isNumberVariable(index)?`${externalId}-part-${index}`:null}function getIndexByPartId(externalId,partId){if(!partId)return null;const temp=partId.split("-"),index=getWhetherIsPartId(externalId,partId)?temp.length-1:-1;return index>-1?parseInt(temp[index]):null}function getWhetherIsPartId(externalId,id){if(!id||!externalId)return!1;const internalId=function getInternalId(externalId,id){return id&&externalId?id.split(`${externalId}-`)[1]:null}(externalId,id);return!(!internalId||internalId.split("-").length!=="part".split("-").length+1||id.indexOf("part")!==externalId.length+1||!/\d$/.test(id))}function isPartUnmergeable(part){return!part||(part.type?part.type===jimu_core.une.String||part.type===jimu_core.une.Field||part.type===jimu_core.une.Operator:(console.warn("Part has no type: ",part),!1))}function isCharacterUnmergeable(char){return!!char&&(isOperator(char)||isCharDoubleQuotationMarker(char)||isCharFrontCurlyBracket(char))}function isNumberVariable(n){return!isNaN(n)&&"[object Number]"===Object.prototype.toString.call(n)}function isCharDoubleQuotationMarker(char){return!(!char||'"'!==char)}function isCharFrontCurlyBracket(char){return!(!char||"{"!==char)}function isField(exp){return/^\{(.*?)\}$/.test(exp)}function isString(exp){return!!exp&&/^\"(.*?)\"$/.test(exp)}function isOperator(exp){return!!exp&&/^[\+\-\*\/\,\(\)\s+]$/.test(exp)}function addAutoAddedDataViews(widgetId,allUseDataSources,browserSizeMode,usePopulatedDataView){const groupedUseDss=function groupUseDataSourcesByMainDs(widgetId,allUseDataSources,browserSizeMode){if(!browserSizeMode||!allUseDataSources||0===allUseDataSources.length)return{};const groupedUseDss={};return allUseDataSources.forEach((u=>{groupedUseDss[u.mainDataSourceId]||(groupedUseDss[u.mainDataSourceId]=[]),groupedUseDss[u.mainDataSourceId].some((v=>v.dataSourceId===u.dataSourceId))||(groupedUseDss[u.mainDataSourceId]=groupedUseDss[u.mainDataSourceId].concat(u))})),groupedUseDss}(0,allUseDataSources,browserSizeMode);Object.keys(groupedUseDss).forEach((mainDataSourceId=>{var _a;groupedUseDss[mainDataSourceId]=null===(_a=groupedUseDss[mainDataSourceId])||void 0===_a?void 0:_a.concat(function getAutoAddedDataViews(widgetId,useDataSourcesWithSameMainDs,allUseDataSources,browserSizeMode,usePopulatedDataView){if(!useDataSourcesWithSameMainDs||0===useDataSourcesWithSameMainDs.length||!browserSizeMode)return[];let defaultDataViews=[];if(!useDataSourcesWithSameMainDs.some((u=>u.dataViewId===jimu_core.aH5.W7))){const selectionView=useDataSourcesWithSameMainDs[0].set("dataSourceId",jimu_core.zAk.getInstance().getDataViewDataSourceId(useDataSourcesWithSameMainDs[0].mainDataSourceId,jimu_core.aH5.W7)).set("dataViewId",jimu_core.aH5.W7);defaultDataViews=defaultDataViews.concat(selectionView)}if(usePopulatedDataView&&function getWhetherUseRepeatedDataSourceContext(widgetId,useDataSourcesWithSameMainDs,allUseDataSources,browserSizeMode){var _a,_b,_c,_d,_e;const config=(null===(_a=null===window||void 0===window?void 0:window.jimuConfig)||void 0===_a?void 0:_a.isBuilder)?null===(_c=null===(_b=(0,jimu_core.Vp3)().getState())||void 0===_b?void 0:_b.appStateInBuilder)||void 0===_c?void 0:_c.appConfig:null===(_d=(0,jimu_core.Vp3)().getState())||void 0===_d?void 0:_d.appConfig;if(!(config&&widgetId&&useDataSourcesWithSameMainDs&&0!==useDataSourcesWithSameMainDs.length&&allUseDataSources&&browserSizeMode))return!1;const parentWidgetId=layout_runtime.searchUtils.getParentWidgetIdOfContent(config,widgetId,jimu_core.K6q.Widget,browserSizeMode),parentWidgetJson=config.widgets[parentWidgetId],isInRepeatedDataSourceContext=parentWidgetJson&&(null===(_e=parentWidgetJson.manifest.properties)||void 0===_e?void 0:_e.canProvideRepeatDataSource);let haveSameUseDataSources=!1;for(let i=0;i<useDataSourcesWithSameMainDs.length;i++){const realUseDataSource=getRealUseDataSources(useDataSourcesWithSameMainDs[i],allUseDataSources);if(haveSameUseDataSources=(null==parentWidgetJson?void 0:parentWidgetJson.useDataSources)&&parentWidgetJson.useDataSources.some((parentU=>(null==realUseDataSource?void 0:realUseDataSource.dataSourceId)===parentU.dataSourceId)),haveSameUseDataSources)break}return isInRepeatedDataSourceContext&&haveSameUseDataSources}(widgetId,useDataSourcesWithSameMainDs,allUseDataSources,browserSizeMode)){const repeatContextView=useDataSourcesWithSameMainDs[0].set("dataSourceId",jimu_core.zAk.getInstance().getDataViewDataSourceId(useDataSourcesWithSameMainDs[0].mainDataSourceId,jimu_core.aH5.RP)).set("dataViewId",jimu_core.aH5.RP);defaultDataViews=defaultDataViews.concat(repeatContextView)}return defaultDataViews}(widgetId,groupedUseDss[mainDataSourceId],allUseDataSources,browserSizeMode,usePopulatedDataView))}));let newUseDss=(0,jimu_core.J3Z)([]);return Object.values(groupedUseDss).forEach((useDss=>{newUseDss=newUseDss.concat(useDss)})),newUseDss}function getRealUseDataSources(tempSelectUseDs,allUseDataSources){if(!tempSelectUseDs)return null;if(tempSelectUseDs.dataViewId===jimu_core.aH5.RP){const useDsHasSameMainDsAsSelectedUseDs=allUseDataSources.find((u=>u.mainDataSourceId===tempSelectUseDs.mainDataSourceId));return useDsHasSameMainDsAsSelectedUseDs&&(0,jimu_core.J3Z)(useDsHasSameMainDsAsSelectedUseDs)}return tempSelectUseDs}function getWhetherNodeAfterRange(range,node){if(!range||!range.collapsed||!node)return;let nodeRange;const r=range;return!!(r.compareBoundaryPoints&&document&&document.createRange)&&(nodeRange=document.createRange(),nodeRange.selectNodeContents(node),nodeRange.collapse(!0),r.compareBoundaryPoints(r.START_TO_END,nodeRange)<1)}function getWhetherNodeBeforeRange(range,node){if(!range||!range.collapsed||!node)return;let nodeRange;const r=range;return!!(r.compareBoundaryPoints&&document&&document.createRange)&&(nodeRange=document.createRange(),nodeRange.selectNodeContents(node),nodeRange.collapse(!1),r.compareBoundaryPoints(r.START_TO_END,nodeRange)>-1)}function moveSelectionByCharacter(partId,startOffset,container,collapse=!0){const node=getNodeByPartId(partId,container);if(node&&startOffset>=0&&window.getSelection){const range=createRange(node,{count:startOffset});range&&(collapse&&range.collapse(!1),window.getSelection().removeAllRanges(),window.getSelection().addRange(range))}}function createRange(node,chars,range){if(!document||!document.createRange)return null;if(range||((range=document.createRange()).selectNodeContents(node),range.setStart(node,0)),0===chars.count)range.setEnd(node,chars.count);else if(node&&chars.count>0)if(node.nodeType===Node.TEXT_NODE)node.textContent.length<chars.count?chars.count-=node.textContent.length:(range.setEnd(node,chars.count),chars.count=0);else for(let lp=0;lp<node.childNodes.length&&(range=createRange(node.childNodes[lp],chars,range),0!==chars.count);lp++);return range}function getSelectionRange(){let range=null;if(window.getSelection&&window.getSelection().getRangeAt){const selection=window.getSelection();selection.rangeCount>0&&(range=selection.getRangeAt(0))}return range}function getSelectionPosInnerPart(externalId,container){const range=getSelectionRange();if(!range)return null;let innerSelection=null;const startContainer=range.startContainer.nodeType===Node.TEXT_NODE?range.startContainer.parentElement:range.startContainer,isSelectionInPart=startContainer===(range.endContainer.nodeType===Node.TEXT_NODE?range.endContainer.parentElement:range.endContainer)&&startContainer&&getWhetherIsPartId(externalId,startContainer.id),partNode=isSelectionInPart?startContainer:null,partId=isSelectionInPart?startContainer.id:null;return partNode&&partId&&(innerSelection={partId,startOffset:range.startOffset,endOffset:range.endOffset,contentLength:partNode.textContent.length||0}),innerSelection}function getPreviousNodeOfSelection(externalId){const parentNode=document&&document.querySelector(`#${externalId}`),range=getSelectionRange();let node,previousNodeOfSelection;if(parentNode&&range)for(node=parentNode.lastElementChild;node;){if(getWhetherNodeBeforeRange(range,node)&&getWhetherIsPartId(externalId,node.id)){previousNodeOfSelection=node;break}node=node.previousElementSibling}return previousNodeOfSelection}function getNextNodeOfSelection(externalId){const parentNode=document&&document.querySelector(`#${externalId}`),range=getSelectionRange();let node,nextNodeOfSelection;if(parentNode&&range)for(node=parentNode.firstElementChild;node;){if(getWhetherNodeAfterRange(range,node)&&getWhetherIsPartId(externalId,node.id)){nextNodeOfSelection=node;break}node=node.nextElementSibling}return nextNodeOfSelection}function getSiblingOfExpSelection(externalId,partId,useNextSibling,isRemoving,parts){const partNode=getNodeByPartId(partId,document&&document.querySelector(`#${externalId}`));let expSiblingId=null,expSelection=null;return partNode?(!useNextSibling&&partNode.nextElementSibling&&getWhetherIsPartId(externalId,partNode.nextElementSibling.id)?expSiblingId=partNode.nextElementSibling.id:useNextSibling&&partNode.previousElementSibling&&getWhetherIsPartId(externalId,partNode.previousElementSibling.id)&&(expSiblingId=partNode.previousElementSibling.id),expSelection=expSiblingId?{type:ExpSelectionType.Char,partId:expSiblingId,startOffset:useNextSibling?getNodeByPartId(expSiblingId,document&&document.querySelector(`#${externalId}`)).textContent.length:0}:{partId:getPartIdByIndex(externalId,useNextSibling?0:parts&&parts.length>0?parts.length-1:0),toStart:useNextSibling,type:ExpSelectionType.Part},expSelection):null}function getStartPartIndexOfRangeSelection(externalId){const range=getSelectionRange();let startPartIndex;if(range.collapsed){const previousNodeOfSelection=getPreviousNodeOfSelection(externalId);startPartIndex=previousNodeOfSelection&&previousNodeOfSelection.id&&getWhetherIsPartId(externalId,previousNodeOfSelection.id)&&getIndexByPartId(externalId,previousNodeOfSelection.id)}else range.startContainer.nodeType===Node.TEXT_NODE&&(/^\ufeff$/.test(range.startContainer.textContent)||/^\ufeff$/.test(range.startContainer.parentElement.previousSibling.textContent))?startPartIndex=0:range.startContainer.id===externalId?startPartIndex=range.startOffset-1:getWhetherIsPartId(externalId,range.startContainer.id)?startPartIndex=getIndexByPartId(externalId,range.startContainer.id)+range.startOffset+1:console.warn("Can not get start part of selection");return isNumberVariable(startPartIndex)?startPartIndex:null}function getEndPartIndexOfRangeSelection(externalId,parts=[]){const range=getSelectionRange();let endPartIndex;if(range.collapsed){const previousNodeOfSelection=getPreviousNodeOfSelection(externalId);endPartIndex=previousNodeOfSelection&&previousNodeOfSelection.id&&getWhetherIsPartId(externalId,previousNodeOfSelection.id)&&getIndexByPartId(externalId,previousNodeOfSelection.id)}else range.endContainer.nodeType===Node.TEXT_NODE&&(/^\ufeff$/.test(range.endContainer.textContent)||/^\ufeff$/.test(range.startContainer.parentElement.previousSibling.textContent))?endPartIndex=parts.length-1>-1?parts.length-1:0:range.endContainer.id===externalId?endPartIndex=range.endOffset-2:getWhetherIsPartId(externalId,range.endContainer.id)?endPartIndex=getIndexByPartId(externalId,range.endContainer.id)-range.endOffset-1:console.warn("Can not get end part of selection");return isNumberVariable(endPartIndex)?endPartIndex:null}function getExpSelectionAndEditablePart(externalId,isInEditablePart,editResult,parts,innerSelection,moveCharacterNumber){let expSelection=null;if(!editResult)return expSelection;const noContentStringOrFieldPartIndex=Object.keys(editResult).find((index=>editResult[index]&&editResult[index].part&&(editResult[index].part.type===jimu_core.une.String&&'""'===editResult[index].part.exp||editResult[index].part.type===jimu_core.une.Field&&"{}"===editResult[index].part.exp)));if(noContentStringOrFieldPartIndex&&editResult[noContentStringOrFieldPartIndex]&&editResult[noContentStringOrFieldPartIndex].part)expSelection={partId:getPartIdByIndex(externalId,parseInt(noContentStringOrFieldPartIndex)),type:ExpSelectionType.Char,startOffset:1};else{const addedNewPartIndexes=function getAddedPartIndexes(editResult){return editResult?Object.keys(editResult).filter((index=>editResult[index]&&editResult[index].part&&!editResult[index].isReplacing)).map((index=>parseInt(index))):[]}(editResult),removedPartIndexes=function getRemovedPartIndexes(editResult){return editResult?Object.keys(editResult).filter((index=>editResult[index]&&!editResult[index].part&&editResult[index].isReplacing)).map((index=>parseInt(index))):[]}(editResult),areNewPartsAdded=addedNewPartIndexes.length>0;if(removedPartIndexes.length>0){const prevPartIndex=Math.min.apply(null,removedPartIndexes)-1,prevPart=parts[prevPartIndex];if(isInEditablePart)if(prevPart)expSelection=removedPartIndexes.length===Object.keys(editResult).length?{partId:getPartIdByIndex(externalId,prevPartIndex),type:ExpSelectionType.Char,startOffset:prevPart.type===jimu_core.une.String||prevPart.type===jimu_core.une.Field?prevPart.exp.length-1:prevPart.exp.length}:getExpSelectionAfterSomePartsMerged(externalId,parts,editResult);else{expSelection={partId:getPartIdByIndex(externalId,prevPartIndex>-1?prevPartIndex:0),type:ExpSelectionType.Part,toStart:!0}}else if(removedPartIndexes.length===Object.keys(editResult).length){const toStart=!(prevPartIndex>-1);expSelection={partId:getPartIdByIndex(externalId,prevPartIndex>-1?prevPartIndex:0),type:ExpSelectionType.Part,toStart}}else expSelection=getExpSelectionAfterSomePartsMerged(externalId,parts,editResult)}else if(areNewPartsAdded)if(addedNewPartIndexes.length===Object.keys(editResult).length){const lastAddedPartIndex=Math.max.apply(null,addedNewPartIndexes),lastAddedPartId=getPartIdByIndex(externalId,lastAddedPartIndex),lastAddedPart=editResult[lastAddedPartIndex]&&editResult[lastAddedPartIndex].part;expSelection={partId:lastAddedPartId,type:ExpSelectionType.Char,startOffset:lastAddedPart&&lastAddedPart.exp&&lastAddedPart.exp.length}}else expSelection=getExpSelectionAfterSomePartsMerged(externalId,parts,editResult);else{const mergedPartIndex=getMergedPartIndex(externalId,editResult),editResultPartIndex=isNumberVariable(mergedPartIndex)?mergedPartIndex:parseInt(Object.keys(editResult)[0]),editResultPartId=isNumberVariable(editResultPartIndex)&&getPartIdByIndex(externalId,editResultPartIndex);if(isInEditablePart){const selectionPartId=innerSelection&&innerSelection.partId,isSelectionPartEdited=editResultPartId===selectionPartId,leftCharNumber=innerSelection.endOffset-(isNumberVariable(moveCharacterNumber)?moveCharacterNumber:0),editablePart=parts[getIndexByPartId(externalId,selectionPartId)],editablePartExpLength=editablePart&&editablePart.exp?editablePart.exp.length:-1;expSelection={partId:editResultPartId,type:ExpSelectionType.Char,startOffset:isSelectionPartEdited&&leftCharNumber>=0&&leftCharNumber<=editablePartExpLength?leftCharNumber:editResult[editResultPartIndex]&&isNumberVariable(editResult[editResultPartIndex].startOffset)?editResult[editResultPartIndex].startOffset:0}}else expSelection={partId:editResultPartId,type:ExpSelectionType.Char,startOffset:editResult[editResultPartIndex].startOffset}}}return expSelection}function getExpSelectionAfterSomePartsMerged(externalId,parts,editResult){const mergedPartIndex=getMergedPartIndex(externalId,editResult),doesMergedPartExist=isNumberVariable(mergedPartIndex),editablePartIndex=doesMergedPartExist?mergedPartIndex:parts.length-1,startOffset=doesMergedPartExist?editResult[mergedPartIndex].startOffset:0;return{partId:getPartIdByIndex(externalId,editablePartIndex),type:ExpSelectionType.Char,startOffset}}function getMergedPartIndex(externalId,editResult){const index=Object.keys(editResult).find((index=>editResult[index].part&&isNumberVariable(editResult[index].startOffset)));return parseInt(index)}function getExps(expressionString){let result=function handleStringExps(e){const q=e.split(/([\"])/g).filter((e=>!!e));let t="",isStringStart=!1,isStringEnd=!1;const result=[];return q.forEach(((v,i)=>{'"'===v?(t+=v,isStringEnd=isStringStart,isStringStart=!0,isStringStart&&isStringEnd&&(result.push(t),t="",isStringStart=!1,isStringEnd=!1)):isStringStart?t+=v:result.push(v),i===q.length-1&&isStringStart&&!isStringEnd&&result.push(t)})),result}(expressionString.replace(/\ufeff/g,""));return result=function handleFieldExps(e){let result=e.map((r=>isString(r)?r:r.split(/({[^\{\}]*})/g).filter((e=>!!e))));return result=Array.prototype.concat.apply([],result),result}(result),result=function handleOperatorExps(e){let result=e.map((r=>isString(r)||isField(r)?r:r.split(/(\s*[\+\-\*\/\(\)\s]\s*)/g).filter((e=>!!e))));return result=Array.prototype.concat.apply([],result),result}(result),result}function getEditResultFromPartsFromNewCharacters(partsFromNewCharacters,startIndex,replaceIndex,startOffset,startOffsetIndex){const editResult={};return!partsFromNewCharacters||!isNumberVariable(startIndex)||startIndex<0||partsFromNewCharacters.forEach(((p,i)=>{const isReplacing=isNumberVariable(replaceIndex)&&replaceIndex>-1&&i===replaceIndex,s=isNumberVariable(startOffsetIndex)&&startOffsetIndex>-1&&i===startOffsetIndex?startOffset:null;editResult[startIndex+i]={part:p,isReplacing,startOffset:s}})),editResult}function applyEditResultToParts(editResult,parts=[]){if(!editResult)return parts;const newParts=(parts=parts||[]).slice();let deleteCount=0;const replacingParts=[];return Object.keys(editResult).sort(((i,j)=>parseInt(i)-parseInt(j))).forEach((index=>{deleteCount+=editResult[index].isReplacing?1:0,editResult[index].part&&replacingParts.push(editResult[index].part)})),newParts.splice(Math.min.apply(null,Object.keys(editResult)),deleteCount,...replacingParts),newParts}function getWhetherPartNeedPopover(type){return!!type&&(type===jimu_core.une.Field||type===jimu_core.une.Function||type===jimu_core.une.Order)}function add_remove_utils_getJimuFieldNameFromAlias(dataSourceId,alias){if(!dataSourceId||!alias)return null;const ds=jimu_core.zAk.getInstance().getDataSource(dataSourceId),schema=ds&&ds.getSchema&&ds.getSchema(),fields=schema&&schema.fields;return fields&&Object.keys(fields).sort(((j1,j2)=>j1.localeCompare(j2))).find((jimuFieldName=>(fields[jimuFieldName].alias||fields[jimuFieldName].name)===alias))||null}function getExpressionPart(exp,dataSourceId,isFromRepeatedDataSourceContext,jimuFieldName){return isField(exp)?{type:jimu_core.une.Field,exp,dataSourceId,jimuFieldName:jimuFieldName||add_remove_utils_getJimuFieldNameFromAlias(dataSourceId,exp.replace(/^\{/,"").replace(/\}$/,"")),isFromRepeatedDataSourceContext:!!isFromRepeatedDataSourceContext}:function isFunction(exp){return!!exp&&Object.keys(jimu_core.CIK).some((k=>jimu_core.CIK[k]===exp))}(exp)?{type:jimu_core.une.Function,exp}:function isNumber(exp){return!!exp&&(/^\d*\.?\d+(\d|\s)*$/.test(exp)||/^\d+\.?\d*(\d|\s)*$/.test(exp))}(exp)?{type:jimu_core.une.Number,exp}:isOperator(exp)?{type:jimu_core.une.Operator,exp}:isString(exp)?{type:jimu_core.une.String,exp}:function isOrder(exp){return!!exp&&["ASC","DESC"].includes(exp)}(exp)?{type:jimu_core.une.Order,exp}:{type:jimu_core.une.Unknown,exp}}function removeParts(externalId,parts,startIndex,endIndex){if(!(parts=parts||[])||!isNumberVariable(startIndex)||!isNumberVariable(endIndex))return null;const previousPart=parts[startIndex-1],nextPart=parts[endIndex+1],editResult={};if(previousPart&&nextPart&&!isPartUnmergeable(previousPart)&&!isPartUnmergeable(nextPart)){const newParts=getExps(previousPart.exp+nextPart.exp).map(((e,i)=>getExpressionPart(e)));for(let i=startIndex-1;i<=endIndex+1;i++)editResult[i]={part:newParts[i-(startIndex-1)]||null,isReplacing:!0,startOffset:newParts[i-(startIndex-1)]?previousPart.exp.length:null}}else for(let i=startIndex;i<=endIndex;i++)editResult[i]={part:null,isReplacing:!0,startOffset:null};return editResult}function removeCharactersFromOnePart(externalId,parts,partId,startIndex,endIndex){parts=parts||[];const index=getIndexByPartId(externalId,partId),part=parts&&parts[index];if(!part||!part.exp||!isNumberVariable(startIndex)||!isNumberVariable(endIndex)||startIndex<0||endIndex<0)return null;let editResult={};const toBeRemovedCharacters=part.exp.slice(startIndex,endIndex+1),isFirstCharToBeRemoved=0===startIndex,isLastCharToBeRemoved=endIndex===part.exp.length-1;let newExp;newExp=(isFirstCharToBeRemoved||isLastCharToBeRemoved)&&isCharDoubleQuotationMarker(toBeRemovedCharacters)?part.exp.replace(/^\"/,"").replace(/\"$/,""):isFirstCharToBeRemoved&&isCharFrontCurlyBracket(toBeRemovedCharacters)||isLastCharToBeRemoved&&function isCharPostCurlyBracket(char){return!(!char||"}"!==char)}(toBeRemovedCharacters)?part.exp.replace(/^\{/,"").replace(/\}$/,""):`${part.exp.slice(0,startIndex)}${part.exp.slice(endIndex+1)}`;const newPart=getExpressionPart(newExp,part.dataSourceId,part.isFromRepeatedDataSourceContext,part.jimuFieldName);if(newPart.exp.length>0)if(isPartUnmergeable(newPart))editResult[index]={part:newPart,isReplacing:!0,startOffset:startIndex+1-(endIndex-startIndex+1)};else{const prevPart=parts[index-1],nextPart=parts[index+1],newPartsFromNewExp=getExps(newExp.replace(/\"/g,'""').replace(/\{/g,"{}")).map((exp=>getExpressionPart(exp))),isPrevPartUnmergeable=isPartUnmergeable(prevPart),isNextPartUnmergeable=isPartUnmergeable(nextPart);let extraEditedPartsLength,expStringAfterMerge,startIndexInOriginParts,startOffset;prevPart&&nextPart&&!isPrevPartUnmergeable&&!isNextPartUnmergeable?(expStringAfterMerge=prevPart.exp+newExp+nextPart.exp,extraEditedPartsLength=2):prevPart&&!isPrevPartUnmergeable?(expStringAfterMerge=prevPart.exp+newExp,extraEditedPartsLength=1):nextPart&&!isNextPartUnmergeable?(expStringAfterMerge=newExp+nextPart.exp,extraEditedPartsLength=1):(expStringAfterMerge=newExp,extraEditedPartsLength=0),prevPart&&!isPrevPartUnmergeable?(startIndexInOriginParts=index-1,startOffset=isFirstCharToBeRemoved?prevPart.exp.length:isLastCharToBeRemoved?newPartsFromNewExp[newPartsFromNewExp.length-1].exp.length:0):(startIndexInOriginParts=index,startOffset=isFirstCharToBeRemoved?0:isLastCharToBeRemoved?newPartsFromNewExp[newPartsFromNewExp.length-1].exp.length:0);const newParts=getExps(expStringAfterMerge.replace(/\"/g,'""').replace(/\{/g,"{}")).map((exp=>getExpressionPart(exp))),selectedPartIndex=isFirstCharToBeRemoved?startIndexInOriginParts:isLastCharToBeRemoved?startIndexInOriginParts+newParts.length-1:null;for(let i=startIndexInOriginParts;i<=startIndexInOriginParts+newParts.length+extraEditedPartsLength-1;i++)editResult[i]={part:newParts[i-startIndexInOriginParts]||null,isReplacing:i-startIndexInOriginParts<=extraEditedPartsLength,startOffset:i===selectedPartIndex?startOffset:null}}else editResult=removeParts(0,parts,index,index);return editResult}function getPopoverItems(externalId,partId,parts,useDataSources,widgetId,browserSizeMode){if(!partId||!parts)return[];let popoverItems=[];const index=getIndexByPartId(externalId,partId),part=parts[index];if(part){if(part.type===jimu_core.une.Field){if(part.dataSourceId){const selectedDs=jimu_core.zAk.getInstance().getDataSource(part.dataSourceId),fields=selectedDs&&selectedDs.getSchema&&selectedDs.getSchema().fields;fields&&Object.keys(fields).filter((jimuFieldName=>{const name=fields[jimuFieldName].alias||fields[jimuFieldName].name;return name&&0===name.toLowerCase().indexOf(part.exp.replace(/[\{\}]/g,"").toLowerCase())})).filter((jimuFieldName=>{if(parts[index-1]&&parts[index-1].type===jimu_core.une.Operator&&"("===parts[index-1].exp&&parts[index-2]&&parts[index-2].type===jimu_core.une.Function){const func=parts[index-2].exp;if(func===jimu_core.CIK.Count)return!0;const isFuncMinOrMax=func===jimu_core.CIK.Min||func===jimu_core.CIK.Max;return fields[jimuFieldName].type===jimu_core.Eo3.Number||isFuncMinOrMax&&fields[jimuFieldName].type===jimu_core.Eo3.Date}return!0})).sort(((j1,j2)=>fields[j1].name.localeCompare(fields[j2].name))).forEach((jimuFieldName=>{popoverItems.push({id:jimuFieldName,content:fields[jimuFieldName].alias||fields[jimuFieldName].name,type:PopoverType.Field})}))}else if(useDataSources&&useDataSources.length>0){const isInsideFunction=index>1&&"("===parts[index-1].exp&&parts[index-2].type===jimu_core.une.Function,usePopulatedDataView=!isInsideFunction,supportedUseDss=isInsideFunction?getSupportedUseDataSources(parts[index-2].exp,useDataSources):useDataSources;popoverItems=function getDssPopoverItems(useDataSources,previousUseDataSources){const popoverItems=[];return useDataSources&&useDataSources.asMutable().forEach((u=>{const ds=jimu_core.zAk.getInstance().getDataSource(getRealUseDataSources(u,previousUseDataSources).dataSourceId);if(ds){let label;label=u.dataViewId&&u.dataViewId!==jimu_core.aH5.VA?u.dataViewId===jimu_core.aH5.W7?`${ds.getMainDataSource().getLabel()} / ${jimu_core.Ruy.getIntl().formatMessage({id:"selectionDataView"})}`:u.dataViewId===jimu_core.aH5.RP?`${ds.getMainDataSource().getLabel()} / ${jimu_core.Ruy.getIntl().formatMessage({id:"populatedDataView"})}`:`${ds.getMainDataSource().getLabel()} / ${ds.getLabel()}`:ds.getLabel(),popoverItems.push({id:u.dataSourceId,content:label,type:PopoverType.DataSource})}})),popoverItems}(addAutoAddedDataViews(widgetId,supportedUseDss,browserSizeMode,usePopulatedDataView),supportedUseDss)}}else if(part.type===jimu_core.une.Unknown){let prevPartWhichIsNotSpace,i=index-1;for(;i>-1&&(prevPartWhichIsNotSpace=parts[i],!prevPartWhichIsNotSpace||/^\s*$/.test(prevPartWhichIsNotSpace.exp));)i--;(null==prevPartWhichIsNotSpace?void 0:prevPartWhichIsNotSpace.type)===jimu_core.une.Operator&&","===prevPartWhichIsNotSpace.exp?["ASC","DESC"].filter((o=>0===o.toLowerCase().indexOf(part.exp.toLowerCase()))).forEach((o=>{popoverItems.push({id:o,content:o,type:PopoverType.Order})})):function getSortedKeys(obj){return Object.keys(obj).sort(((ds1,ds2)=>ds1.localeCompare(ds2)))}(jimu_core.CIK).filter((k=>0===jimu_core.CIK[k].toLowerCase().indexOf(part.exp.toLowerCase()))).forEach((k=>{popoverItems.push({id:k,content:jimu_core.CIK[k],type:PopoverType.Function})}))}return popoverItems}}function getPopoverTarget(externalId,isInEditablePart,parts){if(!document||!document.querySelector(`#${externalId}`))return null;let previousNodeOfSelection=getPreviousNodeOfSelection(externalId);for(;previousNodeOfSelection&&parts[getIndexByPartId(externalId,previousNodeOfSelection.id)]&&parts[getIndexByPartId(externalId,previousNodeOfSelection.id)].type===jimu_core.une.Operator;)previousNodeOfSelection=previousNodeOfSelection.previousElementSibling;return!isInEditablePart&&previousNodeOfSelection?previousNodeOfSelection.id:function getPartIdOfSelection(externalId){const range=getSelectionRange();if(range&&range.collapsed&&range.startContainer)return getPartIdByChildNode(externalId,range.startContainer);return null}(externalId)}!function(ExpEditorHelperTabs){ExpEditorHelperTabs.Fields="FIELDS",ExpEditorHelperTabs.Functions="FUNCTIONS"}(ExpEditorHelperTabs||(ExpEditorHelperTabs={}));class ExpEditorHelper extends jimu_core.q_G.PureComponent{constructor(props){var _a,_b;super(props),this.dsManager=jimu_core.zAk.getInstance(),this.__unmount=!1,this.ExpEditorHelperTabs={[ExpEditorHelperTabs.Fields]:this.props.intl.formatMessage({id:"fields",defaultMessage:jimu_ui.defaultMessages.fields}),[ExpEditorHelperTabs.Functions]:this.props.intl.formatMessage({id:"functions",defaultMessage:jimu_ui.defaultMessages.functions})},this.getSelectedFields=()=>{var _a,_b;const editingPartIndex=this.getEditingPartIndex(),editingPart=null===(_b=null===(_a=this.props.expression)||void 0===_a?void 0:_a.parts)||void 0===_b?void 0:_b[editingPartIndex];if((null==editingPart?void 0:editingPart.type)===jimu_core.une.Field){const selectedFieldJimuName=editingPart.jimuFieldName;if(selectedFieldJimuName){const dsId=editingPart.dataSourceId;return dsId?(0,jimu_core.J3Z)({[dsId]:[selectedFieldJimuName]}):null}}return null},this.getSelectedFunction=(considerEditing=!0)=>{var _a,_b;const functionPartIndex=considerEditing?this.getEditingPartIndex():getIndexByPartId(this.props.externalId,this.getSelectionPartId())-1,editingPart=null===(_b=null===(_a=this.props.expression)||void 0===_a?void 0:_a.parts)||void 0===_b?void 0:_b[functionPartIndex];return(null==editingPart?void 0:editingPart.type)===jimu_core.une.Function?editingPart.exp:null},this.onFunctionSelect=functionName=>{if(!functionName)return;const newPart={type:jimu_core.une.Function,exp:functionName};let newParts;newParts=this.getIsReplacing()?[newPart]:[newPart,{type:jimu_core.une.Operator,exp:"("},{type:jimu_core.une.Operator,exp:")"}],this.changeExpression(newParts,this.props.expression)},this.onFieldSelect=(allSelectedFields,ds,isFromRepeatedDataSourceContext)=>{const field=allSelectedFields&&allSelectedFields[0];if(!field||!ds)return;const newPart={type:jimu_core.une.Field,exp:`{${field.alias||field.name}}`,dataSourceId:ds.id,jimuFieldName:field.jimuName,isFromRepeatedDataSourceContext};this.changeExpression([newPart],this.props.expression)},this.onActiveTabChange=tab=>{this.setState({active:tab})},this.getSelectionPartId=()=>{var _a,_b;let partId;if(this.props.inEditablePart){const s=getSelectionPosInnerPart(this.props.externalId,this.props.container);partId=s&&s.partId}else{const n=getPreviousNodeOfSelection(this.props.externalId);partId=n&&n.id}return function isSelectionInNode(node){if(!node)return!1;const range=getSelectionRange();if(!range)return!1;const commonAncestor=range.commonAncestorContainer;return node.contains(commonAncestor)}(document&&(null===(_a=document.querySelector(`#${this.props.externalId}`))||void 0===_a?void 0:_a.parentElement))||(partId=null),partId=partId||(null===(_b=this.props.expSelection)||void 0===_b?void 0:_b.partId),partId||(partId=getPartIdByIndex(this.props.externalId,0)),partId},this.changeExpression=(newParts,expression)=>{if(!newParts)return;const isReplacing=this.getIsReplacing(),newIndex=this.getNewPartIndex(newParts,expression,isReplacing),newPartId=getPartIdByIndex(this.props.externalId,newIndex);let p=expression&&expression.parts&&expression.parts.slice()||[];if(0===p.length)p=newParts;else{const deleteNum=isReplacing?1:0;p.splice(newIndex,deleteNum,...newParts)}this.props.onSelect({name:expression&&expression.name||this.props.externalId,parts:p},newPartId,isReplacing)},this.getNewPartIndex=(newParts,expression,isReplacing)=>{var _a,_b,_c;if(!newParts)return null;let newIndex;if(0===(expression&&expression.parts||[]).length)newIndex=0;else if(isReplacing)newIndex=this.getEditingPartIndex();else{const selectionPartId=this.getSelectionPartId();let index=getIndexByPartId(this.props.externalId,selectionPartId);selectionPartId===(null===(_a=this.props.expSelection)||void 0===_a?void 0:_a.partId)&&((null===(_b=this.props.expSelection)||void 0===_b?void 0:_b.type)===ExpSelectionType.Char&&0===this.props.expSelection.startOffset||(null===(_c=this.props.expSelection)||void 0===_c?void 0:_c.type)===ExpSelectionType.Part&&this.props.expSelection.toStart)&&index--,newIndex=function areFunctionParts(parts){if(!parts)return!1;const startWithFunctionPart=parts[0]&&parts[0].type===jimu_core.une.Function,parenthesesAfterFunctionName=parts[1]&&parts[1].type===jimu_core.une.Operator&&"("===parts[1].exp,endWithParenthesesOperatorPart=parts[parts.length-1]&&parts[parts.length-1].type===jimu_core.une.Operator&&")"===parts[parts.length-1].exp;return startWithFunctionPart&&parenthesesAfterFunctionName&&endWithParenthesesOperatorPart}(newParts)?index+1:index+newParts.length}return newIndex},this.getEditingPartIndex=()=>{if(!this.props.inEditablePart)return null;const selectionPartId=this.getSelectionPartId();return getIndexByPartId(this.props.externalId,selectionPartId)},this.getIsReplacing=()=>{var _a,_b;const editingPartIndex=this.getEditingPartIndex(),editingPart=null===(_b=null===(_a=this.props.expression)||void 0===_a?void 0:_a.parts)||void 0===_b?void 0:_b[editingPartIndex];return(null==editingPart?void 0:editingPart.type)===jimu_core.une.Field||(null==editingPart?void 0:editingPart.type)===jimu_core.une.Function};const editingPartIndex=this.getEditingPartIndex(),editingPart=null===(_b=null===(_a=this.props.expression)||void 0===_a?void 0:_a.parts)||void 0===_b?void 0:_b[editingPartIndex];this.state={active:(null==editingPart?void 0:editingPart.type)===jimu_core.une.Function?ExpEditorHelperTabs.Functions:ExpEditorHelperTabs.Fields,FieldSelector:null}}componentDidMount(){this.__unmount=!1,Promise.all([__webpack_require__.e(6990),__webpack_require__.e(8012),__webpack_require__.e(2497)]).then(__webpack_require__.bind(__webpack_require__,"../jimu-ui/advanced/data-source-selector.tsx")).then((clazz=>{!this.__unmount&&this.setState({FieldSelector:clazz.FieldSelector})}))}componentDidUpdate(prevProps){var _a,_b;if(prevProps.expSelection!==this.props.expSelection&&this.getIsReplacing()){const editingPartIndex=this.getEditingPartIndex(),editingPart=null===(_b=null===(_a=this.props.expression)||void 0===_a?void 0:_a.parts)||void 0===_b?void 0:_b[editingPartIndex];this.setState({active:(null==editingPart?void 0:editingPart.type)===jimu_core.une.Function?ExpEditorHelperTabs.Functions:ExpEditorHelperTabs.Fields})}}componentWillUnmount(){this.__unmount=!0}render(){if(!this.props.container)return null;const FieldSelector=this.state.FieldSelector;return jimu_core.q_G.createElement("div",{className:"exp-editor-helper h-100"},jimu_core.q_G.createElement(jimu_ui.Tabs,{fill:!0,type:"pills",className:"h-100",value:this.state.active,onChange:this.onActiveTabChange},jimu_core.q_G.createElement(jimu_ui.Tab,{id:ExpEditorHelperTabs.Fields,key:ExpEditorHelperTabs.Fields,title:this.ExpEditorHelperTabs[ExpEditorHelperTabs.Fields]},FieldSelector&&jimu_core.q_G.createElement(FieldSelector,{widgetId:this.props.widgetId,useDataSources:getSupportedUseDataSources(this.getSelectedFunction(!1),this.props.useDataSources),onChange:this.onFieldSelect,useSelectionDataView:!0,usePopulatedDataView:!0,selectedFields:this.getSelectedFields()})),jimu_core.q_G.createElement(jimu_ui.Tab,{id:ExpEditorHelperTabs.Functions,key:ExpEditorHelperTabs.Functions,title:this.ExpEditorHelperTabs[ExpEditorHelperTabs.Functions]},jimu_core.q_G.createElement(FunctionSelector,{onSelect:this.onFunctionSelect,selectedFunction:this.getSelectedFunction()}))))}}const FunctionSelector=({onSelect,selectedFunction})=>jimu_core.q_G.createElement("div",{className:"mt-18 px-4"},Object.keys(jimu_core.CIK).map(((f,i)=>jimu_core.q_G.createElement("div",{onClick:()=>{onSelect(jimu_core.CIK[f])},key:i,className:(0,jimu_core.xWm)("mt-3 p-1 expression-editor-function-item",{"expression-editor-function-item-selected":selectedFunction===jimu_core.CIK[f]}),tabIndex:0},jimu_core.CIK[f]))));try{expeditorhelper.displayName="expeditorhelper",expeditorhelper.__docgenInfo={description:"",displayName:"expeditorhelper",props:{expression:{defaultValue:null,description:"",name:"expression",required:!0,type:{name:"Expression"}},useDataSources:{defaultValue:null,description:"",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},externalId:{defaultValue:null,description:"",name:"externalId",required:!0,type:{name:"string"}},expSelection:{defaultValue:null,description:"",name:"expSelection",required:!0,type:{name:"ExpSelection"}},inEditablePart:{defaultValue:null,description:"",name:"inEditablePart",required:!0,type:{name:"boolean"}},container:{defaultValue:null,description:"",name:"container",required:!0,type:{name:"HTMLElement"}},intl:{defaultValue:null,description:"",name:"intl",required:!0,type:{name:"IntlShape"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!0,type:{name:"string"}},onSelect:{defaultValue:null,description:"e: new expression\npartId: id of added new part\nisReplacing: if true, will replace a existed part with new part (only when is in editable part and the part is field or function)",name:"onSelect",required:!0,type:{name:"(e: Expression, partId: string, isReplacing: boolean) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/exp-editor-helper.tsx#expeditorhelper"]={docgenInfo:expeditorhelper.__docgenInfo,name:"expeditorhelper",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/exp-editor-helper.tsx#expeditorhelper"})}catch(__react_docgen_typescript_loader_error){}class order_exp_NumberExp extends jimu_core.q_G.PureComponent{render(){return jimu_core.q_G.createElement(ExpBase,Object.assign({},this.props,{className:(0,jimu_core.xWm)("order-exp",{[this.props.className]:!!this.props.className}),style:this.props.style,tabIndex:0}))}}try{orderexp.displayName="orderexp",orderexp.__docgenInfo={description:"",displayName:"orderexp",props:{exp:{defaultValue:null,description:"",name:"exp",required:!0,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/order-exp.tsx#orderexp"]={docgenInfo:orderexp.__docgenInfo,name:"orderexp",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/components/order-exp.tsx#orderexp"})}catch(__react_docgen_typescript_loader_error){}class _ExpressionEditor extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.expressionString="",this.ltrStyle={direction:"ltr"},this.getFocusOnce=!1,this.resizeHelperContainer=()=>{var _a,_b,_c,_d;const editorHeight=(null===(_b=null===(_a=this.contentEditableContainer)||void 0===_a?void 0:_a.current)||void 0===_b?void 0:_b.offsetHeight)||0,errorMsgHeight=(null===(_d=null===(_c=this.errorMsgContainer)||void 0===_c?void 0:_c.current)||void 0===_d?void 0:_d.offsetHeight)||0;this.helperContainer.current.style.height=`calc(100% - 30px - ${editorHeight}px - ${errorMsgHeight}px)`},this.setSelectionToEnd=()=>{this.setState({isPopoverOpen:!1,expSelection:{partId:this.props.expression&&this.props.expression.parts&&getPartIdByIndex(this.id,this.props.expression.parts.length-1)||getPartIdByIndex(this.id,0),type:ExpSelectionType.Part,toStart:!1}})},this.getWhetherLoseFocus=()=>{const s=window.getSelection&&window.getSelection();return!(s&&this.contentEditableContainer&&this.contentEditableContainer.current.contains(s.focusNode)&&this.contentEditableContainer.current!==s.focusNode)},this.getExpressionString=container=>{const c=container||this.contentEditableContainer?this.contentEditableContainer.current:document,p=c&&c.querySelector(`#${this.id}`);return p?p.textContent.replace(/\ufeff/g,""):""},this.getComponent=(part,index)=>{var _a;const id=getPartIdByIndex(this.id,index),isInEditablePart=this.getWhetherInEditablePart();switch(part.type){case jimu_core.une.Field:return(0,jimu_core.Yac)(FieldExp,{exp:part.exp,id,key:index,isDsDisabled:!getWhetherUseDssMatchExpDss(part,this.props.useDataSources),isEditable:isInEditablePart&&this.state.expSelection.partId===id,dataSourceId:part.dataSourceId,isError:!jimu_core.sNq.getWhetherFieldInDs(part.dataSourceId,part.jimuFieldName,part.exp.replace(/^\{/,"").replace(/\}$/,""))});case jimu_core.une.String:return(0,jimu_core.Yac)(StringExp,{exp:part.exp,id,key:index,isEditable:isInEditablePart&&this.state.expSelection.partId===id});case jimu_core.une.Operator:return(0,jimu_core.Yac)(Operator,{exp:part.exp,id,key:index,isEditable:isInEditablePart&&this.state.expSelection.partId===id});case jimu_core.une.Function:return(0,jimu_core.Yac)(FunctionExp,{exp:part.exp,id,key:index,isDsDisabled:!getWhetherUseDssMatchExpDss(part,this.props.useDataSources),isEditable:isInEditablePart&&this.state.expSelection.partId===id,externalId:this.id,dataSourceIds:null===(_a=this.props.useDataSources)||void 0===_a?void 0:_a.map((u=>u.dataSourceId))});case jimu_core.une.Number:return(0,jimu_core.Yac)(NumberExp,{exp:part.exp,id,key:index,isEditable:isInEditablePart&&this.state.expSelection.partId===id});case jimu_core.une.Order:return(0,jimu_core.Yac)(order_exp_NumberExp,{exp:part.exp,id,key:index,isEditable:isInEditablePart&&this.state.expSelection.partId===id});case jimu_core.une.Unknown:return(0,jimu_core.Yac)(ErrorExp,{exp:part.exp,id,key:index,isEditable:isInEditablePart&&this.state.expSelection.partId===id});default:const exhaustiveCheck=part.type;throw new Error(`Unhandled case: ${exhaustiveCheck}`)}},this.getWhetherInEditablePart=()=>!(!this.state.expSelection||this.state.expSelection.type!==ExpSelectionType.Char),this.getSingleExpFromPopoverItem=item=>item.type===PopoverType.Field?`{${item.content}}`:item.content,this.renderPartsToHtml=parts=>server_browser.qV((0,jimu_core.Yac)("p",{id:this.id,className:"w-100 m-0 p-1",spellCheck:!1,style:{textAlign:"left"}},"\ufeff",parts&&parts.map(((p,i)=>this.getComponent(p,i))),"\ufeff")),this.getNewExpression=parts=>({parts,name:this.props.expression&&this.props.expression.name||this.id}),this.onChange=e=>{var _a;const parentNode=e.currentTarget.querySelector(`#${this.id}`);if(!parentNode||!e.isTrusted)return;const expressionString=this.getExpressionString(parentNode),newCharacters=function getNewCharacterFromExpressionString(previousExpressionString,expressionString){const pre=previousExpressionString.split("");return expressionString.split("").find(((c,i)=>c!==pre[i]))}(this.expressionString,expressionString);if(!newCharacters)return;const isInEditablePart=this.getWhetherInEditablePart(),originalParts=this.props.expression&&this.props.expression.parts,range=isInEditablePart?getSelectionRange():null,nextNodeOfSelection=getNextNodeOfSelection(this.id),editResult=function addCharactersToParts(externalId,parts,newCharacters,isInEditablePart,dsIds,range,nextNodeOfSelection){let editResult={};if(!newCharacters)return editResult;parts=(parts=parts||[])||[];const nextPartIndex=nextNodeOfSelection?getIndexByPartId(externalId,nextNodeOfSelection.id):parts.length,completeQuotationAndBracketNewChars=isCharDoubleQuotationMarker(newCharacters)?'""':isCharFrontCurlyBracket(newCharacters)?"{}":newCharacters,partsFromNewCharacters=getExps(completeQuotationAndBracketNewChars).map((exp=>getExpressionPart(exp))),isFirstPartUnmergeable=partsFromNewCharacters[0]&&1===partsFromNewCharacters[0].exp.length?isCharacterUnmergeable(partsFromNewCharacters[0].exp):isPartUnmergeable(partsFromNewCharacters[0]),isLastPartUnmergeable=partsFromNewCharacters[partsFromNewCharacters.length-1]&&1===partsFromNewCharacters[partsFromNewCharacters.length-1].exp.length?isCharacterUnmergeable(partsFromNewCharacters[partsFromNewCharacters.length-1].exp):isPartUnmergeable(partsFromNewCharacters[partsFromNewCharacters.length-1]);if(isInEditablePart){const currentPartIndex=nextPartIndex-1>0?nextPartIndex-1:0,currentPart=parts[currentPartIndex],isCurrentPartUnmergeable=isPartUnmergeable(currentPart),startOffset=range&&range.startOffset,startContainer=range&&range.startContainer,isAddingToStart=!(!startOffset||startOffset!==newCharacters.length),isAddingToEnd=!(!startOffset||!startContainer||startOffset!==startContainer.textContent.length);if(isCurrentPartUnmergeable)if(isAddingToStart){const previousPartIndex=currentPartIndex-1,previousPart=parts[previousPartIndex];if(isPartUnmergeable(previousPart)||isFirstPartUnmergeable)editResult=getEditResultFromPartsFromNewCharacters(partsFromNewCharacters,currentPartIndex);else{const p=getExps(previousPart.exp+completeQuotationAndBracketNewChars).map((exp=>getExpressionPart(exp)));editResult=getEditResultFromPartsFromNewCharacters(p,previousPartIndex,0,p[p.length-1].exp.length,p.length-1)}}else if(isAddingToEnd){const nextPart=parts[nextPartIndex];if(isPartUnmergeable(nextPart)||isLastPartUnmergeable)editResult=getEditResultFromPartsFromNewCharacters(partsFromNewCharacters,nextPartIndex);else{const p=getExps(completeQuotationAndBracketNewChars+nextPart.exp).map((exp=>getExpressionPart(exp))),startOffset=p[p.length-1].exp.length-nextPart.exp.length>-1?p[p.length-1].exp.length-nextPart.exp.length:p[p.length-1].exp.length;editResult=getEditResultFromPartsFromNewCharacters(p,nextPartIndex,p.length-1,startOffset,p.length-1)}}else{const currentPart=parts[currentPartIndex],exp=startContainer&&startContainer.textContent,updatedCurrentPart=currentPart&&exp&&getExpressionPart(exp,currentPart.dataSourceId,currentPart.isFromRepeatedDataSourceContext,currentPart.jimuFieldName);editResult[currentPartIndex]={part:updatedCurrentPart,isReplacing:!0,startOffset:range&&range.startOffset}}else if(isAddingToStart)if(isLastPartUnmergeable)editResult=getEditResultFromPartsFromNewCharacters(partsFromNewCharacters,currentPartIndex);else{const p=getExps(completeQuotationAndBracketNewChars+currentPart.exp).map((exp=>getExpressionPart(exp))),s=p[p.length-1].exp.length-currentPart.exp.length>-1?p[p.length-1].exp.length-currentPart.exp.length:p[p.length-1].exp.length;editResult=getEditResultFromPartsFromNewCharacters(p,currentPartIndex,p.length-1,s,p.length-1)}else if(isAddingToEnd)if(isFirstPartUnmergeable)editResult=getEditResultFromPartsFromNewCharacters(partsFromNewCharacters,nextPartIndex);else{const p=getExps(currentPart.exp+completeQuotationAndBracketNewChars).map((exp=>getExpressionPart(exp)));editResult=getEditResultFromPartsFromNewCharacters(p,currentPartIndex,0,p[0].exp.length,0)}else{const partsFromExpString=getExps((startContainer&&startContainer.textContent).replace(/\"/g,'""').replace(/\{/g,"{}")).map((exp=>getExpressionPart(exp)));editResult=getEditResultFromPartsFromNewCharacters(partsFromExpString,currentPartIndex,0,1===partsFromExpString.length?startOffset:partsFromExpString[partsFromExpString.length-1].exp.length,1===partsFromExpString.length?0:partsFromExpString.length-1)}}else{const nextPart=parts[nextPartIndex],previousPartIndex=nextPartIndex-1>0?nextPartIndex-1:0,previousPart=parts[previousPartIndex],isPreviousPartUnmergeable=isPartUnmergeable(previousPart),isNextPartUnmergeable=isPartUnmergeable(nextPart);if(isPreviousPartUnmergeable&&isNextPartUnmergeable)editResult=getEditResultFromPartsFromNewCharacters(partsFromNewCharacters,nextPartIndex);else if(isNextPartUnmergeable)if(isPreviousPartUnmergeable)console.warn("One mergeable part can not be next to another mergeable part");else if(isFirstPartUnmergeable)editResult=getEditResultFromPartsFromNewCharacters(partsFromNewCharacters,nextPartIndex);else{const p=getExps(previousPart.exp+completeQuotationAndBracketNewChars).map((exp=>getExpressionPart(exp)));editResult=getEditResultFromPartsFromNewCharacters(p,previousPartIndex,0,p[0].exp.length,0)}else if(isLastPartUnmergeable)editResult=getEditResultFromPartsFromNewCharacters(partsFromNewCharacters,nextPartIndex);else{const p=getExps(completeQuotationAndBracketNewChars+nextPart.exp).map((exp=>getExpressionPart(exp))),startOffset=p[p.length-1].exp.length-nextPart.exp.length>-1?p[p.length-1].exp.length-nextPart.exp.length:p[p.length-1].exp.length;editResult=getEditResultFromPartsFromNewCharacters(p,nextPartIndex,p.length-1,startOffset,p.length-1)}}return editResult}(this.id,originalParts,newCharacters,isInEditablePart,null===(_a=this.props.useDataSources)||void 0===_a||_a.asMutable().map((u=>u.dataSourceId)),range,nextNodeOfSelection),parts=applyEditResultToParts(editResult,originalParts),innerSelection=isInEditablePart?getSelectionPosInnerPart(this.id,document&&document.querySelector(`#${this.id}`)):null,expSelection=getExpSelectionAndEditablePart(this.id,isInEditablePart,editResult,parts,innerSelection);this.setState({isPopoverOpen:!1,expSelection},(()=>{this.setState({isPopoverOpen:!0})})),this.props.onChange(this.getNewExpression(parts))},this.onClick=e=>{const partId=getPartIdByChildNode(this.id,e.target),index=getIndexByPartId(this.id,partId);if(!isNumberVariable(index)||index<0)return void((e.target===this.contentEditableContainer.current||this.contentEditableContainer.current.contains(e.target))&&this.setSelectionToEnd());const partNode=index>-1?getNodeByPartId(partId,this.contentEditableContainer.current):null;if(partNode&&this.state.expSelection&&(this.state.expSelection.type!==ExpSelectionType.Char||getIndexByPartId(this.id,this.state.expSelection.partId)!==index)&&this.props.expression&&this.props.expression.parts&&this.props.expression.parts[index]){const expSelection={partId,type:ExpSelectionType.Char,startOffset:partNode.textContent.length};this.setState({expSelection,isPopoverOpen:!1},(()=>{this.setState({isPopoverOpen:getWhetherPartNeedPopover(this.props.expression.parts[index].type)})}))}},this.onDoubleClick=e=>{const partId=getPartIdByChildNode(this.id,e.target),index=getIndexByPartId(this.id,partId);if(!isNumberVariable(index)||index<0)return void((e.target===this.contentEditableContainer.current||this.contentEditableContainer.current.contains(e.target))&&this.setSelectionToEnd());const partNode=index>-1?getNodeByPartId(partId,this.contentEditableContainer.current):null;if(partNode){const expSelection={partId,type:ExpSelectionType.Char,startOffset:partNode.textContent.length,collapse:!1};this.setState({expSelection,isPopoverOpen:!1},(()=>{this.setState({isPopoverOpen:getWhetherPartNeedPopover(this.props.expression.parts[index].type)})}))}},this.onHelperItemSelect=(e,partId,isReplacing)=>{if(this.props.onChange(e),e&&e.parts&&partId){const index=getIndexByPartId(this.id,partId),part=e.parts[index];if(!part)return void console.warn("Can not move selection because can not find part: ",partId);const isPopoverOpen=!1;let expSelection={type:ExpSelectionType.Char,partId,startOffset:part.exp.length};part.type===jimu_core.une.Function&&(isReplacing||(expSelection={type:ExpSelectionType.Part,partId:getPartIdByIndex(this.id,getIndexByPartId(this.id,partId)+1),toStart:!1})),this.setState({expSelection,isPopoverOpen:!1},(()=>{this.setState({isPopoverOpen})}))}},this.onBlur=e=>{this.props.onChange(this.props.expression)},this.onKeyDown=e=>{if(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),["Backspace","Delete","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key))e.preventDefault(),"Backspace"!==e.key&&"Delete"!==e.key||function triggerInputEvent(element){if(!element)return;const e=new Event("input",{bubbles:!0,cancelable:!0});element.dispatchEvent(e)}(e.currentTarget),"Backspace"===e.key?this.handleBackspace():"Delete"===e.key?this.handleDelete():"ArrowLeft"===e.key?this.handleLeftArrow():"ArrowRight"===e.key?this.handleRightArrow():"Enter"===e.key?this.handleEnter():"ArrowDown"===e.key?this.handleDownArrow():"ArrowUp"===e.key&&this.handleUpArrow();else if(e.keyCode>=48&&e.keyCode<=57||e.keyCode>=65&&e.keyCode<=90){getSelectionRange().collapsed||this.handleBackspace()}},this.handleBackspace=()=>{const originalParts=this.props.expression&&this.props.expression.parts;let editResult,removedCharNumber;if(this.getWhetherInEditablePart()){const innerSelection=getSelectionPosInnerPart(this.id,this.contentEditableContainer.current);if(innerSelection&&innerSelection.partId){const startIndex=innerSelection.startOffset===innerSelection.endOffset?innerSelection.startOffset-1:innerSelection.startOffset,endIndex=innerSelection.endOffset-1;editResult=removeCharactersFromOnePart(this.id,originalParts,innerSelection.partId,startIndex,endIndex),removedCharNumber=endIndex-startIndex+1}}else{const startIndexOfSelection=getStartPartIndexOfRangeSelection(this.id),endIndexOfSelection=getEndPartIndexOfRangeSelection(this.id,originalParts);editResult=removeParts(this.id,originalParts,startIndexOfSelection,endIndexOfSelection),removedCharNumber=0}this.doRemove(editResult,originalParts,removedCharNumber)},this.handleDelete=()=>{const originalParts=this.props.expression&&this.props.expression.parts;let editResult,removedCharNumber;if(this.getWhetherInEditablePart()){const innerSelection=getSelectionPosInnerPart(this.id,this.contentEditableContainer.current);if(innerSelection&&innerSelection.partId){const startIndex=innerSelection.startOffset,endIndex=innerSelection.startOffset===innerSelection.endOffset?innerSelection.endOffset:innerSelection.endOffset-1;editResult=removeCharactersFromOnePart(this.id,originalParts,innerSelection.partId,startIndex,endIndex),removedCharNumber=startIndex===endIndex?0:endIndex-startIndex+1}}else{const startIndexOfSelection=getStartPartIndexOfRangeSelection(this.id),endIndexOfSelection=getEndPartIndexOfRangeSelection(this.id,originalParts),range=getSelectionRange(),startIndexToBeRemoved=range.collapsed?isNumberVariable(startIndexOfSelection)?startIndexOfSelection+1:0:startIndexOfSelection,endIndexToBeRemoved=range.collapsed?isNumberVariable(startIndexOfSelection)?startIndexOfSelection+1:0:endIndexOfSelection;editResult=removeParts(this.id,originalParts,startIndexToBeRemoved,endIndexToBeRemoved),removedCharNumber=0}this.doRemove(editResult,originalParts,removedCharNumber)},this.doRemove=(editResult,originalParts,removedCharNumber)=>{const parts=applyEditResultToParts(editResult,originalParts),isInEditablePart=this.getWhetherInEditablePart(),innerSelection=isInEditablePart?getSelectionPosInnerPart(this.id,document&&document.querySelector(`#${this.id}`)):null,expSelection=editResult?getExpSelectionAndEditablePart(this.id,isInEditablePart,editResult,parts,innerSelection,removedCharNumber):this.state.expSelection;this.props.onChange(this.getNewExpression(parts)),this.setState({isPopoverOpen:!1,expSelection},(()=>{this.setState({isPopoverOpen:expSelection.partId&&parts[getIndexByPartId(this.id,expSelection.partId)]&&getWhetherPartNeedPopover(parts[getIndexByPartId(this.id,expSelection.partId)].type)})}))},this.handleLeftArrow=()=>{if(this.getWhetherInEditablePart()){const innerSelection=getSelectionPosInnerPart(this.id,this.contentEditableContainer.current);if(innerSelection&&innerSelection.partId){const expSelection=innerSelection.startOffset-1>-1?{type:ExpSelectionType.Char,partId:innerSelection.partId,startOffset:innerSelection.startOffset-1}:getSiblingOfExpSelection(this.id,innerSelection.partId,!0,0,this.props.expression&&this.props.expression.parts);this.setState({expSelection,isPopoverOpen:!1})}}else{const previousNodeOfSelection=getPreviousNodeOfSelection(this.id);previousNodeOfSelection&&this.setState({expSelection:{partId:previousNodeOfSelection.id,toStart:!0,type:ExpSelectionType.Part},isPopoverOpen:!1})}},this.handleRightArrow=()=>{if(this.getWhetherInEditablePart()){const innerSelection=getSelectionPosInnerPart(this.id,this.contentEditableContainer.current);if(innerSelection&&innerSelection.partId){const expSelection=innerSelection.startOffset+1<=innerSelection.contentLength?{type:ExpSelectionType.Char,partId:innerSelection.partId,startOffset:innerSelection.startOffset+1}:getSiblingOfExpSelection(this.id,innerSelection.partId,!1,0,this.props.expression&&this.props.expression.parts);this.setState({expSelection,isPopoverOpen:!1})}}else{const nextNodeOfSelection=getNextNodeOfSelection(this.id);nextNodeOfSelection&&this.setState({expSelection:{partId:nextNodeOfSelection.id,toStart:!1,type:ExpSelectionType.Part},isPopoverOpen:!1})}},this.handleDownArrow=()=>{if(this.state.isPopoverOpen){const popoverTarget=getPopoverTarget(this.id,this.getWhetherInEditablePart(),this.props.expression&&this.props.expression.parts),popoverItems=getPopoverItems(this.id,popoverTarget,this.props.expression&&this.props.expression.parts,this.props.useDataSources,this.props.widgetId,this.props.browserSizeMode);let selectedPopoverItemIndex=this.state.selectedPopoverItemIndex;selectedPopoverItemIndex=selectedPopoverItemIndex?parseInt(selectedPopoverItemIndex)<popoverItems.length-1?`${parseInt(this.state.selectedPopoverItemIndex)+1}`:""+(popoverItems.length-1):"0",this.setState({selectedPopoverItemIndex})}},this.handleUpArrow=()=>{if(this.state.isPopoverOpen){const popoverTarget=getPopoverTarget(this.id,this.getWhetherInEditablePart(),this.props.expression&&this.props.expression.parts),popoverItems=getPopoverItems(this.id,popoverTarget,this.props.expression&&this.props.expression.parts,this.props.useDataSources,this.props.widgetId,this.props.browserSizeMode);let selectedPopoverItemIndex=this.state.selectedPopoverItemIndex;selectedPopoverItemIndex=selectedPopoverItemIndex?parseInt(selectedPopoverItemIndex)>0?""+(parseInt(this.state.selectedPopoverItemIndex)-1):"0":""+(popoverItems.length-1),this.setState({selectedPopoverItemIndex})}},this.handleEnter=()=>{if(this.state.isPopoverOpen&&this.state.selectedPopoverItemIndex){const popoverTarget=getPopoverTarget(this.id,this.getWhetherInEditablePart(),this.props.expression&&this.props.expression.parts),popoverItems=getPopoverItems(this.id,popoverTarget,this.props.expression&&this.props.expression.parts,this.props.useDataSources,this.props.widgetId,this.props.browserSizeMode);this.setState({selectedPopoverItemIndex:null}),this.handlePopoverItemClick(popoverItems[this.state.selectedPopoverItemIndex],popoverTarget)}else{const partsLength=this.props.expression&&this.props.expression.parts&&this.props.expression.parts.length||0;this.setState({isPopoverOpen:!1,expSelection:{partId:this.state.expSelection&&this.state.expSelection.type===ExpSelectionType.Char?this.state.expSelection.partId:getPartIdByIndex(this.id,partsLength>0?partsLength-1:0),toStart:!1,type:ExpSelectionType.Part}})}},this.handlePopoverItemClick=(item,partId)=>{if(!item||!partId)return;const newParts=this.props.expression&&this.props.expression.parts?this.props.expression.parts.slice():[];item.type===PopoverType.Field?this.handleFieldPopoverClick(newParts,partId,item):item.type===PopoverType.DataSource?this.handleDsPopoverClick(newParts,partId,item):item.type===PopoverType.Function?this.handleFunctionPopoverClick(newParts,partId,item):item.type===PopoverType.Order&&this.handleOrderPopoverClick(newParts,partId,item)},this.handleFieldPopoverClick=(newParts,partId,item)=>{newParts=newParts||[];const index=getIndexByPartId(this.id,partId),dsId=newParts[index].dataSourceId,newPart=getExpressionPart(this.getSingleExpFromPopoverItem(item),dsId,newParts[index].isFromRepeatedDataSourceContext,item.id);newParts.splice(index,1,newPart);const expSelection={partId:getPartIdByIndex(this.id,index),toStart:!1,type:ExpSelectionType.Part};this.setState({isPopoverOpen:!1,expSelection}),this.props.onChange(this.getNewExpression(newParts))},this.handleDsPopoverClick=(parts,partId,item)=>{parts=parts||[];const index=getIndexByPartId(this.id,partId),newParts=parts.slice();if(item.id.split("-").reverse()[0]===jimu_core.aH5.RP){const mainDataSourceId=item.id.split("-").reverse().slice(1).reverse().join("-"),realUseDs=getRealUseDataSources((0,jimu_core.J3Z)({dataSourceId:item.id,mainDataSourceId,dataViewId:jimu_core.aH5.RP}),this.props.useDataSources);newParts[index].isFromRepeatedDataSourceContext=!0,newParts[index].dataSourceId=realUseDs&&realUseDs.dataSourceId}else newParts[index].dataSourceId=item.id;const expSelection={partId,type:ExpSelectionType.Char,startOffset:newParts[index].exp.length-1};this.props.onChange(this.getNewExpression(newParts)),this.setState({isPopoverOpen:!1,expSelection},(()=>{this.setState({isPopoverOpen:!0})}))},this.handleFunctionPopoverClick=(newParts,partId,item)=>{newParts=newParts||[];const index=getIndexByPartId(this.id,partId),newPart=getExpressionPart(this.getSingleExpFromPopoverItem(item)),expSelection={partId:getPartIdByIndex(this.id,index+1),type:ExpSelectionType.Part,toStart:!1};newParts.splice(index,1,newPart,{type:jimu_core.une.Operator,exp:"("},{type:jimu_core.une.Operator,exp:")"}),this.props.onChange(this.getNewExpression(newParts)),this.setState({isPopoverOpen:!1,expSelection})},this.handleOrderPopoverClick=(newParts,partId,item)=>{newParts=newParts||[];const index=getIndexByPartId(this.id,partId),newPart=getExpressionPart(this.getSingleExpFromPopoverItem(item)),expSelection={partId:getPartIdByIndex(this.id,index),type:ExpSelectionType.Part,toStart:!1};newParts.splice(index,1,newPart),this.props.onChange(this.getNewExpression(newParts)),this.setState({isPopoverOpen:!1,expSelection})},_ExpressionEditor.count++,this.id=`expression-${_ExpressionEditor.count}`,this.contentEditableContainer=jimu_core.q_G.createRef(),this.helperContainer=jimu_core.q_G.createRef(),this.state={isPopoverOpen:!1,isEditorMounted:!1,expSelection:null,selectedPopoverItemIndex:null}}componentDidMount(){this.resizeObserver=new ResizeObserver(this.resizeHelperContainer),this.resizeObserver.observe(this.contentEditableContainer.current),this.expressionString=this.getExpressionString()||"",this.props.autoFocus&&(this.getFocusOnce=!0,this.props.expression&&this.props.expression.parts&&1===this.props.expression.parts.length&&this.props.expression.parts[0].type===jimu_core.une.String?this.setState({expSelection:{partId:getPartIdByIndex(this.id,0),type:ExpSelectionType.Char,startOffset:this.props.expression.parts[0].exp.length-1}}):((0,jimu_core.u02)(this.contentEditableContainer.current,!0),this.setSelectionToEnd())),this.setState({isEditorMounted:!0}),this.contentEditableContainer.current.ondragstart=()=>!1,this.contentEditableContainer.current.onpaste=()=>!1}componentDidUpdate(prevProps,prevState){this.state.expSelection&&this.state.expSelection.partId&&(prevState.expSelection!==this.state.expSelection||this.props.autoFocus&&!this.getFocusOnce&&this.getWhetherLoseFocus())&&(this.getFocusOnce=!0,this.state.expSelection.type===ExpSelectionType.Part?function moveSelectionByPart(partId,toStart,container){const node=getNodeByPartId(partId,container);if(node){if(window.getSelection&&document&&document.createRange){const r=document.createRange();node&&(r.selectNode(node),r.collapse(toStart),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}}else(0,jimu_core.u02)(container)}(this.state.expSelection.partId,this.state.expSelection.toStart,this.contentEditableContainer.current):this.state.expSelection.type===ExpSelectionType.Char&&moveSelectionByCharacter(this.state.expSelection.partId,this.state.expSelection.startOffset,this.contentEditableContainer.current,this.state.expSelection.collapse)),prevProps.expression!==this.props.expression&&(this.props.expression&&this.props.expression.parts?this.expressionString=this.getExpressionString():this.expressionString="")}componentWillUnmount(){this.resizeObserver.disconnect()}render(){var _a;let popoverTarget;this.state.isPopoverOpen&&(popoverTarget=getPopoverTarget(this.id,this.getWhetherInEditablePart(),this.props.expression&&this.props.expression.parts));let html=this.renderPartsToHtml(this.props.expression&&this.props.expression.parts);html=html&&html.replace(/&quot;/g,'"');const isValid=jimu_core.sNq.getWhetherExpressionValid(this.props.expression);return(0,jimu_core.Yac)(jimu_core.P0p,{useDataSources:this.props.useDataSources},(0,jimu_core.Yac)("div",{style:this.props.style,onClick:this.onClick,className:(0,jimu_core.xWm)("w-100 h-100",{[this.props.className]:!!this.props.className})},(0,jimu_core.Yac)("div",{className:"w-100 h-100 component-expression-editor"},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("w-100 expression-editor-input",{"error-border":!isValid})},(0,jimu_core.Yac)(react_contenteditable_default(),{innerRef:this.contentEditableContainer,html,disabled:!(!this.state.expSelection||this.state.expSelection.type!==ExpSelectionType.Char),onChange:this.onChange,onKeyDown:this.onKeyDown,onBlur:this.onBlur,onDoubleClick:this.onDoubleClick,className:"w-100 break-all expression-editor-input-content-editable",style:this.ltrStyle}),(0,jimu_core.Yac)(ExpPopover,{targetNodeId:popoverTarget,containerNode:null===(_a=this.contentEditableContainer)||void 0===_a?void 0:_a.current,expSelection:this.state.expSelection,items:getPopoverItems(this.id,popoverTarget,this.props.expression&&this.props.expression.parts,this.props.useDataSources,this.props.widgetId,this.props.browserSizeMode),isOpen:this.state.isPopoverOpen,onClick:this.handlePopoverItemClick,theme:this.props.theme,selectedItemIndex:this.state.selectedPopoverItemIndex})),!isValid&&(0,jimu_core.Yac)("div",{className:"mt-1 error-message",ref:this.errorMsgContainer},this.props.intl.formatMessage({id:"invalidExpression",defaultMessage:jimu_ui.defaultMessages.invalidExpression})),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("expression-editor-helper mt-4",{"with-error-message":!isValid}),ref:this.helperContainer},(0,jimu_core.Yac)(ExpEditorHelper,{expression:this.props.expression,useDataSources:this.props.useDataSources,onSelect:this.onHelperItemSelect,intl:this.props.intl,externalId:this.id,inEditablePart:this.getWhetherInEditablePart(),container:this.state.isEditorMounted?this.contentEditableContainer.current:null,expSelection:this.state.expSelection,widgetId:this.props.widgetId})))))}}_ExpressionEditor.count=-1;const __ExpressionEditor=jimu_core.E_S.connect(((state,ownProps)=>{var _a,_b;return{browserSizeMode:(null===(_a=null==state?void 0:state.appContext)||void 0===_a?void 0:_a.isBuilder)?null===(_b=null==state?void 0:state.appStateInBuilder)||void 0===_b?void 0:_b.browserSizeMode:null==state?void 0:state.browserSizeMode}}))(_ExpressionEditor),expression_editor=(0,jimu_theme.SL)((0,jimu_theme.Xy)((0,jimu_core.j4T)(__ExpressionEditor),"ExpressionEditor"));try{expressioneditor.displayName="expressioneditor",expressioneditor.__docgenInfo={description:"",displayName:"expressioneditor",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},autoFocus:{defaultValue:null,description:"",name:"autoFocus",required:!1,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},widgetId:{defaultValue:null,description:"Use widget id to get widget context, e.g. whether widget is in repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},useDataSources:{defaultValue:null,description:"",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"",name:"expression",required:!0,type:{name:"Expression"}},theme:{defaultValue:null,description:"",name:"theme",required:!1,type:{name:"IMThemeVariables"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-editor/index.tsx#expressioneditor"]={docgenInfo:expressioneditor.__docgenInfo,name:"expressioneditor",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-editor/index.tsx#expressioneditor"})}catch(__react_docgen_typescript_loader_error){}class AttributeTab extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.__unmount=!1,this.getSelectedFields=()=>{if(!this.props.expression||!this.props.useDataSources)return null;const part=this.props.expression.parts&&this.props.expression.parts[0],selectedFieldJimuName=part&&getWhetherUseDssMatchExpDss(part,this.props.useDataSources)&&part.type===jimu_core.une.Field?part.jimuFieldName:null;if(selectedFieldJimuName){const dsId=part.dataSourceId;return{fields:dsId?(0,jimu_core.J3Z)({[dsId]:[selectedFieldJimuName]}):null,isSelectedFromRepeatedDataSourceContext:part.isFromRepeatedDataSourceContext}}return null},this.onSelectedFieldsChange=(allSelectedFields,ds,isFromRepeatedDataSourceContext)=>{const field=allSelectedFields&&allSelectedFields[0];if(!field||!ds)return;const part={type:jimu_core.une.Field,exp:`{${field.alias||field.name}}`,dataSourceId:ds.id,jimuFieldName:field.jimuName,isFromRepeatedDataSourceContext:!!isFromRepeatedDataSourceContext};this.props.onChange({name:part.exp,parts:[part]})},this.state={FieldSelector:null}}componentDidMount(){this.__unmount=!1,Promise.all([__webpack_require__.e(6990),__webpack_require__.e(8012),__webpack_require__.e(2497)]).then(__webpack_require__.bind(__webpack_require__,"../jimu-ui/advanced/data-source-selector.tsx")).then((clazz=>{!this.__unmount&&this.setState({FieldSelector:clazz.FieldSelector})}))}componentWillUnmount(){this.__unmount=!0}render(){const FieldSelector=this.state.FieldSelector,selectResult=this.getSelectedFields();return jimu_core.q_G.createElement("div",{className:"expression-builder-tab attribute-tab common-tab p-0"},jimu_core.q_G.createElement("div",{className:"field-selector-container pb-4"},FieldSelector&&jimu_core.q_G.createElement(FieldSelector,{types:this.props.types,useDataSources:this.props.useDataSources,widgetId:this.props.widgetId,onChange:this.onSelectedFieldsChange,selectedFields:null==selectResult?void 0:selectResult.fields,isSelectedFromRepeatedDataSourceContext:null==selectResult?void 0:selectResult.isSelectedFromRepeatedDataSourceContext,useSelectionDataView:!0,usePopulatedDataView:!0})))}}try{attribute.displayName="attribute",attribute.__docgenInfo={description:"",displayName:"attribute",props:{useDataSources:{defaultValue:null,description:"",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},intl:{defaultValue:null,description:"",name:"intl",required:!0,type:{name:"IntlShape"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!1,type:{name:"string"}},types:{defaultValue:null,description:"",name:"types",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-builder/components/attribute.tsx#attribute"]={docgenInfo:attribute.__docgenInfo,name:"attribute",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-builder/components/attribute.tsx#attribute"})}catch(__react_docgen_typescript_loader_error){}var setting=__webpack_require__("../jimu-icons/outlined/application/setting.tsx");const DefaultNumberFormat={useGrouping:!0,notation:"standard",minimumFractionDigits:0,maximumFractionDigits:4};class ExpressionTab extends jimu_core.q_G.PureComponent{constructor(props){var _a,_b,_c,_d,_e,_f;super(props),this.numberFormatBtnRef=jimu_core.q_G.createRef(),this.expressionCountAdded=!1,this.insertCount=0,this.theme=window.jimuConfig.isBuilder?(0,jimu_theme.O4)():(0,jimu_theme.wE)(),this.numberFormatStyles=jimu_core.AHW`
    width: ${jimu_core.PLL.rem(240)};
    padding: ${jimu_core.PLL.rem(16)};
    .number-format-switch-label{
      font-size: ${jimu_core.PLL.rem(14)};
      font-weight: 600;
      color: ${(null===(_a=this.theme)||void 0===_a?void 0:_a.ref.palette.neutral[1100])||"#dcdcdc"};
    }
    .number-format-checkbox-label{
      font-size: ${jimu_core.PLL.rem(13)};
      color: ${(null===(_b=this.theme)||void 0===_b?void 0:_b.ref.palette.neutral[1100])||"#dcdcdc"};
    }
    .number-format-numeric-input-label{
      font-size: ${jimu_core.PLL.rem(13)};
      color: ${(null===(_c=this.theme)||void 0===_c?void 0:_c.ref.palette.neutral[900])||"#a0a0a0"};
    }
  `,this.getMutableExpression=expression=>this.props.expression&&this.props.expression.asMutable?this.props.expression.asMutable({deep:!0}):this.props.expression,this.onExpChange=e=>{this.setState({expression:e})},this.onChange=()=>{const newExpression={name:this.state.name||this.getDefaultName(),parts:this.state.expression&&this.state.expression.parts};this.state.numberFormat&&(newExpression.numberFormat=this.state.numberFormat),this.insertCount++,this.props.onChange(newExpression)},this.onNameChange=e=>{this.setState({name:e.target.value})},this.getDefaultName=()=>`${this.props.intl.formatMessage({id:"expression",defaultMessage:jimu_ui.defaultMessages.expression})} ${ExpressionTab.count}`,this.getWhetherDisableInsert=()=>!this.state.expression||!this.state.expression.parts||0===this.state.expression.parts.length||!jimu_core.sNq.getWhetherExpressionValid(this.state.expression),this.onNumberFormatClick=()=>{this.toggleNumberFormatSettingPopper()},this.toggleNumberFormatSettingPopper=()=>{this.setState({isNumberFormatSettingOpen:!this.state.isNumberFormatSettingOpen})},this.onToggleNumberFormatSetting=(e,checked)=>{checked?this.setState({numberFormat:DefaultNumberFormat}):this.setState({numberFormat:null})},this.onMinDigitsChange=v=>{this.setState({numberFormat:Object.assign(Object.assign({},this.state.numberFormat),{minimumFractionDigits:v})})},this.onMaxDigitsChange=v=>{this.setState({numberFormat:Object.assign(Object.assign({},this.state.numberFormat),{maximumFractionDigits:v})})},this.onUseGroupChange=(e,checked)=>{this.setState({numberFormat:Object.assign(Object.assign({},this.state.numberFormat),{useGrouping:checked})})},this.onNotationChange=(e,checked)=>{this.setState({numberFormat:Object.assign(Object.assign({},this.state.numberFormat),{notation:checked?"compact":"standard"})})},(null===(_d=props.expression)||void 0===_d?void 0:_d.name)||(ExpressionTab.count++,this.expressionCountAdded=!0),this.state={expression:this.getMutableExpression(this.props.expression),name:(null===(_e=this.props.expression)||void 0===_e?void 0:_e.name)||this.getDefaultName(),numberFormat:null===(_f=this.props.expression)||void 0===_f?void 0:_f.numberFormat,isNumberFormatSettingOpen:!1}}componentDidUpdate(prevProps){var _a,_b;prevProps.expression!==this.props.expression&&this.setState({expression:this.getMutableExpression(this.props.expression),name:(null===(_a=this.props.expression)||void 0===_a?void 0:_a.name)||this.getDefaultName(),numberFormat:null===(_b=this.props.expression)||void 0===_b?void 0:_b.numberFormat})}componentWillUnmount(){this.expressionCountAdded&&0===this.insertCount&&ExpressionTab.count--}render(){var _a,_b;const numberFormatString=this.props.intl.formatMessage({id:"numberFormatting",defaultMessage:jimu_ui.defaultMessages.numberFormatting}),decimalPlaceString=this.props.intl.formatMessage({id:"decimalPlace",defaultMessage:jimu_ui.defaultMessages.decimalPlace}),showThousandSeparatorString=this.props.intl.formatMessage({id:"showThousandSeparator",defaultMessage:jimu_ui.defaultMessages.showThousandSeparator}),unitString=this.props.intl.formatMessage({id:"unit",defaultMessage:jimu_ui.defaultMessages.unit}),toString=this.props.intl.formatMessage({id:"to",defaultMessage:jimu_ui.defaultMessages.to}),numberFormatDecimalId=`expression-${ExpressionTab.count}-number-format-decimal`;return(0,jimu_core.Yac)("div",{className:"expression-builder-tab expression-tab px-4"},(0,jimu_core.Yac)("div",{className:"mb-4"},(0,jimu_core.Yac)("div",{className:"d-flex justify-content-start"},(0,jimu_core.Yac)(jimu_ui.TextInput,{className:"flex-grow-1",value:this.state.name,onChange:this.onNameChange,id:"expression-name-input",size:"sm"}))),(0,jimu_core.Yac)("div",{className:"expression-editor-container"},(0,jimu_core.Yac)(expression_editor,Object.assign({},this.props,{expression:this.state.expression,onChange:this.onExpChange,autoFocus:this.props.isActive}))),(0,jimu_core.Yac)("div",{className:"fixed-at-bottom d-flex align-items-center justify-content-between px-4"},(0,jimu_core.Yac)(jimu_ui.Button,{type:"default",icon:!0,size:"default",onClick:this.onNumberFormatClick,title:numberFormatString,"aria-label":numberFormatString,ref:this.numberFormatBtnRef},(0,jimu_core.Yac)(setting.J,{size:"m"})),(0,jimu_core.Yac)(jimu_ui.Button,{onClick:this.onChange,type:"primary",disabled:this.getWhetherDisableInsert(),className:"expression-insert-btn ml-2",size:"default",title:this.props.intl.formatMessage({id:"insert",defaultMessage:jimu_ui.defaultMessages.insert})},(0,jimu_core.Yac)("div",{className:"text-truncate"},this.props.intl.formatMessage({id:"insert",defaultMessage:jimu_ui.defaultMessages.insert})))),(0,jimu_core.Yac)(jimu_ui.Popper,{reference:this.numberFormatBtnRef.current,open:this.state.isNumberFormatSettingOpen,arrowOptions:!0,toggle:this.toggleNumberFormatSettingPopper,offsetOptions:[-8,0],placement:"top-start",autoUpdate:!0},(0,jimu_core.Yac)("div",{css:this.numberFormatStyles},(0,jimu_core.Yac)("div",{className:"w-100 mb-2"},(0,jimu_core.Yac)(jimu_ui.Label,{className:"w-100 d-flex justify-content-between"},(0,jimu_core.Yac)("div",{className:"w-75 text-truncate number-format-switch-label",title:numberFormatString},numberFormatString),(0,jimu_core.Yac)(jimu_ui.Switch,{checked:!!this.state.numberFormat,onChange:this.onToggleNumberFormatSetting}))),this.state.numberFormat&&(0,jimu_core.Yac)("div",{className:"w-100"},(0,jimu_core.Yac)("div",{className:"w-100 mb-2 d-flex"},(0,jimu_core.Yac)(jimu_ui.Label,{className:"w-100 text-truncate m-0 number-format-numeric-input-label",for:numberFormatDecimalId},decimalPlaceString)),(0,jimu_core.Yac)("div",{className:"w-100 d-flex justify-content-between mb-4",id:numberFormatDecimalId},(0,jimu_core.Yac)(jimu_ui.NumericInput,{value:this.state.numberFormat.minimumFractionDigits,onChange:this.onMinDigitsChange,showHandlers:!0,precision:0,min:0,max:null!==(_a=this.state.numberFormat.maximumFractionDigits)&&void 0!==_a?_a:20,size:"sm"}),(0,jimu_core.Yac)("span",{className:"mx-2 number-format-numeric-input-label"},toString),(0,jimu_core.Yac)(jimu_ui.NumericInput,{value:this.state.numberFormat.maximumFractionDigits,onChange:this.onMaxDigitsChange,showHandlers:!0,precision:0,min:null!==(_b=this.state.numberFormat.minimumFractionDigits)&&void 0!==_b?_b:0,max:20,size:"sm"})),(0,jimu_core.Yac)("div",{className:"w-100 mb-2"},(0,jimu_core.Yac)(jimu_ui.Label,{className:"w-100 d-flex justify-content-start m-0"},(0,jimu_core.Yac)(jimu_ui.Checkbox,{className:"mr-2",checked:!!this.state.numberFormat.useGrouping,onChange:this.onUseGroupChange}),(0,jimu_core.Yac)("div",{className:"w-85 text-truncate number-format-checkbox-label",title:showThousandSeparatorString},showThousandSeparatorString))),(0,jimu_core.Yac)("div",{className:"w-100"},(0,jimu_core.Yac)(jimu_ui.Label,{className:"w-100 d-flex justify-content-start m-0"},(0,jimu_core.Yac)(jimu_ui.Checkbox,{className:"mr-2",checked:"compact"===this.state.numberFormat.notation,onChange:this.onNotationChange}),(0,jimu_core.Yac)("div",{className:"w-85 text-truncate number-format-checkbox-label",title:unitString},unitString)))))))}}ExpressionTab.count=0;const components_expression=ExpressionTab;try{expression.displayName="expression",expression.__docgenInfo={description:"",displayName:"expression",props:{useDataSources:{defaultValue:null,description:"",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},intl:{defaultValue:null,description:"",name:"intl",required:!0,type:{name:"IntlShape"}},isActive:{defaultValue:null,description:"",name:"isActive",required:!0,type:{name:"boolean"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-builder/components/expression.tsx#expression"]={docgenInfo:expression.__docgenInfo,name:"expression",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-builder/components/expression.tsx#expression"})}catch(__react_docgen_typescript_loader_error){}class StatisticsTab extends jimu_core.q_G.PureComponent{constructor(props){var _a;super(props),this.dsManager=jimu_core.zAk.getInstance(),this.__unmount=!1,this.getWhetherExpressionIsFuncAndHasOnePart=groupedParts=>!!groupedParts&&!(1!==groupedParts.length||!groupedParts[0]||groupedParts[0].type!==jimu_core.une.Function),this.hasNoParamAndDsEnabled=part=>!!part&&((!part.parts||0===part.parts.length)&&getWhetherUseDssMatchExpDss(part,this.props.useDataSources)),this.hasParamsAndDsEnabled=part=>!!part&&(part.parts&&part.parts.length&&getWhetherUseDssMatchExpDss(part.parts[0],this.props.useDataSources)),this.getWhetherUseSelectedDs=part=>!this.state||!this.state.selectedDsId||part.dataSourceId===this.state.selectedDsId,this.getDefaultDsId=()=>{const parts=this.props.expression&&this.props.expression.parts,groupedParts=(0,jimu_core.Bsv)(parts);if(this.getWhetherExpressionIsFuncAndHasOnePart(groupedParts)){const groupedFuncPart=groupedParts[0];if(this.hasNoParamAndDsEnabled(groupedFuncPart))return groupedFuncPart.dataSourceId;if(this.hasParamsAndDsEnabled(groupedFuncPart))return groupedFuncPart.parts[0].dataSourceId}return null},this.getDefaultFunc=()=>{const parts=this.props.expression&&this.props.expression.parts,groupedParts=(0,jimu_core.Bsv)(parts);if(this.getWhetherExpressionIsFuncAndHasOnePart(groupedParts)){return groupedParts[0].exp||jimu_core.CIK.Average}return jimu_core.CIK.Average},this.getDefaultPercentileParams=()=>{const parts=this.props.expression&&this.props.expression.parts,groupedParts=(0,jimu_core.Bsv)(parts);if(this.getWhetherExpressionIsFuncAndHasOnePart(groupedParts)){const groupedFuncPart=groupedParts[0],func=groupedFuncPart.exp,paramsParts=groupedFuncPart.parts,percentileParams=jimu_core.sNq.getPercentileParams(paramsParts,func)||{};return("number"!=typeof percentileParams.value||isNaN(percentileParams.value))&&(percentileParams.value=50),percentileParams.orderBy||(percentileParams.orderBy="ASC"),percentileParams}return{value:50,orderBy:"ASC"}},this.getDefaultJimuFieldName=dsId=>{const parts=this.props.expression&&this.props.expression.parts,groupedParts=(0,jimu_core.Bsv)(parts),groupedFuncPart=groupedParts[0],ds=jimu_core.zAk.getInstance().getDataSource(dsId),defaultFieldName=null==ds?void 0:ds.getIdField();return this.getWhetherExpressionIsFuncAndHasOnePart(groupedParts)&&this.hasParamsAndDsEnabled(groupedFuncPart)&&this.getWhetherUseSelectedDs(groupedFuncPart.parts[0])&&groupedFuncPart.parts[0].jimuFieldName||defaultFieldName},this.getDefaultExpName=(fieldName,func,percentileValue,percentileOrder)=>isPercentileFunction(func)?"ASC"!==percentileOrder?`${func}({${fieldName}}, ${percentileValue}, ${percentileOrder})`:`${func}({${fieldName}}, ${percentileValue})`:`${func}({${fieldName}})`,this.getCustomExpName=(fieldName,func,percentileValue,percentileOrder,previousExpName)=>previousExpName===this.getDefaultExpName(fieldName,func,percentileValue,percentileOrder)?"":previousExpName||"",this.getSelectedFieldName=(fields,fieldJimuName)=>fields?fieldJimuName&&fields[fieldJimuName]&&(fields[fieldJimuName].alias||fields[fieldJimuName].name):"",this.getSelectedJimuFieldName=()=>this.state.selectedJimuFieldName,this.getSelectedFunction=()=>this.state.selectedFunction,this.getFieldsByFunc=(dsId,func)=>{if(!dsId)return{};const ds=this.dsManager&&this.dsManager.getDataSource(dsId),schema=ds&&ds.getSchema(),fields=schema&&schema.fields;if(!fields)return{};if(func===jimu_core.CIK.Count)return fields.asMutable({deep:!0});const newFields={},isMinOrMax=func===jimu_core.CIK.Min||func===jimu_core.CIK.Max;return Object.keys(fields).forEach((f=>{(fields[f].type===jimu_core.Eo3.Number||isMinOrMax&&fields[f].type===jimu_core.Eo3.Date)&&(newFields[f]=fields[f])})),newFields},this.getSelectedUseDataSource=()=>{var _a;const d=jimu_core.zAk.getInstance().getDataSource(this.state.selectedDsId);return this.state.selectedDsId&&d?(0,jimu_core.J3Z)({dataSourceId:d.id,mainDataSourceId:d.getMainDataSource().id,dataViewId:d.dataViewId,rootDataSourceId:null===(_a=d.getRootDataSource())||void 0===_a?void 0:_a.id}):null},this.onFieldChange=e=>{const value=e.currentTarget.value;this.setState({selectedJimuFieldName:value})},this.onFunctionChange=e=>{const value=e.currentTarget.value;this.setState({selectedFunction:value})},this.onPercentileValueChange=value=>{this.setState({percentileValue:value})},this.onPercentileOrderChange=e=>{const value=e.currentTarget.value;this.setState({percentileOrder:value})},this.onCustomExpNameChange=e=>{this.setState({customExpName:e.target.value})},this.onChange=()=>{const fields=this.getFieldsByFunc(this.state.selectedDsId,this.state.selectedFunction),fieldName=this.getSelectedFieldName(fields,this.state.selectedJimuFieldName),name=this.state.customExpName||this.getDefaultExpName(fieldName,this.state.selectedFunction,this.state.percentileValue,this.state.percentileOrder),parts=[{type:jimu_core.une.Function,exp:this.state.selectedFunction},{type:jimu_core.une.Operator,exp:"("},{type:jimu_core.une.Field,exp:`{${fieldName}}`,dataSourceId:this.state.selectedDsId,jimuFieldName:this.state.selectedJimuFieldName}];isPercentileFunction(this.state.selectedFunction)&&(parts.push({type:jimu_core.une.Operator,exp:","},{type:jimu_core.une.Number,exp:`${this.state.percentileValue}`}),"ASC"!==this.state.percentileOrder&&parts.push({type:jimu_core.une.Operator,exp:","},{type:jimu_core.une.Order,exp:this.state.percentileOrder})),parts.push({type:jimu_core.une.Operator,exp:")"}),this.props.onChange({name,parts})},this.onSelectedUseDsChange=useDataSource=>{this.setState({selectedDsId:null==useDataSource?void 0:useDataSource.dataSourceId})};const dsId=this.getDefaultDsId(),jimuFieldName=this.getDefaultJimuFieldName(dsId),func=this.getDefaultFunc(),percentileParams=this.getDefaultPercentileParams(),percentileValue=percentileParams.value,percentileOrder=percentileParams.orderBy,fields=this.getFieldsByFunc(dsId,func),fieldName=this.getSelectedFieldName(fields,jimuFieldName);this.state={customExpName:this.getCustomExpName(fieldName,func,percentileValue,percentileOrder,null===(_a=this.props.expression)||void 0===_a?void 0:_a.name),selectedDsId:dsId,selectedJimuFieldName:jimuFieldName,selectedFunction:func,MainDataAndViewSelector:null,DataViewPriority:null,percentileValue,percentileOrder}}componentDidMount(){this.__unmount=!1,Promise.all([__webpack_require__.e(6990),__webpack_require__.e(8012),__webpack_require__.e(2497)]).then(__webpack_require__.bind(__webpack_require__,"../jimu-ui/advanced/data-source-selector.tsx")).then((clazz=>{!this.__unmount&&this.setState({MainDataAndViewSelector:clazz.MainDataAndViewSelector,DataViewPriority:clazz.DataViewPriority})}))}componentDidUpdate(prevProps,prevState){var _a;if(prevProps.expression!==this.props.expression||prevProps.useDataSources!==this.props.useDataSources){const dsId=this.getDefaultDsId(),jimuFieldName=this.getDefaultJimuFieldName(dsId),func=this.getDefaultFunc(),percentileParams=this.getDefaultPercentileParams(),percentileValue=percentileParams.value,percentileOrder=percentileParams.orderBy,fields=this.getFieldsByFunc(dsId,func),fieldName=this.getSelectedFieldName(fields,jimuFieldName);this.setState({customExpName:this.getCustomExpName(fieldName,func,percentileValue,percentileOrder,null===(_a=this.props.expression)||void 0===_a?void 0:_a.name),selectedDsId:dsId,selectedJimuFieldName:jimuFieldName,selectedFunction:func,percentileValue,percentileOrder})}if(prevState.selectedDsId!==this.state.selectedDsId){const jimuName=this.getDefaultJimuFieldName(this.state.selectedDsId);this.setState({selectedJimuFieldName:jimuName})}}componentWillUnmount(){this.__unmount=!0}render(){const fields=this.getFieldsByFunc(this.state.selectedDsId,this.state.selectedFunction),MainDataAndViewSelector=this.state.MainDataAndViewSelector,DataViewPriority=this.state.DataViewPriority,fieldName=this.getSelectedFieldName(fields,this.state.selectedJimuFieldName);return jimu_core.q_G.createElement("div",{className:"expression-builder-tab statistics-tab common-tab"},jimu_core.q_G.createElement("div",{className:"data-option"},jimu_core.q_G.createElement("div",{className:"flex-grow-1"},jimu_core.q_G.createElement(jimu_ui.TextInput,{placeholder:this.getDefaultExpName(fieldName,this.state.selectedFunction,this.state.percentileValue,this.state.percentileOrder),value:this.state.customExpName,className:"flex-grow-1",size:"sm",onChange:this.onCustomExpNameChange}))),MainDataAndViewSelector&&jimu_core.q_G.createElement(MainDataAndViewSelector,{useDataSources:this.props.useDataSources,onChange:this.onSelectedUseDsChange,useSelectionDataView:!0,className:"p-4",selectedUseDataSource:this.getSelectedUseDataSource(),defaultDataViewPriority:DataViewPriority.Second}),jimu_core.q_G.createElement("div",{className:"data-option mb-3"},jimu_core.q_G.createElement("div",{className:"w-100 text-truncate mb-3 option-label"},this.props.intl.formatMessage({id:"operator",defaultMessage:jimu_ui.defaultMessages.operator})),jimu_core.q_G.createElement("div",{className:"flex-grow-1"},jimu_core.q_G.createElement(jimu_ui.Select,{value:this.getSelectedFunction(),className:"select-max-width",size:"sm",onChange:this.onFunctionChange},function getSupportedFunctions(dsId){var _a,_b;const ds=jimu_core.zAk.getInstance().getDataSource(dsId);if(null===(_b=null===(_a=null==ds?void 0:ds.getCapabilities)||void 0===_a?void 0:_a.call(ds))||void 0===_b?void 0:_b.getQueryCapabilities().supportsPercentileStatistics)return Object.values(jimu_core.CIK);{const functions=Object.assign({},jimu_core.CIK);return delete functions.PercentileContinuous,delete functions.PercentileDiscrete,Object.values(functions)}}(this.state.selectedDsId).map(((f,i)=>jimu_core.q_G.createElement("option",{value:f,key:i,className:"select-max-width text-truncate"},f)))))),jimu_core.q_G.createElement("div",{className:"data-option mb-3"},jimu_core.q_G.createElement("div",{className:"w-100 text-truncate mb-3 option-label"},this.props.intl.formatMessage({id:"field",defaultMessage:jimu_ui.defaultMessages.field})),jimu_core.q_G.createElement("div",{className:"flex-grow-1"},jimu_core.q_G.createElement(jimu_ui.Select,{value:this.getSelectedJimuFieldName(),size:"sm",onChange:this.onFieldChange,className:"select-max-width"},fields&&Object.keys(fields).map(((f,i)=>jimu_core.q_G.createElement("option",{value:fields[f].jimuName,key:i,className:"select-max-width",title:fields[f].alias||fields[f].name},jimu_core.q_G.createElement("div",{className:"text-truncate"},fields[f].alias||fields[f].name))))))),isPercentileFunction(this.state.selectedFunction)&&jimu_core.q_G.createElement("div",{className:"data-option mb-3"},jimu_core.q_G.createElement("div",{className:"w-100 text-truncate mb-3 option-label"},this.props.intl.formatMessage({id:"percentileValue",defaultMessage:jimu_ui.defaultMessages.percentileValue})),jimu_core.q_G.createElement("div",{className:"flex-grow-1"},jimu_core.q_G.createElement(jimu_ui.NumericInput,{value:this.state.percentileValue,className:"w-100",min:0,max:100,precision:0,onChange:this.onPercentileValueChange}))),isPercentileFunction(this.state.selectedFunction)&&jimu_core.q_G.createElement("div",{className:"data-option mb-3"},jimu_core.q_G.createElement("div",{className:"w-100 text-truncate mb-3 option-label"},this.props.intl.formatMessage({id:"orderBy",defaultMessage:jimu_ui.defaultMessages.orderBy})),jimu_core.q_G.createElement("div",{className:"flex-grow-1"},jimu_core.q_G.createElement(jimu_ui.Select,{value:this.state.percentileOrder,size:"sm",onChange:this.onPercentileOrderChange,className:"select-max-width"},["ASC","DESC"].map(((d,i)=>jimu_core.q_G.createElement("option",{value:d,key:i,className:"select-max-width",title:d},jimu_core.q_G.createElement("div",{className:"text-truncate"},d))))))),jimu_core.q_G.createElement("div",{className:"data-option w-100 mt-2 d-flex justify-content-end"},jimu_core.q_G.createElement(jimu_ui.Button,{onClick:this.onChange,type:"primary",className:"stat-inter-btn",title:this.props.intl.formatMessage({id:"insert",defaultMessage:jimu_ui.defaultMessages.insert}),disabled:!Object.keys(fields||{}).includes(this.getSelectedJimuFieldName())},jimu_core.q_G.createElement("div",{className:"text-truncate"},this.props.intl.formatMessage({id:"insert",defaultMessage:jimu_ui.defaultMessages.insert})))))}}try{statistics.displayName="statistics",statistics.__docgenInfo={description:"",displayName:"statistics",props:{useDataSources:{defaultValue:null,description:"",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},intl:{defaultValue:null,description:"",name:"intl",required:!0,type:{name:"IntlShape"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-builder/components/statistics.tsx#statistics"]={docgenInfo:statistics.__docgenInfo,name:"statistics",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-builder/components/statistics.tsx#statistics"})}catch(__react_docgen_typescript_loader_error){}class expression_builder_ExpressionBuilder extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.expressionFrom={[ExpressionBuilderType.Attribute]:this.props.intl.formatMessage({id:"attribute",defaultMessage:jimu_ui.defaultMessages.attribute}),[ExpressionBuilderType.Statistics]:this.props.intl.formatMessage({id:"statistics",defaultMessage:jimu_ui.defaultMessages.statistics}),[ExpressionBuilderType.Expression]:this.props.intl.formatMessage({id:"expression",defaultMessage:jimu_ui.defaultMessages.expression})},this.onChange=e=>{this.props.onChange&&this.props.onChange(e)},this.getActiveExpressionFrom=(expression,types)=>{if(!expression||!expression.parts||0===expression.parts.length)return this.props.types[0];if(expression.numberFormat)return this.props.types.some((f=>f===ExpressionBuilderType.Expression))?ExpressionBuilderType.Expression:types[0];const groupedParts=(0,jimu_core.Bsv)(expression.parts);return 1===groupedParts.length&&groupedParts[0].type===jimu_core.une.Field?types.some((f=>f===ExpressionBuilderType.Attribute))?ExpressionBuilderType.Attribute:types.some((f=>f===ExpressionBuilderType.Expression))?ExpressionBuilderType.Expression:types[0]:1===groupedParts.length&&groupedParts[0].type===jimu_core.une.Function&&types.some((f=>f===ExpressionBuilderType.Statistics))?ExpressionBuilderType.Statistics:types.some((f=>f===ExpressionBuilderType.Expression))?ExpressionBuilderType.Expression:types[0]},this.getTabsContent=(types,activeTab,useDataSources,expression)=>1===(null==types?void 0:types.length)?(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("h-100",{"has-nav":types&&types.length>1})},this.getSingleTab(types[0],!0,useDataSources,expression)):(null==types?void 0:types.length)>1?(0,jimu_core.Yac)(jimu_ui.Tabs,{fill:!0,type:"underline",className:"h-100",value:activeTab,onChange:this.onActiveTabChange},types.asMutable().map((t=>{const tabName=this.expressionFrom[t];return(0,jimu_core.Yac)(jimu_ui.Tab,{id:t,title:tabName,key:t},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("h-100",{"has-nav":(null==types?void 0:types.length)>1})},this.getSingleTab(t,t===activeTab,useDataSources,expression)))}))):void 0,this.getSingleTab=(tab,isActive,useDataSources,expression)=>{switch(tab){case ExpressionBuilderType.Attribute:return(0,jimu_core.Yac)(AttributeTab,{types:this.props.fieldTypes,useDataSources,expression,onChange:this.onChange,intl:this.props.intl,widgetId:this.props.widgetId});case ExpressionBuilderType.Statistics:return(0,jimu_core.Yac)(StatisticsTab,{useDataSources,expression,onChange:this.onChange,intl:this.props.intl,widgetId:this.props.widgetId});case ExpressionBuilderType.Expression:return(0,jimu_core.Yac)(components_expression,Object.assign({},this.props,{useDataSources,expression,onChange:this.onChange,intl:this.props.intl,isActive}));default:return null}},this.onActiveTabChange=types=>{this.setState({activeTab:types})};const activeTab=this.getActiveExpressionFrom(this.props.expression,this.props.types);this.state={activeTab,content:this.getTabsContent(this.props.types,activeTab,this.props.useDataSources,this.props.expression)}}componentDidUpdate(prevProps,prevState){this.props.types===prevProps.types&&this.props.expression===prevProps.expression||this.setState({activeTab:this.getActiveExpressionFrom(this.props.expression,this.props.types)}),this.props.types===prevProps.types&&this.props.expression===prevProps.expression&&this.props.useDataSources===prevProps.useDataSources&&this.state.activeTab===prevState.activeTab||this.setState({content:this.getTabsContent(this.props.types,this.state.activeTab,this.props.useDataSources,this.props.expression)})}render(){return(0,jimu_core.Yac)(jimu_core.P0p,{useDataSources:this.props.useDataSources},(0,jimu_core.Yac)("div",{style:this.props.style,className:(0,jimu_core.xWm)("w-100 h-100",{[this.props.className]:!!this.props.className})},(0,jimu_core.Yac)("div",{className:"w-100 h-100 component-expression-builder"},this.state.content)))}}const expression_builder=(0,jimu_core.j4T)((0,jimu_theme.Xy)(expression_builder_ExpressionBuilder,"ExpressionBuilder"));try{ExpressionBuilderProps.displayName="ExpressionBuilderProps",ExpressionBuilderProps.__docgenInfo={description:"Props of expression builder component.",displayName:"ExpressionBuilderProps",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-builder/index.tsx#ExpressionBuilderProps"]={docgenInfo:ExpressionBuilderProps.__docgenInfo,name:"ExpressionBuilderProps",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-builder/index.tsx#ExpressionBuilderProps"})}catch(__react_docgen_typescript_loader_error){}try{expression_builder_ExpressionBuilder.displayName="_ExpressionBuilder",expression_builder_ExpressionBuilder.__docgenInfo={description:"The `ExpressionBuilder` component allows users to build an Expression.\n\n```ts\nimport { ExpressionBuilder } from 'jimu-ui/advanced/expression-builder'\n```",displayName:"_ExpressionBuilder",props:{useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},intl:{defaultValue:null,description:"@ignore",name:"intl",required:!0,type:{name:"IntlShape"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-builder/index.tsx#_ExpressionBuilder"]={docgenInfo:expression_builder_ExpressionBuilder.__docgenInfo,name:"_ExpressionBuilder",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-builder/index.tsx#_ExpressionBuilder"})}catch(__react_docgen_typescript_loader_error){}try{expressionbuilder.displayName="expressionbuilder",expressionbuilder.__docgenInfo={description:"This component is used to build an {@link Expression}.",displayName:"expressionbuilder",props:{style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-builder/index.tsx#expressionbuilder"]={docgenInfo:expressionbuilder.__docgenInfo,name:"expressionbuilder",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-builder/index.tsx#expressionbuilder"})}catch(__react_docgen_typescript_loader_error){}class expression_builder_popup_ExpressionBuilderPopup extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.overflowYStyle={overflow:"hidden"},this.__unmount=!1,this.state={SidePopper:null}}componentDidMount(){this.__unmount=!1,Promise.all([__webpack_require__.e(9530),__webpack_require__.e(3162),__webpack_require__.e(6448),__webpack_require__.e(7568),__webpack_require__.e(6990),__webpack_require__.e(8012),__webpack_require__.e(2922),__webpack_require__.e(6428),__webpack_require__.e(5233),__webpack_require__.e(3212),__webpack_require__.e(1623),__webpack_require__.e(5091),__webpack_require__.e(116)]).then(__webpack_require__.bind(__webpack_require__,"../jimu-ui/advanced/setting-components.tsx")).then((clazz=>{!this.__unmount&&this.setState({SidePopper:clazz.SidePopper})}))}componentWillUnmount(){this.__unmount=!0}render(){const SidePopper=this.state.SidePopper,types=this.props.types,title=types?types.length>1?this.props.intl.formatMessage({id:"dynamicContent",defaultMessage:jimu_ui.defaultMessages.dynamicContent}):getExpressionFromString(types[0],this.props.intl):"";return(0,jimu_core.Yac)("div",{className:"w-100 h-100"},SidePopper&&(0,jimu_core.Yac)(SidePopper,{isOpen:this.props.isOpen&&!jimu_core.v6q.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.props.onClose,trigger:this.props.trigger,backToFocusNode:this.props.backToFocusNode,title},(0,jimu_core.Yac)("div",{className:"h-100 bg-default border-color-gray-400 component-expression-builder-popup"},(0,jimu_core.Yac)("div",{className:"w-100 h-100 expression-popup"},(0,jimu_core.Yac)("div",{style:this.overflowYStyle,className:"h-100"},(0,jimu_core.Yac)(expression_builder,Object.assign({},this.props)))))))}}const expression_builder_popup=(0,jimu_theme.SL)((0,jimu_core.j4T)(expression_builder_popup_ExpressionBuilderPopup));try{expression_builder_popup_ExpressionBuilderPopup.displayName="_ExpressionBuilderPopup",expression_builder_popup_ExpressionBuilderPopup.__docgenInfo={description:"The `ExpressionBuilderPopup` component allows users to build an Expression using a popup.\n\n```ts\nimport { ExpressionBuilderPopup } from 'jimu-ui/advanced/expression-builder'\n```",displayName:"_ExpressionBuilderPopup",props:{isOpen:{defaultValue:null,description:"Whether to show the popup.",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"Callback when the close icon in header of the popup is clicked.",name:"onClose",required:!0,type:{name:"() => void"}},trigger:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"trigger",required:!1,type:{name:"HTMLElement | HTMLElement[]"}},backToFocusNode:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"backToFocusNode",required:!1,type:{name:"HTMLElement"}},useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},theme:{defaultValue:null,description:"@ignore",name:"theme",required:!0,type:{name:"IMThemeVariables"}},intl:{defaultValue:null,description:"@ignore",name:"intl",required:!0,type:{name:"IntlShape"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-builder-popup/index.tsx#_ExpressionBuilderPopup"]={docgenInfo:expression_builder_popup_ExpressionBuilderPopup.__docgenInfo,name:"_ExpressionBuilderPopup",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-builder-popup/index.tsx#_ExpressionBuilderPopup"})}catch(__react_docgen_typescript_loader_error){}try{expressionbuilderpopup.displayName="expressionbuilderpopup",expressionbuilderpopup.__docgenInfo={description:"",displayName:"expressionbuilderpopup",props:{trigger:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"trigger",required:!1,type:{name:"HTMLElement | HTMLElement[]"}},style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},onClose:{defaultValue:null,description:"Callback when the close icon in header of the popup is clicked.",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"Whether to show the popup.",name:"isOpen",required:!0,type:{name:"boolean"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},backToFocusNode:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"backToFocusNode",required:!1,type:{name:"HTMLElement"}},theme:{defaultValue:null,description:"",name:"theme",required:!1,type:{name:"IMThemeVariables"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-builder-popup/index.tsx#expressionbuilderpopup"]={docgenInfo:expressionbuilderpopup.__docgenInfo,name:"expressionbuilderpopup",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-builder-popup/index.tsx#expressionbuilderpopup"})}catch(__react_docgen_typescript_loader_error){}var text_page=__webpack_require__("../jimu-icons/svg/outlined/data/text-page.svg"),text_page_default=__webpack_require__.n(text_page),sum=__webpack_require__("../jimu-icons/svg/outlined/editor/sum.svg"),sum_default=__webpack_require__.n(sum),code=__webpack_require__("../jimu-icons/svg/outlined/data/code.svg"),code_default=__webpack_require__.n(code),braces=__webpack_require__("../jimu-icons/svg/outlined/data/braces.svg"),braces_default=__webpack_require__.n(braces);class _ExpressionInput extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.expBuilderTrigger=jimu_core.q_G.createRef(),this.dropdownButton=jimu_core.q_G.createRef(),this.toggleDropdown=()=>{this.setState({isDropdownOpen:!this.state.isDropdownOpen})},this.getExpFromIcon=from=>{switch(from){case ExpressionInputType.Static:return text_page_default();case ExpressionInputType.Attribute:return braces_default();case ExpressionInputType.Statistics:return sum_default();case ExpressionInputType.Expression:return code_default();default:return null}},this.getSelectedExpFromExpression=()=>{var _a;if(null===(_a=this.props.expression)||void 0===_a?void 0:_a.numberFormat)return this.props.types.some((f=>f===ExpressionInputType.Expression))?ExpressionInputType.Expression:this.props.types[0];if(!this.props.expression||!this.props.expression.parts||0===this.props.expression.parts.length)return this.props.types.some((f=>f===ExpressionInputType.Static))?ExpressionInputType.Static:this.props.types.some((f=>f===ExpressionInputType.Attribute))?ExpressionInputType.Attribute:this.props.types.some((f=>f===ExpressionInputType.Statistics))?ExpressionInputType.Statistics:this.props.types.some((f=>f===ExpressionInputType.Expression))?ExpressionInputType.Expression:this.props.types[0];const groupedParts=(0,jimu_core.Bsv)(this.props.expression.parts);return 1===groupedParts.length&&groupedParts[0].type===jimu_core.une.Field?this.props.types.some((f=>f===ExpressionInputType.Attribute))?ExpressionInputType.Attribute:this.props.types.some((f=>f===ExpressionInputType.Expression))?ExpressionInputType.Expression:this.props.types[0]:1===groupedParts.length&&groupedParts[0].type===jimu_core.une.Function?this.props.types.some((f=>f===ExpressionInputType.Statistics))?ExpressionInputType.Statistics:this.props.types.some((f=>f===ExpressionInputType.Expression))?ExpressionInputType.Expression:this.props.types[0]:1===groupedParts.length&&groupedParts[0].type===jimu_core.une.String&&this.props.types.some((f=>f===ExpressionInputType.Static))?ExpressionInputType.Static:this.props.types.some((f=>f===ExpressionInputType.Expression))?ExpressionInputType.Expression:this.props.types[0]},this.getWhetherFromExpBuilder=(expFrom,useDataSources)=>(null==useDataSources?void 0:useDataSources.length)>0&&expFrom&&Object.keys(ExpressionBuilderType).some((f=>ExpressionBuilderType[f]===expFrom)),this.getExpressionFrom=()=>this.getWhetherFromExpBuilder(this.state.selectedExpFrom,this.props.useDataSources)?(0,jimu_core.J3Z)([this.state.selectedExpFrom]):(0,jimu_core.J3Z)([]),this.getStringFromExpression=()=>this.props.expression&&1===this.props.expression.parts.length&&this.props.expression.parts[0].type===jimu_core.une.String?this.props.expression.parts[0].exp.replace(/^"/,"").replace(/"$/,""):"",this.onInputBlur=e=>{const value=e.target.value,expression={name:value,parts:[{type:jimu_core.une.String,exp:`"${value}"`}]};this.props.onChange&&this.props.onChange(expression)},this.onInputChange=e=>{this.setState({inputValue:e.target.value})},this.onExpChange=expression=>{this.props.onChange&&this.props.onChange(expression)},this.onExpFromChange=value=>{value!==this.state.selectedExpFrom?(value!==ExpressionInputType.Expression&&this.onExpChange({name:"",parts:[]}),this.setState({selectedExpFrom:value},(()=>{value===ExpressionInputType.Static?this.props.closeExpPopup():this.props.openExpPopup()}))):this.toggleExpPopup()},this.getWhetherExpDssMatchInUseDss=expression=>{const parts=expression&&expression.parts;return!!parts&&parts.every((p=>getWhetherUseDssMatchExpDss(p,this.props.useDataSources)))},this.toggleExpPopup=()=>{this.getWhetherFromExpBuilder(this.state.selectedExpFrom,this.props.useDataSources)?this.props.isExpPopupOpen?this.props.closeExpPopup():this.props.openExpPopup():this.props.closeExpPopup()},this.state={selectedExpFrom:this.getSelectedExpFromExpression(),isDropdownOpen:!1,inputValue:this.getStringFromExpression()}}componentDidUpdate(prevProps,prevState){prevState.selectedExpFrom===ExpressionInputType.Static&&this.state.selectedExpFrom!==ExpressionInputType.Static&&this.setState({inputValue:""})}render(){var _a;const{placeHolders={},autoHide}=this.props,{selectedExpFrom}=this.state,isFromExpBuilder=this.getWhetherFromExpBuilder(this.state.selectedExpFrom,this.props.useDataSources),inputValue=isFromExpBuilder?this.props.expression&&this.props.expression.name||"":this.state.inputValue,isExpressionValid=jimu_core.sNq.getWhetherExpressionValid(this.props.expression),doExpressionDssMatchInUseDss=this.getWhetherExpDssMatchInUseDss(this.props.expression),isExpressionError=!isExpressionValid||!doExpressionDssMatchInUseDss,shouldHideTypesSelector=autoHide&&(this.props.types||[]).length<=1||!(null===(_a=this.props.useDataSources)||void 0===_a?void 0:_a.length);return(0,jimu_core.Yac)("div",{style:this.props.style,ref:this.expBuilderTrigger,className:(0,jimu_core.xWm)("w-100 h-100",{[this.props.className]:!!this.props.className})},(0,jimu_core.Yac)("div",{className:"d-flex justify-content-start align-items-center component-expression-input"},!shouldHideTypesSelector&&(0,jimu_core.Yac)("div",{className:"expression-builder-trigger"},(0,jimu_core.Yac)(jimu_ui.Dropdown,{isOpen:this.state.isDropdownOpen,toggle:this.toggleDropdown,className:"w-100 h-100 expression-builder-trigger-dropdown"},(0,jimu_core.Yac)(jimu_ui.DropdownButton,{arrow:!1,dot:!0,icon:!0,ref:this.dropdownButton,title:getExpressionFromString(this.state.selectedExpFrom,this.props.intl),className:"text-truncate d-flex justify-content-center align-items-center trigger-dropdown-toggle p-0 jimu-outline-inside"},selectedExpFrom&&(0,jimu_core.Yac)(jimu_ui.Icon,{icon:this.getExpFromIcon(selectedExpFrom),className:"m-0 p-0"})),(0,jimu_core.Yac)(jimu_ui.DropdownMenu,{appendToBody:!1,strategy:"fixed"},this.props.types.map(((f,i)=>(0,jimu_core.Yac)(jimu_ui.DropdownItem,{onClick:e=>{this.onExpFromChange(f)},key:i,className:"text-default",a11yFocusBack:!1},(0,jimu_core.Yac)(jimu_ui.Icon,{icon:this.getExpFromIcon(f),className:"mr-2"}),(0,jimu_core.Yac)("span",null,getExpressionFromString(f,this.props.intl)))))))),(0,jimu_core.Yac)("div",{className:"flex-grow-1 expression-input"},isExpressionError&&isFromExpBuilder?inputValue?(0,jimu_core.Yac)("div",{className:"w-100 h-100 text-truncate ds-disabled d-flex align-items-center",onClick:this.toggleExpPopup},(0,jimu_core.Yac)("span",{className:"error-wrapper",title:inputValue},inputValue)):(0,jimu_core.Yac)("div",{className:"w-100 h-100 text-truncate ds-disabled ds-placeholder d-flex align-items-center",onClick:this.toggleExpPopup},(0,jimu_core.Yac)("span",{className:"error-wrapper",title:placeHolders[selectedExpFrom]},placeHolders[selectedExpFrom])):(0,jimu_core.Yac)("div",{className:"w-100 h-100",onClick:isFromExpBuilder?this.toggleExpPopup:void 0},(0,jimu_core.Yac)("div",{className:"w-100 h-100"},(0,jimu_core.Yac)(jimu_ui.TextInput,{className:(0,jimu_core.xWm)("w-100 h-100",{"ds-disabled":isFromExpBuilder}),value:inputValue,disabled:isFromExpBuilder,onChange:this.onInputChange,onBlur:this.onInputBlur,title:inputValue,placeholder:placeHolders[selectedExpFrom],"aria-label":this.props["aria-label"]}),isFromExpBuilder&&(0,jimu_core.Yac)("div",{className:"ds-disabled disabled-input-cover"}))))),(0,jimu_core.Yac)(expression_builder_popup,Object.assign({},this.props,{onChange:this.onExpChange,types:this.getExpressionFrom(),isOpen:this.props.isExpPopupOpen,onClose:this.props.closeExpPopup,trigger:this.expBuilderTrigger.current,backToFocusNode:this.dropdownButton.current})))}}const expression_input=(0,jimu_core.j4T)((0,jimu_theme.Xy)(_ExpressionInput,"ExpressionInput"));try{expressioninput.displayName="expressioninput",expressioninput.__docgenInfo={description:"",displayName:"expressioninput",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/components/expression-input/index.tsx#expressioninput"]={docgenInfo:expressioninput.__docgenInfo,name:"expressioninput",path:"../jimu-ui/advanced/lib/expression-builder/components/expression-input/index.tsx#expressioninput"})}catch(__react_docgen_typescript_loader_error){}try{ExpressionEditor.displayName="ExpressionEditor",ExpressionEditor.__docgenInfo={description:"",displayName:"ExpressionEditor",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},autoFocus:{defaultValue:null,description:"",name:"autoFocus",required:!1,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},widgetId:{defaultValue:null,description:"Use widget id to get widget context, e.g. whether widget is in repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},useDataSources:{defaultValue:null,description:"",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"",name:"expression",required:!0,type:{name:"Expression"}},theme:{defaultValue:null,description:"",name:"theme",required:!1,type:{name:"IMThemeVariables"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionEditor"]={docgenInfo:ExpressionEditor.__docgenInfo,name:"ExpressionEditor",path:"../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionEditor"})}catch(__react_docgen_typescript_loader_error){}try{ExpressionBuilder.displayName="ExpressionBuilder",ExpressionBuilder.__docgenInfo={description:"This component is used to build an {@link Expression}.",displayName:"ExpressionBuilder",props:{style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionBuilder"]={docgenInfo:ExpressionBuilder.__docgenInfo,name:"ExpressionBuilder",path:"../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionBuilder"})}catch(__react_docgen_typescript_loader_error){}try{ExpressionInput.displayName="ExpressionInput",ExpressionInput.__docgenInfo={description:"",displayName:"ExpressionInput",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionInput"]={docgenInfo:ExpressionInput.__docgenInfo,name:"ExpressionInput",path:"../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionInput"})}catch(__react_docgen_typescript_loader_error){}try{_ExpressionBuilder.displayName="_ExpressionBuilder",_ExpressionBuilder.__docgenInfo={description:"The `ExpressionBuilder` component allows users to build an Expression.\n\n```ts\nimport { ExpressionBuilder } from 'jimu-ui/advanced/expression-builder'\n```",displayName:"_ExpressionBuilder",props:{useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},intl:{defaultValue:null,description:"@ignore",name:"intl",required:!0,type:{name:"IntlShape"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/index.tsx#_ExpressionBuilder"]={docgenInfo:_ExpressionBuilder.__docgenInfo,name:"_ExpressionBuilder",path:"../jimu-ui/advanced/lib/expression-builder/index.tsx#_ExpressionBuilder"})}catch(__react_docgen_typescript_loader_error){}try{_ExpressionBuilderPopup.displayName="_ExpressionBuilderPopup",_ExpressionBuilderPopup.__docgenInfo={description:"The `ExpressionBuilderPopup` component allows users to build an Expression using a popup.\n\n```ts\nimport { ExpressionBuilderPopup } from 'jimu-ui/advanced/expression-builder'\n```",displayName:"_ExpressionBuilderPopup",props:{isOpen:{defaultValue:null,description:"Whether to show the popup.",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"Callback when the close icon in header of the popup is clicked.",name:"onClose",required:!0,type:{name:"() => void"}},trigger:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"trigger",required:!1,type:{name:"HTMLElement | HTMLElement[]"}},backToFocusNode:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"backToFocusNode",required:!1,type:{name:"HTMLElement"}},useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},theme:{defaultValue:null,description:"@ignore",name:"theme",required:!0,type:{name:"IMThemeVariables"}},intl:{defaultValue:null,description:"@ignore",name:"intl",required:!0,type:{name:"IntlShape"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/index.tsx#_ExpressionBuilderPopup"]={docgenInfo:_ExpressionBuilderPopup.__docgenInfo,name:"_ExpressionBuilderPopup",path:"../jimu-ui/advanced/lib/expression-builder/index.tsx#_ExpressionBuilderPopup"})}catch(__react_docgen_typescript_loader_error){}try{ExpressionBuilderPopup.displayName="ExpressionBuilderPopup",ExpressionBuilderPopup.__docgenInfo={description:"",displayName:"ExpressionBuilderPopup",props:{trigger:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"trigger",required:!1,type:{name:"HTMLElement | HTMLElement[]"}},style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},onClose:{defaultValue:null,description:"Callback when the close icon in header of the popup is clicked.",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"Whether to show the popup.",name:"isOpen",required:!0,type:{name:"boolean"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},backToFocusNode:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"backToFocusNode",required:!1,type:{name:"HTMLElement"}},theme:{defaultValue:null,description:"",name:"theme",required:!1,type:{name:"IMThemeVariables"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionBuilderPopup"]={docgenInfo:ExpressionBuilderPopup.__docgenInfo,name:"ExpressionBuilderPopup",path:"../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionBuilderPopup"})}catch(__react_docgen_typescript_loader_error){}try{ExpressionBuilderProps.displayName="ExpressionBuilderProps",ExpressionBuilderProps.__docgenInfo={description:"Props of expression builder component.",displayName:"ExpressionBuilderProps",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionBuilderProps"]={docgenInfo:ExpressionBuilderProps.__docgenInfo,name:"ExpressionBuilderProps",path:"../jimu-ui/advanced/lib/expression-builder/index.tsx#ExpressionBuilderProps"})}catch(__react_docgen_typescript_loader_error){}(0,jimu_theme.SF)("jimu-ui/advanced/expression-builder/",styles_namespaceObject);try{ExpressionEditor.displayName="ExpressionEditor",ExpressionEditor.__docgenInfo={description:"",displayName:"ExpressionEditor",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},autoFocus:{defaultValue:null,description:"",name:"autoFocus",required:!1,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},widgetId:{defaultValue:null,description:"Use widget id to get widget context, e.g. whether widget is in repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},useDataSources:{defaultValue:null,description:"",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"",name:"expression",required:!0,type:{name:"Expression"}},theme:{defaultValue:null,description:"",name:"theme",required:!1,type:{name:"IMThemeVariables"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/expression-builder.tsx#ExpressionEditor"]={docgenInfo:ExpressionEditor.__docgenInfo,name:"ExpressionEditor",path:"../jimu-ui/advanced/expression-builder.tsx#ExpressionEditor"})}catch(__react_docgen_typescript_loader_error){}try{ExpressionBuilder.displayName="ExpressionBuilder",ExpressionBuilder.__docgenInfo={description:"This component is used to build an {@link Expression}.",displayName:"ExpressionBuilder",props:{style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/expression-builder.tsx#ExpressionBuilder"]={docgenInfo:ExpressionBuilder.__docgenInfo,name:"ExpressionBuilder",path:"../jimu-ui/advanced/expression-builder.tsx#ExpressionBuilder"})}catch(__react_docgen_typescript_loader_error){}try{ExpressionInput.displayName="ExpressionInput",ExpressionInput.__docgenInfo={description:"",displayName:"ExpressionInput",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/expression-builder.tsx#ExpressionInput"]={docgenInfo:ExpressionInput.__docgenInfo,name:"ExpressionInput",path:"../jimu-ui/advanced/expression-builder.tsx#ExpressionInput"})}catch(__react_docgen_typescript_loader_error){}try{_ExpressionBuilder.displayName="_ExpressionBuilder",_ExpressionBuilder.__docgenInfo={description:"The `ExpressionBuilder` component allows users to build an Expression.\n\n```ts\nimport { ExpressionBuilder } from 'jimu-ui/advanced/expression-builder'\n```",displayName:"_ExpressionBuilder",props:{useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},intl:{defaultValue:null,description:"@ignore",name:"intl",required:!0,type:{name:"IntlShape"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/expression-builder.tsx#_ExpressionBuilder"]={docgenInfo:_ExpressionBuilder.__docgenInfo,name:"_ExpressionBuilder",path:"../jimu-ui/advanced/expression-builder.tsx#_ExpressionBuilder"})}catch(__react_docgen_typescript_loader_error){}try{_ExpressionBuilderPopup.displayName="_ExpressionBuilderPopup",_ExpressionBuilderPopup.__docgenInfo={description:"The `ExpressionBuilderPopup` component allows users to build an Expression using a popup.\n\n```ts\nimport { ExpressionBuilderPopup } from 'jimu-ui/advanced/expression-builder'\n```",displayName:"_ExpressionBuilderPopup",props:{isOpen:{defaultValue:null,description:"Whether to show the popup.",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"Callback when the close icon in header of the popup is clicked.",name:"onClose",required:!0,type:{name:"() => void"}},trigger:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"trigger",required:!1,type:{name:"HTMLElement | HTMLElement[]"}},backToFocusNode:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"backToFocusNode",required:!1,type:{name:"HTMLElement"}},useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},theme:{defaultValue:null,description:"@ignore",name:"theme",required:!0,type:{name:"IMThemeVariables"}},intl:{defaultValue:null,description:"@ignore",name:"intl",required:!0,type:{name:"IntlShape"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/expression-builder.tsx#_ExpressionBuilderPopup"]={docgenInfo:_ExpressionBuilderPopup.__docgenInfo,name:"_ExpressionBuilderPopup",path:"../jimu-ui/advanced/expression-builder.tsx#_ExpressionBuilderPopup"})}catch(__react_docgen_typescript_loader_error){}try{ExpressionBuilderPopup.displayName="ExpressionBuilderPopup",ExpressionBuilderPopup.__docgenInfo={description:"",displayName:"ExpressionBuilderPopup",props:{trigger:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"trigger",required:!1,type:{name:"HTMLElement | HTMLElement[]"}},style:{defaultValue:null,description:"@ignore",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"@ignore",name:"className",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"Will call the function when click a field or click insert button.",name:"onChange",required:!0,type:{name:"(expression: Expression) => void"}},onClose:{defaultValue:null,description:"Callback when the close icon in header of the popup is clicked.",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"Whether to show the popup.",name:"isOpen",required:!0,type:{name:"boolean"}},widgetId:{defaultValue:null,description:"Id of widget.\nUse widget id to get widget context, e.g. whether widget is in a repeated data source context.",name:"widgetId",required:!1,type:{name:"string"}},useDataSources:{defaultValue:null,description:"Widget's `useDataSources`, which means data sources that widget is using.\nWill use these data source to build expression.",name:"useDataSources",required:!0,type:{name:"ImmutableArray<UseDataSource>"}},expression:{defaultValue:null,description:"Expression you want to show in the builder.",name:"expression",required:!0,type:{name:"Expression | ImmutableObject<Expression>"}},types:{defaultValue:null,description:"The builder contains three tabs, pass in `types` to show some of the tabs.\n`ExpressionBuilderType` is enum type.\n\n```ts\nimport { ExpressionBuilderType } from 'jimu-ui/advanced/expression-builder'\n```",name:"types",required:!0,type:{name:"ImmutableArray<ExpressionBuilderType>"}},fieldTypes:{defaultValue:null,description:"Field types in attribute tab.",name:"fieldTypes",required:!1,type:{name:"ImmutableArray<JimuFieldType>"}},backToFocusNode:{defaultValue:null,description:"See `SidePopper` in jimu-ui/advanced/setting-components for more details.",name:"backToFocusNode",required:!1,type:{name:"HTMLElement"}},theme:{defaultValue:null,description:"",name:"theme",required:!1,type:{name:"IMThemeVariables"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/expression-builder.tsx#ExpressionBuilderPopup"]={docgenInfo:ExpressionBuilderPopup.__docgenInfo,name:"ExpressionBuilderPopup",path:"../jimu-ui/advanced/expression-builder.tsx#ExpressionBuilderPopup"})}catch(__react_docgen_typescript_loader_error){}try{ExpressionBuilderProps.displayName="ExpressionBuilderProps",ExpressionBuilderProps.__docgenInfo={description:"Props of expression builder component.",displayName:"ExpressionBuilderProps",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/expression-builder.tsx#ExpressionBuilderProps"]={docgenInfo:ExpressionBuilderProps.__docgenInfo,name:"ExpressionBuilderProps",path:"../jimu-ui/advanced/expression-builder.tsx#ExpressionBuilderProps"})}catch(__react_docgen_typescript_loader_error){}}}]);
//# sourceMappingURL=8007.61d14e62.iframe.bundle.js.map