{"version":3,"file":"5091.2ff18208.iframe.bundle.js","mappings":";;;;;;;;;;AAeA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAZA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4IA;;;;ACzIA;;;;AAIA;;;;;;;;;AASA;;;AAGA;;;;AAIA;AACA;AACA;;;;;;;;;;;;AAYA;;;;;;;AAOA;AACA;;;;;;AAMA;;;;;;AAMA;AACA;AACA;;;;AAIA;;;;;;;;;;;;;;;;;AAiBA;;;;;;;AAOA;;AAEA;;;;AAIA;;;;;;;;;;;AAWA;;;;AAIA;AACA;;;;;;;;;AASA;;;;;;;AAOA;;;;;;;;;AASA;;;;;;;;;;AAUA;;;;;;;;;ACxIA;AACA;;;;AAIA;;;AAGA;;;;;;;AAOA;;ACfA;;AAIA;;AAEA;AACA;;;;;;;AAOA;;AAEA;;;ACjBA;;;AAGA;AACA;;;;;;;;AAQA;;;;AAIA;;;;;AAKA;;;;;AAKA;;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsDA;;;;;;;;;AAYA;;;;AAIA;;;AAGA;AACA;;;;AAIA;;;AAGA;;;;;AAKA;;;;AAIA;;;;;AAKA;;;;;AAKA;;;;AAIA;;;;;;;;;;;AAWA;;;;;;;;;;AAYA;ACpKA;;AAEA;;;AAGA;;;AAGA;;;AAGA;AACA;;;AAGA;AACA;;AAEA;;;AAGA;AACA;AACA;;;;;;AAMA;;;;AAIA;;AAGA;ACpCA;;AAEA;AACA;;;AAGA;AACA;;AAEA;;;AAGA;AACA;;AAGA;;;;;ACXA;;;;;AAKA;ACVA;;;;;;AAMA;AACA;;;;AAKA;;ACXA;;;;;;;;;;;AAWA;;AAEA;;;;;;;;;;;;;;;AAeA;;;;;;;;AAQA;;;;;;;;;;;;AAYA;;;;AAIA;;AAEA;;;;;;;ACzBA;;;;;;AAMA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;;AAEA;;;;;;AAMA;;;;;;;;;AChDA;;;;;;;;;;;AAWA;;AAEA;;;;;;ACbA;ACgCA;;AAWA;;ACyIA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;ACnLA;AACA;AAQA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACiEA;;;;AA+BA;;;;;;;;;;;;;;;;;;;;;;;;;AC1FA;;;;;;;;;;;;;;;;;;AC+BA;;;;AClDA;;;;;;;;;;;AAYA;ACpBA;AACA;;;ACQA;;;;;;;;;;;;;;;;;;AAkBA;;;;;;;;;;;;;;;;;;AAkBA;;;;;;;;;;;AAWA;;;;;;;;AAQA;;;;;;;;;;;;;;AC9BA;AACA;;;;;;;;;;AAUA;;;AAOA;;;;AASA;;;;;AChCA;;;ACLA;;;;;;;AAaA;;;;;ACZA;;;ACTA;;;;;AAKA;;;;;;;AAOA;;;;;;;;;;;;;;;ACGA;;;;;;;AASA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACyHA;;;AAwBA;;AAGA;;;;;;;;;;;;;;;;;;;;ACnHA;;;AAmBA;;AAGA;;;;;;;;ACxFA;;;;;;AAiDA;;;AAIA;;;;;;;;;;;;;;;;;;;;;;AC3CA;ACwLA;;;;;AAKA;;AAKA;;;;;AASA;;;;AAQA;;;;;;;;;;AC3BA;;;;AAKA;;;;;ACjLA;;;;ACoJA;;;;;;;;;;ACmDA;;AC1MA;;AAGA;;AAEA;AACA;;;;;AAMA;;ACtCA;;;;;;;;;;;;AAaA;;;;;;;;;;;;;;;;;;;;;;;;AC0MA;;;;;;;;AClNA;;;;;;;AAOA;;;;;;AAMA;;;;AAIA;;;;AAIA;;;;AAKA","sources":["webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/widget-selector.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/sort-setting.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/style-picker.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/layout/collapse.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/link-selector-content.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/proxy-setting.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/proxy-setting-popup.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/radio-group.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/side-popper.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/jimu-layer-view-selector-deprecated.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/jimu-layer-view-selector-dropdown.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/styles/components/jimu-layer-view-selector.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/jimu-layer-view-selector-deprecated/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/jimu-layer-view-selector/dropdown/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/proxy-setting/setting-popup/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/page-aware-popper.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/widget-list-popper/widget-list.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/widget-list-popper/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/sort-tree-popper/sort-tree.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/collapsable-reset-panel/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/template-selector/template-item.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/template-selector/template-list.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/page-template-popper/page-template-list.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/page-template-popper/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/window-template-popper/window-template-list.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/window-template-popper/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/template-selector/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/size-mode-select/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/utility-selector/components/org-utility.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/utility-selector/components/added-utility.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/utility-selector/components/utility-item.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/utility-selector/components/new-utility-panel.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/utility-selector/components/add-utility-tabs.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/utility-selector/components/utility-selector.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/search-setting/dataSetting/display-field-select.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/search-setting/dataSetting/set-locator-source.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/search-setting/dataSetting/datasource-list.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/search-setting/dataSetting/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/search-setting/search-suggestion-setting.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/multiple-jimu-map-config/index.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/setting-components/components/switch-card-layout/card-layout-setting.tsx"],"sourcesContent":["import { css } from 'jimu-core';\nexport const widgetSelectorStyles = (props) => {\n    const theme = props.theme;\n    const closeImageUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAsElEQVQ4jaWSLQ7EIBhEv2LxnAzP1cBzAU6DhKCpZneaQHYpP2k6omreCzA9yjf0IgyfGCMZY+g8zy2ADrpgmsA5R977raTC6IJpAiklCSEopTSVVBgddME0AeeclFJTSQ+jCwY5fh9xVERm8E0wkiAzeCjoJcgMbm/wJjdBf4XdOmwF49irdf4Es6l2E7MVXLOSXAJr7XKqkQTMFcwYQiha65JzLruggy4YZPgfPMkHXzQME+F7oHYAAAAASUVORK5CYII=';\n    const widgetPlaceholderImageUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA20lEQVQ4jWPkidn2n4ECwESJ5iFgABsLI8PBRiuGS732DKJ8bKQbwMHKzKAqyc0gK8zBIMDNilUNI6FYkBBgBxrExPDg9Xes8iy4NIZYSDJ4GYkx/Pj1j6F25Q2cFuD0wo2nXxi42ZkZYu1lGMItpUg34Mrjzwx//0HYT9//IN0AFiZGBjstIaAh/xkOXntLugHGyvwM/FysDBcefGT48PUP6QaI8ELinZ2FicFGQ4iBnRW7UmY2vegGbBIPXn1j+P//P8OXn38ZPn77zXDxwSesBhBMB4QAxXkBAMaDOywJrob4AAAAAElFTkSuQmCC';\n    return css `\r\n    .component-choose-widget-popup{\r\n      .widget-card-active-btn{\r\n        outline: none;\r\n      }\r\n    }\r\n    div.component-choose-widget-popup-modal{\r\n      width: 850px;\r\n      max-width: 850px;\r\n      height: 600px;\r\n      background: ${theme.ref.palette.white};\r\n      border-radius: 4px;\r\n      position: absolute;\r\n      margin: auto;\r\n      top: 0;\r\n      bottom: 0;\r\n      left: 0;\r\n      right: 0;\r\n      .component-choose-widget-clear-border{\r\n        border: 0;\r\n        padding: 0;\r\n      }\r\n      .modal-content{\r\n        border: 0;\r\n        padding: 20px 10px 20px 40px;\r\n        position: static;\r\n      }\r\n      .component-choose-widget-modal-header{\r\n        .choose-widget-popup-close{\r\n          width: 50px;\r\n          height: 50px;\r\n          display: inline-block;\r\n          right: 28px;\r\n          position: absolute;\r\n          top: 10px;\r\n          &:hover{\r\n            cursor: pointer;\r\n          }\r\n        }\r\n        .choose-widget-popup-close:after{\r\n          content: '';\r\n          display: inline-block;\r\n          width: 16px;\r\n          height: 16px;\r\n          background-image: url(${closeImageUrl});\r\n          position: relative;\r\n          left: 18px;\r\n          top: 12px;\r\n        }\r\n      }\r\n      .component-choose-widget-modal-body{\r\n        display: -webkit-box;\r\n        display: -ms-flexbox;\r\n        display: flex;\r\n        -ms-flex-wrap: wrap;\r\n        flex-wrap: wrap;\r\n        -webkit-box-pack: start;\r\n        -ms-flex-pack: start;\r\n        justify-content: flex-start;\r\n        margin: 40px 0 10px 0;\r\n        .widget-card-item{\r\n          width: 70px;\r\n          height: 120px;\r\n          border: 0;\r\n          margin: 0 30px 0 0;\r\n          &:hover{\r\n            cursor: pointer;\r\n          }\r\n          .widget-card-image{\r\n            width: 70px;\r\n            height: 70px;\r\n            border: 1px solid #ccc;\r\n            display: -webkit-box;\r\n            display: -ms-flexbox;\r\n            display: flex;\r\n            -webkit-box-align: center;\r\n            -ms-flex-align: center;\r\n            align-items: center;\r\n            -webkit-box-pack: center;\r\n            -ms-flex-pack: center;\r\n            justify-content: center;\r\n            >div{\r\n              width: 30px;\r\n              height: 30px;\r\n              position: relative;\r\n              &:after{\r\n                display: none;\r\n              }\r\n            }\r\n          }\r\n          .widget-card-content{\r\n            font-size: 12px;\r\n            color: #000;\r\n            letter-spacing: 0.33px;\r\n            padding: 2px;\r\n            text-align: center;\r\n            line-height: 14px;\r\n          }\r\n        }\r\n        .widget-card-selected{\r\n          .widget-card-image{\r\n            border: 2px solid #0C5CB6;\r\n            >div:after{\r\n              content: '';\r\n              display: block;\r\n              width: 16px;\r\n              height: 16px;\r\n              position: absolute;\r\n              top: -20px;\r\n              right: -20px;\r\n              background-image: url(${widgetPlaceholderImageUrl});\r\n            }\r\n          }\r\n        }\r\n      }\r\n      .component-choose-widget-modal-footer{\r\n        position: absolute;\r\n        bottom: 20px;\r\n        right: 40px;\r\n        >button{\r\n          font-size: 14px;\r\n          letter-spacing: 0.39px;\r\n          text-align: center;\r\n          vertical-align: middle;\r\n        }\r\n        button:first-of-type {\r\n          background-color: #0075D0;\r\n          border: 1px solid  #0075D0;\r\n          border-radius: 3px;\r\n          color: #ffffff;\r\n        }\r\n        button:last-of-type{\r\n          background-color: #ffffff;\r\n          border: 1px solid #CCCCCC;\r\n          border-radius: 3px;\r\n          color: #000000;\r\n        }\r\n      }\r\n    }\r\n  `;\n};\n","import { css, polished } from 'jimu-core';\nexport const sortSettingStyle = (props) => {\n    const theme = props.theme;\n    return css `\r\n    width:100%;\r\n    &.single-row-item {\r\n        .select-con {\r\n            padding: ${polished.rem(10)} ${polished.rem(0)};\r\n            .option-name-con {\r\n                margin-bottom: 0;\r\n                .close-con>span {\r\n                    margin-left: ${polished.rem(10)};\r\n                }\r\n            }\r\n        }\r\n    }\r\n    .padding-0 {\r\n        padding: 0;\r\n    }\r\n    .jimu-tree-item {\r\n        margin-bottom:${polished.rem(10)};\r\n    }\r\n    .jimu-tree-item__draggable {\r\n        box-shadow: 0 0 0 2px ${polished.rgba(theme.ref.palette.white, 0.3)};\r\n    }\r\n    .add-option-btn {\r\n        & {\r\n            color:${theme.sys.color.primary.light};\r\n            margin-top:${polished.rem(10)};\r\n            margin-bottom: ${polished.rem(17)};\r\n            cursor: pointer;\r\n            font-size:13px;\r\n            overflow: hidden;\r\n            padding: 0;\r\n        }\r\n        .add-option-icon{\r\n            margin-right: 4px;\r\n        }\r\n    }\r\n    .no-sort-remind {\r\n        margin: 70px auto 0;\r\n        color: ${theme.ref.palette.neutral[700]};\r\n        font-size: 13px;\r\n        text-align: center;\r\n    }\r\n    .select-con {\r\n        & {\r\n            box-sizing:border-box;\r\n            padding-right: ${polished.rem(10)};\r\n            padding: ${polished.rem(8)} ${polished.rem(10)} ${polished.rem(10)} ${polished.rem(6)};\r\n        }\r\n        .option-name-con {\r\n            & {\r\n              display: flex;\r\n              align-items: center;\r\n              margin-bottom:${polished.rem(5)};\r\n              width: 100%;\r\n            }\r\n            .option-name {\r\n              font-size: 13px;\r\n              line-height: 13px;\r\n              color: ${theme.ref.palette.neutral[1100]};\r\n              height: ${polished.rem(30)};\r\n              line-height: ${polished.rem(25)};\r\n              cursor: pointer;\r\n              overflow: hidden;\r\n              width: 0;\r\n              padding-right: ${polished.rem(4)};\r\n              .edit-input {\r\n                max-width: 88%;\r\n                input {\r\n                    width: 80px;\r\n                }\r\n                input:placeholder-shown {\r\n                    text-overflow: ellipsis;\r\n                }\r\n              }\r\n            }\r\n            .option-name input {\r\n                display:inline-block;\r\n                width: auto;\r\n                height: 100%;\r\n            }\r\n            .jimu-input {\r\n                line-height: ${polished.rem(30)};\r\n                vertical-align: middle;\r\n            }\r\n            .input-wrapper {\r\n                vertical-align: middle;\r\n            }\r\n            .option-name-icon-con {\r\n                margin-left: ${polished.rem(5)};\r\n                svg {\r\n                    margin-top:  ${polished.rem(5)};\r\n                }\r\n            }\r\n            .option-name-icon {\r\n                color: ${theme.ref.palette.neutral[900]};\r\n                cursor: pointer;\r\n            }\r\n            .option-name span {\r\n                display: inline-block;\r\n                text-overflow: ellipsis;\r\n                overflow:hidden;\r\n            }\r\n            .close-con {\r\n                svg {\r\n                    margin: 0;\r\n                    margin-top:  ${polished.rem(2)};\r\n                }\r\n            }\r\n            .close-con>span {\r\n                margin-right: ${polished.rem(10)};\r\n                color: ${theme.ref.palette.black};\r\n                cursor: pointer;\r\n            }\r\n        }\r\n\r\n        .select-down-con {\r\n            & {\r\n                display: flex;\r\n                align-items: center;\r\n                height: ${polished.rem(34)};\r\n            }\r\n            .sort-arrow-down-icon {\r\n                margin-right: 0;\r\n            }\r\n            .select-input {\r\n                flex-grow:1;\r\n                color: ${theme.ref.palette.neutral[1200]};\r\n            }\r\n            .sort-button {\r\n                margin-left: 5px;\r\n                cursor: pointer;\r\n                border:none;\r\n            }\r\n            .sort-field-selector {\r\n                & {\r\n                    background:${theme.sys.color.secondary.light};\r\n                    border-radius: 2px;\r\n                    flex-grow: 1;\r\n                    width: 0;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n  `;\n};\n","import { css } from 'jimu-core';\nexport const stylePickerStyles = (props) => {\n    const theme = props.theme;\n    return css `\r\n    .widget-setting--stylepicker {\r\n      display: grid;\r\n      grid-template-columns: repeat(2, 1fr);\r\n      grid-gap: 10px;\r\n    }\r\n\r\n    .widget-setting--stylepicker-item {\r\n      height: 93px;\r\n      border: 1px solid ${theme.ref.palette.neutral[500]};\r\n      background-color: ${theme.ref.palette.white};\r\n      background-repeat: no-repeat;\r\n      background-position: center;\r\n      &:hover {\r\n        border-color: ${theme.sys.color.primary.main};\r\n      }\r\n      &.active {\r\n        border: 2px solid ${theme.sys.color.primary.main};\r\n      }\r\n      &.full-width {\r\n        grid-column-start: 1;\r\n        grid-column-end: 3;\r\n      }\r\n    }\r\n  `;\n};\n","import { css } from 'jimu-core';\nexport const settingCollapseStyles = (props) => {\n    var _a, _b, _c, _d, _e, _f;\n    const isOpen = props === null || props === void 0 ? void 0 : props.isOpen;\n    const type = (_a = props === null || props === void 0 ? void 0 : props.type) !== null && _a !== void 0 ? _a : 'default';\n    const theme = props.theme;\n    const light500 = (_c = (_b = theme === null || theme === void 0 ? void 0 : theme.ref.palette) === null || _b === void 0 ? void 0 : _b.neutral) === null || _c === void 0 ? void 0 : _c[500];\n    const light800 = (_e = (_d = theme === null || theme === void 0 ? void 0 : theme.ref.palette) === null || _d === void 0 ? void 0 : _d.neutral) === null || _e === void 0 ? void 0 : _e[700];\n    const primary = (_f = theme === null || theme === void 0 ? void 0 : theme.sys.color) === null || _f === void 0 ? void 0 : _f.primary.main;\n    if (type !== 'primary') {\n        return css `\r\n    .dividing-line {\r\n      background-color: ${light800};\r\n    }\r\n    `;\n    }\n    return css `\r\n    .handle {\r\n      border-top: 2px solid ${isOpen ? primary : light500};\r\n      background-color: ${light500};\r\n      .title {\r\n        padding-left: 8px;\r\n        padding-right: 8px;\r\n      }\r\n    }\r\n    .dividing-line {\r\n      background-color: ${light800};\r\n    }\r\n    `;\n};\n","import { css, polished } from 'jimu-core';\nexport function linkSelectorContentStyles(props) {\n    var _a, _b, _c, _d, _e;\n    const theme = props.theme;\n    const gray = (_c = (_b = (_a = theme === null || theme === void 0 ? void 0 : theme.ref) === null || _a === void 0 ? void 0 : _a.palette) === null || _b === void 0 ? void 0 : _b.neutral[500]) !== null && _c !== void 0 ? _c : '#ccc';\n    const cyan = (_e = (_d = theme === null || theme === void 0 ? void 0 : theme.sys) === null || _d === void 0 ? void 0 : _d.color.primary.main) !== null && _e !== void 0 ? _e : 'blue';\n    const settingColor = polished.rgba(gray, 0.5);\n    if (window.jimuConfig.isInBuilder) {\n        return css `\r\n    .widget-builder-link-selector {\r\n      .collapse-btn{\r\n        margin-right: ${polished.rem(-16)};\r\n      }\r\n      .option-name{\r\n        font-size: ${polished.rem(13)};\r\n        color: ${theme.ref.palette.neutral[900]};\r\n      }\r\n      .link-selector-list {\r\n        .view-border{\r\n          border-width: 1px;\r\n          border-style: solid;\r\n        }\r\n        .link-selector-list-item {\r\n          height: ${polished.rem(30)};\r\n          cursor: pointer;\r\n\r\n          &:hover {\r\n            background-color: ${settingColor};\r\n          }\r\n        }\r\n\r\n        .link-selector-list-select {\r\n          background-color: ${settingColor};\r\n        }\r\n      }\r\n\r\n      select {\r\n        padding-top: ${polished.rem(2)} !important;\r\n      }\r\n\r\n      .item-selected {\r\n        background-color: ${cyan} !important;\r\n      }\r\n\r\n      .form-check-input {\r\n        span {\r\n          background: #00A6B6 !important;\r\n        }\r\n      }\r\n\r\n      .form-check-input:hover {\r\n        border-color: gray;\r\n      }\r\n\r\n      input[type='radio'].form-check-input {\r\n        -webkit-appearance: none;\r\n        -moz-appearance: none;\r\n        background: transparent;\r\n        border: 1px solid #000;\r\n        width: 16px;\r\n        height: 16px;\r\n        border-radius: 50%;\r\n        transition: all 0.2s ease;\r\n        &:before {\r\n        content: '';\r\n        display: block;\r\n        position: absolute;\r\n        width: 0;\r\n        height: 0;\r\n        border-radius: 50%;\r\n        background: #00A6B6 !important;\r\n        margin: 8px;\r\n        transition: all 0.2s ease-out;\r\n        }\r\n        &:hover {\r\n        border-color: #00A6B6 !important;\r\n        }\r\n        &:checked {\r\n        &:before {\r\n            width: 8px;\r\n            height: 8px;\r\n            margin: 3px;\r\n        }\r\n        }\r\n      }\r\n      .link-setting-cursor-pointer{\r\n        cursor: pointer;\r\n      }\r\n      .open-type-label{\r\n        width: 100%;\r\n        display: block;\r\n      }\r\n    }\r\n    .url-error-container{\r\n      *{\r\n        color: ${theme.sys.color.error.main};\r\n      }\r\n      div{\r\n        width: calc(100% - 20px);\r\n        margin-left: 4px;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n    }\r\n  `;\n    }\n    else {\n        return css `\r\n    .widget-builder-link-selector {\r\n      .collapse-btn{\r\n        position: absolute;\r\n        right: ${polished.rem(-4)};\r\n      }\r\n      .option-name{\r\n        font-size: ${polished.rem(13)};\r\n        color: ${theme.ref.palette.neutral[900]};\r\n        font-weight: 500;\r\n      }\r\n      .item-common{\r\n        background: ${theme.ref.palette.white};\r\n      }\r\n      .view-border{\r\n        border: 1px solid ${theme.ref.palette.neutral[500]};\r\n      }\r\n      .link-selector-list {\r\n\r\n        .link-selector-list-item {\r\n          height: ${polished.rem(30)};\r\n          cursor: pointer;\r\n\r\n          &:hover {\r\n            background-color: ${settingColor};\r\n          }\r\n        }\r\n\r\n        .link-selector-list-select {\r\n          background-color: ${settingColor};\r\n        }\r\n      }\r\n\r\n      select {\r\n        padding-top: ${polished.rem(2)} !important;\r\n      }\r\n\r\n      .item-selected {\r\n        background-color: ${cyan} !important;\r\n      }\r\n      .link-setting-cursor-pointer{\r\n        cursor: pointer;\r\n      }\r\n      .open-type-label{\r\n        width: 100%;\r\n        display: block;\r\n      }\r\n      .url-error-container{\r\n        *{\r\n          color: ${theme.sys.color.error.main};\r\n        }\r\n        div{\r\n          width: calc(100% - 20px);\r\n          margin-left: 4px;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis;\r\n        }\r\n      }\r\n    }\r\n  `;\n    }\n}\n","import { css, polished } from 'jimu-core';\nexport function proxySettingStyles(props) {\n    const theme = props.theme;\n    return css `\r\n    color: ${theme.ref.palette.neutral[1000]};\r\n    .font-size-13{\r\n      font-size: ${polished.rem(13)} !important;\r\n    }\r\n    .subscriber-warning{\r\n      font-size: ${polished.rem(13)};\r\n    }\r\n    .secondary-title{\r\n      font-size: ${polished.rem(14)};\r\n    }\r\n    .content-table{\r\n      font-size: ${polished.rem(13)};\r\n      color: ${theme.ref.palette.neutral[1100]};\r\n    }\r\n    .content-table-header{\r\n      height: ${polished.rem(32)};\r\n      background-color: ${theme.ref.palette.neutral[500]};\r\n      display: block;\r\n      line-height: ${polished.rem(30)};\r\n    }\r\n    .content-table-tr{\r\n      height: ${polished.rem(39)};\r\n      line-height: ${polished.rem(39)};\r\n      border-bottom: 1px solid ${theme.ref.palette.neutral[500]};\r\n    }\r\n    .col-4, .col-2{\r\n      height: 100%;\r\n    }\r\n    .request-limit{\r\n      margin-top: ${polished.rem(6)};\r\n    }\r\n    .request-interval{\r\n      display: block;\r\n      margin-top: ${polished.rem(-3)};\r\n    }\r\n  `;\n}\n","import { css, polished } from 'jimu-core';\nexport function proxySettingPopupStyles(props) {\n    const theme = props.theme;\n    return css `\r\n    max-width: ${polished.rem(960)} !important;\r\n    .header{\r\n      font-size: ${polished.rem(16)};\r\n      color: ${theme.ref.palette.neutral[1000]};\r\n    }\r\n    .proxy-setting-container{\r\n      width: ${polished.rem(960)};\r\n      height: ${polished.rem(640)};\r\n      border: 0;\r\n      color: ${theme.ref.palette.neutral[1000]};\r\n    }\r\n    .px-30{\r\n      padding-right: ${polished.rem(30)};\r\n      padding-left: ${polished.rem(30)};\r\n    }\r\n  `;\n}\n","import { css } from 'jimu-core';\nexport const radioGroupStyle = (props) => {\n    const theme = props.theme;\n    const gutter = props.gutter;\n    return css `\r\n    margin-bottom: 0;\r\n    label {\r\n      display: inline-flex;\r\n      align-items: center;\r\n      margin-right: ${gutter || theme.sys.spacing(4)};\r\n      .jimu-radio {\r\n        margin-right: 8px;\r\n      }\r\n    }\r\n  `;\n};\n","import { css, polished } from 'jimu-core';\nexport function sidePopperStyles(props) {\n    const theme = props.theme;\n    return css `\r\n    width: ${polished.rem(260)};\r\n    height: calc(100vh - 70px);\r\n    padding: 0;\r\n    overflow: hidden;\r\n    border-radius: 0;\r\n    box-shadow: 0 0 0;\r\n    border-left: 1px solid ${theme.ref.palette.neutral[700]};\r\n    border-right: 1px solid ${theme.ref.palette.neutral[700]};\r\n    border-top: 0;\r\n    border-bottom: 0;\r\n    margin: 0 !important;\r\n  `;\n}\n","import { css } from 'jimu-core';\nexport const JimuLayerViewSelectorDeprecatedStyles = (props) => {\n    const theme = props.theme;\n    return css `\r\n    .dropdown-menu--inner {\r\n      background-color: ${theme.sys.color.secondary.light};\r\n      padding: 0;\r\n    }\r\n\r\n    .dropdown-toggle-content {\r\n      width: 100%;\r\n    }\r\n\r\n    .layerviewselector-input {\r\n      width: 100%;\r\n      height: 30px !important;\r\n      background-color: ${theme.sys.color.secondary.light};\r\n      &:hover {\r\n        background-color: ${theme.sys.color.secondary.light};\r\n      }\r\n      flex-direction: unset !important;\r\n    }\r\n\r\n    .layerviewselector-input-text {\r\n      max-width: calc(100% - 13px);\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n    }\r\n\r\n    .layerviewselector-bg {\r\n      max-height: 270px;\r\n      overflow-y: auto;\r\n      background-color: ${theme.sys.color.secondary.light};\r\n    }\r\n\r\n    .layerviewselector-item-bg {\r\n      cursor: pointer;\r\n    }\r\n\r\n    .layerviewselector-item-bg:hover {\r\n      background-color: ${theme.sys.color.primary.main};\r\n    }\r\n\r\n    .layerviewselector-ds-item {\r\n      cursor: pointer;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n      width: 100%;\r\n    }\r\n\r\n    .layerviewselector-ds-item:hover {\r\n      background-color: ${theme.sys.color.primary.main};\r\n    }\r\n\r\n    .layerviewselector-ds-item-selected {\r\n      background-color: ${theme.sys.color.primary.main};\r\n    }\r\n  `;\n};\n","import { css, polished } from 'jimu-core';\nimport { getBoxStyles } from 'jimu-theme';\nfunction getInputHeight(inputVarsBySize, inputBorderWidth) {\n    const heightInner = polished.math(`\r\n    ${inputVarsBySize.fontSize} * ${inputVarsBySize.lineHeight} +\r\n    ${inputVarsBySize.paddingY} * 2`);\n    return inputBorderWidth.toString() === '0'\n        ? heightInner\n        : `calc(${heightInner} + ${inputBorderWidth} * 2)`;\n}\nfunction getInputSizingStyles(inputVars, size) {\n    const inputVarsBySize = inputVars.sizes[size];\n    return `\r\n    height: ${inputVarsBySize.height !== 'auto'\n        ? inputVarsBySize.height\n        : getInputHeight(inputVarsBySize, inputVars.border.width)};\r\n    padding: ${inputVarsBySize.paddingY} ${inputVarsBySize.paddingX};\r\n    font-size: ${inputVarsBySize.fontSize};\r\n    line-height: ${inputVarsBySize.lineHeight};\r\n    border-radius: ${inputVarsBySize.borderRadius};\r\n  `;\n}\nexport const JimuLayerViewSelectorDropdownStyles = (props) => {\n    var _a, _b;\n    const theme = props.theme;\n    const buttonProps = props === null || props === void 0 ? void 0 : props.buttonProps;\n    const inputVars = (_a = theme === null || theme === void 0 ? void 0 : theme.components) === null || _a === void 0 ? void 0 : _a.input;\n    return css `\r\n    width: 100%;\r\n      > .dropdown{\r\n        > .dropdown-button {\r\n          text-align: start;\r\n        }\r\n      }\r\n      ${(_b = buttonProps === null || buttonProps === void 0 ? void 0 : buttonProps.type) !== null && _b !== void 0 ? _b : css `\r\n      /* Button override */\r\n        > .dropdown{\r\n          > .dropdown-button {\r\n            &,\r\n            &:hover {\r\n              color: ${inputVars.color};\r\n              background-color: ${inputVars.bg};\r\n              background-clip: padding-box;\r\n              box-shadow: ${inputVars.boxShadow};\r\n              transition: ${inputVars.transition};\r\n              text-decoration: none;\r\n              ${getInputSizingStyles(inputVars, 'sm')}\r\n              ${getBoxStyles(inputVars)}\r\n            }\r\n            &[aria-expanded=\"true\"] {\r\n              color: ${inputVars.color};\r\n              background-color: ${inputVars.focus.bg};\r\n              border-color: ${inputVars.focus.borderColor};\r\n              text-decoration: none;\r\n              box-shadow: ${inputVars.boxShadow}, ${inputVars.focus.boxShadow};\r\n            }\r\n          }\r\n        }\r\n      `}\r\n\r\n  `;\n};\n","import { css } from 'jimu-core';\nexport const JimuLayerViewSelectorStyles = (props) => {\n    const height = props.isInDropdown ? '366px' : 'calc(100% - 34px)';\n    return css `\r\n    .button-container {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      .search-input {\r\n        width: calc(100% - 32px);\r\n      }\r\n      .layer-label {\r\n        font-size: 14px;\r\n        color: ${props.theme.sys.color.surface.paperHint};\r\n        font-weight: 600;\r\n        margin-left: 2px;\r\n      }\r\n      .right-buttons {\r\n        display: flex;\r\n        gap: var(--sys-spacing-1);\r\n      }\r\n    }\r\n    .tree-container{\r\n      margin-top: 16px;\r\n      height: ${height};\r\n    }\r\n    `;\n};\n","/** @jsx jsx */\nimport { React, jsx, css, classNames, ReactResizeDetector, MultipleDataSourceComponent, DataSourceComponent, injectIntl, getAppStore, Immutable, DataSourceManager } from 'jimu-core';\nimport { Dropdown, DropdownButton, DropdownMenu } from 'jimu-ui';\nimport { DsListForSelector } from './ds-list-for-selector';\nimport { withStyles } from 'jimu-theme';\nconst STYLE = css `\r\n& {\r\n  .ds-selector > span {\r\n    display: none;\r\n  }\r\n}\r\n`;\nclass _JimuLayerViewSelectorDeprecated extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.selectorConRef = React.createRef();\n        this.toggleList = (evt) => {\n            this.setState({\n                listOpen: !this.state.listOpen\n            });\n        };\n        this.onResize = ({ width, height }) => {\n            this.setState({\n                width: width\n            });\n        };\n        this.handleChooseLayer = (selectedDsJson) => {\n            if (this.props.onSelect) {\n                if (selectedDsJson) {\n                    const rootDs = DataSourceManager.getInstance().getDataSource(selectedDsJson.rootDataSourceId);\n                    const layerDs = DataSourceManager.getInstance().getDataSource(selectedDsJson.dataSourceId);\n                    const layerId = layerDs.id; // let survey widget work, need @teng9981 's help to review\n                    const jimuLayerId = rootDs.isDataSourceSet() && rootDs.getJimuChildId(layerId)[0];\n                    this.props.onSelect(Immutable({\n                        jimuMapViewId: `${this.props.useMapWidgetIds[0]}-${selectedDsJson.rootDataSourceId}`,\n                        jimuLayerId: jimuLayerId,\n                        dataSourceId: selectedDsJson && selectedDsJson.dataSourceId,\n                        rootDataSourceId: selectedDsJson && selectedDsJson.rootDataSourceId\n                    }));\n                }\n                else {\n                    this.props.onSelect(Immutable({}));\n                }\n            }\n            this.setState({\n                listOpen: false\n            });\n        };\n        this.handleClickNone = () => {\n            if (this.props.onSelect) {\n                this.props.onSelect(Immutable({}));\n            }\n            this.setState({\n                listOpen: false\n            });\n        };\n        this.getTitle = () => {\n            if (this.props.jimuLayerViewInfo && this.props.useMapWidgetIds && this.props.useMapWidgetIds[0] && this.props.jimuLayerViewInfo.dataSourceId) {\n                return (jsx(DataSourceComponent, { useDataSource: Immutable({\n                        dataSourceId: this.props.jimuLayerViewInfo.dataSourceId,\n                        mainDataSourceId: this.props.jimuLayerViewInfo.dataSourceId,\n                        rootDataSourceId: this.props.jimuLayerViewInfo.rootDataSourceId\n                    }) }, (ds, info, query) => {\n                    return ds === null || ds === void 0 ? void 0 : ds.getLabel();\n                }));\n            }\n            else {\n                return this.getNoneString();\n            }\n        };\n        this.getContent = () => {\n            const widgetId = this.props.useMapWidgetIds && this.props.useMapWidgetIds[0];\n            const config = getAppStore().getState().appStateInBuilder.appConfig;\n            const widgetJson = config.widgets[widgetId];\n            if (widgetJson && widgetJson.useDataSources && widgetJson.useDataSources[0]) {\n                return (jsx(\"div\", { className: 'w-100 mt-1 mb-2' },\n                    jsx(\"div\", { onClick: () => { this.handleClickNone(); } },\n                        jsx(\"div\", { className: 'layerviewselector-ds-item pl-2 pr-2' }, this.getNoneString())),\n                    jsx(\"div\", { className: 'w-100 mt-1 mb-1' },\n                        jsx(\"div\", { className: 'w-100 border border-bottom-0 border-right-0 border-left-0' })),\n                    jsx(\"div\", { className: 'ds-selector' },\n                        jsx(MultipleDataSourceComponent, { useDataSources: widgetJson.useDataSources }, (dss, infos) => {\n                            const fromRootDsIds = Immutable(Object.keys(dss));\n                            const selectedDsIds = [];\n                            if (this.props.jimuLayerViewInfo && this.props.jimuLayerViewInfo.dataSourceId) {\n                                selectedDsIds.push(this.props.jimuLayerViewInfo.dataSourceId);\n                            }\n                            return (jsx(DsListForSelector, { fromRootDsIds: fromRootDsIds, onSelect: (selectedDsJson) => { this.handleChooseLayer(selectedDsJson); }, selectedDsIds: Immutable(selectedDsIds) }));\n                        }))));\n            }\n            else {\n                return this.getEmptyContent();\n            }\n        };\n        this.getNoneString = () => {\n            return this.props.intl.formatMessage({ id: 'none', defaultMessage: 'None' });\n        };\n        this.getEmptyContent = () => {\n            return (jsx(\"div\", { className: 'w-100 mt-1 mb-2' },\n                jsx(\"div\", { className: 'layerviewselector-ds-item pl-2 pr-2', onClick: () => { this.handleClickNone(); } }, this.getNoneString())));\n        };\n        this.state = {\n            listOpen: false,\n            width: 0\n        };\n    }\n    render() {\n        return (jsx(\"div\", { ref: this.selectorConRef, className: classNames('w-100', { [this.props.className]: !!this.props.className }) },\n            jsx(Dropdown, { size: 'sm', toggle: (evt) => { this.toggleList(evt); }, isOpen: this.state.listOpen, className: 'w-100' },\n                jsx(DropdownButton, { size: 'sm', type: 'tertiary', className: classNames('w-100 d-flex flex-column align-items-center toollist-item', 'justify-content-between toollist-item-click layerviewselector-input') },\n                    jsx(\"div\", { className: 'w-100 d-flex justify-content-between align-items-center' },\n                        jsx(\"div\", { className: 'layerviewselector-input-text ml-2' }, this.getTitle()))),\n                jsx(DropdownMenu, { className: classNames('ml-0 mr-0 mb-0 mt-1 p-0', { [this.props.className]: !!this.props.className }), css: STYLE },\n                    jsx(\"div\", { className: 'w-100 h-100 layerviewselector-bg' },\n                        jsx(\"div\", { style: { width: `${this.state.width}px` } }, this.getContent())))),\n            jsx(ReactResizeDetector, { targetRef: this.selectorConRef, handleWidth: true, onResize: this.onResize })));\n    }\n}\n/**\n * @deprecated\n * A react component for selecting layers in a map. It is usually used on the settings page of a widget,\n * and works with JimuLayerViewComponent to get the jimulayerview instance.\n */\nexport const JimuLayerViewSelectorDeprecated = injectIntl(withStyles(_JimuLayerViewSelectorDeprecated, 'JimuLayerViewSelectorDeprecated'));\n","/** @jsx jsx */\nimport { React, css, jsx, polished, classNames, hooks } from 'jimu-core';\nimport { Dropdown, DropdownButton, DropdownMenu, defaultMessages } from 'jimu-ui';\nimport { MapViewManager } from 'jimu-arcgis';\nimport { withStyles } from 'jimu-theme';\nimport { JimuLayerViewSelector } from '../selector';\n/**\n * A component for selecting layers in a map view. It is usually used on the settings page of a widget.\n * It includes a dropdown button to display the selected values and JimuLayerViewSelector component to select the layer.\n * ```\n * import { JimuLayerViewSelectorDropdown } from 'jimu-ui/advanced/setting-components'\n * ```\n */\nexport const JimuLayerViewSelectorDropdownComponent = (props) => {\n    const translate = hooks.useTranslation(defaultMessages);\n    const { useRef, useState } = React;\n    const buttonRef = useRef(null);\n    const [isOpen, setIsOpen] = useState(false);\n    const getSelectLabel = () => {\n        var _a;\n        const { selectedValues, isMultiSelection, jimuMapViewId } = props;\n        const number = (selectedValues === null || selectedValues === void 0 ? void 0 : selectedValues.length) || 0;\n        if (number === 0) {\n            return translate('numSelected', { number });\n        }\n        if (isMultiSelection) {\n            return translate('numSelected', { number });\n        }\n        else {\n            const jimuMapView = MapViewManager.getInstance().getJimuMapViewById(jimuMapViewId);\n            return (_a = jimuMapView === null || jimuMapView === void 0 ? void 0 : jimuMapView.jimuLayerViews[selectedValues[0]]) === null || _a === void 0 ? void 0 : _a.layer.title;\n        }\n    };\n    const onTogglePopper = () => {\n        if (isOpen) {\n            setIsOpen(false);\n        }\n        else {\n            setIsOpen(true);\n        }\n    };\n    const getDropdownMenuStyle = () => {\n        var _a;\n        return css `\r\n      ${buttonRef\n            ? `\r\n          width: ${polished.rem(1.5 * ((_a = buttonRef.current) === null || _a === void 0 ? void 0 : _a.clientWidth))} !important;\r\n        `\n            : ''}\r\n      padding: 16px;\r\n    `;\n    };\n    return (jsx(\"div\", { className: classNames('component-layer-view-selector-dropdown', 'w-100', props.className || '') },\n        jsx(Dropdown, { className: 'w-100', direction: 'down', toggle: onTogglePopper, isOpen: isOpen, autoWidth: true },\n            jsx(DropdownButton, { ref: node => { buttonRef.current = node; } }, getSelectLabel()),\n            jsx(DropdownMenu, { className: 'shadow-3', css: getDropdownMenuStyle(), alignment: 'end' },\n                jsx(JimuLayerViewSelector, Object.assign({}, props, { isInDropdown: true }))))));\n};\n/**\n * A component for selecting layers in a map view. It is usually used on the settings page of a widget.\n * It includes a dropdown button to display the selected values and JimuLayerViewSelector component to select the layer.\n * ```\n * import { JimuLayerViewSelectorDropdown } from 'jimu-ui/advanced/setting-components'\n * ```\n */\nexport const JimuLayerViewSelectorDropdown = withStyles(JimuLayerViewSelectorDropdownComponent, 'JimuLayerViewSelectorDropdown');\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/** @jsx jsx */\nimport { React, jsx, defaultMessages as jimuCoreMessages, injectIntl, SessionManager, esri, moduleLoader, dataSourceUtils, classNames, getAppStore, urlUtils, Immutable, appConfigUtils, css, polished, ReactRedux, DataSourceTypes, proxyUtils } from 'jimu-core';\nimport { Modal, ModalHeader, ModalBody, defaultMessages as jimuUIMessages, ModalFooter, Button, Loading, Toast, ToastType } from 'jimu-ui';\nimport { ProxySetting } from '../setting';\nimport { isSameProxy, isRegisteredApp, getProxyJsonFromSourceUrl, getCreateProxyUrl, deleteProxies, getNeedProxyItems } from '../utils';\nimport { LoadingType } from 'jimu-ui/lib/components/types';\nimport { withStyles, withTheme } from 'jimu-theme';\nconst dataSourceJsonCreator = dataSourceUtils.dataSourceJsonCreator;\nconst registerAppPromise = {};\nclass _ProxySettingPopup extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.__unmount = false;\n        this.getProxySettingConfigs = (needProxyItems) => {\n            var _a, _b;\n            const proxySettingConfigs = {};\n            const appProxies = (_b = (_a = getAppStore().getState().appStateInBuilder) === null || _a === void 0 ? void 0 : _a.appConfig) === null || _b === void 0 ? void 0 : _b.appProxies;\n            Object.keys(needProxyItems).forEach(sourceUrl => {\n                const proxyJson = getProxyJsonFromSourceUrl(sourceUrl, appProxies);\n                if (proxyJson) {\n                    // init a new proxy setting config without previous proxy url and proxy id\n                    proxySettingConfigs[sourceUrl] = proxyJson.without('id').without('proxyId').without('proxyUrl');\n                }\n            });\n            return Promise.resolve(proxySettingConfigs);\n        };\n        this.registerApp = () => __awaiter(this, void 0, void 0, function* () {\n            var _a, _b, _c, _d;\n            const appId = (_b = (_a = getAppStore().getState()) === null || _a === void 0 ? void 0 : _a.appStateInBuilder) === null || _b === void 0 ? void 0 : _b.appId;\n            if (registerAppPromise[appId]) {\n                return yield registerAppPromise[appId];\n            }\n            const portalUrl = (_d = (_c = getAppStore().getState()) === null || _c === void 0 ? void 0 : _c.appStateInBuilder) === null || _d === void 0 ? void 0 : _d.portalUrl;\n            const url = `${portalUrl}/sharing/rest/oauth2/registerApp`;\n            registerAppPromise[appId] = esri.restRequest.request(url, {\n                authentication: SessionManager.getInstance().getSessionByUrl(getAppStore().getState().portalUrl),\n                httpMethod: 'POST',\n                params: {\n                    itemId: appId,\n                    appType: 'browser',\n                    redirect_uris: JSON.stringify([this.getAppRootUrl()])\n                }\n            });\n            return yield registerAppPromise[appId];\n        });\n        this.createProxies = (proxySettingConfigs) => __awaiter(this, void 0, void 0, function* () {\n            var _a, _b, _c;\n            if (!proxySettingConfigs) {\n                return yield Promise.resolve(null);\n            }\n            const appProxies = (_c = (_b = (_a = getAppStore().getState()) === null || _a === void 0 ? void 0 : _a.appStateInBuilder) === null || _b === void 0 ? void 0 : _b.appConfig) === null || _c === void 0 ? void 0 : _c.appProxies;\n            const existingProxyJsons = {};\n            let proxies = [];\n            Object.keys(proxySettingConfigs).forEach(sourceUrl => {\n                const proxyConfig = proxySettingConfigs[sourceUrl];\n                if (!proxyConfig) {\n                    return;\n                }\n                const hitsPerInterval = proxyConfig.hitsPerInterval;\n                const intervalSeconds = proxyConfig.intervalSeconds;\n                const existingProxyJson = getProxyJsonFromSourceUrl(sourceUrl, appProxies);\n                if (isSameProxy(existingProxyJson, sourceUrl, hitsPerInterval, intervalSeconds)) {\n                    existingProxyJsons[existingProxyJson.id] = existingProxyJson;\n                }\n                else {\n                    proxies = proxies.concat({\n                        sourceUrl: sourceUrl,\n                        hitsPerInterval,\n                        intervalSeconds\n                    });\n                }\n            });\n            if (proxies.length === 0) { // No need to create new proxies.\n                return Immutable(existingProxyJsons);\n            }\n            const isRegistered = isRegisteredApp();\n            if (!isRegistered) { // Must register app before creating proxies.\n                yield this.registerApp();\n            }\n            const serviceProxyParams = {\n                referrers: [this.getAppOrTemplateUrl()].concat(proxyUtils.getProxyReferrers())\n            };\n            const createProxyUrl = getCreateProxyUrl();\n            return esri.restRequest.request(createProxyUrl, {\n                authentication: SessionManager.getInstance().getSessionByUrl(getAppStore().getState().portalUrl),\n                httpMethod: 'POST',\n                params: {\n                    serviceProxyParams,\n                    proxies\n                }\n            }).then(res => {\n                var _a, _b;\n                const proxiesInResponse = (res === null || res === void 0 ? void 0 : res.appProxies) || [];\n                const proxiesInAppConfig = existingProxyJsons;\n                const appConfig = (_b = (_a = getAppStore().getState()) === null || _a === void 0 ? void 0 : _a.appStateInBuilder) === null || _b === void 0 ? void 0 : _b.appConfig;\n                const appProxies = appConfig === null || appConfig === void 0 ? void 0 : appConfig.appProxies;\n                proxiesInResponse.forEach(p => {\n                    const existingProxyJson = getProxyJsonFromSourceUrl(p.sourceUrl, appProxies);\n                    // If have a proxy json with same source url, should update the proxy json instead of adding a new proxy json to app config.\n                    const proxyJsonId = (existingProxyJson === null || existingProxyJson === void 0 ? void 0 : existingProxyJson.id) || appConfigUtils.getUniqueId('appProxy');\n                    proxiesInAppConfig[proxyJsonId] = Object.assign(Object.assign({}, p), { id: proxyJsonId });\n                });\n                return Immutable(proxiesInAppConfig);\n            });\n        });\n        this.getAppRootUrl = () => {\n            var _a;\n            const origin = (_a = window === null || window === void 0 ? void 0 : window.location) === null || _a === void 0 ? void 0 : _a.origin;\n            return origin;\n        };\n        this.getAppOrTemplateUrl = () => {\n            var _a, _b, _c, _d, _e, _f;\n            const appId = (_b = (_a = getAppStore().getState()) === null || _a === void 0 ? void 0 : _a.appStateInBuilder) === null || _b === void 0 ? void 0 : _b.appId;\n            const appItem = (_d = (_c = getAppStore().getState()) === null || _c === void 0 ? void 0 : _c.appStateInBuilder) === null || _d === void 0 ? void 0 : _d.appInfo;\n            const isTemplate = (appItem === null || appItem === void 0 ? void 0 : appItem.type) === 'Web Experience Template';\n            const appUrlWithoutOrigin = (_e = urlUtils.getAppUrl({ id: appId, type: isTemplate ? 'template' : 'app' })) === null || _e === void 0 ? void 0 : _e.replace(/^\\//, '');\n            const origin = (_f = this.getAppRootUrl()) === null || _f === void 0 ? void 0 : _f.replace(/\\/$/, '');\n            return `${origin}/${appUrlWithoutOrigin}`;\n        };\n        this.onProxyConfigChange = (proxySettingConfigs) => {\n            this.setState({ proxySettingConfigs: proxySettingConfigs });\n        };\n        this.onFinish = () => {\n            var _a, _b, _c, _d;\n            this.setState({ isLoading: true });\n            // New proxy settings, these settings haven't been used to create/update remote proxies yet.\n            const proxySettingConfigs = this.state.proxySettingConfigs || {};\n            // Existing proxy settings in app config, these settings have already been synced to remote proxies.\n            const existingProxyJsons = (_c = (_b = (_a = getAppStore().getState()) === null || _a === void 0 ? void 0 : _a.appStateInBuilder) === null || _b === void 0 ? void 0 : _b.appConfig) === null || _c === void 0 ? void 0 : _c.appProxies;\n            const needToDeleteProxies = existingProxyJsons && Object.values(existingProxyJsons).filter(proxyJson => {\n                var _a;\n                let newProxyConfig = proxySettingConfigs[proxyJson === null || proxyJson === void 0 ? void 0 : proxyJson.sourceUrl];\n                const isFeatureService = dataSourceJsonCreator.getDataSourceTypeFromArcGISWholeServiceUrl(proxyJson === null || proxyJson === void 0 ? void 0 : proxyJson.sourceUrl) === DataSourceTypes.FeatureService;\n                if (isFeatureService) {\n                    const associatedSceneServiceUrl = (_a = proxyJson === null || proxyJson === void 0 ? void 0 : proxyJson.sourceUrl) === null || _a === void 0 ? void 0 : _a.replace('/FeatureServer', '/SceneServer');\n                    const newAssociatedSceneServiceConfig = proxySettingConfigs[associatedSceneServiceUrl];\n                    /**\n                     * If current source url is a feature service and has an associated scene service,\n                     * 1. if have added the feature service as data source and configured proxy for it, should use its own proxy config\n                     * 2. else use its associated scene service's proxy config\n                     */\n                    newProxyConfig = newProxyConfig || (newAssociatedSceneServiceConfig ? Object.assign(Object.assign({}, newAssociatedSceneServiceConfig), { sourceUrl: proxyJson === null || proxyJson === void 0 ? void 0 : proxyJson.sourceUrl }) : null);\n                }\n                /**\n                 * If existing proxy's source url is not used any more, or,\n                 * existing proxy is not same as new proxy config (need to create a new proxy),\n                 * delete it.\n                 */\n                return !newProxyConfig || !isSameProxy(proxyJson, newProxyConfig.sourceUrl, newProxyConfig.hitsPerInterval, newProxyConfig.intervalSeconds);\n            });\n            deleteProxies(needToDeleteProxies === null || needToDeleteProxies === void 0 ? void 0 : needToDeleteProxies.map(proxyJson => proxyJson.proxyId), (_d = this.state) === null || _d === void 0 ? void 0 : _d.getAppConfigAction()).then(() => {\n                this.createProxies(proxySettingConfigs).then(proxyJsons => {\n                    var _a;\n                    if (!this.__unmount) {\n                        if (proxyJsons) {\n                            const action = (_a = this.state) === null || _a === void 0 ? void 0 : _a.getAppConfigAction();\n                            Object.keys(proxyJsons).forEach(proxyId => {\n                                action === null || action === void 0 ? void 0 : action.editAppProxy(proxyJsons[proxyId]);\n                            });\n                            action === null || action === void 0 ? void 0 : action.exec();\n                        }\n                        const newAppConfig = getAppStore().getState().appStateInBuilder.appConfig;\n                        this.props.onFinish(newAppConfig);\n                    }\n                });\n            }).catch(error => {\n                console.error('Creating proxy failed: ', error);\n                this.setState({\n                    isLoading: false,\n                    isError: true\n                }, () => {\n                    setTimeout(() => {\n                        this.setState({\n                            isError: false\n                        });\n                    }, 5500);\n                });\n            });\n        };\n        this.getTostStyle = () => {\n            var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n            return css `\r\n      & {\r\n        height:  ${polished.rem(40)};\r\n        top: ${polished.rem(60)};\r\n      }\r\n      .jimu-toast-info {\r\n        background: ${(_c = (_b = (_a = this.props) === null || _a === void 0 ? void 0 : _a.theme) === null || _b === void 0 ? void 0 : _b.sys.color) === null || _c === void 0 ? void 0 : _c.secondary.light};\r\n        line-height: ${polished.rem(40)};\r\n        color: ${(_f = (_e = (_d = this.props) === null || _d === void 0 ? void 0 : _d.theme) === null || _e === void 0 ? void 0 : _e.ref.palette) === null || _f === void 0 ? void 0 : _f.neutral[1100]};\r\n        font-weight: 300;\r\n        padding: 0 ${polished.rem(16)};\r\n        box-shadow: 0 0 ${polished.rem(10)} ${polished.rem(2)} ${polished.rgba((_j = (_h = (_g = this.props) === null || _g === void 0 ? void 0 : _g.theme) === null || _h === void 0 ? void 0 : _h.ref.palette) === null || _j === void 0 ? void 0 : _j.white, 0.2)};\r\n      }\r\n    `;\n        };\n        this.getPublishButtonText = () => {\n            const { appHasBeenSaved, intl } = this.props;\n            if (appHasBeenSaved) {\n                return intl.formatMessage({ id: 'publish', defaultMessage: jimuCoreMessages.publish });\n            }\n            else {\n                return intl.formatMessage({ id: 'saveAndPublish', defaultMessage: jimuUIMessages.saveAndPublish });\n            }\n        };\n        this.getSubscriberContentString = () => {\n            const { appHasBeenSaved, intl } = this.props;\n            if (appHasBeenSaved) {\n                return intl.formatMessage({ id: 'subscriberContents', defaultMessage: jimuUIMessages.subscriberContents });\n            }\n            else {\n                return intl.formatMessage({ id: 'unsavedChangesAndSubscriberContents', defaultMessage: jimuUIMessages.unsavedChangesAndSubscriberContents });\n            }\n        };\n        this.state = {\n            getAppConfigAction: null,\n            isLoading: false,\n            isError: false,\n            proxySettingConfigs: null,\n            needProxyItems: null\n        };\n    }\n    componentDidMount() {\n        this.__unmount = false;\n        import('jimu-for-builder').then(module => {\n            if (!this.__unmount) {\n                this.setState({\n                    getAppConfigAction: module.getAppConfigAction\n                });\n            }\n        });\n        this.setState({ isLoading: true });\n        this.initNeedProxyItemsAndProxySettingConfigs();\n    }\n    componentDidUpdate(prevProps) {\n        if ((!prevProps.isOpen && this.props.isOpen) || (prevProps.appProxies !== this.props.appProxies)) {\n            this.initNeedProxyItemsAndProxySettingConfigs();\n        }\n    }\n    initNeedProxyItemsAndProxySettingConfigs() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.setState({ isLoading: true });\n            try {\n                const needProxyItems = yield getNeedProxyItems();\n                const proxySettingConfigs = yield this.getProxySettingConfigs(needProxyItems);\n                if (!this.__unmount) {\n                    this.setState({\n                        proxySettingConfigs: proxySettingConfigs,\n                        needProxyItems: needProxyItems,\n                        isLoading: false\n                    });\n                }\n            }\n            catch (err) {\n                if (!this.__unmount) {\n                    this.setState({ isLoading: false });\n                }\n                console.error('Getting proxy config error', err);\n            }\n        });\n    }\n    componentWillUnmount() {\n        this.__unmount = true;\n    }\n    render() {\n        const proxySettingConfigs = this.state.proxySettingConfigs;\n        const needProxyItems = this.state.needProxyItems;\n        const subscriberContentString = this.getSubscriberContentString();\n        return (jsx(Modal, { isOpen: this.props.isOpen, centered: true, className: classNames({ [this.props.className]: !!this.props.className }), returnfocusafterclose: 'true', contentClassName: 'proxy-setting-container', backdrop: 'static', \"aria-label\": subscriberContentString },\n            jsx(ModalHeader, { className: 'd-flex justify-content-between header px-30', toggle: this.props.onToggle },\n                jsx(\"div\", { className: 'flex-grow-1 text-truncate' }, subscriberContentString)),\n            jsx(ModalBody, { className: 'd-flex px-30' },\n                jsx(ProxySetting, { onChange: this.onProxyConfigChange, proxySettingConfigs: proxySettingConfigs, needProxyItems: needProxyItems, appHasBeenSaved: this.props.appHasBeenSaved })),\n            jsx(ModalFooter, { className: 'px-30' },\n                jsx(Button, { className: 'mr-2', type: 'primary', onClick: this.onFinish }, this.getPublishButtonText()),\n                jsx(Button, { type: 'default', onClick: this.props.onCancel }, this.props.intl.formatMessage({ id: 'cancel', defaultMessage: jimuCoreMessages.cancel }))),\n            this.state.isLoading && jsx(Loading, { type: LoadingType.Secondary }),\n            this.state.isError &&\n                jsx(Toast, { open: this.state.isError, type: ToastType.Info, css: this.getTostStyle(), text: this.props.intl.formatMessage({ id: 'createProxyToPublishAppError', defaultMessage: jimuUIMessages.createProxyToPublishAppError }) })));\n    }\n}\nconst mapStateToProps = (state, ownProps) => {\n    var _a, _b;\n    return {\n        appProxies: (_b = (_a = state === null || state === void 0 ? void 0 : state.appStateInBuilder) === null || _a === void 0 ? void 0 : _a.appConfig) === null || _b === void 0 ? void 0 : _b.appProxies\n    };\n};\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst __ProxySettingPopup = withStyles(withTheme(injectIntl(_ProxySettingPopup)), 'ProxySettingPopup');\nexport const ProxySettingPopup = ReactRedux.connect(mapStateToProps)(__ProxySettingPopup);\n","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\n/** @jsx jsx */\nimport { Popper } from 'jimu-ui';\nimport { React, ReactRedux, jsx, css } from 'jimu-core';\nimport { popperPointer } from 'jimu-theme';\nclass PageAwarePopper extends React.PureComponent {\n    componentDidUpdate(prevProps) {\n        if (this.props.pageId !== prevProps.pageId || this.props.sizemode !== prevProps.sizemode) {\n            this.props.toggle();\n        }\n    }\n    getStyle() {\n        const { theme } = this.props;\n        return theme && css `\r\n      background-color: ${theme.ref.palette.neutral[400]};\r\n      ${popperPointer({\n            background: theme.ref.palette.neutral[400],\n            border: {\n                color: theme.ref.palette.neutral[600],\n                width: '1px'\n            }\n        })}\r\n    `;\n    }\n    render() {\n        const _a = this.props, { pageId, sizemode, dispatch } = _a, otherProps = __rest(_a, [\"pageId\", \"sizemode\", \"dispatch\"]);\n        return jsx(Popper, Object.assign({ className: 'page-aware-popper', css: this.getStyle() }, otherProps));\n    }\n}\nfunction mapStateToProps(state) {\n    return {\n        pageId: state.appRuntimeInfo.currentPageId,\n        sizemode: state.browserSizeMode\n    };\n}\nexport default ReactRedux.connect(mapStateToProps)(PageAwarePopper);\n","/** @jsx jsx */\nimport { React, jsx, css, classNames, injectIntl, cancelablePromise, moduleLoader, defaultMessages as jimuCoreMessages, lodash, focusElementInKeyboardMode } from 'jimu-core';\nimport { Loading, Icon, defaultMessages, Button, Select, LoadingType, TextInput } from 'jimu-ui';\nimport { ArcgisEnterpriseFilled } from 'jimu-icons/filled/brand/arcgis-enterprise';\nimport { SearchOutlined } from 'jimu-icons/outlined/editor/search';\nconst ALL_GROUP_VALUE = 1000;\nconst style = css `\r\n  color: var(ref-palette-neutral-1100);\r\n\r\n  .widget-enterprise-btn {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    z-index: 1;\r\n  }\r\n\r\n  .px-20 {\r\n    padding-left: 18px;\r\n    padding-right: 18px;\r\n  }\r\n\r\n  .pt-20 {\r\n    padding-top: 20px;\r\n  }\r\n\r\n  .list-container {\r\n    height: calc(100% - 150px);\r\n    overflow-y: auto;\r\n    padding-bottom: 20px;\r\n  }\r\n\r\n  .groups {\r\n    font-size: 13px;\r\n    font-weight: 600;\r\n    color: var(--ref-palette-neutral-900);\r\n  }\r\n\r\n  .group-select {\r\n    width: 210px;\r\n  }\r\n\r\n  .widget-group {\r\n    .group-label{\r\n      font-size: 13px;\r\n      font-weight: 600;\r\n      color: var(--ref-palette-neutral-900);\r\n    }\r\n  }\r\n\r\n  .card-grid {\r\n    display: grid;\r\n    grid-template-columns: repeat(3, minmax(0, 1fr));\r\n    grid-row-gap: 0.5rem;\r\n    grid-column-gap: 0.5rem;\r\n  }\r\n\r\n  .widget-card {\r\n    height: 80px;\r\n    width: 112px;\r\n    padding: 0;\r\n    border: none;\r\n    position: relative;\r\n\r\n    > .jimu-btn {\r\n      border-color: var(--ref-palette-neutral-500);\r\n    }\r\n\r\n    .widget-card--content {\r\n      padding-top: 12px;\r\n      cursor: pointer;\r\n      background-color: var(--ref-palette-neutral-500);\r\n      &:hover {\r\n        background-color: var(--ref-palette-neutral-600);\r\n      }\r\n    }\r\n\r\n    .widget-card-image {\r\n      width: 20px;\r\n      height: 20px;\r\n      &:after {\r\n        display: none;\r\n      }\r\n      img {\r\n        width: 20px;\r\n        height: 20px;\r\n      }\r\n    }\r\n\r\n    .widget-card-name {\r\n      line-height: 1rem;\r\n      max-height: 2rem;\r\n      white-space: normal;\r\n      color: var(--ref-palette-neutral-1200);\r\n      padding: 0 5px;\r\n      font-size: 13px;\r\n    }\r\n  }\r\n`;\nclass _WidgetList extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.allGroup = {\n            value: ALL_GROUP_VALUE,\n            label: this.props.intl.formatMessage({ id: 'all', defaultMessage: defaultMessages.all })\n        };\n        this.getRequireEnterpriseIconTooltip = (requiredUserTypeExtensions) => {\n            if ((requiredUserTypeExtensions === null || requiredUserTypeExtensions === void 0 ? void 0 : requiredUserTypeExtensions.length) > 0) {\n                const userTypeExtensions = requiredUserTypeExtensions.join(', ');\n                return this.props.intl.formatMessage({ id: 'requireEnterpriseAndUserTypeExtensions', defaultMessage: defaultMessages.requireEnterpriseAndUserTypeExtensions }, { userTypeExtensions });\n            }\n            else {\n                return this.props.intl.formatMessage({ id: 'requireEnterprise', defaultMessage: defaultMessages.requireEnterprise });\n            }\n        };\n        this.WidgetCard = ({ widgetInfo }) => {\n            var _a, _b, _c, _d;\n            return jsx(\"div\", { className: 'd-flex align-items-start justify-content-center widget-card' },\n                ((_a = widgetInfo.manifest) === null || _a === void 0 ? void 0 : _a.requireEnterprise) && jsx(Button, { title: this.getRequireEnterpriseIconTooltip((_b = widgetInfo.manifest) === null || _b === void 0 ? void 0 : _b.requiredUserTypeExtensions), type: 'tertiary', className: 'widget-enterprise-btn', disableHoverEffect: true, disableRipple: true, icon: true, size: 'sm' },\n                    jsx(ArcgisEnterpriseFilled, null)),\n                jsx(Button, { className: 'w-100 h-100 p-0', key: widgetInfo.name, onClick: () => { this.props.onSelect(widgetInfo); }, \"aria-label\": widgetInfo.label },\n                    jsx(\"div\", { className: 'd-flex flex-column w-100 h-100 widget-card--content' },\n                        jsx(\"div\", { className: 'd-flex justify-content-center' },\n                            jsx(\"div\", { className: 'widget-card-image' },\n                                jsx(Icon, { size: 20, className: 'w-100 m-0', autoFlip: (_d = (_c = widgetInfo.manifest) === null || _c === void 0 ? void 0 : _c.properties) === null || _d === void 0 ? void 0 : _d.flipIcon, icon: typeof widgetInfo.icon === 'string' ? widgetInfo.icon : widgetInfo.icon && widgetInfo.icon.svg, color: 'var(--ref-palette-neutral-1200)' }))),\n                        jsx(\"div\", { className: 'flex-grow-1 d-flex align-items-center' },\n                            jsx(\"div\", { className: 'widget-card-name w-100 text-center text-capitalize text-truncate', css: css `\r\n                line-height: 1rem;\r\n                max-height: 2.2rem;\r\n                white-space: normal;\r\n              `, title: widgetInfo.label }, widgetInfo.label)))));\n        };\n        this.WidgetGroup = ({ group }) => {\n            if (!group) {\n                return null;\n            }\n            const WidgetCard = this.WidgetCard;\n            return jsx(\"div\", { className: 'widget-group w-100 mb-4' },\n                jsx(\"h4\", { className: 'group-label w-100 text-break', title: group.label }, group.label),\n                jsx(\"div\", { className: 'card-grid m-0' }, group.itemList.sort((i1, i2) => i1.order - i2.order).map((item, index) => {\n                    if (!item) {\n                        return jsx(\"div\", { className: 'widget-card', style: { visibility: 'hidden' }, key: index });\n                    }\n                    return jsx(WidgetCard, { widgetInfo: item, key: index });\n                })));\n        };\n        this.getGroupList = (commonWidgetList, customWidgetList, searchValue) => {\n            var _a, _b, _c, _d;\n            const groups = [this.allGroup];\n            const showCommonGroups = !!commonWidgetList;\n            if (showCommonGroups) {\n                const commonGroups = this.getCommonGroups(commonWidgetList, ALL_GROUP_VALUE, searchValue);\n                commonGroups && Object.values(commonGroups).forEach(g => {\n                    if (typeof g.groupId === 'number') {\n                        groups.push({ value: g.groupId, label: this.getGroupLabel(g.groupId) });\n                    }\n                });\n            }\n            const showCustomGroup = (_b = (_a = this.state.jimuForBuilderUtils) === null || _a === void 0 ? void 0 : _a.showCustomWidgets) === null || _b === void 0 ? void 0 : _b.call(_a, commonWidgetList);\n            if (showCustomGroup) {\n                const customGroup = this.getCustomGroup(commonWidgetList, customWidgetList, ALL_GROUP_VALUE, searchValue);\n                customGroup && groups.push({ value: (_c = this.state.jimuForBuilderUtils) === null || _c === void 0 ? void 0 : _c.CUSTOM_GROUP, label: this.getGroupLabel((_d = this.state.jimuForBuilderUtils) === null || _d === void 0 ? void 0 : _d.CUSTOM_GROUP) });\n            }\n            return groups.filter(g => !!g.label);\n        };\n        this.changeSelectedGroup = e => {\n            this.setState({ selectedGroup: e.target.value });\n        };\n        this.onSearchValueChange = e => {\n            this.setState({\n                searchValue: e.target.value,\n                selectedGroup: ALL_GROUP_VALUE // if is searching, will reset the selected group to all\n            });\n        };\n        this.state = {\n            selectedGroup: ALL_GROUP_VALUE,\n            commonWidgetList: null,\n            remoteCustomWidgetList: null,\n            searchValue: '',\n            jimuForBuilderUtils: null\n        };\n        this.searchInputRef = React.createRef();\n    }\n    componentDidMount() {\n        this.loadJimuForBuilderUtilsPromise = cancelablePromise.cancelable(import('jimu-for-builder').then(JimuForBuilder => {\n            this.setState({ jimuForBuilderUtils: JimuForBuilder === null || JimuForBuilder === void 0 ? void 0 : JimuForBuilder.utils });\n        }));\n        lodash.defer(() => {\n            focusElementInKeyboardMode(this.searchInputRef.current, true);\n        });\n    }\n    componentDidUpdate(prevProps, prevState) {\n        if (!prevState.jimuForBuilderUtils && this.state.jimuForBuilderUtils) {\n            this.loadCommonWidgetList(this.state.jimuForBuilderUtils.fetchCommonWidgetList);\n            this.loadCustomWidgetList(this.state.jimuForBuilderUtils.fetchRemoteCustomWidgetList);\n        }\n    }\n    componentWillUnmount() {\n        var _a, _b, _c;\n        (_a = this.loadJimuForBuilderUtilsPromise) === null || _a === void 0 ? void 0 : _a.cancel();\n        (_b = this.loadCommonWidgetsPromise) === null || _b === void 0 ? void 0 : _b.cancel();\n        (_c = this.loadCommonWidgetsPromise) === null || _c === void 0 ? void 0 : _c.cancel();\n    }\n    loadCommonWidgetList(fetchCommonWidgetList) {\n        if (!fetchCommonWidgetList) {\n            return;\n        }\n        this.loadCommonWidgetsPromise = cancelablePromise.cancelable(fetchCommonWidgetList().then((items) => {\n            var _a, _b;\n            const notLayoutWidgetList = items === null || items === void 0 ? void 0 : items.filter(item => this.props.isAccepted(item, this.props.isPlaceholder));\n            (_b = (_a = this.props).onWidgetLoaded) === null || _b === void 0 ? void 0 : _b.call(_a);\n            this.setState({\n                commonWidgetList: notLayoutWidgetList\n            });\n        }));\n    }\n    loadCustomWidgetList(fetchRemoteCustomWidgetList) {\n        if (!fetchRemoteCustomWidgetList) {\n            return;\n        }\n        this.loadRemoteCustomWidgetsPromise = cancelablePromise.cancelable(fetchRemoteCustomWidgetList().then((items) => {\n            var _a, _b;\n            const list = items === null || items === void 0 ? void 0 : items.filter(item => this.props.isAccepted(item, this.props.isPlaceholder));\n            (_b = (_a = this.props).onWidgetLoaded) === null || _b === void 0 ? void 0 : _b.call(_a);\n            this.setState({\n                remoteCustomWidgetList: list\n            });\n        }));\n    }\n    getGroupLabel(groupId) {\n        var _a, _b;\n        return (_b = (_a = this.state.jimuForBuilderUtils) === null || _a === void 0 ? void 0 : _a.getWidgetsGroupLabel) === null || _b === void 0 ? void 0 : _b.call(_a, groupId, this.props.intl);\n    }\n    getCommonGroups(commonWidgetList, selectedGroup, searchValue) {\n        const list = selectedGroup === ALL_GROUP_VALUE ? commonWidgetList : commonWidgetList === null || commonWidgetList === void 0 ? void 0 : commonWidgetList.filter(w => w.group === selectedGroup);\n        const groups = {};\n        list === null || list === void 0 ? void 0 : list.forEach(w => {\n            var _a;\n            if (w.group === ((_a = this.state.jimuForBuilderUtils) === null || _a === void 0 ? void 0 : _a.CUSTOM_GROUP)) {\n                return;\n            }\n            const groupLabel = this.getGroupLabel(w.group);\n            if (this.isFuzzySearch(groupLabel, searchValue) || this.isFuzzySearch(w.label, searchValue)) {\n                if (!groups[w.group]) {\n                    groups[w.group] = {\n                        label: groupLabel,\n                        groupId: w.group,\n                        itemList: []\n                    };\n                }\n                groups[w.group].itemList.push(w);\n            }\n        });\n        return groups;\n    }\n    getCustomGroup(commonWidgetList, customWidgetList, selectedGroup, searchValue) {\n        var _a, _b, _c;\n        if (selectedGroup === ALL_GROUP_VALUE || selectedGroup === ((_a = this.state.jimuForBuilderUtils) === null || _a === void 0 ? void 0 : _a.CUSTOM_GROUP)) {\n            const groupLabel = this.getGroupLabel((_b = this.state.jimuForBuilderUtils) === null || _b === void 0 ? void 0 : _b.CUSTOM_GROUP);\n            const itemList = (customWidgetList || []).concat(((commonWidgetList === null || commonWidgetList === void 0 ? void 0 : commonWidgetList.filter(w => { var _a; return w.group === ((_a = this.state.jimuForBuilderUtils) === null || _a === void 0 ? void 0 : _a.CUSTOM_GROUP); })) || [])).filter(w => this.isFuzzySearch(groupLabel, searchValue) || this.isFuzzySearch(w.label, searchValue));\n            // Hide group which items are empty when searching.\n            if (!searchValue || itemList.length > 0) {\n                return {\n                    label: groupLabel,\n                    groupId: (_c = this.state.jimuForBuilderUtils) === null || _c === void 0 ? void 0 : _c.CUSTOM_GROUP,\n                    itemList\n                };\n            }\n        }\n        return null;\n    }\n    isFuzzySearch(label, searchValue) {\n        if (!label) {\n            return false;\n        }\n        if (!searchValue) {\n            return true;\n        }\n        return label.toLocaleLowerCase().includes(searchValue.toLocaleLowerCase());\n    }\n    render() {\n        var _a, _b, _c, _d;\n        const WidgetGroup = this.WidgetGroup;\n        const { commonWidgetList, remoteCustomWidgetList: customWidgetList, selectedGroup, searchValue } = this.state;\n        const showCommonGroups = !!commonWidgetList;\n        let commonWidgetsToShow = commonWidgetList;\n        const sectionItem = (_b = (_a = this.state.jimuForBuilderUtils) === null || _a === void 0 ? void 0 : _a.getSectionItemForWidgetsList) === null || _b === void 0 ? void 0 : _b.call(_a, this.props.intl);\n        if (showCommonGroups && this.props.isAccepted(sectionItem, this.props.isPlaceholder)) {\n            commonWidgetsToShow = commonWidgetList.concat([sectionItem]);\n        }\n        const commonGroups = showCommonGroups && this.getCommonGroups(commonWidgetsToShow, selectedGroup, searchValue);\n        const showCustomGroup = (_d = (_c = this.state.jimuForBuilderUtils) === null || _c === void 0 ? void 0 : _c.showCustomWidgets) === null || _d === void 0 ? void 0 : _d.call(_c, commonWidgetsToShow);\n        const customGroup = showCustomGroup && this.getCustomGroup(commonWidgetsToShow, customWidgetList, selectedGroup, searchValue);\n        const groupList = this.getGroupList(commonWidgetsToShow, customWidgetList, searchValue);\n        return (jsx(\"div\", { className: classNames('content mt-4', this.props.className), css: style },\n            jsx(\"div\", { className: 'd-flex justify-content-between align-items-center mb-4 px-20' },\n                jsx(TextInput, { ref: this.searchInputRef, prefix: jsx(SearchOutlined, { size: 16, color: 'var(--ref-palette-neutral-800)' }), value: searchValue, onChange: this.onSearchValueChange, className: 'w-100', size: 'sm', placeholder: this.props.intl.formatMessage({ id: 'search', defaultMessage: jimuCoreMessages.search }), allowClear: true })),\n            jsx(\"div\", { className: 'd-flex justify-content-between align-items-center mb-4 px-20' },\n                jsx(\"div\", { className: 'groups' }, this.props.intl.formatMessage({ id: 'category', defaultMessage: defaultMessages.category })),\n                jsx(Select, { className: 'group-select', size: 'sm', value: selectedGroup, onChange: this.changeSelectedGroup }, groupList.map((g, i) => {\n                    return (jsx(\"option\", { value: g.value, key: i, selected: g.value === selectedGroup }, g.label));\n                }))),\n            jsx(\"div\", { className: 'w-100 list-container px-20' },\n                !commonWidgetList && jsx(Loading, { type: LoadingType.Secondary }),\n                showCommonGroups && Object.values(commonGroups).sort((g1, g2) => g1.groupId - g2.groupId).map((g, i) => {\n                    return jsx(WidgetGroup, { key: i, group: g });\n                }),\n                showCustomGroup && jsx(WidgetGroup, { group: customGroup }))));\n    }\n}\n_WidgetList.defaultProps = {\n    isPlaceholder: false,\n    isAccepted: () => true\n};\nexport const WidgetList = injectIntl(_WidgetList);\n","/** @jsx jsx */\nimport { React, jsx, css, injectIntl, defaultMessages as jimuCoreMessages } from 'jimu-core';\nimport { defaultMessages, Button } from 'jimu-ui';\nimport Popper from '../page-aware-popper';\nimport { CloseOutlined } from 'jimu-icons/outlined/editor/close';\nimport { WidgetList } from './widget-list';\nconst shiftOptions = {\n    rootBoundary: 'viewport',\n    padding: 0\n};\nconst flipOptions = {\n    fallbackPlacements: ['top', 'right', 'bottom', 'left']\n};\nconst style = css `\r\n  background-color: var(--sys-color-surface-paper);\r\n  color: var(--ref-palette-neutral-1100);\r\n\r\n  .content {\r\n    height: 600px;\r\n    width: 404px;\r\n    overflow: hidden;\r\n    padding: 0;\r\n  }\r\n\r\n  .title {\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    color: var(--ref-palette-neutral-1100);\r\n  }\r\n\r\n  .px-20 {\r\n    padding-left: 20px;\r\n    padding-right: 20px;\r\n  }\r\n\r\n  .pt-20 {\r\n    padding-top: 20px;\r\n  }\r\n`;\nclass _WidgetListPopper extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.togglePopper = (evt) => {\n            if (this.state.open && this.props.onClose) {\n                this.props.onClose(evt);\n            }\n        };\n        this.onWidgetLoaded = () => {\n            this.setState({ generation: this.state.generation + 1 });\n        };\n        this.state = {\n            open: true,\n            generation: 0\n        };\n    }\n    render() {\n        var _a;\n        if (!this.state.open) {\n            return null;\n        }\n        return (jsx(Popper, { className: this.props.className, placement: (_a = this.props.placement) !== null && _a !== void 0 ? _a : 'bottom', toggle: this.togglePopper, css: style, version: this.state.generation, shiftOptions: shiftOptions, flipOptions: flipOptions, reference: this.props.referenceElement, open: true, forceLatestFocusElements: true, autoFocus: false },\n            jsx(\"div\", { className: 'shadow-3 content', css: this.props.css },\n                jsx(\"div\", { className: 'd-flex justify-content-between align-items-center px-20 pt-20' },\n                    jsx(\"div\", { className: 'title' }, this.props.intl.formatMessage({ id: 'addWidget', defaultMessage: defaultMessages.addWidget })),\n                    jsx(Button, { size: 'sm', icon: true, type: 'tertiary', onClick: this.togglePopper, title: this.props.intl.formatMessage({ id: 'close', defaultMessage: jimuCoreMessages.close }) },\n                        jsx(CloseOutlined, null))),\n                jsx(WidgetList, { isPlaceholder: this.props.isPlaceholder, isAccepted: this.props.isAccepted, onSelect: this.props.onSelect, onWidgetLoaded: this.onWidgetLoaded }))));\n    }\n}\n_WidgetListPopper.defaultProps = {\n    isPlaceholder: false,\n    isAccepted: () => true\n};\nexport const WidgetListPopper = injectIntl(_WidgetListPopper);\n","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\n/** @jsx jsx */\nimport { React, jsx, css, hooks, classNames } from 'jimu-core';\nimport { Button, defaultMessages as jimuUIMessages, Tooltip } from 'jimu-ui';\nimport { Tree, TreeAlignmentType } from 'jimu-ui/basic/list-tree';\nimport { useTheme } from 'jimu-theme';\nimport { DownOutlined } from 'jimu-icons/outlined/directional/down';\nimport { UpOutlined } from 'jimu-icons/outlined/directional/up';\nimport { CloseOutlined } from 'jimu-icons/outlined/editor/close';\nconst getListStyles = (theme) => css `\r\nwidth: 100%;\r\n.jimu-tree-main {\r\n  padding: 2px 0 2px 0;\r\n  overflow: hidden;\r\n}\r\n.jimu-tree-item__drag-handle, .jimu-tree-item__title {\r\n  cursor: move;\r\n}\r\n.jimu-tree-item__children-toggle {\r\n  display: none;\r\n}\r\n.toggle-placeholder {\r\n  display: none;\r\n}\r\n.jimu-collapse {\r\n  width: 100%;\r\n}\r\n`;\nconst buttonStyles = css `button { padding: 0 !important; }`;\nexport const SortTree = (props) => {\n    const { rootItemJson, onSort, onRemove, css, className } = props, others = __rest(props, [\"rootItemJson\", \"onSort\", \"onRemove\", \"css\", \"className\"]);\n    const [version, setVersion] = React.useState(0);\n    const rootItemJsonExpanded = React.useMemo(() => {\n        return version === 0 ? rootItemJson : Object.assign({}, rootItemJson);\n    }, [rootItemJson, version]);\n    const onUpdateItem = React.useCallback((actionData, refComponent) => {\n        if (actionData.updateType === 'handleDidDrop') {\n            onSort === null || onSort === void 0 ? void 0 : onSort(actionData);\n        }\n    }, [onSort]);\n    const translate = hooks.useTranslation(jimuUIMessages);\n    const renderOverrideItemCommands = React.useCallback((actionData, refComponent) => {\n        var _a;\n        const item = refComponent.props.itemJsons[0];\n        const toggleItem = () => {\n            item.itemStateExpanded = !item.itemStateExpanded;\n            setVersion(old => old + 1);\n        };\n        const removeWidget = () => {\n            onRemove === null || onRemove === void 0 ? void 0 : onRemove(item);\n        };\n        return jsx(\"div\", { css: buttonStyles, className: 'd-flex align-items-center justify-content-end' },\n            ((_a = item.itemChildren) === null || _a === void 0 ? void 0 : _a.length) > 0 &&\n                jsx(Tooltip, { title: item.itemStateExpanded ? translate('collapse') : translate('expand') },\n                    jsx(Button, { onClick: toggleItem, type: 'tertiary', disableHoverEffect: true, disableRipple: true, icon: true, \"aria-expanded\": item.itemStateExpanded }, item.itemStateExpanded ? jsx(UpOutlined, { size: 's' }) : jsx(DownOutlined, { size: 's' }))),\n            jsx(Tooltip, { title: translate('deleteOption') },\n                jsx(Button, { onClick: removeWidget, type: 'tertiary', disableHoverEffect: true, disableRipple: true, icon: true },\n                    jsx(CloseOutlined, { size: 's' }))));\n    }, [onRemove, translate]);\n    const theme = useTheme();\n    return (jsx(Tree, Object.assign({ css: [getListStyles(theme), css], className: classNames('sort-tree', className), rootItemJson: rootItemJsonExpanded, dndEnabled: true, isMultiSelection: false, treeAlignmentType: TreeAlignmentType.Intact, renderOverrideItemCommands: renderOverrideItemCommands }, others, { onUpdateItem: onUpdateItem })));\n};\n","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\n/** @jsx jsx */\nimport { jsx, classNames, css, hooks } from 'jimu-core';\nimport { Button, CollapsablePanel, defaultMessages as jimuUIMessages } from 'jimu-ui';\nimport { ResetOutlined } from 'jimu-icons/outlined/editor/reset';\nconst getStyles = () => css `\r\n  .jimu-collapse-wrapper-inner {\r\n    padding-top: var(--sys-spacing-2);\r\n  }\r\n`;\nconst getLabelResetStyles = () => css `\r\n  flex-grow: 1;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  .label {\r\n    color:  var(--sys-color-action-text);\r\n    &.disabled {\r\n      color: var(--sys-color-action-disabled-text);\r\n    }\r\n  }\r\n`;\nexport function CollapsableResetPanel(props) {\n    const { label, isEmpty, onReset, children } = props, others = __rest(props, [\"label\", \"isEmpty\", \"onReset\", \"children\"]);\n    const labelReset = jsx(LabelReset, { label: label, isEmpty: isEmpty, onReset: onReset });\n    return jsx(CollapsablePanel, Object.assign({ css: getStyles(), headerTag: 'div', label: labelReset, \"aria-label\": label }, others, { defaultIsOpen: !isEmpty }), children);\n}\nexport function LabelReset(props) {\n    const { label, isEmpty, onReset } = props;\n    const translate = hooks.useTranslation(jimuUIMessages);\n    const resetString = translate('reset');\n    return jsx(\"div\", { css: getLabelResetStyles() },\n        jsx(\"span\", { className: classNames('label', { disabled: isEmpty }) }, label),\n        !isEmpty && jsx(Button, { size: 'sm', variant: 'text', icon: true, title: resetString, \"aria-label\": label, className: 'p-0', onClick: onReset },\n            jsx(ResetOutlined, null)));\n}\n","/** @jsx jsx */\nimport { React, jsx, classNames, getAppStore, css } from 'jimu-core';\nimport { Tooltip, Button } from 'jimu-ui';\nexport function TemplateItem(props) {\n    var _a, _b, _c, _d;\n    const { template, onClick } = props;\n    const locale = getAppStore().getState().appContext.locale;\n    const label = (_b = (_a = template.i18nLabel) === null || _a === void 0 ? void 0 : _a[locale]) !== null && _b !== void 0 ? _b : template.label;\n    const desc = (_d = (_c = template.i18nDescription) === null || _c === void 0 ? void 0 : _c[locale]) !== null && _d !== void 0 ? _d : template.description;\n    const multipleIcon = template.gifThumbnail != null;\n    const descId = 'templage_desc_' + template.name;\n    const style = React.useMemo(() => css `\r\n    transform: ${getAppStore().getState().appContext.isRTL && template.flipThumbnail ? 'scaleX(-1);' : ''}  ;\r\n  `, [template]);\n    return (jsx(\"div\", { className: 'block-item' },\n        jsx(Tooltip, { title: desc },\n            jsx(Button, { role: 'option', \"aria-label\": label, \"aria-describedby\": descId, onClick: onClick, className: 'block-item--icon p-0' },\n                jsx(\"img\", { className: classNames('default-icon', { 'multiple-icon': multipleIcon }), css: style, src: template.thumbnail, draggable: false, width: template.thumbnailWidth / 2, height: template.thumbnailHeight / 2 }),\n                multipleIcon && (jsx(\"img\", { className: classNames('gif-icon', { 'multiple-icon': multipleIcon }), css: style, draggable: false, src: template.gifThumbnail })))),\n        jsx(\"span\", { \"aria-hidden\": true, className: 'block-item-label text-center mt-2', css: css `max-width: ${template.thumbnailWidth / 2}px` }, label),\n        jsx(\"span\", { \"aria-hidden\": true, className: 'sr-only', id: descId }, desc)));\n}\n","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\n/** @jsx jsx */\nimport { React, jsx, css } from 'jimu-core';\nimport { getBuilderThemeVariables, Theme2GlobalStyleClassName } from 'jimu-theme';\nimport { TemplateItem } from './template-item';\nexport function TemplateList(props) {\n    const { templates, onItemSelect } = props, otherProps = __rest(props, [\"templates\", \"onItemSelect\"]);\n    const theme = React.useMemo(() => getBuilderThemeVariables(), []);\n    const style = React.useMemo(() => css `\r\n    width: auto;\r\n    padding: 20px;\r\n    background-color: ${theme ? theme.ref.palette.neutral[400] : 'var(--ref-palette-neutral-400)'};\r\n    display: grid;\r\n    grid-template-columns: 1fr 1fr;\r\n    grid-row-gap: 10px;\r\n    grid-column-gap: 10px;\r\n\r\n    .block-item {\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: flex-start;\r\n      align-items: center;\r\n      padding: 0;\r\n\r\n      .jimu-btn {\r\n        border-radius: unset !important;\r\n      }\r\n\r\n      .block-item--icon {\r\n        background: ${theme ? theme.ref.palette.neutral[300] : 'var(--ref-palette-neutral-300)'};\r\n        border: none;\r\n        position: relative;\r\n        cursor: pointer;\r\n\r\n        .default-icon {\r\n          opacity: 1;\r\n        }\r\n        .gif-icon {\r\n          opacity: 0;\r\n          position: absolute;\r\n          top: 0;\r\n          left: 0;\r\n          width: 100%;\r\n          height: 100%;\r\n        }\r\n      }\r\n      .block-item--icon:hover {\r\n        outline: 2px solid ${theme ? theme.sys.color.primary.main : 'var(--sys-color-primary-main)'};\r\n        .default-icon.multiple-icon {\r\n          opacity: 0;\r\n        }\r\n        .gif-icon {\r\n          opacity: 1;\r\n        }\r\n      }\r\n\r\n      .block-item-label {\r\n        user-select: none;\r\n        color: ${theme ? theme.ref.palette.neutral[900] : 'var(--ref-palette-neutral-900)'};\r\n      }\r\n    }\r\n\r\n    .size-mode-SMALL & .block-item {\r\n      width: 140px;\r\n      height: auto;\r\n    }\r\n  `, [theme]);\n    return (jsx(\"div\", Object.assign({ className: window.jimuConfig.isInBuilder ? Theme2GlobalStyleClassName : '', css: style }, otherProps, { role: 'listbox' }), templates.map((template) => (jsx(TemplateItem, { key: template.name, template: template, onClick: () => { onItemSelect(template); } })))));\n}\n","/** @jsx jsx */\nimport { React, jsx, css, classNames } from 'jimu-core';\nimport { Tabs, Tab, Select, FOCUSABLE_CONTAINER_CLASS } from 'jimu-ui';\nimport { getFullScreenPageTemplates, getFullScreenGridPageTemplates, getScrollingPageTemplates } from 'jimu-for-builder/templates';\nimport { TemplateList } from '../template-selector/template-list';\nexport class PageTemplateList extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.onTabSelect = (tabId) => {\n            this.props.onTabSelect(tabId);\n        };\n        this.onFullScreenTypeChange = (e) => {\n            this.setState({ fullScreenType: e.target.value });\n        };\n        this.state = { fullScreenType: 'all' };\n    }\n    render() {\n        const { theme, formatMessage } = this.props;\n        const { fullScreenType } = this.state;\n        let templates = [];\n        if (fullScreenType === 'fixed') {\n            templates = getFullScreenPageTemplates();\n        }\n        else if (fullScreenType === 'grid') {\n            templates = getFullScreenGridPageTemplates();\n        }\n        else {\n            templates = [getFullScreenPageTemplates()[0], getFullScreenGridPageTemplates()[0]]\n                .concat(getFullScreenPageTemplates().slice(1), getFullScreenGridPageTemplates().slice(1));\n        }\n        return (jsx(\"div\", { className: 'w-100 h-100' },\n            jsx(\"h5\", { className: 'pt-4 px-5 mb-2 hint-paper text-truncate', title: formatMessage('addPage') }, formatMessage('addPage')),\n            jsx(Tabs, { defaultValue: 'fullScreenApp', fill: true, type: 'underline', css: css `\r\n            height: calc(100% - 49px);\r\n            width: 390px;\r\n            .tab-content {\r\n              height: calc(100% - 30px);\r\n              .tab-pane {\r\n                height: 100%;\r\n                overflow-y: scroll;\r\n              }\r\n              .tab-pane:first-of-type {\r\n                overflow-y: hidden;\r\n              }\r\n            }\r\n            .jimu-nav {\r\n              padding-left: ${theme && theme.sys.spacing(5)};\r\n              padding-right: ${theme && theme.sys.spacing(5)};\r\n            }\r\n            .nav-item {\r\n              width: 50%;\r\n              .tab-title {\r\n                overflow: hidden;\r\n                text-overflow: ellipsis;\r\n                white-space: nowrap;\r\n              }\r\n            }\r\n          `, onChange: this.onTabSelect },\n                jsx(Tab, { id: 'fullScreenApp', title: formatMessage('fullScreenApp'), className: FOCUSABLE_CONTAINER_CLASS },\n                    jsx(\"div\", { className: 'd-flex flex-column h-100' },\n                        jsx(\"div\", { className: 'align-self-end my-4', css: css `\r\n                width: 120px;\r\n                padding-right: 1.2rem;\r\n              ` },\n                            jsx(Select, { value: fullScreenType, \"aria-label\": formatMessage('page'), size: 'sm', onChange: this.onFullScreenTypeChange },\n                                jsx(\"option\", { value: 'all' }, formatMessage('all')),\n                                jsx(\"option\", { value: 'fixed' }, formatMessage('fixed')),\n                                jsx(\"option\", { value: 'grid' }, formatMessage('grid')))),\n                        jsx(TemplateList, { className: classNames({ [FOCUSABLE_CONTAINER_CLASS]: this.props.tabId === 'fullScreenApp' }), templates: templates, onItemSelect: this.props.onItemSelect, css: css `\r\n                  height: calc(100% - 64px);\r\n                  overflow: auto;\r\n                  padding-top: 0;\r\n                ` }))),\n                jsx(Tab, { id: 'scrollingPage', title: formatMessage('scrollingPage'), className: FOCUSABLE_CONTAINER_CLASS },\n                    jsx(TemplateList, { className: classNames({ [FOCUSABLE_CONTAINER_CLASS]: this.props.tabId === 'scrollingPage' }), templates: getScrollingPageTemplates(), onItemSelect: this.props.onItemSelect })))));\n    }\n}\n","/** @jsx jsx */\nimport { React, jsx, css, focusElementInKeyboardMode } from 'jimu-core';\nimport { PageTemplateList } from './page-template-list';\nimport Popper from '../page-aware-popper';\nconst shiftOptions = {\n    rootBoundary: 'viewport',\n    padding: { bottom: 20 }\n};\nexport class PageTemplatePopper extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.togglePopper = () => {\n            if (this.state.open && this.props.onClose) {\n                this.props.onClose();\n            }\n            if (this.state.open) {\n                focusElementInKeyboardMode(this.props.referenceElement);\n            }\n            this.setState({ open: !this.state.open });\n        };\n        this.tabSelect = (tabId) => {\n            this.setState({ tabId: tabId });\n        };\n        this.onItemSelect = (templateJson) => {\n            this.props.onClose();\n            this.props.onItemSelect(templateJson);\n        };\n        this.state = {\n            open: true,\n            tabId: 'fullScreenApp'\n        };\n    }\n    render() {\n        const { referenceElement, theme } = this.props;\n        return (jsx(Popper, { placement: 'bottom', theme: this.props.theme, reference: referenceElement, offsetOptions: 10, open: true, toggle: this.togglePopper, arrowOptions: true, shiftOptions: shiftOptions, forceLatestFocusElements: true },\n            jsx(\"div\", { css: css `\r\n            width: 390px;\r\n            max-height: 640px;\r\n            height: calc(100vh - 150px);\r\n            overflow: hidden;\r\n          ` },\n                jsx(PageTemplateList, { theme: theme, tabId: this.state.tabId, onTabSelect: this.tabSelect, formatMessage: this.props.formatMessage, onItemSelect: this.onItemSelect }))));\n    }\n}\n","/** @jsx jsx */\nimport { React, jsx, css } from 'jimu-core';\nimport { Select } from 'jimu-ui';\nimport { getAnchoredWindowTemplates, getFixedModalWindowTemplates, getFixedNonModalWindowTemplates, getWindowTemplates } from 'jimu-for-builder/templates';\nimport { TemplateList } from '../template-selector/template-list';\nexport class WindowTemplateList extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.onTypeChange = (e) => {\n            this.setState({ type: e.target.value });\n        };\n        this.state = { type: 'all' };\n    }\n    render() {\n        const { formatMessage } = this.props;\n        const { type } = this.state;\n        let templates = [];\n        if (type === 'fixedModalWindow') {\n            templates = getFixedModalWindowTemplates();\n        }\n        else if (type === 'fixedNonModalWindow') {\n            templates = getFixedNonModalWindowTemplates();\n        }\n        else if (type === 'anchoredWindow') {\n            templates = getAnchoredWindowTemplates();\n        }\n        else { // all\n            templates = getWindowTemplates();\n        }\n        return (jsx(\"div\", { className: 'w-100 h-100' },\n            jsx(\"h5\", { className: 'pt-4 px-5 mb-2 hint-paper text-truncate', title: formatMessage('addDialog') }, formatMessage('addDialog')),\n            jsx(\"div\", { className: 'd-flex flex-column h-100' },\n                jsx(\"div\", { className: 'align-self-end my-4', css: css `\r\n              width: 170px;\r\n              padding-right: 1.2rem;\r\n            ` },\n                    jsx(Select, { value: this.state.type, \"aria-label\": formatMessage('addDialog'), size: 'sm', onChange: this.onTypeChange },\n                        jsx(\"option\", { value: 'all' }, formatMessage('all')),\n                        jsx(\"option\", { value: 'fixedModalWindow' }, formatMessage('fixedModalWindow')),\n                        jsx(\"option\", { value: 'fixedNonModalWindow' }, formatMessage('fixedNonModalWindow')),\n                        jsx(\"option\", { value: 'anchoredWindow' }, formatMessage('anchoredWindow')))),\n                jsx(TemplateList, { templates: templates, onItemSelect: this.props.onItemSelect, css: css `\r\n              height: calc(100% - 110px);\r\n              overflow: auto;\r\n              padding-top: 0;\r\n              .block-item .block-item--icon {\r\n                outline-offset: -2px;\r\n              }\r\n            ` }))));\n    }\n}\n","/** @jsx jsx */\nimport { React, jsx, css, focusElementInKeyboardMode } from 'jimu-core';\nimport { WindowTemplateList } from './window-template-list';\nimport Popper from '../page-aware-popper';\nconst shiftOptions = {\n    rootBoundary: 'viewport',\n    padding: { bottom: 20 }\n};\nexport class WindowTemplatePopper extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.togglePopper = () => {\n            if (this.state.open && this.props.onClose) {\n                this.props.onClose();\n            }\n            if (this.state.open) {\n                focusElementInKeyboardMode(this.props.referenceElement);\n            }\n            this.setState({ open: !this.state.open });\n        };\n        this.onItemSelect = (templateJson) => {\n            this.props.onClose();\n            this.props.onItemSelect(templateJson);\n        };\n        this.state = {\n            open: true\n        };\n    }\n    render() {\n        const { referenceElement, theme } = this.props;\n        return (jsx(Popper, { placement: 'bottom', theme: theme, reference: referenceElement, offsetOptions: 10, open: true, toggle: this.togglePopper, arrowOptions: true, shiftOptions: shiftOptions, forceLatestFocusElements: true },\n            jsx(\"div\", { css: css `\r\n            width: 390px;\r\n            max-height: 640px;\r\n            height: calc(100vh - 150px);\r\n            overflow: hidden;\r\n          ` },\n                jsx(WindowTemplateList, { formatMessage: this.props.formatMessage, onItemSelect: this.onItemSelect }))));\n    }\n}\n","/** @jsx jsx */\nimport { React, jsx, css, lodash, focusElementInKeyboardMode } from 'jimu-core';\nimport { getTheme, getTheme2 } from 'jimu-theme';\nimport { TemplateList } from './template-list';\nimport Popper from '../page-aware-popper';\nconst shiftOptions = {\n    rootBoundary: 'viewport',\n    crossAxis: true,\n    padding: { bottom: 20 }\n};\nconst flipOptions = {\n    boundary: document.body,\n    fallbackPlacements: ['right', 'left']\n};\nexport function TemplateSelector(props) {\n    const { title, templates, templateContentStyle, referenceElement, onItemSelect, onClose } = props;\n    const theme = React.useMemo(() => {\n        if (props.theme) {\n            return props.theme;\n        }\n        if (window.jimuConfig.isInBuilder) {\n            return getTheme2();\n        }\n        return getTheme();\n    }, [props.theme]);\n    const style = React.useMemo(() => css `\r\n    min-width: 300px;\r\n    width: auto;\r\n    border: 1px solid ${theme ? theme.ref.palette.neutral[600] : 'var(--ref-palette-neutral-600)'};\r\n    box-shadow: 0 4px 20px 4px rgba(0,0,0,0.50);\r\n\r\n    .template-content {\r\n      max-height: 600px;\r\n      height: ${title ? 'calc(100% - 50px)' : '100%'};\r\n      overflow: auto;\r\n    }\r\n\r\n    .size-mode-SMALL & .template-content {\r\n      width: 320px;\r\n    }\r\n  `, [theme, title]);\n    const togglePopper = React.useCallback(() => {\n        onClose === null || onClose === void 0 ? void 0 : onClose();\n        if (typeof (referenceElement === null || referenceElement === void 0 ? void 0 : referenceElement.focus) === 'function') {\n            lodash.defer(() => {\n                focusElementInKeyboardMode(referenceElement);\n            });\n        }\n    }, [onClose, referenceElement]);\n    const handleSelect = React.useCallback((item) => {\n        togglePopper();\n        onItemSelect(item);\n    }, [togglePopper, onItemSelect]);\n    return (jsx(Popper, { placement: 'bottom', theme: theme, css: style, reference: referenceElement, offsetOptions: 10, toggle: togglePopper, open: true, arrowOptions: true, shiftOptions: shiftOptions, flipOptions: flipOptions },\n        title && (jsx(\"h5\", { className: 'hint-paper text-truncate title px-5 pt-4 mb-0' }, title)),\n        jsx(\"div\", { className: 'template-content', style: templateContentStyle },\n            jsx(TemplateList, { templates: templates, onItemSelect: handleSelect }))));\n}\n","/** @jsx jsx */\nimport { React, jsx, css, injectIntl } from 'jimu-core';\nimport { CheckOutlined } from 'jimu-icons/outlined/application/check';\nimport { Dropdown, DropdownButton, DropdownItem, DropdownMenu, Input } from 'jimu-ui';\nexport var SizeMode;\n(function (SizeMode) {\n    SizeMode[\"Auto\"] = \"AUTO\";\n    SizeMode[\"Custom\"] = \"CUSTOM\";\n})(SizeMode || (SizeMode = {}));\nclass _SizeModeSelector extends React.PureComponent {\n    constructor(props) {\n        super(props);\n        this.toggleDropdown = () => {\n            this.setState(prevState => ({\n                dropdownOpen: !prevState.dropdownOpen\n            }));\n        };\n        this.state = { dropdownOpen: false };\n        this._onAutoSelected = this.onSelect.bind(this, SizeMode.Auto);\n        this._onCustomSelected = this.onSelect.bind(this, SizeMode.Custom);\n    }\n    onSelect(mode) {\n        if (this.props.mode !== mode) {\n            this.props.onChange(mode);\n        }\n    }\n    getStyle() {\n        return css `\r\n      .auto-dropdown.jimu-dropdown {\r\n        width: 26px;\r\n        height: 26px;\r\n\r\n        .btn {\r\n          padding: 0 !important;\r\n        }\r\n      }\r\n\r\n      & > .jimu-dropdown .jimu-dropdown-button,\r\n      & > .jimu-dropdown .jimu-dropdown-button:hover {\r\n        height: 26px;\r\n        padding: 0 0.375rem;\r\n      }\r\n    `;\n    }\n    autoInput() {\n        return (jsx(Input, { style: { width: '110px' }, css: css `\r\n          background-color: var(--ref-palette-neutral-600);\r\n          border-color: var(--ref-palette-neutral-600);\r\n          color: var(--ref-palette-black);\r\n          height: 1.625rem;\r\n          border-width: 0;\r\n          padding: 0 0.25rem;\r\n        `, disabled: true, value: this.props.intl.formatMessage({ id: 'auto' }) }));\n    }\n    render() {\n        const { mode, intl } = this.props;\n        const autoLabel = intl.formatMessage({ id: 'auto' });\n        const customLabel = intl.formatMessage({ id: 'custom' });\n        return (jsx(\"div\", { className: 'd-flex', css: this.getStyle() },\n            jsx(Dropdown, { className: 'auto-dropdown', isOpen: this.state.dropdownOpen, toggle: this.toggleDropdown },\n                jsx(DropdownButton, { icon: true }),\n                jsx(DropdownMenu, null,\n                    jsx(DropdownItem, { onClick: this._onAutoSelected },\n                        jsx(\"span\", { css: css `width: 1rem;` }, mode === SizeMode.Auto && jsx(CheckOutlined, { size: 's' })),\n                        autoLabel),\n                    jsx(DropdownItem, { onClick: this._onCustomSelected },\n                        jsx(\"span\", { css: css `width: 1rem;` }, mode === SizeMode.Custom && jsx(CheckOutlined, { size: 's' })),\n                        customLabel))),\n            mode === SizeMode.Auto && this.autoInput(),\n            mode === SizeMode.Custom && this.props.children));\n    }\n}\nexport const SizeModeSelector = injectIntl(_SizeModeSelector);\n","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\n/** @jsx jsx */\nimport { React, jsx, css, getAppStore, classNames, UtilityManager, Immutable, appConfigUtils, hooks } from 'jimu-core';\nimport { Button, Tooltip, defaultMessages } from 'jimu-ui';\nimport { DataSourceTree } from 'jimu-ui/advanced/data-source-selector';\nimport { getAppConfigAction } from 'jimu-for-builder';\nimport { predefinedOrgUtilities } from './types';\nimport { UtilityGroupFilled } from 'jimu-icons/filled/data/utility-group';\nimport { InfoOutlined } from 'jimu-icons/outlined/suggested/info';\nimport { isUtilityMatch } from '../util';\nimport { UtilityIcon } from './utility-icon';\nfunction getUtilitySetting(name, utility) {\n    if (/rest\\/services\\/.*\\/GeocodeServer/.test(utility.url)) {\n        const { url } = utility, otherProps = __rest(utility, [\"url\"]);\n        return otherProps;\n    }\n    if (name === 'printTask') {\n        return {\n            templates: utility.templates\n        };\n    }\n    return null;\n}\nexport function extractService(helperServices, serviceTypes, keyword, pattern, translate) {\n    // organize the tree based on predefinedOrgUtilities\n    const result = [];\n    predefinedOrgUtilities.forEach(uItem => {\n        const utility = helperServices[uItem.name];\n        // const label = uItem.name !== 'asyncPrintTask' ? translate(uItem.name) : 'Custom Layout Printing (Beta)'\n        const label = translate(uItem.name);\n        if (uItem.dynamic) {\n            // read content from helperServices\n            if (Array.isArray(utility)) {\n                result.push({\n                    id: uItem.name,\n                    name: uItem.name,\n                    label,\n                    type: uItem.type,\n                    children: utility.map((child, index) => {\n                        var _a;\n                        const setting = getUtilitySetting(uItem.name, child);\n                        return { id: `${uItem.name}_${index}`, name: uItem.name, type: uItem.type, index, label: (_a = child.name) !== null && _a !== void 0 ? _a : child.id, url: child.url, setting };\n                    }).filter(childItem => {\n                        return isUtilityMatch(childItem, serviceTypes, keyword, pattern);\n                    })\n                });\n            }\n            else if (utility) {\n                const setting = getUtilitySetting(uItem.name, utility);\n                result.push({ id: uItem.name, name: uItem.name, label, type: uItem.type, url: utility.url, setting });\n            }\n        }\n        else if (utility) {\n            const setting = getUtilitySetting(uItem.name, utility);\n            result.push({ id: uItem.name, name: uItem.name, label, type: uItem.type, url: utility.url, setting });\n        }\n    });\n    return result.filter(item => {\n        if (item.children) {\n            return item.children.length > 0;\n        }\n        return isUtilityMatch(item, serviceTypes, keyword, pattern);\n    });\n}\nexport function addNewUtility(utilityTreeItem) {\n    const uid = UtilityManager.getInstance().getIdOfOrgUtility(utilityTreeItem.name, utilityTreeItem.url, utilityTreeItem.index, utilityTreeItem.label);\n    if (uid)\n        return uid;\n    // 1. add a new utility\n    const appConfigActions = getAppConfigAction();\n    const nextId = appConfigUtils.getUniqueId('utility');\n    const utilityJson = {\n        id: nextId,\n        type: utilityTreeItem.type,\n        name: utilityTreeItem.name,\n        label: utilityTreeItem.label,\n        url: utilityTreeItem.url,\n        source: 'org'\n    };\n    if (utilityTreeItem.setting) {\n        utilityJson.orgSetting = utilityTreeItem.setting;\n    }\n    if (utilityTreeItem.index >= 0) {\n        utilityJson.taskName = utilityTreeItem.label;\n        utilityJson.index = utilityTreeItem.index;\n    }\n    appConfigActions.addUtility(utilityJson).exec();\n    return nextId;\n}\nfunction isInHelperServices(helperServices, name, url, index, taskName) {\n    var _a;\n    if (index >= 0) {\n        const services = helperServices[name];\n        if (Array.isArray(services)) {\n            return services.some(service => {\n                return (service.name === taskName || service.id === taskName) && service.url === url;\n            });\n        }\n        return false;\n    }\n    return ((_a = helperServices[name]) === null || _a === void 0 ? void 0 : _a.url) === url;\n}\nfunction findNotMatchedOrgUtilities(helperServices, useUtilities) {\n    const result = useUtilities.map(u => {\n        return UtilityManager.getInstance().getUtilityJson(u.utilityId);\n    }).filter(uJson => {\n        if ((uJson === null || uJson === void 0 ? void 0 : uJson.source) === 'org') {\n            const { name, url, index, taskName } = uJson;\n            return !isInHelperServices(helperServices, name, url, index, taskName);\n        }\n        return false;\n    });\n    return result;\n}\nconst style = css `\r\n  .utility-item.utility-item-selected {\r\n    outline: 1px solid var(--sys-color-primary-light);\r\n    border-radius: 0;\r\n    position: relative;\r\n    .item-active-icon {\r\n      position: absolute;\r\n      top: -1px;\r\n      right: -1px;\r\n      & > div {\r\n        width: 0;\r\n        height: 0;\r\n        border-top: 0.75rem var(--sys-color-primary-light) solid;\r\n        border-left: 0.75rem transparent solid;\r\n        background-color: transparent;\r\n      }\r\n    }\r\n  }\r\n\r\n  .utility-item-not-matched.utility-item-selected {\r\n    outline: 1px solid var(--sys-color-primary-dark);\r\n    border-radius: 0;\r\n  }\r\n\r\n  .utility-item-not-matched {\r\n    position: relative;\r\n\r\n    .item-active-icon {\r\n      position: absolute;\r\n      top: -1px;\r\n      right: -1px;\r\n      .icon-container {\r\n        width: 0;\r\n        height: 0;\r\n        border-top: 0.75rem var(--sys-color-primary-dark) solid;\r\n        border-left: 0.75rem transparent solid;\r\n        background-color: transparent;\r\n      }\r\n    }\r\n  }\r\n\r\n  .org-tree {\r\n    height: auto !important;\r\n  }\r\n  .tree-root {\r\n    padding: 0.5rem 0;\r\n\r\n  }\r\n`;\nexport function OrgUtilityTree(props) {\n    var _a;\n    const { keyword, pattern, serviceTypes, useUtilities, isMultiple, onChange } = props;\n    const helperServices = (_a = getAppStore().getState().portalSelf) === null || _a === void 0 ? void 0 : _a.helperServices;\n    const [services, setServices] = React.useState([]);\n    const [notMatchedUtilities, setNotMatchedUtilities] = React.useState(null);\n    const translate = hooks.useTranslation(defaultMessages);\n    React.useEffect(() => {\n        setServices(extractService(helperServices, serviceTypes, keyword, pattern, translate));\n    }, [helperServices, serviceTypes, keyword, pattern, translate]);\n    hooks.useEffectOnce(() => {\n        const notMatched = findNotMatchedOrgUtilities(helperServices, useUtilities !== null && useUtilities !== void 0 ? useUtilities : Immutable([]));\n        setNotMatchedUtilities(notMatched);\n    });\n    const getChildNodes = hooks.useEventCallback((utility) => {\n        const { children } = utility;\n        return children !== null && children !== void 0 ? children : [];\n    });\n    const getLabel = hooks.useEventCallback(utility => utility.label);\n    const isNodeSelectable = hooks.useEventCallback(utility => utility.id !== 'root' && !utility.children);\n    const renderLabel = hooks.useEventCallback((label, treeNode, selectable = false) => {\n        return (jsx(\"div\", { className: 'w-100 d-flex align-items-center', css: css `\r\n          height: 1.625rem;\r\n          line-height: 1.625rem;\r\n          background-color: ${selectable ? 'var(--ref-palette-neutral-500)' : 'transparent'};\r\n          color: var(--ref-palette-neutral-1100);\r\n        ` },\n            jsx(\"div\", { className: 'd-flex flex-shrink-0 justify-content-center align-items-center h-100', css: css `width: 1.625rem; background-color: var(--sys-color-info-main);` }, (treeNode === null || treeNode === void 0 ? void 0 : treeNode.children) || (treeNode === null || treeNode === void 0 ? void 0 : treeNode.id) === 'root' ? jsx(UtilityGroupFilled, { color: 'var(--ref-palette-black)', className: 'mr-0' }) : jsx(UtilityIcon, { type: treeNode === null || treeNode === void 0 ? void 0 : treeNode.type, color: 'var(--ref-palette-black)', className: 'mr-0' })),\n            jsx(\"div\", { className: 'text-truncate px-1' }, label)));\n    });\n    const indexOfUtility = React.useCallback((treeNode) => {\n        const { label, index, name, url } = treeNode;\n        let result = -1;\n        useUtilities === null || useUtilities === void 0 ? void 0 : useUtilities.some((u, idx) => {\n            const utilityJson = UtilityManager.getInstance().getUtilityJson(u.utilityId);\n            if ((utilityJson === null || utilityJson === void 0 ? void 0 : utilityJson.source) === 'org') {\n                if (index >= 0) { // from a group\n                    if (utilityJson.index >= 0 && utilityJson.name === name && utilityJson.taskName === label) {\n                        result = idx;\n                        return true;\n                    }\n                }\n                else if (utilityJson.name === name && utilityJson.url === url) {\n                    result = idx;\n                    return true;\n                }\n            }\n            return false;\n        });\n        return result;\n    }, [useUtilities]);\n    const toggleItem = React.useCallback((treeNode) => {\n        if (typeof onChange === 'function') {\n            const index = indexOfUtility(treeNode);\n            const uid = UtilityManager.getInstance().getIdOfOrgUtility(treeNode.name, treeNode.url, treeNode.index, treeNode.label);\n            const actualUseUtilities = useUtilities !== null && useUtilities !== void 0 ? useUtilities : Immutable([]);\n            if (index >= 0) {\n                if (isMultiple) {\n                    // 1. remove an useUtility\n                    onChange(actualUseUtilities.filter((_, idx) => idx !== index));\n                    // 2. check if the org utility is used by any widget, if not, remove this utility\n                    if (!UtilityManager.getInstance().isUtilityUsed(uid)) {\n                        const appConfigActions = getAppConfigAction();\n                        const appConfig = appConfigActions.appConfig;\n                        const utilities = appConfig.utilities.without(uid);\n                        appConfigActions.updateUtilities(utilities).exec();\n                    }\n                }\n            }\n            else {\n                // add a new useUtility\n                if (uid != null) {\n                    if (isMultiple) {\n                        onChange(Immutable.set(actualUseUtilities, actualUseUtilities.length, {\n                            utilityId: uid\n                        }));\n                    }\n                    else {\n                        onChange(Immutable([{\n                                utilityId: uid\n                            }]));\n                    }\n                }\n                else {\n                    // 1. add a new utility\n                    const nextId = addNewUtility(treeNode);\n                    // 2. add useUtility\n                    if (isMultiple) {\n                        onChange(Immutable.set(actualUseUtilities, actualUseUtilities.length, {\n                            utilityId: nextId\n                        }));\n                    }\n                    else {\n                        onChange(Immutable([{\n                                utilityId: nextId\n                            }]));\n                    }\n                }\n            }\n        }\n    }, [indexOfUtility, useUtilities, isMultiple, onChange]);\n    const renderItem = React.useCallback((treeNode) => {\n        const selected = indexOfUtility(treeNode) >= 0;\n        return (jsx(Button, { type: 'tertiary', className: classNames('utility-item jimu-outline-inside text-left w-100', { 'utility-item-selected': selected }), \"aria-checked\": selected, \"aria-label\": treeNode.label, title: treeNode.label, onClick: () => { toggleItem(treeNode); } },\n            renderLabel(treeNode.label, treeNode, true),\n            selected && (jsx(\"div\", { className: 'item-active-icon' },\n                jsx(\"div\", { className: 'text-center' })))));\n    }, [indexOfUtility, renderLabel, toggleItem]);\n    return (jsx(\"div\", { className: 'utility-tree w-100 my-4', css: style },\n        (notMatchedUtilities === null || notMatchedUtilities === void 0 ? void 0 : notMatchedUtilities.length) > 0 && (jsx(\"div\", { className: 'p-2 mb-2' },\n            jsx(\"div\", { className: 'd-flex mb-2 justify-content-between align-items-center' },\n                jsx(\"span\", { className: 'font-13' }, \"Expired\"),\n                jsx(Tooltip, { title: translate('orgUtilityNotAvailable') },\n                    jsx(Button, { type: 'tertiary', size: 'sm', icon: true },\n                        jsx(InfoOutlined, { size: 's' })))),\n            notMatchedUtilities.map(uJson => {\n                var _a, _b, _c, _d, _e, _f;\n                const selected = useUtilities === null || useUtilities === void 0 ? void 0 : useUtilities.some(uItem => uItem.utilityId === uJson.id);\n                return (jsx(\"div\", { className: 'w-100', key: uJson.id },\n                    jsx(Button, { type: 'tertiary', className: classNames('utility-item-not-matched jimu-outline-inside text-left p-0 w-100', { 'utility-item-selected': selected }), \"aria-checked\": selected, \"aria-label\": (_b = (_a = uJson.taskName) !== null && _a !== void 0 ? _a : uJson.label) !== null && _b !== void 0 ? _b : uJson.name, title: (_d = (_c = uJson.taskName) !== null && _c !== void 0 ? _c : uJson.label) !== null && _d !== void 0 ? _d : uJson.name, onClick: () => { toggleItem({ name: uJson.name, url: uJson.url, index: uJson.index, label: uJson.taskName }); } },\n                        renderLabel((_f = (_e = uJson.taskName) !== null && _e !== void 0 ? _e : uJson.label) !== null && _f !== void 0 ? _f : uJson.name, { type: uJson.type }, true),\n                        selected && (jsx(\"div\", { className: 'item-active-icon' },\n                            jsx(\"div\", { className: 'icon-container' }))))));\n            }))),\n        services.map(service => (jsx(\"div\", { key: service.id },\n            jsx(DataSourceTree, { className: 'org-tree', dataSource: service, getChildDataSources: getChildNodes, getLabel: getLabel, isNodeSelectable: isNodeSelectable, renderSelectableNode: renderItem, renderUnselectableNode: (label, source) => renderLabel(label, source), defaultOpen: true }))))));\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/** @jsx jsx */\nimport { React, jsx, css, UtilityManager, classNames, Immutable, SupportedUtilityType, hooks, getAppStore } from 'jimu-core';\nimport { Button } from 'jimu-ui';\nimport { DataSourceTree } from 'jimu-ui/advanced/data-source-selector';\nimport { UtilityGroupFilled } from 'jimu-icons/filled/data/utility-group';\nimport { isUtilityMatch } from '../util';\nimport { UtilityIcon } from './utility-icon';\nfunction extractService(utilities, serviceTypes, keyword, pattern) {\n    return __awaiter(this, void 0, void 0, function* () {\n        var _a, _b;\n        const result = [];\n        const uIdArray = Object.keys(utilities !== null && utilities !== void 0 ? utilities : {});\n        const runtimeInfo = getAppStore().getState().appStateInBuilder.appRuntimeInfo;\n        const utilityStates = (_a = runtimeInfo.utilityStates) !== null && _a !== void 0 ? _a : {};\n        for (let i = 0; i < uIdArray.length; i++) {\n            const item = utilities[uIdArray[i]];\n            if (item.source === 'org' || (uIdArray[i] in utilityStates && utilityStates[uIdArray[i]].success === false)) {\n                continue;\n            }\n            const utility = yield UtilityManager.getInstance().getUtility(item.id);\n            let utilityItem;\n            if (item.portalUrl && item.itemId) {\n                utilityItem = { id: item.id, label: (_b = item.label) !== null && _b !== void 0 ? _b : item.sourceLabel, type: item.type, url: utility.itemInfo.url };\n            }\n            else {\n                utilityItem = { id: item.id, label: item.label, type: item.type, url: item.url };\n            }\n            if (utility.tasks) {\n                utilityItem.children = utility.tasks\n                    .filter((task) => task.visible || task.visible == null)\n                    .map((task, index) => {\n                    var _a;\n                    return {\n                        rootId: item.id,\n                        id: `${item.id}_${index}`,\n                        task: task.name,\n                        type: task.isPrintingTask ? SupportedUtilityType.Printing : SupportedUtilityType.GPTask,\n                        label: (_a = task.label) !== null && _a !== void 0 ? _a : task.name,\n                        url: `${utilityItem.url}/${task.name}`\n                    };\n                })\n                    .filter(childItem => {\n                    return isUtilityMatch(childItem, serviceTypes, keyword, pattern);\n                });\n            }\n            result.push(utilityItem);\n        }\n        return result.filter(item => {\n            if (item.children) {\n                return item.children.length > 0;\n            }\n            return isUtilityMatch(item, serviceTypes, keyword, pattern);\n        });\n    });\n}\nconst style = css `\r\n  .utility-item.utility-item-selected {\r\n    outline: 1px solid var(--sys-color-primary-light);\r\n    position: relative;\r\n    .item-active-icon {\r\n      position: absolute;\r\n      top: -1px;\r\n      right: -1px;\r\n      & > div {\r\n        width: 0;\r\n        height: 0;\r\n        border-top: 0.75rem var(--sys-color-primary-light) solid;\r\n        border-left: 0.75rem transparent solid;\r\n        background-color: transparent;\r\n      }\r\n    }\r\n  }\r\n  .tree-root {\r\n    padding: 0.5rem 0;\r\n  }\r\n`;\nexport function AddedUtilityTree(props) {\n    const { keyword, pattern, serviceTypes, utilities, useUtilities, isMultiple, onUtilitiesChange, className } = props;\n    const [services, setServices] = React.useState([]);\n    const cancelable = hooks.useCancelablePromiseMaker();\n    React.useEffect(() => {\n        cancelable(extractService(utilities, serviceTypes, keyword, pattern)).then(result => {\n            setServices(result);\n        });\n    }, [utilities, cancelable, serviceTypes, keyword, pattern]);\n    const getChildNodes = hooks.useEventCallback((treeNode) => {\n        const { children } = treeNode;\n        return children !== null && children !== void 0 ? children : [];\n    });\n    const getLabel = hooks.useEventCallback((treeNode) => treeNode.label);\n    const isNodeSelectable = hooks.useEventCallback((treeNode) => treeNode.id !== 'root' && !treeNode.children);\n    const renderLabel = hooks.useEventCallback((label, treeNode, selectable = false) => {\n        return (jsx(\"div\", { className: 'w-100 d-flex align-items-center', css: css `\r\n          height: 1.625rem;\r\n          line-height: 1.625rem;\r\n          background-color: ${selectable ? 'var(--ref-palette-neutral-500)' : 'transparent'};\r\n          color: var(--ref-palette-neutral-1100);\r\n        ` },\n            jsx(\"div\", { className: 'd-flex flex-shrink-0 justify-content-center align-items-center h-100', css: css `width: 1.625rem; background-color: var(--sys-color-info-main);` }, (treeNode === null || treeNode === void 0 ? void 0 : treeNode.children) || treeNode.id === 'root' ? jsx(UtilityGroupFilled, { color: 'var(--ref-palette-black)', className: 'mr-0' }) : jsx(UtilityIcon, { type: treeNode === null || treeNode === void 0 ? void 0 : treeNode.type, color: 'var(--ref-palette-black)', className: 'mr-0' })),\n            jsx(\"div\", { className: 'text-truncate px-1' }, label)));\n    });\n    const indexOfUtility = React.useCallback((treeNode) => {\n        const { id, rootId, task } = treeNode;\n        let result = -1;\n        useUtilities === null || useUtilities === void 0 ? void 0 : useUtilities.some((u, idx) => {\n            if (u.utilityId === id || (u.utilityId === rootId && u.task === task)) {\n                result = idx;\n                return true;\n            }\n            return false;\n        });\n        return result;\n    }, [useUtilities]);\n    const toggleItem = React.useCallback((treeNode) => {\n        var _a, _b;\n        if (typeof onUtilitiesChange === 'function') {\n            const index = indexOfUtility(treeNode);\n            const actualUseUtilities = useUtilities !== null && useUtilities !== void 0 ? useUtilities : Immutable([]);\n            if (index >= 0) {\n                if (isMultiple) {\n                    onUtilitiesChange(actualUseUtilities.filter((_, idx) => idx !== index));\n                }\n            }\n            else {\n                if (isMultiple) {\n                    onUtilitiesChange(Immutable.set(actualUseUtilities, actualUseUtilities.length, {\n                        utilityId: (_a = treeNode.rootId) !== null && _a !== void 0 ? _a : treeNode.id,\n                        task: treeNode.task\n                    }));\n                }\n                else {\n                    onUtilitiesChange(Immutable([{\n                            utilityId: (_b = treeNode.rootId) !== null && _b !== void 0 ? _b : treeNode.id,\n                            task: treeNode.task\n                        }]));\n                }\n            }\n        }\n    }, [indexOfUtility, useUtilities, isMultiple, onUtilitiesChange]);\n    const renderItem = React.useCallback((treeNode) => {\n        const selected = indexOfUtility(treeNode) >= 0;\n        return (jsx(Button, { type: 'tertiary', className: classNames('utility-item jimu-outline-inside text-left w-100', { 'utility-item-selected': selected }), \"aria-checked\": selected, \"aria-label\": treeNode.label, title: treeNode.label, onClick: () => { toggleItem(treeNode); } },\n            renderLabel(treeNode.label, treeNode, true),\n            selected && (jsx(\"div\", { className: 'item-active-icon' },\n                jsx(\"div\", { className: 'text-center' })))));\n    }, [indexOfUtility, renderLabel, toggleItem]);\n    return (jsx(\"div\", { className: classNames('utility-tree w-100', className, { 'my-4': !(className === null || className === void 0 ? void 0 : className.includes('my-')) }), css: style }, services.map(service => (jsx(\"div\", { key: service.id },\n        jsx(DataSourceTree, { className: 'added-tree', dataSource: service, getChildDataSources: getChildNodes, getLabel: getLabel, isNodeSelectable: isNodeSelectable, renderSelectableNode: renderItem, renderUnselectableNode: (label, source) => renderLabel(label, source), defaultOpen: true }))))));\n}\n","/** @jsx jsx */\nimport { React, jsx, css, UtilityManager, hooks } from 'jimu-core';\nimport { Button, Collapse, Loading, LoadingType } from 'jimu-ui';\nimport { UtilityGroupFilled } from 'jimu-icons/filled/data/utility-group';\nimport { UtilityFilled } from 'jimu-icons/filled/data/utility';\nimport { CloseOutlined } from 'jimu-icons/outlined/editor/close';\nimport { PlusCircleOutlined } from 'jimu-icons/outlined/editor/plus-circle';\nimport { MinusCircleOutlined } from 'jimu-icons/outlined/editor/minus-circle';\nimport { VisibleOutlined } from 'jimu-icons/outlined/application/visible';\nimport { InvisibleOutlined } from 'jimu-icons/outlined/application/invisible';\nconst collapseLineStyle = css `\r\n  border-left: 1px solid var(--ref-palette-neutral-700);\r\n  border-bottom: 1px solid var(--ref-palette-neutral-700);\r\n  width: 1.5rem;\r\n  height: 2.1rem;\r\n  position: absolute;\r\n  top: -16px;\r\n  left: 8px;\r\n`;\nexport function UtilityItem(props) {\n    var _a, _b;\n    const { utility, onRemove, onChange } = props;\n    const [isOpen, setIsOpen] = React.useState(false);\n    const [tasks, setTasks] = React.useState(null);\n    const [loaded, setIsLoaded] = React.useState(false);\n    const translate = hooks.useTranslation();\n    hooks.useEffectOnce(() => {\n        UtilityManager.getInstance().getUtilityFromJson(utility).then(u => {\n            var _a;\n            if (((_a = u.tasks) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n                setTasks(u.tasks);\n            }\n        }).finally(() => {\n            setIsLoaded(true);\n        });\n    });\n    const toggleOpen = React.useCallback(() => {\n        setIsOpen(!isOpen);\n    }, [isOpen]);\n    const handleRemove = React.useCallback(() => {\n        onRemove(utility);\n    }, [onRemove, utility]);\n    const toggleVisible = React.useCallback((task) => {\n        const newTasks = [];\n        tasks.forEach((taskItem) => {\n            if (taskItem.name === task.name) {\n                newTasks.push(Object.assign(Object.assign({}, taskItem), { visible: taskItem.visible == null ? false : !taskItem.visible }));\n            }\n            else {\n                newTasks.push(taskItem);\n            }\n        });\n        setTasks(newTasks);\n        const newUtility = utility.set('tasks', newTasks);\n        onChange(newUtility);\n    }, [tasks, utility, onChange]);\n    if (!loaded) {\n        return jsx(\"div\", { className: 'loading-container' },\n            jsx(Loading, { type: LoadingType.Bar }));\n    }\n    return (jsx(React.Fragment, null,\n        jsx(\"div\", { className: 'w-100 d-flex align-items-center mb-2 pl-4', css: css `\r\n          height: 1.625rem;\r\n          line-height: 1.625rem;\r\n          background-color: var(--ref-palette-neutral-500);\r\n          color: var(--ref-palette-neutral-1100);\r\n          position: relative;\r\n        ` },\n            jsx(\"div\", { className: 'd-flex flex-shrink-0 justify-content-center align-items-center h-100' },\n                (tasks === null || tasks === void 0 ? void 0 : tasks.length) > 0 && (jsx(Button, { className: 'px-0', type: 'tertiary', icon: true, size: 'sm', onClick: toggleOpen, css: css `\r\n                position: absolute;\r\n                left: 0;\r\n              ` }, isOpen ? jsx(MinusCircleOutlined, { size: 's' }) : jsx(PlusCircleOutlined, { size: 's' }))),\n                jsx(\"div\", { className: 'utility-icon-container' }, (tasks === null || tasks === void 0 ? void 0 : tasks.length) > 0 ? jsx(UtilityGroupFilled, { color: 'var(--ref-palette-black)' }) : jsx(UtilityFilled, { color: 'var(--ref-palette-black)' }))),\n            jsx(\"div\", { className: 'text-truncate px-2', title: (_a = utility.label) !== null && _a !== void 0 ? _a : utility.sourceLabel }, (_b = utility.label) !== null && _b !== void 0 ? _b : utility.sourceLabel),\n            jsx(Button, { className: 'ml-auto', type: 'tertiary', icon: true, size: 'sm', onClick: handleRemove },\n                jsx(CloseOutlined, null))),\n        (tasks === null || tasks === void 0 ? void 0 : tasks.length) > 0 && (jsx(Collapse, { isOpen: isOpen }, tasks.map(task => (jsx(\"div\", { key: task.name, className: 'd-flex align-items-center mb-2', css: css `padding-left: 2rem; position: relative;` },\n            jsx(\"div\", { className: 'utility-icon-container mr-2' },\n                jsx(UtilityFilled, { color: 'var(--ref-palette-black)' })),\n            jsx(\"div\", { className: 'text-truncate', title: task.name }, task.name),\n            jsx(Button, { type: 'tertiary', title: task.visible == null || task.visible ? translate('invisible') : translate('visible'), \"aria-label\": task.visible == null || task.visible ? translate('invisible') : translate('visible'), className: 'p-0 ml-auto utility-tasks align-items-center', onClick: () => { toggleVisible(task); } }, task.visible == null || task.visible ? jsx(VisibleOutlined, null) : jsx(InvisibleOutlined, null)),\n            jsx(\"div\", { className: 'collapse-line', css: collapseLineStyle }))))))));\n}\n","/** @jsx jsx */\nimport { React, jsx, css, Immutable, hooks } from 'jimu-core';\nimport { Button, Collapse, defaultMessages } from 'jimu-ui';\nimport { UpOutlined } from 'jimu-icons/outlined/directional/up';\nimport { DownOutlined } from 'jimu-icons/outlined/directional/down';\nimport { UtilityItem } from './utility-item';\nconst style = css `\r\n  max-height: 300px;\r\n  background-color: var(--ref-palette-neutral-500);\r\n\r\n  .item-list {\r\n    max-height: 180px;\r\n    overflow: auto;\r\n  }\r\n\r\n  .utility-icon-container {\r\n    display: flex;\r\n    flex-shrink: 0;\r\n    justify-content: center;\r\n    align-items: center;\r\n    background-color: var(--sys-color-info-main);\r\n    width: 1.625rem;\r\n    height: 1.625rem;\r\n    margin-right: 8px;\r\n    svg {\r\n      margin-right: 0 !important;\r\n    }\r\n  }\r\n`;\nexport function NewUtilityPanel(props) {\n    const { utilities, onDoneClick, onChange } = props;\n    const translate = hooks.useTranslation(defaultMessages);\n    const [isOpen, setIsOpen] = React.useState(false);\n    const toggleOpen = React.useCallback(() => {\n        setIsOpen(!isOpen);\n    }, [isOpen]);\n    const handleRemove = React.useCallback((utility) => {\n        onChange(utilities.filter(u => u.id !== utility.id));\n    }, [onChange, utilities]);\n    const handleChange = React.useCallback((utility) => {\n        const index = utilities.findIndex(u => u.id === utility.id);\n        onChange(Immutable.set(utilities, index, utility));\n    }, [onChange, utilities]);\n    if (!utilities) {\n        return null;\n    }\n    return (jsx(\"div\", { className: 'w-100 p-4 shadow-3', css: style },\n        jsx(\"div\", { className: 'new_utility_header d-flex align-items-center' },\n            jsx(\"div\", { className: 'font-13' },\n                jsx(\"span\", null, utilities.length),\n                jsx(\"span\", { className: 'ml-1' }, translate('selected'))),\n            jsx(Button, { className: 'ml-2', type: 'tertiary', icon: true, size: 'sm', onClick: toggleOpen }, isOpen ? jsx(UpOutlined, null) : jsx(DownOutlined, null)),\n            !isOpen && (jsx(Button, { className: 'ml-auto', type: 'primary', \"aria-label\": translate('done'), onClick: onDoneClick }, translate('done')))),\n        jsx(Collapse, { isOpen: isOpen },\n            jsx(\"div\", { className: 'my-4 item-list' }, utilities.map((u, index) => jsx(UtilityItem, { key: index, utility: u, onChange: handleChange, onRemove: handleRemove })))),\n        isOpen && (jsx(Button, { className: 'w-100', type: 'primary', \"aria-label\": translate('done'), onClick: onDoneClick }, translate('done')))));\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/** @jsx jsx */\nimport { React, ReactRedux, jsx, css, SupportedItemTypes, Immutable, appConfigUtils, UtilityManager, SupportedUtilityType, hooks } from 'jimu-core';\nimport { Tabs, Tab, Button, Alert, UrlInput, defaultMessages, Loading, LoadingType } from 'jimu-ui';\nimport { ItemSelector, ItemSelectorMode } from 'jimu-ui/basic/item-selector';\nimport { getLabelOfUrl, checkServiceType, isValidUtilityUrl } from '../util';\nimport { NewUtilityPanel } from './new-utility-panel';\nconst itemTypes = Immutable([\n    SupportedItemTypes.GeocodingService,\n    SupportedItemTypes.GeometryService,\n    SupportedItemTypes.GeoprocessingService,\n    SupportedItemTypes.NetworkAnalysisService\n]);\nfunction getNextUtilityId() {\n    return appConfigUtils.getUniqueId('utility');\n}\nconst serviceMap = new Map();\nconst onlineItemMap = new Map();\nconst emptyUtilities = Immutable({});\nexport function AddUtilityTabs(props) {\n    const { utilities = emptyUtilities, onChange, batchUtilityJsons, onBatchUpdate, onBatchDone, isMultiple = true, immediate = true } = props;\n    const [url, setUrl] = React.useState('');\n    const [isValidUrl, setIsValidUrl] = React.useState(false);\n    const [showItemAlert, setShowItemAlert] = React.useState({ show: false, msg: null });\n    const [isBusy, setIsBusy] = React.useState(false);\n    const formatMessage = hooks.useTranslation(defaultMessages);\n    const portalUrl = ReactRedux.useSelector((state) => {\n        return state.portalUrl;\n    });\n    const selectedItems = React.useMemo(() => {\n        const result = [];\n        Object.keys(utilities).forEach(id => {\n            const utility = utilities[id];\n            if (utility.portalUrl) {\n                result.push(utility.itemId);\n            }\n        });\n        batchUtilityJsons === null || batchUtilityJsons === void 0 ? void 0 : batchUtilityJsons.forEach(u => {\n            if (u.portalUrl) {\n                result.push(u.itemId);\n            }\n        });\n        return Immutable(result);\n    }, [utilities, batchUtilityJsons]);\n    const checkOnChange = hooks.useEventCallback((value) => {\n        if (/^https:\\/\\//.test(value)) {\n            const isValid = isValidUtilityUrl(value);\n            if (isValid) {\n                const duplicated = UtilityManager.getInstance().urlExist(value);\n                if (duplicated) {\n                    setIsValidUrl(false);\n                    return { valid: false, msg: formatMessage('duplicatedService') };\n                }\n                setIsValidUrl(true);\n                return { valid: true };\n            }\n        }\n        setIsValidUrl(false);\n        return { valid: false, msg: formatMessage('serviceNotSupported') };\n    });\n    const hanldeUrlChange = hooks.useEventCallback((r) => {\n        setUrl(r.value);\n    });\n    const isItemSelectable = React.useCallback((item) => __awaiter(this, void 0, void 0, function* () {\n        let url = onlineItemMap.get(item.id);\n        let isValid = false;\n        if (!url) {\n            url = yield UtilityManager.getInstance().getUrlOfItem(item.portalUrl, item.id);\n            if (url) {\n                onlineItemMap.set(item.id, url);\n            }\n        }\n        if (url) {\n            if (serviceMap.has(url)) {\n                if (serviceMap.get(url).valid) {\n                    isValid = true;\n                }\n            }\n            else {\n                isValid = isValidUtilityUrl(url);\n            }\n        }\n        if (isValid) {\n            setShowItemAlert({ show: false, msg: null });\n            return true;\n        }\n        else {\n            setShowItemAlert({ show: true, msg: formatMessage('serviceNotSupported') });\n            setTimeout(() => {\n                setShowItemAlert({ show: false, msg: null });\n            }, 3000);\n            return false;\n        }\n    }), [formatMessage]);\n    const handleItemAdded = React.useCallback((_, latestSelectedItem) => __awaiter(this, void 0, void 0, function* () {\n        var _a;\n        const itemServiceUrl = onlineItemMap.get(latestSelectedItem.id);\n        if (itemServiceUrl && !serviceMap.has(itemServiceUrl)) {\n            // check if the item content is a valid utility\n            try {\n                const { type, info } = yield checkServiceType(itemServiceUrl);\n                if (type != null) {\n                    serviceMap.set(itemServiceUrl, { valid: true, type, info });\n                    setShowItemAlert({ show: false, msg: null });\n                }\n                else {\n                    serviceMap.set(itemServiceUrl, { valid: false });\n                    throw new Error(`service not supported ${itemServiceUrl}`);\n                }\n            }\n            catch (e) {\n                setShowItemAlert({ show: true, msg: formatMessage('invalidResourceItem') });\n                setTimeout(() => {\n                    setShowItemAlert({ show: false, msg: null });\n                }, 3000);\n                return;\n            }\n        }\n        if (itemServiceUrl && ((_a = serviceMap.get(itemServiceUrl)) === null || _a === void 0 ? void 0 : _a.valid)) {\n            const { type, info } = serviceMap.get(itemServiceUrl);\n            const newUtility = {\n                id: getNextUtilityId(),\n                sourceLabel: latestSelectedItem.title,\n                type,\n                source: 'custom',\n                itemId: latestSelectedItem.id,\n                portalUrl: latestSelectedItem.portalUrl,\n                url: itemServiceUrl\n            };\n            if (type === SupportedUtilityType.GPServer) {\n                newUtility.tasks = info === null || info === void 0 ? void 0 : info.tasks;\n            }\n            if (immediate) {\n                const newUtilities = utilities.set(newUtility.id, newUtility);\n                onChange(newUtilities);\n            }\n            else {\n                newUtility.id = `${Date.now()}`; // assign a random id\n                onBatchUpdate(Immutable.set(batchUtilityJsons, batchUtilityJsons.length, newUtility));\n            }\n        }\n    }), [onChange, onBatchUpdate, batchUtilityJsons, utilities, immediate, formatMessage]);\n    const handleItemRemoved = React.useCallback((_, latestRemovedItem) => {\n        if (immediate) {\n            const idToRemove = Object.keys(utilities).find(id => utilities[id].itemId === latestRemovedItem.id && utilities[id].portalUrl === latestRemovedItem.portalUrl);\n            const newUtilities = utilities.without(idToRemove);\n            onChange(newUtilities);\n        }\n        else {\n            onBatchUpdate(batchUtilityJsons.filter(u => u.itemId !== latestRemovedItem.id));\n        }\n    }, [onChange, onBatchUpdate, utilities, batchUtilityJsons, immediate]);\n    const handleAddService = React.useCallback(() => __awaiter(this, void 0, void 0, function* () {\n        var _a, _b, _c;\n        const exists = UtilityManager.getInstance().urlExist(url);\n        if (!serviceMap.has(url)) {\n            setIsBusy(true);\n            // check if the url is a valid utility\n            try {\n                const { type, info } = yield checkServiceType(url, true);\n                if (type != null) {\n                    serviceMap.set(url, { valid: true, type, info });\n                }\n                else {\n                    serviceMap.set(url, { valid: false });\n                    throw new Error(`service not supported ${url}`);\n                }\n            }\n            catch (e) {\n                setShowItemAlert({ show: true, msg: formatMessage('invalidResourceItem') });\n                setTimeout(() => {\n                    setShowItemAlert({ show: false, msg: null });\n                }, 3000);\n                return;\n            }\n            finally {\n                setIsBusy(false);\n            }\n        }\n        const checkResult = serviceMap.get(url);\n        if (!exists && (checkResult === null || checkResult === void 0 ? void 0 : checkResult.valid)) {\n            const newUtility = {\n                id: getNextUtilityId(),\n                type: checkResult.type,\n                source: 'custom',\n                url,\n                label: (_b = (_a = checkResult.info) === null || _a === void 0 ? void 0 : _a.displayName) !== null && _b !== void 0 ? _b : getLabelOfUrl(url)\n            };\n            if (checkResult.type === SupportedUtilityType.GPServer) {\n                newUtility.tasks = (_c = checkResult.info) === null || _c === void 0 ? void 0 : _c.tasks;\n            }\n            if (immediate) {\n                const newUtilities = utilities.set(newUtility.id, newUtility);\n                onChange(newUtilities);\n            }\n            else {\n                newUtility.id = `${Date.now()}`; // assign a random id\n                onBatchUpdate(Immutable.set(batchUtilityJsons, batchUtilityJsons.length, newUtility));\n            }\n            setUrl('');\n            setIsValidUrl(false);\n        }\n    }), [onChange, onBatchUpdate, utilities, batchUtilityJsons, immediate, url, formatMessage]);\n    return (jsx(\"div\", { className: 'w-100 h-100', css: css `position: relative;` },\n        jsx(Tabs, { css: css `\r\n          height: ${immediate ? '100%' : 'calc(100% - 64px)'};\r\n          overflow: hidden;\r\n          .tab-content {\r\n            max-height: calc(100% - 2rem);\r\n          }\r\n        `, type: 'underline', fill: true },\n            jsx(Tab, { id: 'layers', title: formatMessage('url') },\n                jsx(\"div\", { className: 'w-100 pt-4 px-4', css: css `\r\n              position: relative;\r\n            ` },\n                    jsx(UrlInput, { schemes: ['https'], height: 80, value: url, placeholder: formatMessage('websitePlaceholder'), checkValidityOnChange: checkOnChange, onChange: hanldeUrlChange })),\n                jsx(\"div\", { className: 'd-flex px-4 pt-4 flex-column align-items-end' },\n                    jsx(Button, { className: 'w-100', type: 'primary', disabled: !isValidUrl || isBusy, onClick: handleAddService, css: css `position: relative;min-height:2rem;` }, isBusy ? jsx(Loading, { type: LoadingType.DotsSecondary }) : formatMessage('add'))),\n                jsx(\"div\", { className: 'd-flex px-4 pt-2 flex-column' },\n                    jsx(\"div\", { css: css `\r\n              color: var(--ref-palette-neutral-900);\r\n              font-weight: 400;\r\n              font-size: 13px;\r\n              line-height: 18px;\r\n            ` }, formatMessage('supportedServices')))),\n            jsx(Tab, { id: 'widgets', title: formatMessage('items') },\n                jsx(ItemSelector, { mode: ItemSelectorMode.Simple, itemType: itemTypes, portalUrl: portalUrl, isMultiple: isMultiple, isSelectable: isItemSelectable, onSelect: handleItemAdded, onRemove: handleItemRemoved, selectedItems: selectedItems, disableRemoveItemsSelectedOnMount: true }))),\n        jsx(\"div\", { css: css `\r\n        position: absolute;\r\n        bottom: 0;\r\n        width: 100%;\r\n      ` },\n            showItemAlert.show && (jsx(Alert, { closable: true, form: 'basic', onClose: () => { setShowItemAlert({ show: false, msg: null }); }, open: true, text: showItemAlert.msg, type: 'warning', withIcon: true, className: 'w-100' })),\n            jsx(NewUtilityPanel, { utilities: batchUtilityJsons, onChange: onBatchUpdate, onDoneClick: onBatchDone }))));\n}\n","/** @jsx jsx */\nimport { React, ReactRedux, jsx, css, UtilityManager, Immutable, appConfigUtils, SupportedUtilityType, hooks } from 'jimu-core';\nimport { getAppConfigAction } from 'jimu-for-builder';\nimport { List, TreeItemActionType } from 'jimu-ui/basic/list-tree';\nimport { Button, TextInput, Tabs, Tab, MultiSelect, Label, Checkbox, defaultMessages } from 'jimu-ui';\nimport { SidePopper } from 'jimu-ui/advanced/setting-components';\nimport { OrgUtilityTree } from './org-utility';\nimport { AddedUtilityTree } from './added-utility';\nimport { AddUtilityTabs } from './add-utility-tabs';\nimport { selectUtilitySVG } from './utility-icon';\nimport { SearchOutlined } from 'jimu-icons/outlined/editor/search';\nimport closeIcon from 'jimu-icons/svg/outlined/editor/close.svg';\nimport warningOutlined from 'jimu-icons/svg/outlined/suggested/warning.svg';\nimport { PlusCircleFilled } from 'jimu-icons/filled/editor/plus-circle';\nexport { extractService, addNewUtility } from './org-utility';\nconst advancedActionMap = {\n    overrideItemBlockInfo: ({ itemBlockInfo }, refComponent) => {\n        return {\n            name: TreeItemActionType.RenderOverrideItem,\n            children: [{\n                    name: TreeItemActionType.RenderOverrideItemBody,\n                    children: [{\n                            name: TreeItemActionType.RenderOverrideItemMainLine,\n                            children: [{\n                                    name: TreeItemActionType.RenderOverrideItemIcon,\n                                    autoCollapsed: true\n                                }, {\n                                    name: TreeItemActionType.RenderOverrideItemTitle\n                                }, {\n                                    name: TreeItemActionType.RenderOverrideItemCommands\n                                }]\n                        }]\n                }]\n        };\n    }\n};\nconst ALL_TYPES_MAP = {\n    [SupportedUtilityType.GeoCoding]: 'geocodingService',\n    [SupportedUtilityType.GeoEnrichment]: 'geoenrichmentService',\n    [SupportedUtilityType.Geometry]: 'geometryService',\n    [SupportedUtilityType.Printing]: 'printingService',\n    [SupportedUtilityType.Routing]: 'routingService',\n    [SupportedUtilityType.GPServer]: 'geoprocessingService',\n    [SupportedUtilityType.GPTask]: 'geoprocessingTask'\n};\nconst ALL_TYPES = Object.keys(ALL_TYPES_MAP);\nexport function UtilitySelector(props) {\n    const { useUtilities, onChange, pattern, types = ALL_TYPES, isMultiple = false, showRemove = true, showOrgUtility = true, closePopupOnSelect = true } = props;\n    const translate = hooks.useTranslation(defaultMessages);\n    const utilities = ReactRedux.useSelector((state) => {\n        var _a, _b, _c;\n        if (window.jimuConfig.isBuilder) {\n            return (_b = (_a = state.appStateInBuilder) === null || _a === void 0 ? void 0 : _a.appConfig) === null || _b === void 0 ? void 0 : _b.utilities;\n        }\n        else {\n            return (_c = state.appConfig) === null || _c === void 0 ? void 0 : _c.utilities;\n        }\n    });\n    const utilityStates = ReactRedux.useSelector((state) => {\n        var _a, _b, _c;\n        if (window.jimuConfig.isBuilder) {\n            return (_b = (_a = state.appStateInBuilder) === null || _a === void 0 ? void 0 : _a.appRuntimeInfo) === null || _b === void 0 ? void 0 : _b.utilityStates;\n        }\n        else {\n            return (_c = state.appRuntimeInfo) === null || _c === void 0 ? void 0 : _c.utilityStates;\n        }\n    });\n    const utilitiesRef = React.useRef(utilities);\n    const typesRef = React.useRef(types);\n    const [showPopper, setShowPopper] = React.useState(false);\n    // 0 means select from existing utility, 1 means add new utility\n    const [selectType, setSelectType] = React.useState(0);\n    const [serviceTypes, setServiceTypes] = React.useState(types);\n    const [keyword, setKeyword] = React.useState('');\n    const [batchUtilityJsons, setBatchUtilityJsons] = React.useState(Immutable([]));\n    const elemRef = React.useRef();\n    const btnRef = React.useRef();\n    const getMultiSelectItems = React.useCallback(() => {\n        return types.map(type => ({\n            value: type,\n            label: translate(ALL_TYPES_MAP[type]),\n            render: (_item, values) => {\n                return (jsx(Label, { className: 'd-flex w-100 h-100 align-items-center mb-0' },\n                    jsx(Checkbox, { checked: values.includes(type) }),\n                    jsx(\"span\", { className: 'ml-2' }, translate(ALL_TYPES_MAP[type]))));\n            }\n        }));\n    }, [translate, types]);\n    const handleTypesChange = React.useCallback((evt, value, values) => {\n        setServiceTypes(values);\n    }, []);\n    const displaySelectedTypes = (values) => {\n        return translate('numSelected', { number: values.length });\n    };\n    React.useEffect(() => {\n        // utilities changes, check if the item in useUtilities is valid\n        if (utilities === utilitiesRef.current) {\n            return;\n        }\n        utilitiesRef.current = utilities;\n        if ((useUtilities === null || useUtilities === void 0 ? void 0 : useUtilities.length) > 0) {\n            const validResult = [];\n            useUtilities.forEach(item => {\n                if (utilities[item.utilityId]) {\n                    validResult.push(item);\n                }\n            });\n            if (useUtilities.length !== validResult.length) {\n                onChange(Immutable(validResult));\n            }\n        }\n    }, [utilities, useUtilities, onChange]);\n    React.useEffect(() => {\n        // compare with previous value\n        let changed = false;\n        if (types.length !== typesRef.current.length) {\n            changed = true;\n        }\n        else {\n            changed = types.some(t => {\n                if (!typesRef.current.includes(t)) {\n                    return true;\n                }\n                return false;\n            });\n        }\n        if (changed) {\n            typesRef.current = types;\n            setServiceTypes(types);\n        }\n    }, [types]);\n    const togglePopper = React.useCallback(() => {\n        setShowPopper(!showPopper);\n    }, [showPopper]);\n    const switchToAddMode = hooks.useEventCallback(() => {\n        setSelectType(1);\n    });\n    const switchToSelectMode = hooks.useEventCallback(() => {\n        setSelectType(0);\n    });\n    const handleUseUtilityChange = React.useCallback((useUtilities) => {\n        onChange(useUtilities);\n        if (!isMultiple && closePopupOnSelect) {\n            setShowPopper(false);\n        }\n    }, [onChange, isMultiple, closePopupOnSelect]);\n    const hanldeUtilitesChange = hooks.useEventCallback((newUtilities) => {\n        getAppConfigAction().updateUtilities(newUtilities).exec();\n    });\n    const handleUtilityBatchChange = hooks.useEventCallback((utilities) => {\n        setBatchUtilityJsons(utilities);\n    });\n    const handleBatchAdd = React.useCallback(() => {\n        const appConfigAction = getAppConfigAction();\n        const utilityManager = UtilityManager.getInstance();\n        let appConfig = appConfigAction.appConfig;\n        batchUtilityJsons.forEach(u => {\n            if ((!u.itemId && !utilityManager.urlExist(u.url)) || (u.itemId && !utilityManager.itemExist(u.portalUrl, u.itemId))) {\n                const newU = u.set('id', appConfigUtils.getUniqueId('utility'));\n                appConfig = appConfig.setIn(['utilities', newU.id], newU);\n            }\n        });\n        appConfigAction.updateUtilities(appConfig.utilities).exec();\n        setBatchUtilityJsons(Immutable([]));\n        switchToSelectMode();\n    }, [batchUtilityJsons, switchToSelectMode]);\n    const handleKeywordChange = hooks.useEventCallback((e) => {\n        setKeyword(e.target.value);\n    });\n    const removeItem = React.useCallback((index) => {\n        onChange(useUtilities.filter((_, idx) => idx !== index));\n    }, [useUtilities, onChange]);\n    const generateUseUtilityItem = (useUtility, index) => {\n        var _a, _b;\n        const utilityJson = UtilityManager.getInstance().getUtilityJson(useUtility.utilityId);\n        const isValid = (_b = (_a = utilityStates === null || utilityStates === void 0 ? void 0 : utilityStates[useUtility.utilityId]) === null || _a === void 0 ? void 0 : _a.success) !== null && _b !== void 0 ? _b : true;\n        const commands = [];\n        if (!isValid) {\n            const isSignInError = UtilityManager.getInstance().utilityHasSignInError(useUtility.utilityId);\n            commands.push({\n                label: isSignInError ? translate('signInErrorDefault') : translate('utilityNotAvailable'),\n                iconProps: () => ({ icon: warningOutlined, size: 16, color: 'var(--sys-color-warning-dark)' })\n            });\n        }\n        if (isMultiple || showRemove) {\n            commands.push({\n                label: translate('remove'),\n                iconProps: () => ({ icon: closeIcon, size: 12 }),\n                action: ({ data }) => {\n                    const { itemJsons: [currentItemJson] } = data;\n                    removeItem(+currentItemJson.itemKey);\n                }\n            });\n        }\n        return ({\n            itemStateDetailContent: useUtility,\n            itemKey: `${index}`,\n            itemStateIcon: { icon: selectUtilitySVG(utilityJson.type), color: 'var(--ref-palette-black)' },\n            itemStateTitle: utilityJson != null ? UtilityManager.getInstance().getLabelOfUseUtility(useUtility) : useUtility.utilityId,\n            itemStateCommands: commands\n        });\n    };\n    return (jsx(\"div\", { className: 'px- pb-2 w-100', ref: elemRef, css: css `\r\n      .jimu-tree-item__icon {\r\n        background-color: var(--sys-color-info-main);\r\n        width: 18px;\r\n        height: 18px;\r\n        margin-right: 8px;\r\n        svg {\r\n          margin-right: 0 !important;\r\n        }\r\n      }\r\n    ` },\n        (useUtilities === null || useUtilities === void 0 ? void 0 : useUtilities.length) > 0 && (jsx(List, Object.assign({ className: 'utility-list mb-2', itemsJson: useUtilities.map(generateUseUtilityItem), onClickItemBody: togglePopper }, advancedActionMap))),\n        (isMultiple || useUtilities == null || useUtilities.length === 0) && (jsx(Button, { className: 'w-100', type: 'tertiary', onClick: togglePopper, disableRipple: true, css: css `\r\n            border: 1px dashed var(--ref-palette-neutral-800);\r\n            &.jimu-btn, &.jimu-btn:hover { color: var(--sys-color-primary-light); background: transparent; }\r\n            &:hover { border: 1px dashed var(--ref-palette-neutral-900); }\r\n          `, ref: btnRef },\n            jsx(\"div\", { className: 'text-truncate font-weight-500' }, translate('selectUtility')))),\n        jsx(SidePopper, { title: translate('selectUtility'), position: 'right', isOpen: showPopper && selectType === 0, toggle: togglePopper, trigger: elemRef.current, backToFocusNode: btnRef.current },\n            jsx(\"div\", { className: 'h-100 d-flex flex-column' },\n                jsx(\"div\", { className: 'px-4 pb-2', css: css `height: 50px;` },\n                    jsx(TextInput, { type: 'search', prefix: jsx(SearchOutlined, { size: 's' }), value: keyword, onChange: handleKeywordChange, placeholder: translate('SearchLabel') })),\n                types !== ALL_TYPES && types.length > 1 && (jsx(\"div\", { className: 'd-flex justify-content-between align-items-center px-4 mb-4' },\n                    jsx(\"span\", null, translate('type')),\n                    jsx(MultiSelect, { \"aria-label\": translate('type'), size: 'sm', css: css `width: 120px; .jimu-dropdown { width: 100%; }`, values: Immutable(serviceTypes), items: getMultiSelectItems(), onClickItem: handleTypesChange, displayByValues: displaySelectedTypes }))),\n                jsx(\"div\", { className: 'd-flex flex-column', css: css `flex: 1 1 auto; .tab-content {overflow: auto;}` },\n                    jsx(\"div\", { css: css `flex: 1 1 0; overflow: auto;` },\n                        showOrgUtility && (jsx(Tabs, { className: 'px-4', type: 'pills', fill: true },\n                            jsx(Tab, { id: 'org_utility', title: translate('organization') },\n                                jsx(OrgUtilityTree, { isMultiple: isMultiple, keyword: keyword.trim(), pattern: pattern, serviceTypes: serviceTypes, useUtilities: useUtilities, onChange: handleUseUtilityChange })),\n                            jsx(Tab, { id: 'added_utility', title: translate('added') },\n                                jsx(AddedUtilityTree, { isMultiple: isMultiple, keyword: keyword.trim(), pattern: pattern, serviceTypes: serviceTypes, utilities: utilities, useUtilities: useUtilities, onUtilitiesChange: handleUseUtilityChange })))),\n                        !showOrgUtility && (jsx(AddedUtilityTree, { isMultiple: isMultiple, keyword: keyword.trim(), pattern: pattern, serviceTypes: serviceTypes, utilities: utilities, useUtilities: useUtilities, onUtilitiesChange: handleUseUtilityChange, className: 'px-4 my-0' }))),\n                    jsx(\"div\", { css: css `height: 40px;border-top: 1px solid var(--ref-palette-neutral-700);` },\n                        jsx(Button, { className: 'w-100 h-100', type: 'tertiary', \"aria-label\": translate('add'), onClick: switchToAddMode },\n                            jsx(\"div\", { className: 'd-flex align-items-center px-2 w-100' },\n                                jsx(PlusCircleFilled, { size: 'l', color: 'var(--sys-color-primary-light)', className: 'mr-2' }),\n                                jsx(\"span\", { css: css `color: var(--sys-color-primary-light)` }, translate('addUtility')))))))),\n        jsx(SidePopper, { title: translate('addUtility'), position: 'right', isOpen: showPopper && selectType === 1, toggle: switchToSelectMode, trigger: elemRef.current },\n            jsx(\"div\", { className: 'h-100', css: css `position: relative;` },\n                jsx(\"div\", { css: css `height: 100%; .tab-content {overflow: auto;}` },\n                    jsx(AddUtilityTabs, { utilities: utilities, batchUtilityJsons: batchUtilityJsons, isMultiple: true, immediate: false, onBatchUpdate: handleUtilityBatchChange, onBatchDone: handleBatchAdd, onChange: hanldeUtilitesChange }))))));\n}\n","/** @jsx jsx */\nimport { jsx, css, Immutable, JimuFieldType } from 'jimu-core';\nimport { useTheme } from 'jimu-theme';\nimport { dataComponentsUtils, FieldSelector } from 'jimu-ui/advanced/data-source-selector';\nimport { List, TreeItemActionType } from 'jimu-ui/basic/list-tree';\nconst DisplayFieldSelect = (props) => {\n    const advancedActionMap = {\n        overrideItemBlockInfo: ({ itemBlockInfo }, refComponent) => {\n            return {\n                name: TreeItemActionType.RenderOverrideItem,\n                children: [{\n                        name: TreeItemActionType.RenderOverrideItemDroppableContainer,\n                        children: [{\n                                name: TreeItemActionType.RenderOverrideItemDraggableContainer,\n                                children: [{\n                                        name: TreeItemActionType.RenderOverrideItemBody,\n                                        children: [{\n                                                name: TreeItemActionType.RenderOverrideItemMainLine,\n                                                children: [{\n                                                        name: TreeItemActionType.RenderOverrideItemDragHandle\n                                                    }, {\n                                                        name: TreeItemActionType.RenderOverrideItemIcon,\n                                                        autoCollapsed: true\n                                                    }, {\n                                                        name: TreeItemActionType.RenderOverrideItemTitle\n                                                    }, {\n                                                        name: TreeItemActionType.RenderOverrideItemCommands\n                                                    }]\n                                            }]\n                                    }]\n                            }]\n                    }]\n            };\n        }\n    };\n    const STYLE = css `\r\n    &{\r\n      max-height: 256px;\r\n      overflow-y: auto;\r\n    }\r\n  `;\n    const theme = useTheme();\n    const { disPlayField, useDataSource, onFieldChange } = props;\n    return (jsx(\"div\", { className: 'w-100' },\n        jsx(FieldSelector, { useDataSources: useDataSource ? Immutable([useDataSource]) : Immutable([]), onChange: (allSelectedFields) => { onFieldChange(allSelectedFields, disPlayField, true); }, selectedFields: Immutable(disPlayField === null || disPlayField === void 0 ? void 0 : disPlayField.map(field => field === null || field === void 0 ? void 0 : field.name)), isMultiple: true, isDataSourceDropDownHidden: true, useDropdown: true, useMultiDropdownBottomTools: true, types: Immutable([JimuFieldType.Number, JimuFieldType.String]) }),\n        jsx(\"div\", { css: STYLE },\n            jsx(List, Object.assign({ size: 'sm', className: 'mt-2', itemsJson: Array.from(disPlayField).map((field, index) => ({\n                    itemStateDetailContent: field,\n                    itemKey: `${field === null || field === void 0 ? void 0 : field.name}${index}`,\n                    itemStateIcon: dataComponentsUtils.getIconFromFieldType(field.type, theme),\n                    itemStateTitle: field.alias || field.jimuName || field.name,\n                    itemStateCommands: []\n                })), dndEnabled: true, onUpdateItem: (actionData, refComponent) => {\n                    const { itemJsons } = refComponent.props;\n                    const [, parentItemJson] = itemJsons;\n                    const newDisplayField = parentItemJson.map(item => {\n                        return item.itemStateDetailContent;\n                    });\n                    onFieldChange(newDisplayField, disPlayField, true);\n                } }, advancedActionMap)))));\n};\nexport default DisplayFieldSelect;\n","/** @jsx jsx */\nimport { React, css, jsx, SupportedUtilityType, i18n, useIntl, Immutable, defaultMessages as jimuCoreDefaultMessage, hooks, getAppStore, focusElementInKeyboardMode } from 'jimu-core';\nimport { SettingSection, SettingRow, SidePopper } from 'jimu-ui/advanced/setting-components';\nimport { UtilitySelector } from 'jimu-ui/advanced/utility-selector';\nimport { IconPicker } from 'jimu-ui/advanced/resource-selector';\nimport { TextInput, NumericInput, Alert, Loading, LoadingType, Checkbox, Button, Switch, defaultMessages as jimuUiDefaultMessage } from 'jimu-ui';\nimport { SearchServiceType, MIN_SCALE } from '../type/type';\nimport { getConfigIdList, getNewConfigId } from '../utils/util';\nimport { DefaultGeocodeLabel } from '../utils/constants';\nimport DisplayFieldSelect from './display-field-select';\nimport { getNewDataConfigByUtility, getUrlOfUseUtility, validateGeocodeService } from '../utils/geocode-utils';\nimport { HelpOutlined } from 'jimu-icons/outlined/suggested/help';\nconst { useEffect, useRef } = React;\nconst COUNTRY_CODE_HELP_LINK = 'https://developers.arcgis.com/rest/geocode/api-reference/geocode-coverage.htm';\nvar UrlCheckResultType;\n(function (UrlCheckResultType) {\n    UrlCheckResultType[\"Pass\"] = \"Pass\";\n    UrlCheckResultType[\"NotHttps\"] = \"Not_Https\";\n    UrlCheckResultType[\"InvalidURL\"] = \"Invalid_URL\";\n})(UrlCheckResultType || (UrlCheckResultType = {}));\nconst supportedUtilityTypes = [SupportedUtilityType.GeoCoding];\nconst EsriLocatorRegExp = /http(s)?:\\/\\/(geocode|geocodedev|geocodeqa)(\\.){0,3}\\.arcgis\\.com\\/arcgis\\/rest\\/services\\/World\\/GeocodeServer/g;\nconst LocatorSourceSidePopper = (props) => {\n    const nls = hooks.useTranslation(jimuUiDefaultMessage, jimuCoreDefaultMessage);\n    const focusCloseButtonTimeoutRef = useRef(null);\n    const { id, trigger, toggle, isOpen, datasourceConfig, dsConfigItemIndex, popperFocusNode, createOutputDs, viewId, showSearchInCurrentMapExtentSetting, showEnableLocalSearchSetting, onSettingChange, updateConfigForLayerOptions, hideIconSetting } = props;\n    const dataSourceConfigItem = (datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig[dsConfigItemIndex]) || Immutable({});\n    const { configId, label, icon, hint, outputDataSourceId, displayFields, searchInCurrentMapExtent, enableLocalSearch } = dataSourceConfigItem;\n    const [newLabel, setNewLabel] = React.useState(label);\n    const [isValidateServiceEnd, setIsValidateServiceEnd] = React.useState(false);\n    const [urlCheckResults, setUrlCheckResultType] = React.useState(UrlCheckResultType.Pass);\n    const [useUtility, setUseUtility] = React.useState(dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.useUtility);\n    const [showLoading, setShowLoading] = React.useState(false);\n    const [enableCountryCode, setEnableCountryCode] = React.useState(false);\n    const [countryCode, setCountryCode] = React.useState(null);\n    const [minScale, setMinScale] = React.useState(null);\n    const [locatorServiceUrl, setLocatorServiceUrl] = React.useState(null);\n    const [showCountryCode, setShowCountryCode] = React.useState(false);\n    useEffect(() => {\n        // focus the back button when it is open\n        if (isOpen) {\n            clearTimeout(focusCloseButtonTimeoutRef.current);\n            focusCloseButtonTimeoutRef.current = setTimeout(() => {\n                const closeButton = document.querySelector('.search-locator-setting-popper .action-close');\n                focusElementInKeyboardMode(closeButton);\n            }, 200);\n        }\n    }, [isOpen]);\n    useEffect(() => {\n        if (!isOpen)\n            return;\n        setUrlCheckResultType(UrlCheckResultType.Pass);\n        setShowLoading(false);\n        if (dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.useUtility) {\n            //Check if geocode service url is available\n            getUrlOfUseUtility(dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.useUtility).then(url => {\n                setIsValidateServiceEnd(false);\n                setLocatorServiceUrl(url);\n                validateGeocodeService(url).then(urlCheckResult => {\n                    setIsValidateServiceEnd(true);\n                    setUrlCheckResultType(urlCheckResult === null || urlCheckResult === void 0 ? void 0 : urlCheckResult.urlCheckResultType);\n                }, err => {\n                    setIsValidateServiceEnd(true);\n                });\n            });\n            setUseUtility(dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.useUtility);\n            setNewLabel(dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.label);\n        }\n        else {\n            setUseUtility(null);\n            setNewLabel(DefaultGeocodeLabel);\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [dsConfigItemIndex, configId, isOpen]);\n    useEffect(() => {\n        setNewLabel(dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.label);\n        setEnableCountryCode(!!(dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.enableCountryCode));\n        setCountryCode(dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.countryCode);\n        setMinScale(dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.minScale);\n    }, [dataSourceConfigItem]);\n    useEffect(() => {\n        setShowCountryCode(EsriLocatorRegExp.test(locatorServiceUrl));\n    }, [locatorServiceUrl]);\n    /**\n     * Fire callback when change layer config.\n     */\n    const onConfigItemChange = (key, value) => {\n        const newDataSourceConfig = datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.asMutable({ deep: true });\n        const newDataSourceConfigItem = dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.setIn(key, value);\n        newDataSourceConfig === null || newDataSourceConfig === void 0 ? void 0 : newDataSourceConfig.splice(dsConfigItemIndex, 1, newDataSourceConfigItem === null || newDataSourceConfigItem === void 0 ? void 0 : newDataSourceConfigItem.asMutable({ deep: true }));\n        onSettingChange(Immutable(newDataSourceConfig), null, viewId);\n    };\n    const handleLabelChange = (event) => {\n        var _a;\n        const value = (_a = event === null || event === void 0 ? void 0 : event.target) === null || _a === void 0 ? void 0 : _a.value;\n        setNewLabel(value);\n    };\n    const handleLabelAccept = value => {\n        if (!value) {\n            setNewLabel(label);\n        }\n        else {\n            setNewLabel(value === null || value === void 0 ? void 0 : value.trim());\n            onConfigItemChange(['label'], value === null || value === void 0 ? void 0 : value.trim());\n        }\n    };\n    const handleHintChange = (event) => {\n        var _a;\n        const value = (_a = event === null || event === void 0 ? void 0 : event.target) === null || _a === void 0 ? void 0 : _a.value;\n        onConfigItemChange(['hint'], value);\n    };\n    const handleUtilityChange = (utilities) => {\n        const utility = utilities[0];\n        setUseUtility(utility || null);\n        if (!utility) {\n            removeUtility();\n        }\n        else {\n            setShowLoading(true);\n            const option = {\n                id: id,\n                createOutputDs: createOutputDs,\n                dataSourceConfigItem: dataSourceConfigItem,\n                viewId: viewId,\n                configId: configId,\n                datasourceConfig: datasourceConfig,\n                useUtility: utility === null || utility === void 0 ? void 0 : utility.asMutable({ deep: true })\n            };\n            setIsValidateServiceEnd(false);\n            getNewDataConfigByUtility(option).then(res => {\n                setIsValidateServiceEnd(true);\n                setShowLoading(false);\n                const { urlCheckResult, dataSourceConfig } = res;\n                if ((urlCheckResult === null || urlCheckResult === void 0 ? void 0 : urlCheckResult.urlCheckResultType) !== UrlCheckResultType.Pass) {\n                    setUseUtility(null);\n                }\n                else {\n                    updateConfigForLayerOptions(Immutable(dataSourceConfig));\n                }\n            }, err => {\n                setIsValidateServiceEnd(true);\n            });\n        }\n    };\n    const removeUtility = () => {\n        const configIdList = getConfigIdList(datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.asMutable({ deep: true }));\n        const nextDsConfigId = configId || getNewConfigId(configIdList, viewId);\n        let newDataSourceConfig = datasourceConfig ? datasourceConfig.asMutable({ deep: true }) : [];\n        // const label = getDefaultGeocodeLabel(geocodeServiceUrl)\n        const initDsConfigItem = {\n            configId: nextDsConfigId,\n            icon: null,\n            label: '.....',\n            hint: '',\n            useUtility: null,\n            searchServiceType: SearchServiceType.GeocodeService,\n            singleLineFieldName: ''\n        };\n        newDataSourceConfig = datasourceConfig.map(el => {\n            if ((el === null || el === void 0 ? void 0 : el.configId) === nextDsConfigId) {\n                return initDsConfigItem;\n            }\n            else {\n                return el;\n            }\n        });\n        updateConfigForLayerOptions(Immutable(newDataSourceConfig));\n    };\n    /**\n     * Fire callback when display fields change.\n     */\n    const onDisplayFieldChange = (allSelectedFields, preFields, isDisplayField = false) => {\n        var _a, _b;\n        if (!allSelectedFields)\n            return;\n        //At least one field is selected\n        if ((allSelectedFields === null || allSelectedFields === void 0 ? void 0 : allSelectedFields.length) === 0) {\n            allSelectedFields = (_b = (_a = Immutable(preFields)) === null || _a === void 0 ? void 0 : _a.asMutable({ deep: true })) === null || _b === void 0 ? void 0 : _b.splice(0, 1);\n        }\n        const newDataSourceConfig = datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.asMutable({ deep: true });\n        const newDataSourceConfigItem = dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.setIn(['displayFields'], allSelectedFields);\n        newDataSourceConfig === null || newDataSourceConfig === void 0 ? void 0 : newDataSourceConfig.splice(dsConfigItemIndex, 1, newDataSourceConfigItem === null || newDataSourceConfigItem === void 0 ? void 0 : newDataSourceConfigItem.asMutable({ deep: true }));\n        updateConfigForLayerOptions(Immutable(newDataSourceConfig));\n    };\n    const STYLE = css `\r\n    &>div {\r\n      padding: 0!important;\r\n    }\r\n  `;\n    const getUseUtility = (useUtility) => {\n        var _a;\n        if (!useUtility)\n            return Immutable([]);\n        const utilities = (_a = getAppStore().getState().appStateInBuilder.appConfig) === null || _a === void 0 ? void 0 : _a.utilities;\n        if (utilities === null || utilities === void 0 ? void 0 : utilities[useUtility.utilityId]) {\n            return Immutable([useUtility]);\n        }\n        else {\n            Immutable([]);\n        }\n    };\n    const toggleEnableCountryCode = () => {\n        setEnableCountryCode(!enableCountryCode);\n        onConfigItemChange(['enableCountryCode'], !enableCountryCode);\n    };\n    const handleCountryCodeChange = (event) => {\n        var _a;\n        const value = (_a = event === null || event === void 0 ? void 0 : event.target) === null || _a === void 0 ? void 0 : _a.value;\n        setCountryCode(value);\n    };\n    const handleCountryCodeAccept = (value) => {\n        setCountryCode(value === null || value === void 0 ? void 0 : value.trim());\n        onConfigItemChange(['countryCode'], value === null || value === void 0 ? void 0 : value.trim());\n    };\n    const handleSearchInCurrentMapExtentChange = (evt) => {\n        onConfigItemChange(['searchInCurrentMapExtent'], !searchInCurrentMapExtent);\n    };\n    const handleEnableLocalSearchChange = (evt) => {\n        const newEnableLocalSearch = !enableLocalSearch;\n        const newDataSourceConfig = datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.asMutable({ deep: true });\n        let newDataSourceConfigItem = dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.setIn(['enableLocalSearch'], newEnableLocalSearch);\n        if (newEnableLocalSearch) {\n            newDataSourceConfigItem = newDataSourceConfigItem.setIn(['minScale'], MIN_SCALE);\n        }\n        newDataSourceConfig === null || newDataSourceConfig === void 0 ? void 0 : newDataSourceConfig.splice(dsConfigItemIndex, 1, newDataSourceConfigItem === null || newDataSourceConfigItem === void 0 ? void 0 : newDataSourceConfigItem.asMutable({ deep: true }));\n        onSettingChange(Immutable(newDataSourceConfig), null, viewId);\n    };\n    const handleMinScaleChange = (value) => {\n        setMinScale(value);\n    };\n    const handleMinScaleAccept = (value) => {\n        if (value < 0 || !value) {\n            value = MIN_SCALE;\n        }\n        setMinScale(value);\n        onConfigItemChange(['minScale'], value);\n    };\n    const renderUtilitySelector = () => {\n        return (jsx(SettingSection, { style: { paddingTop: 0 } },\n            jsx(SettingRow, { flow: 'wrap', label: nls('locatorSource') },\n                jsx(\"div\", { className: 'w-100', css: STYLE },\n                    jsx(UtilitySelector, { useUtilities: getUseUtility(useUtility), onChange: handleUtilityChange, showRemove: false, types: supportedUtilityTypes, closePopupOnSelect: true })),\n                (urlCheckResults !== UrlCheckResultType.Pass && isValidateServiceEnd) && jsx(\"div\", { className: 'd-flex w-100 align-items-center justify-content-between mt-1' },\n                    jsx(Alert, { form: \"basic\", type: \"warning\", className: \"w-100\", open: true, withIcon: true, text: nls('invalidUrlMessage') })))));\n    };\n    const intl = useIntl();\n    const getSuffixOfCountryCodeInput = () => {\n        return (jsx(Button, { disableHoverEffect: true, disableRipple: true, type: 'tertiary', size: 'sm', target: '_blank', icon: true, href: COUNTRY_CODE_HELP_LINK },\n            jsx(HelpOutlined, { autoFlip: !i18n.isSameLanguage(intl === null || intl === void 0 ? void 0 : intl.locale, 'he') })));\n    };\n    return (jsx(SidePopper, { className: 'search-locator-setting-popper', isOpen: isOpen, position: 'right', toggle: toggle, trigger: trigger, title: nls('setLocatorSource'), backToFocusNode: popperFocusNode },\n        jsx(\"div\", { className: 'w-100 h-100', css: css `overflow: auto;` },\n            renderUtilitySelector(),\n            showLoading && jsx(Loading, { type: LoadingType.Secondary, width: 38, height: 38 }),\n            (urlCheckResults === UrlCheckResultType.Pass && configId && useUtility) && jsx(\"div\", null,\n                jsx(SettingSection, null,\n                    jsx(SettingRow, { flow: 'wrap', label: nls('label') },\n                        jsx(TextInput, { \"aria-label\": nls('label'), size: 'sm', value: newLabel || '', onChange: handleLabelChange, onAcceptValue: handleLabelAccept, className: 'w-100' }))),\n                !hideIconSetting && jsx(SettingSection, null,\n                    jsx(SettingRow, { label: nls('searchIcon') },\n                        jsx(IconPicker, { icon: icon, onChange: (icon) => { onConfigItemChange(['icon'], icon); }, configurableOption: 'none', setButtonUseColor: false }))),\n                jsx(SettingSection, { title: nls('searchOptions'), role: 'group', \"aria-label\": nls('searchOptions') },\n                    outputDataSourceId && jsx(SettingRow, { flow: 'wrap', label: nls('displayFields'), role: 'group', \"aria-label\": nls('displayFields') },\n                        jsx(DisplayFieldSelect, { disPlayField: displayFields || [], onFieldChange: onDisplayFieldChange, useDataSource: {\n                                dataSourceId: outputDataSourceId,\n                                mainDataSourceId: outputDataSourceId\n                            } })),\n                    jsx(SettingRow, { flow: 'wrap', label: nls('searchHint') },\n                        jsx(TextInput, { size: 'sm', \"aria-label\": nls('searchHint'), title: hint || nls('findAddressOrPlace'), value: hint || '', onChange: handleHintChange, className: 'w-100', placeholder: nls('findAddressOrPlace') })),\n                    showEnableLocalSearchSetting && jsx(SettingRow, { label: nls('enableLocalSearch') },\n                        jsx(Switch, { title: nls('enableLocalSearch'), checked: !!enableLocalSearch, onChange: handleEnableLocalSearchChange })),\n                    (showEnableLocalSearchSetting && !!enableLocalSearch) && jsx(SettingRow, { label: nls('minScale'), flow: 'wrap' },\n                        jsx(NumericInput, { \"aria-label\": nls('minScale'), size: 'sm', value: minScale, showHandlers: false, onChange: handleMinScaleChange, onAcceptValue: handleMinScaleAccept, className: 'w-100' })),\n                    showCountryCode && jsx(SettingRow, null,\n                        jsx(\"div\", { className: 'd-flex w-100 align-items-center', onClick: toggleEnableCountryCode },\n                            jsx(Checkbox, { className: 'mr-2', checked: enableCountryCode }),\n                            jsx(\"div\", null, nls('searchCountryCodeLabel')))),\n                    (dataSourceConfigItem === null || dataSourceConfigItem === void 0 ? void 0 : dataSourceConfigItem.enableCountryCode) && jsx(SettingRow, null,\n                        jsx(TextInput, { placeholder: nls('searchCountryCodeHint'), \"aria-label\": nls('label'), size: 'sm', value: countryCode || '', onChange: handleCountryCodeChange, onAcceptValue: handleCountryCodeAccept, className: 'w-100', suffix: getSuffixOfCountryCodeInput() })),\n                    showSearchInCurrentMapExtentSetting && jsx(SettingRow, null,\n                        jsx(\"div\", { className: 'd-flex w-100 align-items-center', onClick: handleSearchInCurrentMapExtentChange },\n                            jsx(Checkbox, { className: 'mr-2', checked: !!searchInCurrentMapExtent }),\n                            jsx(\"div\", null, nls('searchInCurrentMapExtent')))))))));\n};\nexport default LocatorSourceSidePopper;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/** @jsx jsx */\nimport { React, ReactRedux, jsx, moduleLoader, defaultMessages as jimuCoreDefaultMessage, Immutable, hooks, css, UtilityManager } from 'jimu-core';\nimport { List, TreeItemActionType } from 'jimu-ui/basic/list-tree';\nimport { Alert, defaultMessages as jimuUiDefaultMessage } from 'jimu-ui';\nimport { SearchServiceType } from '../type/type';\nconst { useState, useRef } = React;\nconst IconClose = require('jimu-icons/svg/outlined/editor/close.svg');\nconst STYLE = css `\r\n  .warning-alert-con {\r\n    padding: 0 !important;\r\n  }\r\n  .warning-alert-con .jimu-icon-component {\r\n    color: var(--sys-color-warning-light) !important;\r\n  }\r\n  .setting-ui-unit-list-new {\r\n    margin-top: 4px;\r\n  }\r\n`;\nconst DatasourceList = (props) => {\n    const nls = hooks.useTranslation(jimuCoreDefaultMessage, jimuUiDefaultMessage);\n    const isLoadDatasourceSelector = useRef(false);\n    const dataComponentsUtilsRef = useRef(null);\n    const utilityAvailableStateRef = useRef(null);\n    const DataSourceRemoveWaringReasonRef = useRef(null);\n    const { className, datasourceConfig, useDataSources, dsConfigItemIndex, createOutputDs, showSourcePanel, showNewSourceItem, id, dataSourceCreateStatus, onDsConfigIdChange, updateConfigForLayerOptions, hideSidePopper } = props;\n    const widgetsJson = ReactRedux.useSelector((state) => { var _a, _b, _c; return (_c = (_b = (_a = state === null || state === void 0 ? void 0 : state.appStateInBuilder) === null || _a === void 0 ? void 0 : _a.appConfig) === null || _b === void 0 ? void 0 : _b.widgets) === null || _c === void 0 ? void 0 : _c[id]; });\n    const widgets = ReactRedux.useSelector((state) => { var _a, _b; return (_b = (_a = state === null || state === void 0 ? void 0 : state.appStateInBuilder) === null || _a === void 0 ? void 0 : _a.appConfig) === null || _b === void 0 ? void 0 : _b.widgets; });\n    const AdvancedActionMap = {\n        overrideItemBlockInfo: ({ itemBlockInfo }, refComponent) => {\n            return {\n                name: TreeItemActionType.RenderOverrideItem,\n                children: [{\n                        name: TreeItemActionType.RenderOverrideItemDroppableContainer,\n                        children: [{\n                                name: TreeItemActionType.RenderOverrideItemDraggableContainer,\n                                children: [{\n                                        name: TreeItemActionType.RenderOverrideItemBody,\n                                        children: [{\n                                                name: TreeItemActionType.RenderOverrideItemMainLine,\n                                                children: [{\n                                                        name: TreeItemActionType.RenderOverrideItemDragHandle\n                                                    }, {\n                                                        name: TreeItemActionType.RenderOverrideItemIcon,\n                                                        autoCollapsed: true\n                                                    }, {\n                                                        name: TreeItemActionType.RenderOverrideItemTitle\n                                                    }, {\n                                                        name: TreeItemActionType.RenderOverrideItemDetailToggle\n                                                    }, {\n                                                        name: TreeItemActionType.RenderOverrideItemCommands\n                                                    }]\n                                            }]\n                                    }]\n                            }]\n                    }]\n            };\n        }\n    };\n    const [dsToRemove, setDsToRemove] = useState(null);\n    const [removeDsIndex, setRemoveDsIndex] = useState(null);\n    const [showRemoveSearchItemWarning, setShowRemoveSearchItemWarning] = useState(false);\n    const [DataSourceRemoveWarningPopup, setDataSourceRemoveWarningPopup] = useState(null);\n    const loadDatasourceSelector = () => __awaiter(void 0, void 0, void 0, function* () {\n        if (isLoadDatasourceSelector.current) {\n            return false;\n        }\n        return import('jimu-ui/advanced/data-source-selector').then(module => {\n            isLoadDatasourceSelector.current = true;\n            dataComponentsUtilsRef.current = module.dataComponentsUtils;\n            DataSourceRemoveWaringReasonRef.current = module.DataSourceRemoveWaringReason;\n            setDataSourceRemoveWarningPopup(module.DataSourceRemoveWarningPopup);\n            return Promise.resolve(true);\n        });\n    });\n    const getUtilityStateText = (dsConfigItem, utilityStates) => {\n        var _a, _b;\n        if ((dsConfigItem === null || dsConfigItem === void 0 ? void 0 : dsConfigItem.searchServiceType) === SearchServiceType.FeatureService)\n            return null;\n        const utilityId = (_a = dsConfigItem === null || dsConfigItem === void 0 ? void 0 : dsConfigItem.useUtility) === null || _a === void 0 ? void 0 : _a.utilityId;\n        const isSignInError = UtilityManager.getInstance().utilityHasSignInError(utilityId);\n        if (isSignInError) {\n            return nls('signInErrorDefault');\n        }\n        else if (((_b = utilityStates === null || utilityStates === void 0 ? void 0 : utilityStates[utilityId]) === null || _b === void 0 ? void 0 : _b.success) === false) {\n            return nls('utilityNotAvailable');\n        }\n        else {\n            return null;\n        }\n    };\n    ReactRedux.useSelector((state) => {\n        var _a, _b;\n        const utilityAvailableState = {};\n        const utilityStates = ((_b = (_a = state.appStateInBuilder) === null || _a === void 0 ? void 0 : _a.appRuntimeInfo) === null || _b === void 0 ? void 0 : _b.utilityStates) || {};\n        datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.forEach(item => {\n            if ((item === null || item === void 0 ? void 0 : item.searchServiceType) === SearchServiceType.GeocodeService) {\n                utilityAvailableState[item.configId] = getUtilityStateText(item === null || item === void 0 ? void 0 : item.asMutable({ deep: true }), utilityStates);\n            }\n        });\n        utilityAvailableStateRef.current = utilityAvailableState;\n    });\n    const hideRemovePopup = () => {\n        setShowRemoveSearchItemWarning(!showRemoveSearchItemWarning);\n    };\n    const beforeRemovingDataSource = hooks.useEventCallback(() => {\n        const newDatasourceConfig = datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.asMutable({ deep: true });\n        newDatasourceConfig === null || newDatasourceConfig === void 0 ? void 0 : newDatasourceConfig.splice(removeDsIndex, 1);\n        updateConfigForLayerOptions(Immutable(newDatasourceConfig));\n        hideSidePopper();\n    });\n    const afterRemovingDataSource = () => {\n        setDsToRemove(null);\n        setRemoveDsIndex(null);\n        setShowRemoveSearchItemWarning(false);\n    };\n    const isDataSourceAccessible = (dataSourceId, isOutputDs = false) => {\n        let isDataSourceInProps;\n        let isDataSourceAccessible = true;\n        if (isOutputDs) {\n            const outputDs = (widgetsJson === null || widgetsJson === void 0 ? void 0 : widgetsJson.outputDataSources) || [];\n            isDataSourceInProps = (outputDs === null || outputDs === void 0 ? void 0 : outputDs.filter(dsId => dataSourceId === dsId).length) > 0;\n        }\n        else {\n            isDataSourceInProps = (useDataSources === null || useDataSources === void 0 ? void 0 : useDataSources.filter(useDs => dataSourceId === useDs.dataSourceId).length) > 0;\n        }\n        if (typeof (dataSourceCreateStatus === null || dataSourceCreateStatus === void 0 ? void 0 : dataSourceCreateStatus[dataSourceId]) === 'boolean' && !(dataSourceCreateStatus === null || dataSourceCreateStatus === void 0 ? void 0 : dataSourceCreateStatus[dataSourceId])) {\n            isDataSourceAccessible = false;\n        }\n        return isDataSourceInProps && dataSourceId && isDataSourceAccessible;\n    };\n    const onRemoveLayerButtonClick = (dsIndex) => {\n        var _a;\n        const isOutputDs = ((_a = datasourceConfig[dsIndex]) === null || _a === void 0 ? void 0 : _a.searchServiceType) === SearchServiceType.GeocodeService;\n        if (!isOutputDs) {\n            removeDsItem(dsIndex);\n        }\n        else {\n            if (isLoadDatasourceSelector.current) {\n                removeOutputDs(dsIndex);\n            }\n            else {\n                loadDatasourceSelector().then(() => {\n                    removeOutputDs(dsIndex);\n                });\n            }\n        }\n    };\n    const removeOutputDs = hooks.useEventCallback((dsIndex) => {\n        const outputDataSourceId = datasourceConfig[dsIndex].outputDataSourceId;\n        const relatedWidgets = dataComponentsUtilsRef.current.getWidgetsUsingDsOrItsDescendantDss(outputDataSourceId, widgets);\n        if (relatedWidgets.length === 0) {\n            removeDsItem(dsIndex);\n        }\n        else {\n            setDsToRemove(outputDataSourceId);\n            setShowRemoveSearchItemWarning(true);\n            setRemoveDsIndex(dsIndex);\n        }\n    });\n    const removeDsItem = (dsIndex) => {\n        const newDatasourceConfig = datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.asMutable({ deep: true });\n        newDatasourceConfig === null || newDatasourceConfig === void 0 ? void 0 : newDatasourceConfig.splice(dsIndex, 1);\n        updateConfigForLayerOptions(Immutable(newDatasourceConfig));\n        hideSidePopper();\n    };\n    const checkISOrderChange = hooks.useEventCallback((newDatasourceConfig) => {\n        const preConfigIds = (datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.map(item => item === null || item === void 0 ? void 0 : item.configId)) || [];\n        const newConfigIds = (newDatasourceConfig === null || newDatasourceConfig === void 0 ? void 0 : newDatasourceConfig.map(item => item === null || item === void 0 ? void 0 : item.configId)) || [];\n        return preConfigIds.join('') !== newConfigIds.join('');\n    });\n    return (jsx(\"div\", { className: `w-100 mt-2 ${className || ''}`, css: STYLE },\n        jsx(List, Object.assign({ className: 'w-100', itemsJson: Array.from(datasourceConfig).map((item, index) => {\n                var _a;\n                return ({\n                    itemStateDetailContent: item,\n                    itemKey: `${index}`,\n                    itemStateChecked: showSourcePanel && index === dsConfigItemIndex,\n                    itemStateTitle: item === null || item === void 0 ? void 0 : item.label,\n                    itemStateIcon: { icon: (_a = item.icon) === null || _a === void 0 ? void 0 : _a.svg },\n                    itemStateCommands: [\n                        {\n                            label: nls('deleteOption'),\n                            iconProps: () => ({ icon: IconClose, size: 12 }),\n                            action: () => {\n                                onRemoveLayerButtonClick(index);\n                            }\n                        }\n                    ]\n                });\n            }), dndEnabled: true, renderOverrideItemDetailToggle: (actionData, refComponent) => {\n                var _a, _b;\n                const { itemJsons } = refComponent.props;\n                const [currentItemJson] = itemJsons;\n                const itemStateDetailContent = currentItemJson === null || currentItemJson === void 0 ? void 0 : currentItemJson.itemStateDetailContent;\n                const isGeocodeService = (itemStateDetailContent === null || itemStateDetailContent === void 0 ? void 0 : itemStateDetailContent.searchServiceType) === SearchServiceType.GeocodeService;\n                const dsId = isGeocodeService ? itemStateDetailContent === null || itemStateDetailContent === void 0 ? void 0 : itemStateDetailContent.outputDataSourceId : (_a = itemStateDetailContent === null || itemStateDetailContent === void 0 ? void 0 : itemStateDetailContent.useDataSource) === null || _a === void 0 ? void 0 : _a.dataSourceId;\n                const isDataError = createOutputDs ? !isDataSourceAccessible(dsId, isGeocodeService) : false;\n                const utilityAvailableText = (_b = utilityAvailableStateRef.current) === null || _b === void 0 ? void 0 : _b[itemStateDetailContent.configId];\n                if (isGeocodeService && utilityAvailableText) {\n                    return (jsx(Alert, { className: 'warning-alert-con', variant: 'text', form: 'tooltip', size: 'small', type: 'warning', text: utilityAvailableText }));\n                }\n                return (isDataError && dsId)\n                    ? jsx(Alert, { variant: 'text', form: 'tooltip', size: 'small', type: 'error', text: nls('dataSourceCreateError') })\n                    : '';\n            }, onUpdateItem: (actionData, refComponent) => {\n                const { itemJsons } = refComponent.props;\n                const [, parentItemJson] = itemJsons;\n                const newDatasourceConfig = parentItemJson.map(item => {\n                    return item.itemStateDetailContent;\n                });\n                onDsConfigIdChange(null);\n                if (checkISOrderChange(newDatasourceConfig)) {\n                    updateConfigForLayerOptions(Immutable(newDatasourceConfig));\n                }\n            }, onClickItemBody: (actionData, refComponent) => {\n                var _a;\n                const { itemJsons: [currentItemJson] } = refComponent.props;\n                const isGeocodeSource = ((_a = currentItemJson === null || currentItemJson === void 0 ? void 0 : currentItemJson.itemStateDetailContent) === null || _a === void 0 ? void 0 : _a.searchServiceType) === SearchServiceType.GeocodeService;\n                onDsConfigIdChange(+currentItemJson.itemKey, isGeocodeSource);\n            } }, AdvancedActionMap)),\n        showNewSourceItem && jsx(List, Object.assign({ className: 'setting-ui-unit-list-new', itemsJson: [{\n                    name: '......'\n                }].map((item, x) => ({\n                itemStateDetailContent: 'item',\n                itemKey: 'index',\n                itemStateChecked: true,\n                itemStateTitle: '......',\n                itemStateCommands: []\n            })), dndEnabled: false, renderOverrideItemDetailToggle: () => '' }, AdvancedActionMap)),\n        DataSourceRemoveWarningPopup && jsx(DataSourceRemoveWarningPopup, { dataSourceId: dsToRemove, isOpen: showRemoveSearchItemWarning, toggle: hideRemovePopup, reason: DataSourceRemoveWaringReasonRef.current.DataSourceRemoved, afterRemove: afterRemovingDataSource, beforeRemove: beforeRemovingDataSource })));\n};\nexport default DatasourceList;\n","/** @jsx jsx */\nimport { React, jsx, css, ReactRedux, polished, defaultMessages as jimuCoreDefaultMessage, Immutable, hooks } from 'jimu-core';\nimport { Dropdown, DropdownButton, DropdownMenu, DropdownItem, Button, Switch, Loading, LoadingType, defaultMessages as jimuUiDefaultMessage } from 'jimu-ui';\nimport { SettingSection, SettingRow } from 'jimu-ui/advanced/setting-components';\nimport { SearchServiceType, SearchDataType } from '../type/type';\nimport { PlusOutlined } from 'jimu-icons/outlined/editor/plus';\nimport LayerSourcePanel from './set-layer-source-side-popper';\nimport LocatorSourcePanel from './set-locator-source';\nimport DatasourceList from './datasource-list';\nimport { getAllDataSourceBySearchDataConfig, getDsInWidgetJson } from '../utils/util';\nimport { getDefaultGeocodeConfig } from '../utils/geocode-utils';\nimport { useTheme } from 'jimu-theme';\nconst { useSelector } = ReactRedux;\nconst { useRef, useEffect } = React;\nexport const SearchDataSetting = (props) => {\n    var _a, _b, _c, _d;\n    const nls = hooks.useTranslation(jimuUiDefaultMessage, jimuCoreDefaultMessage);\n    const appTheme = useTheme();\n    const { datasourceConfig, id, useDataSources, searchDataSettingType, showSearchInCurrentMapExtentSetting, createOutputDs, hideIconSetting, hideDisplayFieldSetting, enableFiltering, viewId, hideEnableFiltering, showEnableLocalSearchSetting, hideTitleOfNewSearchSource, propsForDataSourceSelector, autoSelectSingleGeocodeService, autoSelectAllOrgGeocodeService, onSettingChange, onOutputDsSettingChange, onEnableFilteringChange, supportedDsTypes, hideDs } = props;\n    const sourceListRef = useRef(null);\n    const sidePopperTrigger = useRef(null);\n    const loadingDefaultGeocodeServiceRef = useRef(false);\n    const datasourceConfigRef = useRef(null);\n    const defaultGeocodeConfigRef = useRef(null);\n    const [open, setOpen] = React.useState(false);\n    const [showLayerSourcePanel, setShowLayerSourcePanel] = React.useState(false);\n    const [showLocatorSourcePanel, setShowLocatorSourcePanel] = React.useState(false);\n    const [showNewSourceItem, setShowNewSourceItem] = React.useState(false);\n    const [dsConfigItemIndex, setDsConfigItemIndex] = React.useState(null);\n    const [popperFocusNode, setPopperFocusNode] = React.useState(null);\n    const [dsCreateStatus, setDsCreateStatus] = React.useState(Immutable({}));\n    const [showLoading, setShowLoading] = React.useState(false);\n    const widgetsJson = useSelector((state) => { var _a, _b, _c; return (_c = (_b = (_a = state === null || state === void 0 ? void 0 : state.appStateInBuilder) === null || _a === void 0 ? void 0 : _a.appConfig) === null || _b === void 0 ? void 0 : _b.widgets) === null || _c === void 0 ? void 0 : _c[id]; });\n    const utilitiesInConfig = useSelector((state) => {\n        return state.appStateInBuilder.appConfig.utilities;\n    });\n    const DropDownStyle = css `\r\n    & {\r\n      background-color: ${(_b = (_a = appTheme === null || appTheme === void 0 ? void 0 : appTheme.sys.color) === null || _a === void 0 ? void 0 : _a.secondary) === null || _b === void 0 ? void 0 : _b.main};\r\n    }\r\n  `;\n    const STYLE = css `\r\n    .data-remind {\r\n      color: ${(_d = (_c = appTheme === null || appTheme === void 0 ? void 0 : appTheme.ref.palette) === null || _c === void 0 ? void 0 : _c.neutral) === null || _d === void 0 ? void 0 : _d[1000]};\r\n      font-size: ${polished.rem(12)};\r\n    }\r\n    .loading-con {\r\n      height: 80px;\r\n    }\r\n  `;\n    useEffect(() => {\n        datasourceConfigRef.current = datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.asMutable({ deep: true });\n        createOutputDs && checkAndInitOutputDs();\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [datasourceConfig]);\n    useEffect(() => {\n        const shouldAutoSelectGeocodeUtility = (autoSelectAllOrgGeocodeService || autoSelectSingleGeocodeService);\n        const autoSelectGeocodeUtility = shouldAutoSelectGeocodeUtility && !defaultGeocodeConfigRef.current && !loadingDefaultGeocodeServiceRef.current && !datasourceConfig;\n        const currentDataSourceConfig = datasourceConfigRef.current || [];\n        if (autoSelectGeocodeUtility) {\n            const option = {\n                nls: nls,\n                id,\n                createOutputDs,\n                viewId,\n                isSingle: autoSelectSingleGeocodeService\n            };\n            loadingDefaultGeocodeServiceRef.current = true;\n            setShowLoading(true);\n            getDefaultGeocodeConfig(option).then(res => {\n                loadingDefaultGeocodeServiceRef.current = false;\n                defaultGeocodeConfigRef.current = res;\n                setShowLoading(false);\n                if (res) {\n                    let newDataSourceConfig = currentDataSourceConfig;\n                    newDataSourceConfig = res === null || res === void 0 ? void 0 : res.concat(newDataSourceConfig);\n                    updateConfigForLayerOptions(Immutable(newDataSourceConfig));\n                }\n            }, err => {\n                setShowLoading(false);\n                loadingDefaultGeocodeServiceRef.current = false;\n            });\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [autoSelectAllOrgGeocodeService, autoSelectSingleGeocodeService]);\n    useEffect(() => {\n        deleteSearchTemplateWhenUtilityNotExist(utilitiesInConfig);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [utilitiesInConfig]);\n    const deleteSearchTemplateWhenUtilityNotExist = (utilitiesInConfig) => {\n        let isHasRemoveTemplate = false;\n        const newDataSourceConfig = datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.filter(item => {\n            var _a;\n            if ((item === null || item === void 0 ? void 0 : item.searchServiceType) === SearchServiceType.FeatureService) {\n                return true;\n            }\n            else {\n                const useUtilityId = (_a = item === null || item === void 0 ? void 0 : item.useUtility) === null || _a === void 0 ? void 0 : _a.utilityId;\n                if (!useUtilityId)\n                    return true;\n                if (!(utilitiesInConfig === null || utilitiesInConfig === void 0 ? void 0 : utilitiesInConfig[useUtilityId])) {\n                    isHasRemoveTemplate = true;\n                    return false;\n                }\n                else {\n                    return true;\n                }\n            }\n        });\n        isHasRemoveTemplate && updateConfigForLayerOptions(newDataSourceConfig);\n    };\n    /**\n     * Check is output datasource in current widget json, if not, create output datasource\n    */\n    const checkAndInitOutputDs = () => {\n        const outputDataSources = (widgetsJson === null || widgetsJson === void 0 ? void 0 : widgetsJson.outputDataSources) || [];\n        const newDataSourceConfig = (datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.asMutable({ deep: true })) || [];\n        for (let i; i < (newDataSourceConfig === null || newDataSourceConfig === void 0 ? void 0 : newDataSourceConfig.length) - 1; i++) {\n            const dsConfigItem = newDataSourceConfig[i];\n            if ((dsConfigItem === null || dsConfigItem === void 0 ? void 0 : dsConfigItem.searchServiceType) === SearchServiceType.FeatureService)\n                continue;\n            const outputDsId = dsConfigItem === null || dsConfigItem === void 0 ? void 0 : dsConfigItem.outputDataSourceId;\n            if (!(outputDataSources === null || outputDataSources === void 0 ? void 0 : outputDataSources.includes(outputDsId))) {\n                updateConfigForLayerOptions(datasourceConfig);\n                break;\n            }\n        }\n    };\n    /**\n     * Toggle new search source dropdown list\n     */\n    const toggleNewSource = () => {\n        setOpen(!open);\n    };\n    const dsStatusChange = (dsId, isDsCreateSuccess = false) => {\n        const newDsCreateStatus = dsCreateStatus.set(dsId, isDsCreateSuccess);\n        setDsCreateStatus(newDsCreateStatus);\n    };\n    /**\n     * Fire callback after add new source\n     */\n    const onDsConfigIdChange = (configItemIndex, isGeocodeSource) => {\n        setShowNewSourceItem(false);\n        if (!(typeof (configItemIndex) === 'number')) {\n            hideSidePopper();\n            return;\n        }\n        setSidePopperAnchor(configItemIndex, false);\n        if (dsConfigItemIndex === configItemIndex) {\n            if (isGeocodeSource) {\n                setShowLocatorSourcePanel(!showLocatorSourcePanel);\n                setShowLayerSourcePanel(false);\n            }\n            else {\n                setShowLayerSourcePanel(!showLayerSourcePanel);\n                setShowLocatorSourcePanel(false);\n            }\n        }\n        else {\n            setDsConfigItemIndex(configItemIndex);\n            if (isGeocodeSource) {\n                setShowLocatorSourcePanel(true);\n                setShowLayerSourcePanel(false);\n            }\n            else {\n                setShowLayerSourcePanel(true);\n                setShowLocatorSourcePanel(false);\n            }\n        }\n    };\n    /**\n     * Close side popper\n     */\n    const hideSidePopper = () => {\n        setShowLocatorSourcePanel(false);\n        setShowLayerSourcePanel(false);\n        setDsConfigItemIndex(null);\n    };\n    const openSourcePanel = (isLayerSource) => {\n        const isShowSourcePanel = isLayerSource ? !showLocatorSourcePanel : !showLayerSourcePanel;\n        setShowNewSourceItem(isShowSourcePanel);\n        if (isShowSourcePanel) {\n            const index = (datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.length) || 0;\n            setDsConfigItemIndex(index);\n            setSidePopperAnchor(index, true);\n        }\n        isLayerSource ? setShowLayerSourcePanel(isShowSourcePanel) : setShowLocatorSourcePanel(isShowSourcePanel);\n    };\n    const showSourcePanel = () => {\n        var _a;\n        const isGeocodeSource = ((_a = datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig[dsConfigItemIndex]) === null || _a === void 0 ? void 0 : _a.searchServiceType) === SearchServiceType.GeocodeService;\n        return isGeocodeSource ? showLocatorSourcePanel : showLayerSourcePanel;\n    };\n    /**\n     * Update config after dataSources config change\n     */\n    const updateConfigForLayerOptions = (newDataSourceConfig, closeSidePopper = false) => {\n        if (checkIsNewLayer(newDataSourceConfig)) {\n            setShowNewSourceItem(false);\n        }\n        if (closeSidePopper) {\n            hideSidePopper();\n        }\n        const allDataSources = getAllDataSourceBySearchDataConfig(newDataSourceConfig, createOutputDs);\n        const dsInWidgetJson = getDsInWidgetJson(allDataSources, id, createOutputDs);\n        if (createOutputDs) {\n            onOutputDsSettingChange && onOutputDsSettingChange(allDataSources.outputDataSources, newDataSourceConfig, dsInWidgetJson, viewId);\n        }\n        else {\n            onSettingChange && onSettingChange(newDataSourceConfig, dsInWidgetJson, viewId);\n        }\n    };\n    /**\n     * Check is a new layer\n     */\n    const checkIsNewLayer = (newDataSourceConfig) => {\n        return (newDataSourceConfig === null || newDataSourceConfig === void 0 ? void 0 : newDataSourceConfig.length) !== (datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.length);\n    };\n    const locatorSourcePanelToggle = () => {\n        if (showLocatorSourcePanel) {\n            setDsConfigItemIndex(null);\n        }\n        setShowLocatorSourcePanel(!showLocatorSourcePanel);\n        setShowNewSourceItem(false);\n        removeUnaccessibleSearchData();\n    };\n    const layerSourcePanelToggle = () => {\n        if (showLayerSourcePanel) {\n            setDsConfigItemIndex(null);\n        }\n        setShowLayerSourcePanel(!showLayerSourcePanel);\n        setShowNewSourceItem(false);\n        removeUnaccessibleSearchData();\n    };\n    const removeUnaccessibleSearchData = () => {\n        var _a;\n        const newDataSourceConfig = (_a = datasourceConfig === null || datasourceConfig === void 0 ? void 0 : datasourceConfig.asMutable({ deep: true })) === null || _a === void 0 ? void 0 : _a.filter(item => {\n            return ((item === null || item === void 0 ? void 0 : item.useDataSource) || (item === null || item === void 0 ? void 0 : item.useUtility));\n        });\n        updateConfigForLayerOptions(Immutable(newDataSourceConfig));\n    };\n    const setSidePopperAnchor = (index, newAdded = false) => {\n        let node;\n        if (newAdded) {\n            node = sidePopperTrigger.current.getElementsByClassName('add-search-btn')[0];\n        }\n        else {\n            node = sidePopperTrigger.current.getElementsByClassName('jimu-tree-item__body')[index];\n        }\n        setPopperFocusNode(node);\n    };\n    const handleEnableFiltering = (evt) => {\n        const value = evt.target.checked;\n        onEnableFilteringChange && onEnableFilteringChange(value);\n    };\n    return (jsx(\"div\", null,\n        jsx(SettingSection, { css: STYLE },\n            !hideTitleOfNewSearchSource && jsx(SettingRow, { flow: 'wrap' },\n                jsx(\"span\", { className: 'w-100 data-remind' }, nls('addSources'))),\n            jsx(SettingRow, { flow: 'wrap' },\n                jsx(\"div\", { className: 'w-100', ref: sidePopperTrigger },\n                    jsx(\"div\", null,\n                        (!searchDataSettingType || searchDataSettingType === SearchDataType.Both) && jsx(Dropdown, { className: 'w-100', size: 'sm', toggle: toggleNewSource, isOpen: open, autoWidth: true },\n                            jsx(DropdownButton, { className: 'add-search-btn w-100', title: nls('newSearchSource'), arrow: false, icon: true, type: 'primary' },\n                                jsx(\"div\", { className: 'w-100 text-truncate' },\n                                    jsx(PlusOutlined, { className: 'mr-1 d-inline-block', autoFlip: true }),\n                                    nls('newSearchSource'))),\n                            jsx(DropdownMenu, { css: DropDownStyle },\n                                jsx(DropdownItem, { className: 'w-100', onClick: () => { openSourcePanel(true); }, title: nls('layerSource') }, nls('layerSource')),\n                                jsx(DropdownItem, { className: 'w-100', onClick: () => { openSourcePanel(false); }, title: nls('locatorSource') }, nls('locatorSource')))),\n                        searchDataSettingType === SearchDataType.FeatureService && jsx(Button, { type: 'primary', className: 'w-100 add-search-btn', onClick: () => { openSourcePanel(true); } },\n                            jsx(PlusOutlined, { className: 'mr-1 d-inline-block', autoFlip: true }),\n                            nls('layerSource')),\n                        searchDataSettingType === SearchDataType.GeocodeService && jsx(Button, { type: 'primary', className: 'w-100 add-search-btn', onClick: () => { openSourcePanel(false); } },\n                            jsx(PlusOutlined, { className: 'mr-1 d-inline-block', autoFlip: true }),\n                            nls('locatorSource'))),\n                    jsx(\"div\", { className: 'w-100', ref: sourceListRef },\n                        jsx(DatasourceList, { id: id, dsConfigItemIndex: dsConfigItemIndex, datasourceConfig: datasourceConfig || Immutable([]), showSourcePanel: showSourcePanel(), useDataSources: useDataSources, onDsConfigIdChange: onDsConfigIdChange, showNewSourceItem: showNewSourceItem, updateConfigForLayerOptions: updateConfigForLayerOptions, hideSidePopper: hideSidePopper, createOutputDs: createOutputDs, dataSourceCreateStatus: dsCreateStatus }))),\n                jsx(LayerSourcePanel, { supportedDsTypes: supportedDsTypes, hideDs: hideDs, viewId: viewId, id: id, dsConfigItemIndex: dsConfigItemIndex, datasourceConfig: datasourceConfig || Immutable([]), useDataSources: useDataSources, isOpen: showLayerSourcePanel, onSettingChange: onSettingChange, trigger: sourceListRef === null || sourceListRef === void 0 ? void 0 : sourceListRef.current, updateConfigForLayerOptions: updateConfigForLayerOptions, toggle: layerSourcePanelToggle, dsStatusChange: dsStatusChange, popperFocusNode: popperFocusNode, hideIconSetting: hideIconSetting, hideDisplayFieldSetting: hideDisplayFieldSetting, propsForDataSourceSelector: propsForDataSourceSelector, showSearchInCurrentMapExtentSetting: showSearchInCurrentMapExtentSetting }),\n                jsx(LocatorSourcePanel, { id: id, viewId: viewId, dsConfigItemIndex: dsConfigItemIndex, datasourceConfig: datasourceConfig || Immutable([]), useDataSources: useDataSources, isOpen: showLocatorSourcePanel, onSettingChange: onSettingChange, updateConfigForLayerOptions: updateConfigForLayerOptions, trigger: sourceListRef === null || sourceListRef === void 0 ? void 0 : sourceListRef.current, toggle: locatorSourcePanelToggle, popperFocusNode: popperFocusNode, hideIconSetting: hideIconSetting, createOutputDs: createOutputDs, showSearchInCurrentMapExtentSetting: showSearchInCurrentMapExtentSetting, showEnableLocalSearchSetting: showEnableLocalSearchSetting })),\n            showLoading && jsx(SettingRow, null,\n                jsx(\"div\", { className: 'position-relative w-100 loading-con' },\n                    jsx(Loading, { type: LoadingType.Secondary, width: 38, height: 38 })))),\n        ((searchDataSettingType === SearchDataType.Both || searchDataSettingType === SearchDataType.FeatureService) && !hideEnableFiltering) && jsx(SettingSection, null,\n            jsx(SettingRow, { tag: 'label', label: nls('enableSearchFilter') },\n                jsx(Switch, { checked: enableFiltering, onChange: handleEnableFiltering, title: nls('enableSearchFilter') }))),\n        (searchDataSettingType === SearchDataType.Both || searchDataSettingType === SearchDataType.FeatureService) && jsx(\"span\", null)));\n};\n","/** @jsx jsx */\nimport { React, css, jsx, defaultMessages as jimuCoreDefaultMessage, Immutable, hooks } from 'jimu-core';\nimport { SettingRow } from 'jimu-ui/advanced/setting-components';\nimport { MAX_SUGGESTION, MAX_RECENT_SEARCHES, DEFAULT_MAX_SUGGESTION } from './type/type';\nimport { TextInput, Checkbox, Switch, defaultMessages as jimuiDefaultMessage } from 'jimu-ui';\nimport { useTheme } from 'jimu-theme';\nimport { useEffect } from 'react';\nexport const SearchSuggestionSetting = (props) => {\n    const nls = hooks.useTranslation(jimuiDefaultMessage, jimuCoreDefaultMessage);\n    const appTheme = useTheme();\n    const STYLE = css `\r\n    .check-box-label {\r\n      color: ${appTheme.ref.palette.neutral[1100]}\r\n    }\r\n    .search-setting-con {\r\n      padding-left: 0;\r\n      padding-right: 0;\r\n    }\r\n    .checkbox-con .jimu-widget-setting--row-label{\r\n      max-width: 100%;\r\n    }\r\n    .cursor-pointer {\r\n      cursor: pointer;\r\n    }\r\n  `;\n    const { onSettingChange, hideRecentSearchSetting } = props;\n    const settingConfig = props.settingConfig || Immutable({});\n    const { maxSuggestions, isUseCurrentLoation, isShowRecentSearches, recentSearchesMaxNumber } = settingConfig;\n    const [newRecentSearchesMaxNumber, setRecentSearchesMaxNumber] = React.useState(recentSearchesMaxNumber);\n    const [newMaxSuggestions, setMaxSuggestions] = React.useState(maxSuggestions);\n    useEffect(() => {\n        setRecentSearchesMaxNumber(recentSearchesMaxNumber);\n        setMaxSuggestions(maxSuggestions);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [settingConfig]);\n    const onConfigChange = (key, value) => {\n        const newSettingConfig = settingConfig.setIn(key, value);\n        onSettingChange && onSettingChange(newSettingConfig);\n    };\n    const handleCurrentLocationChange = (evt) => {\n        onConfigChange(['isUseCurrentLoation'], !isUseCurrentLoation);\n    };\n    const handleMaxSuggestionsChange = (e) => {\n        const value = e.target.value;\n        checkNumber(value, 0) && setMaxSuggestions(value);\n    };\n    const handleMaxSuggestionsAccept = value => {\n        if (!value || value > MAX_SUGGESTION) {\n            value = maxSuggestions || DEFAULT_MAX_SUGGESTION;\n            setMaxSuggestions(value);\n        }\n        checkNumber(value, 0) && onConfigChange(['maxSuggestions'], Number(value));\n    };\n    const handleRecentSearchesMaxNumberAccept = value => {\n        if (!value) {\n            value = recentSearchesMaxNumber || MAX_RECENT_SEARCHES;\n            setRecentSearchesMaxNumber(value);\n        }\n        checkNumber(value) && onConfigChange(['recentSearchesMaxNumber'], Number(value));\n    };\n    const handleRecentSearchesMaxNumberChange = (e) => {\n        const value = e.target.value;\n        checkNumber(value) && setRecentSearchesMaxNumber(value);\n    };\n    const checkNumber = (value, minimum = 1) => {\n        if ((value === null || value === void 0 ? void 0 : value.length) === 0)\n            return true;\n        if (isNaN(Number(value))) {\n            return false;\n        }\n        else {\n            const numberVal = Number(value);\n            return Number.isInteger(numberVal) && numberVal >= minimum;\n        }\n    };\n    return (jsx(\"div\", { css: STYLE },\n        jsx(SettingRow, { flow: 'wrap', className: 'mt-2 checkbox-con', label: nls('maximumSuggestions') },\n            jsx(TextInput, { size: 'sm', \"aria-label\": nls('maximumSuggestions'), value: newMaxSuggestions, onChange: handleMaxSuggestionsChange, onAcceptValue: handleMaxSuggestionsAccept, className: 'w-100' })),\n        jsx(SettingRow, null,\n            jsx(\"div\", { className: 'cursor-pointer d-flex align-items-center', onClick: handleCurrentLocationChange, \"aria-label\": nls('useCurrentLocation') },\n                jsx(Checkbox, { checked: !!isUseCurrentLoation, className: 'mr-1', title: nls('useCurrentLocation') }),\n                jsx(\"span\", { className: 'check-box-label' }, nls('useCurrentLocation')))),\n        !hideRecentSearchSetting && jsx(SettingRow, { tag: 'label', label: nls('recentSearches') },\n            jsx(Switch, { checked: isShowRecentSearches || false, title: nls('recentSearches'), onChange: (evt) => { onConfigChange(['isShowRecentSearches'], !isShowRecentSearches); } })),\n        isShowRecentSearches && jsx(SettingRow, { label: nls('maximumNumber') },\n            jsx(TextInput, { size: 'sm', \"aria-label\": nls('maximumNumber'), value: newRecentSearchesMaxNumber, onChange: handleRecentSearchesMaxNumberChange, onAcceptValue: handleRecentSearchesMaxNumberAccept, style: { width: '50px' } }))));\n};\n","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\n/** @jsx jsx */\nimport { MapViewManager } from 'jimu-arcgis';\nimport { React, ReactRedux, DataSourceManager, jsx, css, DataSourceStatus, hooks, focusElementInKeyboardMode } from 'jimu-core';\nimport { defaultMessages } from 'jimu-ui';\nimport { SidePopper } from 'jimu-ui/advanced/setting-components';\nimport { List } from 'jimu-ui/basic/list-tree';\nimport warningOutlined from 'jimu-icons/svg/outlined/suggested/warning.svg';\nconst getStyle = () => {\n    return css `\r\n    .jimu-tree-main {\r\n      padding-top: 2px;\r\n    }\r\n    .jimu-tree-item {\r\n      padding: 2px;\r\n    }\r\n    .jimu-tree-item__icon {\r\n      background-color: var(--sys-color-info-main);\r\n      width: 1rem;\r\n      height: 1rem;\r\n      margin-right: 0.5rem;\r\n      svg {\r\n        margin-right: 0!important;\r\n      }\r\n    }\r\n    .jimu-tree-item__body {\r\n      .jimu-icon {\r\n        color: var(--sys-color-warning-main);\r\n      }\r\n      .jimu-tree-item__main-line {\r\n        cursor: pointer;\r\n      }\r\n    }\r\n  `;\n};\nfunction MultipleJimuMapConfigComponent(props) {\n    var _a, _b;\n    const { mapWidgetId, disabled, disableSwitchMap = false, onClick, sidePopperContent, isDataSourceValid, showDefaultMapWhenEmpty, keepLastTimeMap = false, 'aria-describedby': ariaDescribedby = '' } = props, restProps = __rest(props, [\"mapWidgetId\", \"disabled\", \"disableSwitchMap\", \"onClick\", \"sidePopperContent\", \"isDataSourceValid\", \"showDefaultMapWhenEmpty\", \"keepLastTimeMap\", 'aria-describedby']);\n    const currentActiveJmvIdRef = React.useRef('');\n    const containerRef = React.useRef(null);\n    const [showPopper, setShowPopper] = React.useState(false);\n    const [activeItem, setActiveItem] = React.useState(null);\n    const [currentTitle, setCurrentTitle] = React.useState('');\n    const [currentDsId, setCurrentDsId] = React.useState(null);\n    const [defaultDsId, setDefaultDsID] = React.useState(null);\n    const jimuMapViewGroup = MapViewManager.getInstance().getJimuMapViewGroup(mapWidgetId);\n    const [allDataSourcesReady, setAllDataSourcesReady] = React.useState(false);\n    const translate = hooks.useTranslation(defaultMessages);\n    const useDataSources = ReactRedux.useSelector((state) => {\n        var _a, _b, _c;\n        const appState = state.appStateInBuilder;\n        const useDataSourcesConfig = appState && ((_c = (_b = (_a = appState === null || appState === void 0 ? void 0 : appState.appConfig) === null || _a === void 0 ? void 0 : _a.widgets) === null || _b === void 0 ? void 0 : _b[mapWidgetId]) === null || _c === void 0 ? void 0 : _c.useDataSources);\n        return useDataSourcesConfig;\n    });\n    const dataSourcesInfo = ReactRedux.useSelector((state) => {\n        const appState = state.appStateInBuilder;\n        const dataSourcesInfoConfig = appState && (appState === null || appState === void 0 ? void 0 : appState.dataSourcesInfo);\n        return dataSourcesInfoConfig;\n    }, (oldDssInfo, newDssInfo) => {\n        if (!useDataSources) {\n            return true;\n        }\n        else {\n            for (const useDataSource of useDataSources) {\n                if (oldDssInfo && newDssInfo && (oldDssInfo[useDataSource.dataSourceId] !== newDssInfo[useDataSource.dataSourceId])) {\n                    return false;\n                }\n            }\n            return true;\n        }\n    });\n    React.useEffect(() => {\n        // When the connected dataSources are not ready, check the loading status\n        if (!allDataSourcesReady) {\n            // When connect to an empty map, the useDataSources field is undefined\n            if (!useDataSources || (useDataSources === null || useDataSources === void 0 ? void 0 : useDataSources.length) === 0) {\n                setAllDataSourcesReady(true);\n            }\n            else {\n                let readyCount = 0;\n                for (const item of useDataSources) {\n                    const dsInfo = dataSourcesInfo === null || dataSourcesInfo === void 0 ? void 0 : dataSourcesInfo[item.dataSourceId];\n                    if (dsInfo && (dsInfo.instanceStatus === DataSourceStatus.Created || dsInfo.instanceStatus === DataSourceStatus.CreateError)) {\n                        readyCount++;\n                        if (readyCount === useDataSources.length) {\n                            setAllDataSourcesReady(true);\n                        }\n                    }\n                }\n            }\n        }\n    }, [allDataSourcesReady, dataSourcesInfo, useDataSources]);\n    const getSkeletonList = React.useCallback(() => {\n        const SKELETON_NUM = 2;\n        const skeletonItems = [];\n        for (let i = 0; i < SKELETON_NUM; i++) {\n            skeletonItems.push({\n                itemKey: i.toString(),\n                itemStateCommands: [{\n                        iconProps: () => ({ icon: ' ', size: 12, style: { opacity: 0 } })\n                    }]\n            });\n        }\n        return jsx(List, { className: 'w-100', itemsJson: skeletonItems, dndEnabled: false, handleClickItemBody: () => null });\n    }, []);\n    const getDataSourceLabel = React.useCallback((dsObj) => {\n        if (!dsObj) {\n            return '';\n        }\n        const label = dsObj.getLabel();\n        return label || (dsObj === null || dsObj === void 0 ? void 0 : dsObj.getDataSourceJson().sourceLabel) || dsObj.id;\n    }, []);\n    const defaultItemsJson = (_b = (_a = (useDataSources === null || useDataSources === void 0 ? void 0 : useDataSources.asMutable())) === null || _a === void 0 ? void 0 : _a.sort((useDs1, useDs2) => useDs1.dataSourceId.localeCompare(useDs2.dataSourceId))) === null || _b === void 0 ? void 0 : _b.map(useDataSource => {\n        var _a;\n        const dsObj = DataSourceManager.getInstance().getDataSource(useDataSource.dataSourceId);\n        let item = null;\n        const commands = [];\n        if (isDataSourceValid && !isDataSourceValid(useDataSource.dataSourceId).isValid) {\n            commands.push({\n                label: (_a = isDataSourceValid(useDataSource.dataSourceId)) === null || _a === void 0 ? void 0 : _a.invalidMessage,\n                iconProps: () => ({ icon: warningOutlined, size: 16, color: 'var(--sys-color-warning-dark)' })\n            });\n        }\n        if (dsObj) {\n            item = {\n                itemStateTitle: getDataSourceLabel(dsObj),\n                itemStateChecked: useDataSource.dataSourceId === currentActiveJmvIdRef.current,\n                itemKey: useDataSource.dataSourceId,\n                itemStateDisabled: disabled,\n                itemStateCommands: commands\n            };\n        }\n        else {\n            item = {\n                itemStateTitle: translate('none'),\n                itemKey: useDataSource.dataSourceId,\n                itemStateDisabled: true\n            };\n        }\n        return item;\n    });\n    const getItemsJson = React.useCallback(() => {\n        if (showDefaultMapWhenEmpty && (!useDataSources || useDataSources.length === 0)) {\n            return [{\n                    itemStateTitle: translate('multipleMapDefaultWebMap'),\n                    itemKey: 'default',\n                    itemStateChecked: currentActiveJmvIdRef.current === 'default',\n                    itemStateDisabled: disabled\n                }];\n        }\n        else {\n            return defaultItemsJson;\n        }\n    }, [defaultItemsJson, disabled, showDefaultMapWhenEmpty, translate, useDataSources]);\n    React.useEffect(() => {\n        if (!(jimuMapViewGroup === null || jimuMapViewGroup === void 0 ? void 0 : jimuMapViewGroup.jimuMapViews)) {\n            return;\n        }\n        const jmvPromises = Object.keys(jimuMapViewGroup === null || jimuMapViewGroup === void 0 ? void 0 : jimuMapViewGroup.jimuMapViews).map(jmvId => {\n            return jimuMapViewGroup === null || jimuMapViewGroup === void 0 ? void 0 : jimuMapViewGroup.jimuMapViews[jmvId].whenJimuMapViewLoaded();\n        });\n        Promise.all(jmvPromises).then(() => {\n            var _a;\n            // Get active jimuMapView when all views are ready, set to ' ' for empty map\n            // jmvGroup may have no active mv when just added a new web map\n            const activeDsId = ((_a = jimuMapViewGroup === null || jimuMapViewGroup === void 0 ? void 0 : jimuMapViewGroup.getActiveJimuMapView()) === null || _a === void 0 ? void 0 : _a.dataSourceId) || '';\n            setCurrentDsId(activeDsId.length > 0 ? activeDsId : ' ');\n            setDefaultDsID(activeDsId.length > 0 ? activeDsId : ' ');\n        }).catch(err => {\n            console.error(err);\n        });\n    }, [jimuMapViewGroup, jimuMapViewGroup === null || jimuMapViewGroup === void 0 ? void 0 : jimuMapViewGroup.jimuMapViews]);\n    // Used for switch map\n    const handleClickWithSwitchMap = React.useCallback((actionData, refComponent) => {\n        const { itemJsons } = refComponent.props;\n        const currentItemJson = itemJsons[0];\n        let index = 0;\n        const itemsJson = getItemsJson();\n        for (; index < itemsJson.length; index++) {\n            if (itemsJson[index].itemKey === currentItemJson.itemKey) {\n                break;\n            }\n        }\n        const item = containerRef.current.querySelectorAll('.jimu-tree-item__body')[index];\n        setActiveItem(item);\n        if (isDataSourceValid && !isDataSourceValid(currentItemJson.itemKey).isValid) {\n            // Not a valid data-source, do not response to click\n            return;\n        }\n        setCurrentDsId(currentItemJson.itemKey);\n        onClick && onClick(currentItemJson.itemKey);\n        if (currentActiveJmvIdRef.current === currentItemJson.itemKey) {\n            currentActiveJmvIdRef.current = '';\n            setShowPopper(false);\n        }\n        else {\n            currentActiveJmvIdRef.current = currentItemJson.itemKey;\n            setCurrentTitle(currentItemJson.itemStateTitle);\n            setShowPopper(true);\n        }\n        if (!disableSwitchMap) {\n            // The itemKey is dsId\n            if (jimuMapViewGroup && currentItemJson.itemKey !== currentDsId) {\n                jimuMapViewGroup.switchMap();\n            }\n        }\n    }, [currentDsId, disableSwitchMap, getItemsJson, isDataSourceValid, jimuMapViewGroup, onClick]);\n    React.useEffect(() => {\n        return () => {\n            // Make sure previous round the popper is open, otherwise it will switch twice\n            // Put this logic in cleanup func, so it will be executed even if when click the canvas (component unmount)\n            if (!disableSwitchMap && showPopper && defaultDsId !== currentDsId && !keepLastTimeMap) {\n                jimuMapViewGroup.switchMap();\n                setCurrentDsId(defaultDsId);\n            }\n        };\n    }, [currentDsId, defaultDsId, disableSwitchMap, jimuMapViewGroup, showPopper, keepLastTimeMap]);\n    return (jsx(\"div\", { ref: containerRef, className: 'w-100 multiple-jimu-map-config-component', css: getStyle(), \"aria-describedby\": ariaDescribedby }, \n    // Wait for currentDsId, so the switchMap could work correctly\n    (allDataSourcesReady && currentDsId)\n        ? jsx(React.Fragment, null,\n            jsx(List, Object.assign({}, restProps, { itemsJson: getItemsJson(), handleClickItemBody: handleClickWithSwitchMap })),\n            jsx(SidePopper, { position: 'right', isOpen: showPopper, toggle: () => {\n                    setShowPopper(false);\n                    currentActiveJmvIdRef.current = '';\n                    focusElementInKeyboardMode(containerRef === null || containerRef === void 0 ? void 0 : containerRef.current);\n                }, title: currentTitle, trigger: containerRef === null || containerRef === void 0 ? void 0 : containerRef.current, backToFocusNode: activeItem }, sidePopperContent))\n        : getSkeletonList()));\n}\n/**\n * This component is used for configuring one or multiple `JimuMap`. If two data sources are selected in the connected map widget,\n * clicking on the list item of this component switches the map widget's active view to the corresponding one. The switch behavior\n * is on the fly (discarded when refreshing the page).\n * Use this component by `import { MultipleJimuMapConfig } from 'jimu-ui/advanced/setting-components'`.\n */\nexport const MultipleJimuMapConfig = MultipleJimuMapConfigComponent;\n","/** @jsx jsx */\nimport { React, jsx, css, polished, defaultMessages as jimuCoreDefaultMessage, hooks } from 'jimu-core';\nimport { SettingRow, SettingSection } from '../layout';\nimport { CardLayout } from './type';\nimport { Radio, Modal, ModalBody, ModalHeader, ModalFooter, Button, defaultMessages as jimuiDefaultMessage } from 'jimu-ui';\nimport { WarningOutlined } from 'jimu-icons/outlined/suggested/warning';\nimport { setLayoutAuto, setLayoutCustom } from './utils';\nimport { useState, useEffect } from 'react';\nconst STYLE = css `\r\n  .jimu-radio {\r\n    cursor: pointer;\r\n  }\r\n  .clear-padding {\r\n    padding-left: 0;\r\n    padding-right: 0;\r\n  }\r\n`;\nconst ModalStyle = css `\r\n  & .modal-content {\r\n    border: none;\r\n  }\r\n  .header-con {\r\n    & {\r\n      border: none;\r\n      padding: ${polished.rem(30)};\r\n      padding-bottom: 0;\r\n    }\r\n    svg {\r\n      color: var(--sys-color-warning-main);\r\n      border-bottom: none;\r\n      margin-right: ${polished.rem(12)} !important;\r\n    }\r\n  }\r\n  .modal-body {\r\n    padding: ${polished.rem(24)} ${polished.rem(30)};\r\n  }\r\n  .modal-footer {\r\n    & {\r\n      padding: ${polished.rem(30)};\r\n      padding-top: 0;\r\n    }\r\n  }\r\n`;\nexport const CardLayoutSetting = (props) => {\n    const { id, cardLayout, status, isCardWidget, layouts, mainSizeMode, config, appConfig } = props;\n    const [isOpen, setIsOpen] = useState(false);\n    const [reminderTitle, setReminderTitle] = useState(null);\n    const [reminderText, setReminderText] = useState(null);\n    const [reminderBottomText, setReminderBottomText] = useState(null);\n    const layout = React.useRef(cardLayout);\n    const oldLayout = React.useRef(cardLayout);\n    useEffect(() => {\n        layout.current = props.cardLayout;\n        oldLayout.current = props.cardLayout;\n    }, [status, props]);\n    const handleToggle = () => {\n        setIsOpen(!isOpen);\n        layout.current = oldLayout.current;\n    };\n    const handleConfirm = () => {\n        const option = {\n            layout: layout.current,\n            config: config,\n            widgetId: id,\n            appConfig: appConfig,\n            status: status,\n            label: nls(status.toLowerCase()),\n            isCardWidget,\n            layouts: layouts === null || layouts === void 0 ? void 0 : layouts.asMutable({ deep: true }),\n            mainSizeMode\n        };\n        if (layout.current === CardLayout.AUTO) {\n            setLayoutAuto(option);\n        }\n        else {\n            setLayoutCustom(option);\n        }\n        setIsOpen(false);\n        oldLayout.current = layout.current;\n    };\n    const handleLayoutChange = (newLayout) => {\n        if (oldLayout.current === newLayout)\n            return;\n        if (newLayout === CardLayout.AUTO) {\n            setReminderTitle(nls('remindAutoLayoutTitle'));\n            setReminderText(nls('remindAutoLayoutText'));\n            setReminderBottomText('');\n        }\n        else {\n            setReminderTitle(nls('remindCustomLayoutTitle'));\n            setReminderText(nls('remindCustomLayoutText'));\n            setReminderBottomText(nls('remindCustomLayoutBottomText'));\n        }\n        setIsOpen(true);\n        layout.current = newLayout;\n    };\n    const renderRemindModel = () => {\n        return (jsx(Modal, { isOpen: isOpen, toggle: handleToggle, centered: true, css: ModalStyle },\n            jsx(ModalHeader, { className: 'header-con' },\n                jsx(WarningOutlined, { className: 'mr-2', size: 24 }),\n                reminderTitle),\n            jsx(ModalBody, null,\n                jsx(\"div\", null, reminderText),\n                reminderBottomText && jsx(\"div\", { className: 'mt-5' }, reminderBottomText)),\n            jsx(ModalFooter, null,\n                jsx(Button, { title: nls('ok'), type: 'primary', onClick: handleConfirm }, nls('ok')),\n                jsx(Button, { title: nls('cancel'), onClick: () => { setIsOpen(false); } }, nls('cancel')))));\n    };\n    const nls = hooks.useTranslation(jimuiDefaultMessage, jimuCoreDefaultMessage);\n    return (jsx(\"div\", { css: STYLE, role: 'group', \"aria-label\": nls('layout') },\n        jsx(SettingSection, { className: 'clear-padding', title: nls('layout') },\n            jsx(SettingRow, { flow: 'wrap' },\n                jsx(\"div\", { className: 'd-flex align-items-center', onClick: () => { handleLayoutChange(CardLayout.AUTO); } },\n                    jsx(Radio, { title: nls('auto'), checked: cardLayout === CardLayout.AUTO, className: 'mr-2' }),\n                    \" \",\n                    nls('auto'))),\n            jsx(SettingRow, null,\n                jsx(\"div\", { className: 'd-flex align-items-center', onClick: () => { handleLayoutChange(CardLayout.CUSTOM); } },\n                    jsx(Radio, { title: nls('custom'), checked: cardLayout === CardLayout.CUSTOM || !cardLayout, className: 'mr-2' }),\n                    \" \",\n                    nls('custom'))),\n            renderRemindModel())));\n};\n"],"names":[],"sourceRoot":""}