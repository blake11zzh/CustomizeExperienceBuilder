"use strict";(self.webpackChunkarcgis_experience_builder_design_system=self.webpackChunkarcgis_experience_builder_design_system||[]).push([[8923],{"../jimu-for-builder/service.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AppType:()=>service_type.uC,PublishStatus:()=>service_type.qD,SearchType:()=>service_type.nX,appServices:()=>app_service_namespaceObject,createAppCallBack:()=>createAppByDefaultTemplateCallBack,getNewTypeKeywordsWhenSaveApp:()=>getNewTypeKeywordsWhenSaveApp,getPublishStatus:()=>util_getPublishStatus,getResourceOrigin:()=>portal_util.Ld,initAppConfigOfNewApp:()=>util_initAppConfigOfNewApp,toCreateAppByDefaultTemplate:()=>toCreateAppByDefaultTemplate,userServices:()=>user_service_namespaceObject});var app_service_namespaceObject={};__webpack_require__.r(app_service_namespaceObject),__webpack_require__.d(app_service_namespaceObject,{addToFavorites:()=>addToFavorites,changeAppFolder:()=>changeAppFolder,checkImportAppVersion:()=>checkImportAppVersion,createAppByDefaultTemplate:()=>createAppByDefaultTemplate,createAppByItemTemplateId:()=>createAppByItemTemplateId,createAppByItemTemplateInfo:()=>createAppByItemTemplateInfo,createTemplateByApp:()=>createTemplateByApp,deleteApp:()=>deleteApp,duplicateApp:()=>duplicateApp,getAppGroups:()=>getAppGroups,getAppInfo:()=>getAppInfo,getDefaultTemplateConfig:()=>getDefaultTemplateConfig,getDraftAppConfig:()=>getDraftAppConfig,getFolders:()=>getFolders,getGroupCategorySchema:()=>getGroupCategorySchema,getGroupContent:()=>getGroupContent,getOrgCategorySchema:()=>getOrgCategorySchema,getPublishedAppConfig:()=>getPublishedAppConfig,getUserTags:()=>getUserTags,importAppFromPortal:()=>importAppFromPortal,importAppFromZip:()=>importAppFromZip,publishApp:()=>publishApp,removeFromFavorites:()=>removeFromFavorites,replaceExbVersionInAppConfig:()=>replaceExbVersionInAppConfig,saveApp:()=>saveApp,saveAsApp:()=>saveAsApp,searchApp:()=>searchApp,searchAppByPortalUrl:()=>searchAppByPortalUrl,searchGroups:()=>searchGroups,transferAppToFullMode:()=>transferAppToFullMode,updateAppInfo:()=>updateAppInfo,updateAppInfoWhenSaveApp:()=>updateAppInfoWhenSaveApp,updateAppThumbnail:()=>updateAppThumbnail});var user_service_namespaceObject={};__webpack_require__.r(user_service_namespaceObject),__webpack_require__.d(user_service_namespaceObject,{addUserResource:()=>addUserResource,getUserResource:()=>getUserResource,getUserResources:()=>getUserResources,initUserResource:()=>initUserResource,removeUserResource:()=>removeUserResource,updateUserResource:()=>updateUserResource});var jimu_core=__webpack_require__("../jimu-core/index.tsx"),rest_service=__webpack_require__("../jimu-for-builder/lib/service/rest-service.tsx"),translations_default=__webpack_require__("../jimu-for-builder/lib/translations/default.ts"),service_type=__webpack_require__("../jimu-for-builder/lib/service/type/index.ts"),portal_util=__webpack_require__("../jimu-for-builder/lib/service/app-service/portal-util.ts"),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const request=jimu_core._2M.restRequest.request,{jJ:TYPE_KEYWORDS_OF_EXPRESS_APP}=jimu_core.aH5;function getNewAppTitleWithIndex(title_1){return __awaiter(this,arguments,void 0,(function*(title,isCopy=!1,type=""){const session=jimu_core.Cvv.getInstance().getMainSession();let newTitle=null;const appType=(null==type?void 0:type.includes("Template"))?service_type.uC.TemplateType:service_type.uC.ExperienceType,expressQueryParams=window.isExpressBuilder?'typekeywords: "ExpressExperienceApp"':'NOT typekeywords: "ExpressExperienceApp"';return yield searchApp({q:`type: "${appType}" ${expressQueryParams} AND owner:${null==session?void 0:session.username} AND  title:"${title}"`,sortField:"modified",sortOrder:"desc"},service_type.nX.Other).then((result=>__awaiter(this,void 0,void 0,(function*(){const apps=result.results;if(apps&&apps.length>0){const index=function getMaxIndex(appList,name){const indexData=[],reg=/^[\d]+$/;return appList.forEach((el=>{var _a,_b;const index=null===(_b=null===(_a=el.title)||void 0===_a?void 0:_a.split(`${name} `)[1])||void 0===_b?void 0:_b.split(" ")[0];reg.test(index)&&indexData.push(Number(index))})),indexData.sort((function(a,b){return a<b?1:-1})),indexData[0]||1}(apps,title);return newTitle=getAppName(title,apps,index,isCopy),yield Promise.resolve(newTitle)}return newTitle=isCopy?title:`${title} 1`,yield Promise.resolve(newTitle)})))).catch((err=>__awaiter(this,void 0,void 0,(function*(){return console.error(err),yield Promise.reject(new Error(err))}))))}))}function copyAppByAPI(option){return __awaiter(this,void 0,void 0,(function*(){const{originAppInfo,folder,title,name,updateAppVersion,removeFaviconInConfig,isDuplicateApp,deleteThumbnail,appInfoItemForNewApp,retainsAppSummary}=option;return getNewAppTitleWithIndex(`${title||originAppInfo.title}`,isDuplicateApp,originAppInfo.type).then((newTitle=>__awaiter(this,void 0,void 0,(function*(){newTitle=newTitle||(null==originAppInfo?void 0:originAppInfo.title);const copyItemParams={name:name||newTitle,title:newTitle,folder,includeResources:!0,copyPrivateResources:!0,f:"json"};return(0,rest_service.XW)(originAppInfo,Object.assign(Object.assign({},copyItemParams),{authentication:jimu_core.Cvv.getInstance().getMainSession()})).then((res=>{const itemId=res.itemId;return getAppInfo({id:itemId}).then((newAppInfo=>(newTitle&&(newAppInfo.title=newTitle),function initAppInfoAndItemDataOfNewItem(appInfo_1){return __awaiter(this,arguments,void 0,(function*(appInfo,isUpdateVersion=!1,appInfoItemForNewApp,retainsAppSummary=!1){const itemId=appInfo.id;return function updateAppInfoOfNewApp(appInfo_1){return __awaiter(this,arguments,void 0,(function*(appInfo,isUpdateVersion=!1,appInfoItemForNewApp,retainsAppSummary=!1){const typeKeywords=(null==appInfoItemForNewApp?void 0:appInfoItemForNewApp.typeKeywords)||(null==appInfo?void 0:appInfo.typeKeywords)||[],itemId=appInfo.id,newTypeKeywords=initTypeKeywordsOfNewItem(typeKeywords,appInfo.type,isUpdateVersion);return retainsAppSummary||(appInfo.snippet="",appInfo.description=""),appInfo.url="",appInfo.clearEmptyFields=!0,appInfoItemForNewApp&&((null==appInfoItemForNewApp?void 0:appInfoItemForNewApp.typeKeywords)&&delete appInfoItemForNewApp.typeKeywords,appInfo=Object.assign(Object.assign({},appInfo),appInfoItemForNewApp)),appInfo.typeKeywords=newTypeKeywords,updateAppInfo(appInfo).then((res=>Promise.resolve(itemId)))}))}(appInfo,isUpdateVersion,appInfoItemForNewApp,retainsAppSummary).then((res=>updateItemDataInApp(itemId)))}))}(newAppInfo,updateAppVersion,appInfoItemForNewApp,retainsAppSummary).then((res=>updateAppConfigOfNewItem(itemId,originAppInfo,!0,updateAppVersion,removeFaviconInConfig).then((res=>deleteThumbnail?(0,rest_service.Uu)(newAppInfo).then((res=>Promise.resolve(itemId))):Promise.resolve(itemId)),(err=>(deleteApp(itemId),Promise.reject(new Error(err)))))),(err=>(deleteApp(itemId),Promise.reject(new Error(err))))))))}),(err=>Promise.reject(new Error(err))))}))))}))}function toCreateAppByDefaultTemplate(appInfo,folderId){return __awaiter(this,void 0,void 0,(function*(){const typeKeywords=["EXB Experience","Ready To Use","JavaScript","status: Draft",`version:${jimu_core.rEp}`];window.isExpressBuilder&&typeKeywords.push(TYPE_KEYWORDS_OF_EXPRESS_APP);const itemInfo={title:null==appInfo?void 0:appInfo.name,type:(null==appInfo?void 0:appInfo.type)||"Web Experience",typeKeywords,snippet:(null==appInfo?void 0:appInfo.snippet)||"",description:(null==appInfo?void 0:appInfo.description)||"",tags:(null==appInfo?void 0:appInfo.tags)||[],text:{__not_publish:!0}};return yield(()=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(!1)})))().then((function(exist){return __awaiter(this,void 0,void 0,(function*(){return exist?yield Promise.reject(new Error("app existed.")):yield createApp(itemInfo,folderId)}))}))}))}function createAppByDefaultTemplateCallBack(defaultAppConfigs,item,webmapId,websceneId){return __awaiter(this,void 0,void 0,(function*(){const appResourceManagerInstance=jimu_core.SRz.getModuleSync("jimu-for-builder").AppResourceManager.getInstance(),itemId=item.id;let defaultAppConfig=jimu_core.WpD.replaceI18nPlaceholdersInObject(defaultAppConfigs,jimu_core.Ruy.getIntl(),translations_default.A);return defaultAppConfig=function initAppConfig(appConfig){appConfig.attributes||(appConfig.attributes={});appConfig.widgets||(appConfig.widgets={});appConfig.widgetsManifest||(appConfig.widgetsManifest={});appConfig.views||(appConfig.views={});appConfig.sections||(appConfig.sections={});appConfig.dialogs||(appConfig.dialogs={});appConfig.pages||(appConfig.pages={});appConfig.layouts||(appConfig.layouts={});appConfig.dataSources||(appConfig.dataSources={});appConfig.messageConfigs||(appConfig.messageConfigs={});return appConfig}(defaultAppConfig),jimu_core.VbA.addWebmapOrWebsceneToAppConfig(defaultAppConfig,webmapId,websceneId,!0),appResourceManagerInstance.upLoadAppConfig(itemId.toString(),defaultAppConfig).then((()=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(item)}))))}))}function getCreateAppParamsByAppId(templateId){return __awaiter(this,void 0,void 0,(function*(){return yield function checkIsPortalApp(templateId){return __awaiter(this,void 0,void 0,(function*(){const portalUrl=(0,jimu_core.Vp3)().getState().portalUrl,getAppInfoParams={id:templateId,portalUrl,isLocalApp:!1};return yield getAppInfo(getAppInfoParams).then((appInfo=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(getAppInfoParams)})))).catch((err=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Item does not exist or is inaccessible."))}))))}))}(templateId).then((portalAppInfo=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(portalAppInfo)})))).catch((err=>__awaiter(this,void 0,void 0,(function*(){return yield function checkIsAGOLApp(templateId){return __awaiter(this,void 0,void 0,(function*(){const portalUrl=(0,jimu_core.Vp3)().getState().portalUrl;if(jimu_core.zJ_.isAGOLDomain(portalUrl))return yield Promise.reject(!1);const getAppInfoParams={id:templateId,portalUrl:"https://maps.arcgis.com",isLocalApp:!1};return yield getAppInfo(getAppInfoParams).then((localAppInfo=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(getAppInfoParams)})))).catch((err=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Item does not exist or is inaccessible."))}))))}))}(templateId).then((AGOLAppInfo=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(AGOLAppInfo)})))).catch((err=>__awaiter(this,void 0,void 0,(function*(){return yield function checkIsLocalApp(templateId){return __awaiter(this,void 0,void 0,(function*(){if(window.jimuConfig.isDevEdition){const portalUrl=(0,jimu_core.Vp3)().getState().portalUrl,getAppInfoParams={id:templateId,portalUrl,isLocalApp:!0};return yield getAppInfo(getAppInfoParams).then((localAppInfo=>__awaiter(this,void 0,void 0,(function*(){return(null==localAppInfo?void 0:localAppInfo.success)?yield Promise.resolve(getAppInfoParams):yield Promise.reject(new Error("Item does not exist or is inaccessible."))})))).catch((err=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Item does not exist or is inaccessible."))}))))}return yield Promise.reject(new Error("Item does not exist or is inaccessible."))}))}(templateId)}))))}))))}))}function createApp(appInfo,folderId){return __awaiter(this,void 0,void 0,(function*(){return folderId?yield(0,rest_service.LS)({item:appInfo,folderId,authentication:jimu_core.Cvv.getInstance().getMainSession()}):yield(0,rest_service.wE)({item:appInfo,authentication:jimu_core.Cvv.getInstance().getMainSession()})}))}function updateItemDataInApp(newAppId){return __awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession();return yield(0,rest_service.fk)({item:{id:newAppId,owner:null==session?void 0:session.username,text:{__not_publish:!0}},authentication:jimu_core.Cvv.getInstance().getMainSession()}).then((()=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)}))),(error=>__awaiter(this,void 0,void 0,(function*(){return console.error(error),yield Promise.reject(new Error(error))}))))}))}function updateAppConfigOfNewItem(newAppId_1,originalAppInfo_1){return __awaiter(this,arguments,void 0,(function*(newAppId,originalAppInfo,useDraftConfig=!1,updateAppConfigVersion=!1,isRemoveFaviconInConfig=!1){return(useDraftConfig?(0,rest_service.Ts)(originalAppInfo):getPublishedAppConfig(originalAppInfo)).then((data=>__awaiter(this,void 0,void 0,(function*(){return yield function replaceConfigWithNewAppID(newAppId,originalAppId,config){return __awaiter(this,void 0,void 0,(function*(){const portalUrlPrefix=(0,portal_util.Ld)(originalAppId)+originalAppId+"/resources/",isPortalResourceExp=new RegExp("^"+portalUrlPrefix);function isPortalResources(value){return isPortalResourceExp.test(value)}function matchHandle(value){return value.replace("/"+originalAppId+"/","/"+newAppId+"/")}const replaceOperator={matcher:isPortalResources,handler:matchHandle};return Promise.resolve(jimu_core.WpD.replaceStringInObject(config,replaceOperator))}))}(newAppId,originalAppInfo.id,data).then((newData=>__awaiter(this,void 0,void 0,(function*(){var _a,_b;let newConfigData=function initAppConfigPortalUrl(appConfig,originalAppInfo){var _a;const portalUrl=(0,jimu_core.Vp3)().getState().portalUrl;appConfig.attributes&&(appConfig.attributes.portalUrl=portalUrl);const dataSources=null==appConfig?void 0:appConfig.dataSources;if(dataSources&&(0,portal_util.bl)(originalAppInfo))for(const key in dataSources){isUpdateDataSourcesPortalUrl(null===(_a=dataSources[key])||void 0===_a?void 0:_a.portalUrl)&&(dataSources[key].portalUrl=portalUrl)}return appConfig}(newData,originalAppInfo);newConfigData.template=null==originalAppInfo?void 0:originalAppInfo.id,delete newConfigData.appProxies,delete newConfigData.historyLabels,updateAppConfigVersion&&(newConfigData=null===(_a=replaceExbVersionInAppConfig((0,jimu_core.J3Z)(newConfigData)))||void 0===_a?void 0:_a.asMutable({deep:!0})),isRemoveFaviconInConfig&&(null===(_b=null==newConfigData?void 0:newConfigData.attributes)||void 0===_b?void 0:_b.favicon)&&delete newConfigData.attributes.favicon;const utcTimeStamp=(new Date).getTime();if(newConfigData.timestamp=`${utcTimeStamp}`,(null==data?void 0:data.__not_publish)&&!useDraftConfig)return yield Promise.reject(new Error("This item is not published"));const session=jimu_core.Cvv.getInstance().getMainSession(),owner=null==session?void 0:session.username;return jimu_core.SRz.getModuleSync("jimu-for-builder").AppResourceManager.getInstance().upLoadAppConfig(newAppId,newConfigData,owner).then((()=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(newAppId)}))),(error=>__awaiter(this,void 0,void 0,(function*(){return console.error(error),yield Promise.reject(new Error(error))}))))}))))}))),(err=>__awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Resource does not exist or is inaccessible"))}))))}))}function updateThumbnail(newAppId,originalAppInfo,thumbnail){return __awaiter(this,void 0,void 0,(function*(){const portalUrl=window.jimuConfig.isDevEdition?"localhost:":(0,jimu_core.Vp3)().getState().portalUrl,session=(0,portal_util.Ht)({portalUrl}),originalAppSession=(0,portal_util.Ht)(originalAppInfo);if(thumbnail){const portalThumbnailUrl=`${(0,portal_util.Ld)(originalAppInfo)}${originalAppInfo.id}/info/${thumbnail}?token=${null==originalAppSession?void 0:originalAppSession.token}`,devThumbnailUrl=`${(0,portal_util.Ld)(originalAppInfo)}${originalAppInfo.id}/${thumbnail}`;let thumbnailUrl;return thumbnailUrl=(null==thumbnail?void 0:thumbnail.startsWith("blob:"))?thumbnail:(null==thumbnail?void 0:thumbnail.includes("http"))?`${thumbnail}?token=${null==originalAppSession?void 0:originalAppSession.token}`:(0,portal_util.mT)(originalAppInfo)?portalThumbnailUrl:devThumbnailUrl,yield new Promise((function(resolve,reject){const xhr=new XMLHttpRequest;xhr.open("GET",thumbnailUrl,!0),xhr.responseType="blob",xhr.onload=function(e){if(200===this.status){const blob=this.response;return updateAppThumbnail({id:newAppId,thumbnail:blob,f:"json",token:null==session?void 0:session.token}).then((()=>{resolve(!0)}),(()=>{reject(!1)}))}reject(!1)},xhr.onerror=function(e){reject(new Error(null))},xhr.send()}))}return Promise.resolve(!0)}))}function getNewTypeKeywordsWhenSaveApp(appInfo,updateVersion=!1){let isHavePublishStatus=!1,typeKeywords=appInfo.typeKeywords||[];const currentPublishStatus=util_getPublishStatus(appInfo);if(typeKeywords=typeKeywords.map((el=>(el.includes("status:")&&(isHavePublishStatus=!0),el.includes("status:")&&currentPublishStatus!==service_type.qD.Draft?`status: ${service_type.qD.Changed}`:el.includes("version:")&&updateVersion?`version:${jimu_core.rEp}`:el))),!isHavePublishStatus){const keywords=`status: ${service_type.qD.Draft}`;typeKeywords.push(keywords)}return typeKeywords}function util_getPublishStatus(appItem){let publishStatus;return((null==appItem?void 0:appItem.typeKeywords)||[]).forEach((el=>{if(el.includes("status:")){switch(el.split(": ")[1]){case service_type.qD.Published:publishStatus=service_type.qD.Published;break;case service_type.qD.Changed:publishStatus=service_type.qD.Changed;break;case service_type.qD.Draft:publishStatus=service_type.qD.Draft}}})),publishStatus}function initTypeKeywordsOfNewItem(typeKeywords,newAppType,isUpdateVersion=!1){const itemVersion=`version:${jimu_core.rEp}`,isAddSimpleMode=window.isExpressBuilder&&!(null==typeKeywords?void 0:typeKeywords.includes(TYPE_KEYWORDS_OF_EXPRESS_APP));if(!typeKeywords||0===typeKeywords.length){const defaultTypeKeywords=["EXB Experience","Ready To Use","JavaScript","status: Draft",itemVersion];return isAddSimpleMode&&defaultTypeKeywords.push(TYPE_KEYWORDS_OF_EXPRESS_APP),defaultTypeKeywords}let isHasStatus=!1,isHasVersion=!1,newTypeKeywords=typeKeywords.map((el=>isUpdateVersion&&el.includes("version:")?(isHasVersion=!0,`version:${jimu_core.rEp}`):(el.includes("version:")&&(isHasVersion=!0),!newAppType||el!==service_type.uC.ExperienceType&&el!==service_type.uC.TemplateType?el.includes("status:")?(isHasStatus=!0,"status: Draft"):el:newAppType)));return newTypeKeywords=newTypeKeywords.filter((el=>!el.includes("publishVersion:")&&!el.includes("Registered App")&&!el.includes("App Proxy"))),!isHasStatus&&newTypeKeywords.push("status: Draft"),!isHasVersion&&newTypeKeywords.push(itemVersion),isAddSimpleMode&&newTypeKeywords.push(TYPE_KEYWORDS_OF_EXPRESS_APP),newTypeKeywords=Array.from(new Set(newTypeKeywords)),newTypeKeywords}function optimizeWidgetsConfig(appConfig,appInfo){return Object.values(appConfig.widgets).forEach((json=>{"widgets/common/text/"===json.uri&&function optimizeTextWidgetConfig(config,appInfo){const isTemplate=appInfo.type===service_type.uC.TemplateType;if(isTemplate)return config;isBlankRichText(null==config?void 0:config.text)||delete config.placeholder;return config}(json.config,appInfo)})),appConfig}function replaceExbVersionInAppConfig(appConfig){var _a;if(!appConfig)return null;jimu_core.hOv.lt(jimu_core.rEp,null==appConfig?void 0:appConfig.exbVersion)&&(appConfig=appConfig.set("exbVersion",jimu_core.rEp));const widgets=(null===(_a=(0,jimu_core.Vp3)().getState().appStateInBuilder)||void 0===_a?void 0:_a.appConfig).widgets||{};return Object.keys(widgets).forEach((widgetId=>{var _a,_b,_c;const widgetVersion=null===(_b=null===(_a=widgets[widgetId])||void 0===_a?void 0:_a.manifest)||void 0===_b?void 0:_b.version;if(widgetVersion&&jimu_core.hOv.valid(widgetVersion)){jimu_core.hOv.lt(widgetVersion,null===(_c=widgets[widgetId])||void 0===_c?void 0:_c.version)&&(appConfig=appConfig.setIn(["widgets",widgetId,"version"],widgetVersion))}})),appConfig}function util_initAppConfigOfNewApp(appConfig){var _a,_b,_c;appConfig.attributes?appConfig.attributes.portalUrl=(0,jimu_core.Vp3)().getState().portalUrl:appConfig.attributes={portalUrl:(0,jimu_core.Vp3)().getState().portalUrl};const sharedThemeJson=null===(_b=null===(_a=(0,jimu_core.Vp3)().getState().portalSelf)||void 0===_a?void 0:_a.portalProperties)||void 0===_b?void 0:_b.sharedTheme;return appConfig.sharedThemeVariables=jimu_core.k2j.createSharedThemeVariables(sharedThemeJson),window.isExpressBuilder&&(null===(_c=null==appConfig?void 0:appConfig.forBuilderAttributes)||void 0===_c?void 0:_c.lockLayout)&&(appConfig.forBuilderAttributes.lockLayout=!1),appConfig}function getAppConfigInResources(appId){return __awaiter(this,void 0,void 0,(function*(){const sessionManager=jimu_core.Cvv.getInstance(),timestamp=(new Date).getTime();return window.jimuConfig.isDevEdition?yield window.fetch(`${window.jimuConfig.mountPath}apps/${appId}/resources/config/config.json`).then((res=>__awaiter(this,void 0,void 0,(function*(){return yield res.json()})))):yield request(`${jimu_core.zJ_.getPortalRestUrl((0,jimu_core.Vp3)().getState().portalUrl)}/content/items/${appId}/resources/config/config.json`,{authentication:sessionManager.getSessionByUrl((0,jimu_core.Vp3)().getState().portalUrl),httpMethod:"GET",params:{timestamp}}).catch((err=>__awaiter(this,void 0,void 0,(function*(){return Promise.reject(new Error(err))}))))}))}function isUpdateDataSourcesPortalUrl(dataSourcesPortalUrl){let isCanUpdate=!1;const portalUrl=(0,jimu_core.Vp3)().getState().portalUrl;return(isSamePortal(portalUrl,dataSourcesPortalUrl,"mapsdevext.arcgis.com")||isSamePortal(portalUrl,dataSourcesPortalUrl,"mapsqa.arcgis.com")||isSamePortal(portalUrl,dataSourcesPortalUrl,"maps.arcgis.com"))&&(isCanUpdate=!0),isCanUpdate}function cloneObj(obj){const result={};return Object.keys(obj).forEach((id=>{result[id]=Object.assign({},obj[id])})),result}function getSessionBySearchType(searchType){let session;const portalUrl=(0,jimu_core.Vp3)().getState().portalUrl,portalSession=jimu_core.Cvv.getInstance().getMainSession(),isAGOLDomain=jimu_core.zJ_.isAGOLDomain(portalUrl);switch(searchType){case service_type.nX.Portal:session=portalSession;break;case service_type.nX.AGOL:session=isAGOLDomain?portalSession:{};break;case service_type.nX.Other:session=window.jimuConfig.isDevEdition?{}:portalSession}return session}function getNewTypeKeywordsForTransferApp(typeKeywords=[]){return(null==typeKeywords?void 0:typeKeywords.includes(TYPE_KEYWORDS_OF_EXPRESS_APP))&&(typeKeywords=null==typeKeywords?void 0:typeKeywords.filter((keywords=>keywords!==TYPE_KEYWORDS_OF_EXPRESS_APP))),typeKeywords}function removeNonExistIds(appConfig,type){const his=appConfig.historyLabels;Object.keys(his[type]||{}).forEach((hisId=>{var _a;(null===(_a=appConfig[type])||void 0===_a?void 0:_a[hisId])||delete his[type][hisId]}))}function addHisLabels(draftAppConfig,publishedAppConfig,type){const draftObj=draftAppConfig[type],publishedObj=publishedAppConfig[type];draftObj&&publishedObj&&Object.keys(draftObj).forEach((id=>{var _a,_b;const hisLabels=(null===(_b=null===(_a=publishedAppConfig.historyLabels)||void 0===_a?void 0:_a[type])||void 0===_b?void 0:_b[id])||[];publishedObj[id]&&draftObj[id].label!==publishedObj[id].label&&(hisLabels.includes(publishedObj[id].label)||hisLabels.push(publishedObj[id].label)),hisLabels.length>0&&(draftAppConfig.historyLabels?draftAppConfig.historyLabels[type]?draftAppConfig.historyLabels[type][id]=hisLabels:draftAppConfig.historyLabels[type]={[id]:hisLabels}:draftAppConfig.historyLabels={[type]:{[id]:hisLabels}})}))}const HTML_TAG_REGEXP=/<[^>]*>/g,isBlankRichText=html=>{if(!html)return!0;if("<p></p>"===html||"<p><br></p>"===html)return!0;let plainText="";return plainText=html.includes("<")?function replaceHtml(html){let previous;do{previous=html,html=html.replace(HTML_TAG_REGEXP,"")}while(html!==previous);return html}(html):html,plainText=null==plainText?void 0:plainText.trim(),!plainText};function getAppName(name,appList,index=1,isCopy=!1){const appName=1===index&&isCopy?name:`${name} ${index}`;if(!function isAppNameRepeat(name,appList){let isHasName=!1;return appList.forEach((el=>{name===el.title&&(isHasName=!0)})),isHasName}(appName,appList))return appName;return getAppName(name,appList,index+1)}function isSamePortal(portalUrl,dataSourcesPortalUrl,urlEndString){return((null==portalUrl?void 0:portalUrl.endsWith(urlEndString))||(null==portalUrl?void 0:portalUrl.endsWith(`${urlEndString}/`)))&&((null==dataSourcesPortalUrl?void 0:dataSourcesPortalUrl.endsWith(urlEndString))||(null==dataSourcesPortalUrl?void 0:dataSourcesPortalUrl.endsWith(`${urlEndString}/`)))}var templates=__webpack_require__("../jimu-for-builder/templates.ts"),customize_copy_app_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};function crateAppByApp(option){return customize_copy_app_awaiter(this,void 0,void 0,(function*(){const{originalAppInfo,useDraftConfig,updateAppConfigVersion,isRemoveFaviconInConfig,folderId}=option;return getAppInfo(originalAppInfo).then((appItem=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){if(appItem){const type=(null==option?void 0:option.type)||service_type.uC.ExperienceType;return getNewAppTitleWithIndex(appItem.title).then((newTitle=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){if(newTitle){return function createAppWithNewAppInfo(appInfo,folderId,isUpdateVersion,type){return customize_copy_app_awaiter(this,void 0,void 0,(function*(){const typeOfNewItem=type||appInfo.type||"Web Experience";return createApp({title:appInfo.name,type:typeOfNewItem,typeKeywords:initTypeKeywordsOfNewItem(null==appInfo?void 0:appInfo.typeKeywords,typeOfNewItem,isUpdateVersion),snippet:(null==appInfo?void 0:appInfo.snippet)||"",description:(null==appInfo?void 0:appInfo.description)||"",tags:appInfo.tags,thumbnail:appInfo.thumbnail},folderId)}))}({name:newTitle,tags:appItem.tags,thumbnail:appItem.thumbnail,type,typeKeywords:null==originalAppInfo?void 0:originalAppInfo.typeKeywords},folderId).then((newAppItem=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){if(newAppItem){return function duplicateResourcesAndInitItemData(options){return customize_copy_app_awaiter(this,void 0,void 0,(function*(){const{newAppId}=options;return updateItemDataInApp(newAppId).then((result=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){return result?function duplicateResourcesForNewItem(options){return customize_copy_app_awaiter(this,void 0,void 0,(function*(){const{newAppId,originalAppInfo,useDraftConfig,updateAppConfigVersion,isRemoveFaviconInConfig}=options;return updateAppConfigOfNewItem(newAppId,originalAppInfo,useDraftConfig,updateAppConfigVersion,isRemoveFaviconInConfig).then((res=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){return function duplicateResourcesInApp(newAppId,originalAppInfo){return customize_copy_app_awaiter(this,void 0,void 0,(function*(){const session=(0,portal_util.Ht)(originalAppInfo);return(0,rest_service.JA)(originalAppInfo,{authentication:session}).then((resourceResults=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){const resourcePromises=[],portalResources=resourceResults&&resourceResults.resources;if(portalResources)for(let i=0;i<portalResources.length;i++){"config/config.json"===portalResources[i].resource||resourcePromises.push(uploadResources(newAppId,originalAppInfo,portalResources[i]))}return Promise.all(resourcePromises)}))),(err=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){return Promise.resolve(null)}))))}))}(newAppId,originalAppInfo).then((resourceResult=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){return resourceResult?Promise.resolve(!0):Promise.reject(new Error("Resource does not exist or is inaccessible"))}))),(err=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){return Promise.reject(new Error(err))}))))}))))}))}(options):Promise.reject(new Error(null))}))),(err=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){return Promise.reject(new Error(err))}))))}))}({newAppId:newAppItem.id,originalAppInfo,useDraftConfig,updateAppConfigVersion,isRemoveFaviconInConfig}).then((()=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){return Promise.resolve(newAppItem.id)}))),(error=>customize_copy_app_awaiter(this,void 0,void 0,(function*(){return console.error(error),deleteApp(newAppItem.id),Promise.reject(new Error(error))}))))}return Promise.reject(new Error(null))}))))}return Promise.reject(new Error(null))}))))}return Promise.reject(new Error(null))}))))}))}function uploadResources(newAppId,originalAppInfo,resourceInfo){return customize_copy_app_awaiter(this,void 0,void 0,(function*(){const originalAppSession=(0,portal_util.Ht)(originalAppInfo),token=(0,portal_util.mT)(originalAppInfo)?`?token=${null==originalAppSession?void 0:originalAppSession.token}`:"",portalUrlPrefix=`${(0,portal_util.Ld)(originalAppInfo)}${originalAppInfo.id}/resources/`,portalUrl=window.jimuConfig.isDevEdition?"localhost:":(0,jimu_core.Vp3)().getState().portalUrl,session=(0,portal_util.Ht)({portalUrl}),resourceUrl=portalUrlPrefix+resourceInfo.resource+token;return yield new Promise((function(resolve,reject){const xhr=new XMLHttpRequest;xhr.open("GET",resourceUrl,!0),xhr.responseType="blob",xhr.onload=function(e){if(200===this.status){const blob=this.response;return(0,rest_service.zk)({id:newAppId,resource:blob,name:resourceInfo.resource.split("/")[resourceInfo.resource.split("/").length-1],params:{resourcesPrefix:resourceInfo.resource.split("/").slice(0,resourceInfo.resource.split("/").length-1).join("/")},authentication:session}).then((()=>{resolve(!0)}),(()=>{resolve(!1)}))}resolve(!1)},xhr.onerror=function(e){resolve(!1)},xhr.send()}))}))}var create_app_or_template_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};function createAppByItemTemplateInfo(appInfo,folderId){return create_app_or_template_awaiter(this,void 0,void 0,(function*(){return crateAppByApp({originalAppInfo:appInfo,useDraftConfig:!1,updateAppConfigVersion:!1,isRemoveFaviconInConfig:!0,folderId,type:service_type.uC.ExperienceType})}))}function createAppByItemTemplateId(templateId){return create_app_or_template_awaiter(this,void 0,void 0,(function*(){return yield getCreateAppParamsByAppId(templateId).then((appInfo=>create_app_or_template_awaiter(this,void 0,void 0,(function*(){return yield createAppByItemTemplateInfo(appInfo)}))))}))}function createAppByDefaultTemplate(title,templateName,folderId,webmapId,websceneId){return create_app_or_template_awaiter(this,void 0,void 0,(function*(){return yield getNewAppTitleWithIndex(title).then((newTitle=>create_app_or_template_awaiter(this,void 0,void 0,(function*(){if(newTitle){const appInfo={template:templateName,name:newTitle,description:"",type:service_type.uC.ExperienceType};return yield Promise.all([getDefaultTemplateConfig(appInfo)]).then((function(results){return create_app_or_template_awaiter(this,void 0,void 0,(function*(){let defaultAppConfig=results[0];return defaultAppConfig.template=appInfo.template,defaultAppConfig=util_initAppConfigOfNewApp(defaultAppConfig),yield toCreateAppByDefaultTemplate(appInfo,folderId).then((item=>create_app_or_template_awaiter(this,void 0,void 0,(function*(){return yield createAppByDefaultTemplateCallBack(defaultAppConfig,item,webmapId,websceneId)}))))}))})).catch((error=>create_app_or_template_awaiter(this,void 0,void 0,(function*(){return console.error(error),yield Promise.reject(new Error(error))}))))}return yield Promise.reject(new Error(null))}))))}))}function createTemplateByApp(appInfo,folderId){return create_app_or_template_awaiter(this,void 0,void 0,(function*(){return crateAppByApp({originalAppInfo:appInfo,useDraftConfig:!0,updateAppConfigVersion:!0,isRemoveFaviconInConfig:!0,folderId,type:service_type.uC.TemplateType})}))}var app_service_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};function duplicateApp(appInfo,folderId,isNotUpdateNewAppTitle){return app_service_awaiter(this,void 0,void 0,(function*(){return yield getAppInfo(appInfo).then((appItem=>app_service_awaiter(this,void 0,void 0,(function*(){if(appItem){appItem.isLocalApp=null==appInfo?void 0:appInfo.isLocalApp;const copy=jimu_core.Ruy.getIntl().formatMessage({id:"copy"})||"copy",title=isNotUpdateNewAppTitle?appItem.title:`${appItem.title} ${copy}`;return copyAppByAPI({originAppInfo:appItem,folder:folderId,title,newAppType:appItem.type,isDuplicateApp:!0,updateAppVersion:!1,useDraftConfig:!0,removeFaviconInConfig:!1,deleteThumbnail:!1,retainsAppSummary:!0}).then((itemId=>Promise.resolve(itemId)))}return yield Promise.reject(new Error(null))}))))}))}function transferAppToFullMode(params){return app_service_awaiter(this,void 0,void 0,(function*(){return(null==params?void 0:params.transferDirectly)?function transferAppToFullModeDirectly(appInfo){return __awaiter(this,void 0,void 0,(function*(){const typeKeywords=getNewTypeKeywordsForTransferApp(null==appInfo?void 0:appInfo.typeKeywords);return appInfo.typeKeywords=typeKeywords,updateAppInfo(Object.assign(Object.assign({},appInfo),{thumbnailurl:void 0})).then((res=>Promise.resolve({appInfo})))}))}(params.appInfo):function transferAppToNewFullModeApp(params){return __awaiter(this,void 0,void 0,(function*(){const originAppInfo=params.appInfo;return duplicateApp(originAppInfo,null,!0).then((newItemId=>getAppInfo({id:newItemId}).then((appInfo=>__awaiter(this,void 0,void 0,(function*(){const newAppInfo=appInfo,typeKeywords=getNewTypeKeywordsForTransferApp(null==newAppInfo?void 0:newAppInfo.typeKeywords);return newAppInfo.typeKeywords=typeKeywords,newAppInfo.snippet=null==originAppInfo?void 0:originAppInfo.snippet,updateAppInfo({id:newItemId,typeKeywords}).then((updateRes=>({id:newItemId,appInfo:newAppInfo})))}))))))}))}(params)}))}function importAppFromZip(importAppOption){return app_service_awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession();return yield(0,rest_service.SH)(importAppOption,{authentication:session})}))}function checkImportAppVersion(importAppOption){return app_service_awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession();return yield(0,rest_service.A)(importAppOption,{authentication:session})}))}function importAppFromPortal(portalAppInfo){return app_service_awaiter(this,void 0,void 0,(function*(){return crateAppByApp({originalAppInfo:portalAppInfo,useDraftConfig:!0,updateAppConfigVersion:!1,isRemoveFaviconInConfig:!0,type:portalAppInfo.type})}))}function saveApp(appInfo,appConfig,updatePublishStatus,newAppId){return app_service_awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession(),AppResourceManager=jimu_core.SRz.getModuleSync("jimu-for-builder").AppResourceManager,appConfigUtilsForBuilder=jimu_core.SRz.getModuleSync("jimu-for-builder").appConfigUtils,exts=jimu_core.nH3.getInstance().getExtensions(jimu_core.vZE.R6.BuilderOperations).sort(((a,b)=>(a.index||0)-(b.index||0)));for(const ext of exts)if(ext.beforeSave)try{appConfig=yield ext.beforeSave(appConfig)}catch(error){return console.error("Invoke beforeSave error.",error),Promise.reject(new Error(error))}const owners=(null==appInfo?void 0:appInfo.owner)||session.username,config=Object.assign({},appConfigUtilsForBuilder.getCleanAppConfig(appConfig)),appResourceManagerInstance=AppResourceManager.getInstance();if(config)try{yield appResourceManagerInstance.upLoadAppConfig(appInfo.id,config,owners);const promises=[],{imageResources,iconResources}=appResourceManagerInstance.getResourcesInDraft();if(imageResources&&promises.push(appResourceManagerInstance.upLoadImageResourceList(cloneObj(imageResources),newAppId)),iconResources&&promises.push(appResourceManagerInstance.upLoadIconResourceList(cloneObj(iconResources),newAppId)),updatePublishStatus){const newTypeKeywords=getNewTypeKeywordsWhenSaveApp(appInfo,!0);appInfo.typeKeywords=newTypeKeywords}!newAppId&&promises.push(updateAppInfoWhenSaveApp(appInfo)),yield Promise.all(promises)}catch(error){yield Promise.reject(new Error(error))}else yield Promise.reject(new Error(null))}))}function saveAsApp(originAppInfo,appInfoItemForNewApp,folderId,thumbnailFiles,unlockLayout){return app_service_awaiter(this,void 0,void 0,(function*(){return copyAppByAPI({originAppInfo,folder:folderId,title:appInfoItemForNewApp.title,name:appInfoItemForNewApp.title,updateAppVersion:!0,useDraftConfig:!0,removeFaviconInConfig:!1,appInfoItemForNewApp}).then((itemId=>{const session=jimu_core.Cvv.getInstance().getMainSession();return(0,rest_service.Gq)({id:itemId},{authentication:session}).then((newAppInfo=>app_service_awaiter(this,void 0,void 0,(function*(){return function updateThumbnailForSaveAsApp(originAppInfo,newAppInfo,thumbnailFiles){return __awaiter(this,void 0,void 0,(function*(){if(!thumbnailFiles)return yield updateThumbnail(newAppInfo.id,originAppInfo,(null==originAppInfo?void 0:originAppInfo.thumbnailurl)||originAppInfo.thumbnail);{const session=jimu_core.Cvv.getInstance().getMainSession(),localAppItem={id:newAppInfo.id,f:"json",token:null==session?void 0:session.token,thumbnail:thumbnailFiles};yield updateAppThumbnail(localAppItem,newAppInfo.owner)}}))}(originAppInfo,newAppInfo,thumbnailFiles).then((()=>app_service_awaiter(this,void 0,void 0,(function*(){var _a;let newAppConfig=(0,jimu_core.Vp3)().getState().appStateInBuilder.appConfig;newAppConfig=replaceExbVersionInAppConfig(newAppConfig);const config=null==newAppConfig?void 0:newAppConfig.asMutable({deep:!0});return delete config.appProxies,delete config.historyLabels,unlockLayout&&(null===(_a=null==config?void 0:config.forBuilderAttributes)||void 0===_a?void 0:_a.lockLayout)&&(config.forBuilderAttributes.lockLayout=!1),saveApp(newAppInfo,(0,jimu_core.J3Z)(config),!1,itemId).then((()=>app_service_awaiter(this,void 0,void 0,(function*(){return getAppConfigInResources(itemId).then((config=>app_service_awaiter(this,void 0,void 0,(function*(){return"/"===folderId&&folderId!==newAppInfo.ownerFolder&&newAppInfo.ownerFolder?changeAppFolder({itemId,folderId:"/",authentication:null}).then((res=>Promise.resolve({id:itemId,appConfig:config,appInfo:newAppInfo}))):Promise.resolve({id:itemId,appConfig:config,appInfo:newAppInfo})}))))}))),(error=>(console.error(error),deleteApp(itemId),Promise.reject(new Error(error)))))}))))}))),(err=>Promise.reject(new Error(err))))}))}))}function getPublishedAppConfig(appInfo){return app_service_awaiter(this,void 0,void 0,(function*(){const session=(0,portal_util.Ht)(appInfo);return yield(0,rest_service.MB)(appInfo,{authentication:session}).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))),(error=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(error))}))))}))}function getDraftAppConfig(appInfo){return app_service_awaiter(this,void 0,void 0,(function*(){return yield(0,rest_service.Ts)(appInfo).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))),(error=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(error))}))))}))}function getDefaultTemplateConfig(appInfo){return app_service_awaiter(this,void 0,void 0,(function*(){return(0,templates.getTemplateConfig)(templates.TemplateType.App,appInfo.template)}))}function searchApp(searchOption,searchType){return app_service_awaiter(this,void 0,void 0,(function*(){const session=getSessionBySearchType(searchType);return yield(0,rest_service.Ds)(Object.assign(Object.assign({},searchOption),{authentication:session}),searchType).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))))}))}function searchAppByPortalUrl(searchOption,portalUrl){return app_service_awaiter(this,void 0,void 0,(function*(){const currentPortalUrl=(0,jimu_core.Vp3)().getState().portalUrl;if(portalUrl===currentPortalUrl){const session=getSessionBySearchType(service_type.nX.Portal);searchOption.authentication=session}return yield(0,rest_service.x0)(searchOption,portalUrl).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))))}))}function getGroupCategorySchema(groupId,isGetAGOLCategorySchema){return app_service_awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession();return yield(0,rest_service.rd)(groupId,{authentication:session},isGetAGOLCategorySchema).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))))}))}function getOrgCategorySchema(isGetAGOLCategorySchema){return app_service_awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession();return yield(0,rest_service.Ou)({authentication:session},isGetAGOLCategorySchema).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))))}))}function getGroupContent(groupId,params,isGetAGOLGroupContent){return app_service_awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession();return yield(0,rest_service.my)(groupId,{params,authentication:session},isGetAGOLGroupContent).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))))}))}function getFolders(requestOption){return app_service_awaiter(this,void 0,void 0,(function*(){return(0,rest_service.rt)(requestOption).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){const folders=(null==result?void 0:result.folders)||[];return yield Promise.resolve(folders)}))),(error=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(error))}))))}))}function getUserTags(username){return app_service_awaiter(this,void 0,void 0,(function*(){return yield(0,rest_service.c9)({username,authentication:jimu_core.Cvv.getInstance().getMainSession()})}))}function searchGroups(requestOptions){return app_service_awaiter(this,void 0,void 0,(function*(){return yield(0,rest_service.Co)(requestOptions)}))}function getAppInfo(appInfo){return app_service_awaiter(this,void 0,void 0,(function*(){const session=(0,portal_util.Ht)(appInfo);return yield(0,rest_service.Gq)(appInfo,{authentication:session}).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))))}))}function getAppGroups(params){return app_service_awaiter(this,void 0,void 0,(function*(){return yield(0,rest_service.z7)(params).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))))}))}function updateAppInfo(itemParam){return app_service_awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession(),portalUrl=window.jimuConfig.isDevEdition?"localhost:":(0,jimu_core.Vp3)().getState().portalUrl,getAppInfoParams={id:itemParam.id,portalUrl};return yield(0,rest_service.Gq)(getAppInfoParams,{authentication:session}).then((res=>app_service_awaiter(this,void 0,void 0,(function*(){return yield(0,rest_service.fk)({item:itemParam,owner:res.owner,authentication:session}).then((()=>null))}))))}))}function updateAppInfoWhenSaveApp(appInfo){return app_service_awaiter(this,void 0,void 0,(function*(){return updateAppInfo(Object.assign(Object.assign({},appInfo),{thumbnailurl:void 0})).then((res=>{var _a;const thumbnailUrl=null==appInfo?void 0:appInfo.thumbnailurl,saveThumbnailUrl=null===(_a=(0,jimu_core.Vp3)().getState().appRuntimeInfo)||void 0===_a?void 0:_a.saveThumbnailUrl;return thumbnailUrl&&thumbnailUrl!==saveThumbnailUrl?((0,jimu_core.Vp3)().dispatch(jimu_core.tRc.saveThumbnailUrl(thumbnailUrl)),updateThumbnail(appInfo.id,appInfo,thumbnailUrl)):Promise.resolve(!0)})).catch((err=>Promise.reject(new Error("Update appInfo error"))))}))}function updateAppThumbnail(itemParam_1){return app_service_awaiter(this,arguments,void 0,(function*(itemParam,owner=""){const session=jimu_core.Cvv.getInstance().getMainSession();return yield(0,rest_service.EV)({item:itemParam,authentication:session,owner}).then((()=>null))}))}function addToFavorites(params){return app_service_awaiter(this,void 0,void 0,(function*(){return yield(0,rest_service.YG)(params).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))))}))}function removeFromFavorites(params){return app_service_awaiter(this,void 0,void 0,(function*(){return yield(0,rest_service.Bq)(params).then((result=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(result)}))))}))}function changeAppFolder(params){return app_service_awaiter(this,void 0,void 0,(function*(){return yield(0,rest_service.Pe)(Object.assign(Object.assign({},params),{authentication:jimu_core.Cvv.getInstance().getMainSession()}))}))}function deleteApp(appId){return app_service_awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession();return yield(0,rest_service.Gq)({id:appId},{authentication:session}).then((res=>app_service_awaiter(this,void 0,void 0,(function*(){return yield(0,rest_service.Ai)({id:appId,owner:res.owner,authentication:jimu_core.Cvv.getInstance().getMainSession()})}))))}))}function publishApp(appInfo){return app_service_awaiter(this,void 0,void 0,(function*(){const draftAppConfig=yield getAppConfigInResources(appInfo.id);let publishedAppConfig=yield getPublishedAppConfig(appInfo);const session=jimu_core.Cvv.getInstance().getMainSession();if(draftAppConfig&&publishedAppConfig){const exts=jimu_core.nH3.getInstance().getExtensions(jimu_core.vZE.R6.BuilderOperations).sort(((a,b)=>(a.index||0)-(b.index||0)));for(const ext of exts)if(ext.beforePublish)try{publishedAppConfig=yield ext.beforePublish(publishedAppConfig)}catch(error){return console.error("Invoke beforePublish error.",error),Promise.reject(new Error(error))}const newTypeKeywords=function updateTypeKeywords(typeKeywords,appConfigVersion){let isHavePublishStatus=!1,haveUpdatePublishVersion=!1;const newTypeKeywords=typeKeywords.map((el=>el.includes("status:")?(isHavePublishStatus=!0,`status: ${service_type.qD.Published}`):el.includes("publishVersion:")&&appConfigVersion?(haveUpdatePublishVersion=!0,`publishVersion:${appConfigVersion}`):el));if(!isHavePublishStatus){const keywords=`status: ${service_type.qD.Published}`;newTypeKeywords.push(keywords)}return!haveUpdatePublishVersion&&appConfigVersion&&newTypeKeywords.push(`publishVersion:${appConfigVersion}`),newTypeKeywords}(null==appInfo?void 0:appInfo.typeKeywords,null==publishedAppConfig?void 0:publishedAppConfig.exbVersion);return jimu_core.SRz.getModuleSync("jimu-for-builder").AppResourceManager.getInstance().upLoadLocalResource(draftAppConfig).then((draftAppConfig=>app_service_awaiter(this,void 0,void 0,(function*(){if(!draftAppConfig)return yield Promise.reject(new Error(null));draftAppConfig=function updateHistoryLabels(draftAppConfig,publishedAppConfig){return publishedAppConfig.__not_publish||(draftAppConfig.historyLabels&&(removeNonExistIds(draftAppConfig,"pages"),removeNonExistIds(draftAppConfig,"views"),removeNonExistIds(draftAppConfig,"dialogs")),addHisLabels(draftAppConfig,publishedAppConfig,"pages"),addHisLabels(draftAppConfig,publishedAppConfig,"views"),addHisLabels(draftAppConfig,publishedAppConfig,"dialogs")),draftAppConfig}(draftAppConfig=optimizeWidgetsConfig(draftAppConfig,appInfo),publishedAppConfig);const timeStamp=(new Date).getTime();draftAppConfig.publishTimestamp=timeStamp;const previewUrl=function getPreviewUrl(appInfo){const{type,id}=appInfo;return window.jimuConfig.isDevEdition?null:jimu_core.v6q.getAppUrl({id,type:type===service_type.uC.TemplateType?"template":"app",target:"current_portal",isFullUrl:!0})}(appInfo);return yield(0,rest_service.fk)({item:{id:appInfo.id,owner:appInfo.owner||(null==session?void 0:session.username),text:draftAppConfig,typeKeywords:newTypeKeywords,url:previewUrl},authentication:jimu_core.Cvv.getInstance().getMainSession()}).then((()=>app_service_awaiter(this,void 0,void 0,(function*(){const newAppInfo=Object.assign(Object.assign({},appInfo),{typeKeywords:newTypeKeywords});return Promise.resolve(newAppInfo)}))),(()=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(null))}))))}))),(()=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(null))})))).catch((error=>app_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(error))}))))}yield Promise.reject(new Error(null))}))}var user_service_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const user_service_request=jimu_core._2M.restRequest.request;var RequestType;let initUserResourcePromise,userResourceName;function requestUrlProvider(type,resourceName){return user_service_awaiter(this,void 0,void 0,(function*(){const session=jimu_core.Cvv.getInstance().getMainSession(),{username}=session,portalUrl=(0,jimu_core.Vp3)().getState().portalUrl,portalUserUrl=jimu_core.zJ_.getBaseUserUrl(portalUrl),token=yield TokenManager.getInstance().getToken();let requestUrl;switch(resourceName=null!=resourceName?resourceName:getResourceName(),type){case RequestType.Add:requestUrl=portalUserUrl+"/"+username+"/addResource/?token="+token;break;case RequestType.Remove:requestUrl=portalUserUrl+"/"+username+"/removeResource/?token="+token;break;case RequestType.Get:requestUrl=portalUserUrl+"/"+username+"/resources/"+resourceName+"?token="+token;break;case RequestType.GetAll:requestUrl=portalUserUrl+"/"+username+"/resources/?token="+token}return yield Promise.resolve(requestUrl)}))}function addUserResource(params,resourceName){return user_service_awaiter(this,void 0,void 0,(function*(){resourceName=null!=resourceName?resourceName:getResourceName();const requestOptions={httpMethod:"POST",params:Object.assign(Object.assign({},params),{key:resourceName,access:"UserPrivateAllApps"})};return yield requestUrlProvider(RequestType.Add).then((requestURL=>user_service_awaiter(this,void 0,void 0,(function*(){return yield user_service_request(requestURL,requestOptions).then((response=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(response)}))))})))).catch((err=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed adding user resource:"+err.message))}))))}))}function getUserResource(resourceName){return user_service_awaiter(this,void 0,void 0,(function*(){return resourceName=null!=resourceName?resourceName:getResourceName(),yield requestUrlProvider(RequestType.Get,resourceName).then((requestURL=>user_service_awaiter(this,void 0,void 0,(function*(){return yield user_service_request(requestURL,{params:{f:"json"}}).then((response=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(response)}))))})))).catch((err=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed retrieving user resource:"+err.message))}))))}))}function getUserResources(){return user_service_awaiter(this,void 0,void 0,(function*(){return yield requestUrlProvider(RequestType.GetAll).then((requestURL=>user_service_awaiter(this,void 0,void 0,(function*(){return yield user_service_request(requestURL,{params:{f:"json"}}).then((response=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(response)}))))})))).catch((err=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed retrieving user resource list:"+err.message))}))))}))}function removeUserResource(resourceName){return user_service_awaiter(this,void 0,void 0,(function*(){return resourceName=null!=resourceName?resourceName:getResourceName(),yield requestUrlProvider(RequestType.Remove).then((requestURL=>user_service_awaiter(this,void 0,void 0,(function*(){const requestOptions={params:{key:resourceName}};return yield user_service_request(requestURL,requestOptions).then((response=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(response)}))))})))).catch((err=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed removing user resource:"+err.message))}))))}))}function updateUserResource(options){return user_service_awaiter(this,void 0,void 0,(function*(){return yield getUserResource().then((result=>user_service_awaiter(this,void 0,void 0,(function*(){const newOptions=(0,jimu_core.J3Z)(null!=result?result:{}).merge(options,{deep:!0});return yield addUserResource({text:JSON.stringify(Object.assign({},newOptions))})})))).then((response=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.resolve(response)})))).catch((err=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed updating user resource:"+err.message))}))))}))}function initUserResource(){return initUserResourcePromise||(initUserResourcePromise=getUserResources().then((result=>user_service_awaiter(this,void 0,void 0,(function*(){if(0===result.total)return yield addUserResource({text:"{}"});{const userSettingResource=result.userResources[0],resourceName=getResourceName();return userSettingResource.key===resourceName?yield Promise.resolve({success:!0}):yield getUserResource(userSettingResource.key).catch((err=>null)).then((oldOptions=>user_service_awaiter(this,void 0,void 0,(function*(){return oldOptions&&(oldOptions.showGuides||0===Object.keys(oldOptions).length)?yield removeUserResource(userSettingResource.key).then((()=>user_service_awaiter(this,void 0,void 0,(function*(){return yield addUserResource({text:JSON.stringify(Object.assign({},oldOptions))})})))):yield addUserResource({text:"{}"})}))))}})))).catch((err=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed initializing user resource:"+err.message))}))))),Promise.resolve(initUserResourcePromise)}function getResourceName(){if(!userResourceName){const session=jimu_core.Cvv.getInstance().getMainSession();userResourceName=`${jimu_core.Sif}${(null==session?void 0:session.clientId)?`_${session.clientId}`:""}.json`}return userResourceName}!function(RequestType){RequestType.Add="ADD",RequestType.Remove="REMOVE",RequestType.Get="GET",RequestType.GetAll="GETALL"}(RequestType||(RequestType={}));class TokenManager{static getInstance(){return TokenManager.instance||(TokenManager.instance=new TokenManager),TokenManager.instance}constructor(){this.session=jimu_core.Cvv.getInstance().getMainSession()}_shouldExchangeToken(){return user_service_awaiter(this,void 0,void 0,(function*(){if(!this.exchangedToken||this.session.tokenExpires<new Date){if(!this.portalSelfPromise){const portalUrl=(0,jimu_core.Vp3)().getState().portalUrl;this.portalSelfPromise=user_service_request(`${portalUrl}/sharing/rest/community/self?token=${this.session.token}`).then((_a=>user_service_awaiter(this,[_a],void 0,(function*({appInfo}){return yield Promise.resolve("experienceBuilder"!==(null==appInfo?void 0:appInfo.appId))})))).catch((err=>user_service_awaiter(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(err.message))}))))}return yield this.portalSelfPromise}return yield Promise.resolve(!1)}))}_exchangeToken(){return user_service_awaiter(this,void 0,void 0,(function*(){const requestURL=(0,jimu_core.Vp3)().getState().portalUrl+"/sharing/rest/oauth2/exchangeToken",requestOptions={params:{client_id:this.session.clientId,token:this.session.token}};return yield user_service_request(requestURL,requestOptions)}))}getToken(){return user_service_awaiter(this,void 0,void 0,(function*(){var _a;return(yield this._shouldExchangeToken())?yield this._exchangeToken().catch((err=>(console.warn("Failed exchanging token. Using default token from user session."),{token:this.session.token}))).then((response=>user_service_awaiter(this,void 0,void 0,(function*(){return this.exchangedToken=null==response?void 0:response.token,yield Promise.resolve(this.exchangedToken)})))):yield Promise.resolve(null!==(_a=this.exchangedToken)&&void 0!==_a?_a:this.session.token)}))}}try{getUserResource.displayName="getUserResource",getUserResource.__docgenInfo={description:"",displayName:"getUserResource",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-for-builder/lib/service/user-service.tsx#getUserResource"]={docgenInfo:getUserResource.__docgenInfo,name:"getUserResource",path:"../jimu-for-builder/lib/service/user-service.tsx#getUserResource"})}catch(__react_docgen_typescript_loader_error){}try{removeUserResource.displayName="removeUserResource",removeUserResource.__docgenInfo={description:"",displayName:"removeUserResource",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-for-builder/lib/service/user-service.tsx#removeUserResource"]={docgenInfo:removeUserResource.__docgenInfo,name:"removeUserResource",path:"../jimu-for-builder/lib/service/user-service.tsx#removeUserResource"})}catch(__react_docgen_typescript_loader_error){}try{updateUserResource.displayName="updateUserResource",updateUserResource.__docgenInfo={description:"",displayName:"updateUserResource",props:{showGuides:{defaultValue:null,description:"",name:"showGuides",required:!1,type:{name:"{ [guideKey: string]: boolean; }"}},widgets:{defaultValue:null,description:"",name:"widgets",required:!1,type:{name:"{ [widgetKey: string]: { [itemKey: string]: boolean; }; }"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-for-builder/lib/service/user-service.tsx#updateUserResource"]={docgenInfo:updateUserResource.__docgenInfo,name:"updateUserResource",path:"../jimu-for-builder/lib/service/user-service.tsx#updateUserResource"})}catch(__react_docgen_typescript_loader_error){}try{initAppConfigOfNewApp.displayName="initAppConfigOfNewApp",initAppConfigOfNewApp.__docgenInfo={description:"",displayName:"initAppConfigOfNewApp",props:{name:{defaultValue:null,description:"Because one app can have multiple config.json, we add a name to identify the config.",name:"name",required:!0,type:{name:"string"}},template:{defaultValue:null,description:"The template that an experience created from.",name:"template",required:!0,type:{name:"string"}},mainSizeMode:{defaultValue:null,description:"User can configure an experience for multiple size modes, and the default size mode is saved here. The config user interface is not available yet.",name:"mainSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},pages:{defaultValue:null,description:"Pages within an experience",name:"pages",required:!0,type:{name:"PagesJson"}},pageStructure:{defaultValue:null,description:"The structure of pages",name:"pageStructure",required:!0,type:{name:"{ [pageId: string]: string[]; }[]"}},dialogs:{defaultValue:null,description:"Windows (dialogs) within an experience",name:"dialogs",required:!0,type:{name:"DialogsJson"}},layouts:{defaultValue:null,description:"Layouts within an experience",name:"layouts",required:!0,type:{name:"LayoutsJson"}},controllerPanels:{defaultValue:null,description:"Floating panels for controller widget",name:"controllerPanels",required:!0,type:{name:"ControllerPanelsJson"}},sections:{defaultValue:null,description:"Sections within an experience",name:"sections",required:!1,type:{name:"SectionsJson"}},views:{defaultValue:null,description:"Views within an experience",name:"views",required:!1,type:{name:"ViewsJson"}},widgets:{defaultValue:null,description:"Widgets within an experience",name:"widgets",required:!0,type:{name:"WidgetsJson"}},screenGroups:{defaultValue:null,description:"Screen groups within an experience",name:"screenGroups",required:!0,type:{name:"ScreenGroupsJson"}},screens:{defaultValue:null,description:"Screens within an experience",name:"screens",required:!0,type:{name:"ScreensJson"}},header:{defaultValue:null,description:"The header of an experience",name:"header",required:!0,type:{name:"HeaderJson"}},footer:{defaultValue:null,description:"The footer of an experience",name:"footer",required:!0,type:{name:"FooterJson"}},theme:{defaultValue:null,description:'The theme uri, should end with "/".',name:"theme",required:!0,type:{name:"string"}},sharedThemeVariables:{defaultValue:null,description:"",name:"sharedThemeVariables",required:!1,type:{name:"SharedThemeVariables"}},customTheme:{defaultValue:null,description:"",name:"customTheme",required:!1,type:{name:"Partial<ThemeVariables>"}},customThemeOptions:{defaultValue:null,description:"",name:"customThemeOptions",required:!1,type:{name:"ThemeOptions"}},dataSources:{defaultValue:null,description:"Data sources within an experience",name:"dataSources",required:!1,type:{name:"DataSourcesJson"}},utilities:{defaultValue:null,description:"",name:"utilities",required:!1,type:{name:"UtilitiesJson"}},appProxies:{defaultValue:null,description:"",name:"appProxies",required:!1,type:{name:"ProxiesJson"}},messageConfigs:{defaultValue:null,description:"The message configs of an experience",name:"messageConfigs",required:!1,type:{name:"MessagesJson"}},attributes:{defaultValue:null,description:"",name:"attributes",required:!0,type:{name:"AttributesJson"}},analytics:{defaultValue:null,description:"@ignore",name:"analytics",required:!0,type:{name:"Analytics"}},cookieBanner:{defaultValue:null,description:"",name:"cookieBanner",required:!0,type:{name:"CookieBannerJson"}},useCachedManifest:{defaultValue:null,description:"If true, will read widget's manifest from `widgetsManifest`.\nThis value is false by default",name:"useCachedManifest",required:!1,type:{name:"boolean"}},widgetsManifest:{defaultValue:null,description:"The manifest here are raw manifest, need to be processed before use.\nWe save raw manifest here to save some network requests.\n\nWhen add a widget in builder, the manifest is not saved here because we need to fetch the latest manifest to check version info.\nHowever, we can do this manually.",name:"widgetsManifest",required:!0,type:{name:"{ [widgetUri: string]: WidgetManifest; }"}},themeManifest:{defaultValue:null,description:"",name:"themeManifest",required:!1,type:{name:"ThemeManifest"}},preloadWidgets:{defaultValue:null,description:"The widgets uri in this array will be loaded when the app loads, rather than dynamically loading the widget.",name:"preloadWidgets",required:!1,type:{name:"string[]"}},exbVersion:{defaultValue:null,description:"The framework version when the experience is created/updated.\n\nWhen an old experience is opened in a new version code, this version will be set as the new code version.",name:"exbVersion",required:!0,type:{name:"string"}},originExbVersion:{defaultValue:null,description:"As the `exbVersion` will be replaced with the code version when app is launched, we save the origin version\nin config here.",name:"originExbVersion",required:!0,type:{name:"string"}},__not_publish:{defaultValue:null,description:"Only newly created experience (unpublished) configurations have this property.",name:"__not_publish",required:!0,type:{name:"boolean"}},forBuilderAttributes:{defaultValue:null,description:"These attributes are used by builder only.",name:"forBuilderAttributes",required:!0,type:{name:"ForBuilderAttributes"}},timestamp:{defaultValue:null,description:"UTC timestamp for specific app config version. It's used for app's update.",name:"timestamp",required:!0,type:{name:"string"}},publishTimestamp:{defaultValue:null,description:"This property will be set when publishing.",name:"publishTimestamp",required:!1,type:{name:"string"}},historyLabels:{defaultValue:null,description:"History labels are saved here because the labels may be used in URL.\nThis can avoid link broken.\nThis is done while publishing, which means all labels in the published app will be saved here.",name:"historyLabels",required:!0,type:{name:"HistoryLabels"}},connections:{defaultValue:null,description:"Configure multiple portal connection information",name:"connections",required:!1,type:{name:"Connection[]"}},useAutoSortInFixedLayout:{defaultValue:null,description:"Whether adjust tab order automatically in the fixed layout.",name:"useAutoSortInFixedLayout",required:!1,type:{name:"boolean"}},urlParams:{defaultValue:null,description:"",name:"urlParams",required:!1,type:{name:"UrlParamsConfig"}},placeholderInfos:{defaultValue:null,description:"",name:"placeholderInfos",required:!1,type:{name:"{ [placeholderId: string]: PlaceholderInfo; }"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-for-builder/lib/service/index.tsx#initAppConfigOfNewApp"]={docgenInfo:initAppConfigOfNewApp.__docgenInfo,name:"initAppConfigOfNewApp",path:"../jimu-for-builder/lib/service/index.tsx#initAppConfigOfNewApp"})}catch(__react_docgen_typescript_loader_error){}try{getPublishStatus.displayName="getPublishStatus",getPublishStatus.__docgenInfo={description:"",displayName:"getPublishStatus",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"Web Experience Template"'},{value:'"Web Experience"'}]}},name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!1,type:{name:"any"}},username:{defaultValue:null,description:"",name:"username",required:!1,type:{name:"string"}},thumbnail:{defaultValue:null,description:"",name:"thumbnail",required:!1,type:{name:"string"}},isLocalApp:{defaultValue:null,description:"",name:"isLocalApp",required:!1,type:{name:"boolean"}},portalUrl:{defaultValue:null,description:"",name:"portalUrl",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-for-builder/lib/service/index.tsx#getPublishStatus"]={docgenInfo:getPublishStatus.__docgenInfo,name:"getPublishStatus",path:"../jimu-for-builder/lib/service/index.tsx#getPublishStatus"})}catch(__react_docgen_typescript_loader_error){}try{getResourceOrigin.displayName="getResourceOrigin",getResourceOrigin.__docgenInfo={description:"",displayName:"getResourceOrigin",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"Web Experience Template"'},{value:'"Web Experience"'}]}},name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!1,type:{name:"any"}},username:{defaultValue:null,description:"",name:"username",required:!1,type:{name:"string"}},thumbnail:{defaultValue:null,description:"",name:"thumbnail",required:!1,type:{name:"string"}},isLocalApp:{defaultValue:null,description:"",name:"isLocalApp",required:!1,type:{name:"boolean"}},portalUrl:{defaultValue:null,description:"",name:"portalUrl",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-for-builder/lib/service/index.tsx#getResourceOrigin"]={docgenInfo:getResourceOrigin.__docgenInfo,name:"getResourceOrigin",path:"../jimu-for-builder/lib/service/index.tsx#getResourceOrigin"})}catch(__react_docgen_typescript_loader_error){}try{initAppConfigOfNewApp.displayName="initAppConfigOfNewApp",initAppConfigOfNewApp.__docgenInfo={description:"",displayName:"initAppConfigOfNewApp",props:{name:{defaultValue:null,description:"Because one app can have multiple config.json, we add a name to identify the config.",name:"name",required:!0,type:{name:"string"}},template:{defaultValue:null,description:"The template that an experience created from.",name:"template",required:!0,type:{name:"string"}},mainSizeMode:{defaultValue:null,description:"User can configure an experience for multiple size modes, and the default size mode is saved here. The config user interface is not available yet.",name:"mainSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},pages:{defaultValue:null,description:"Pages within an experience",name:"pages",required:!0,type:{name:"PagesJson"}},pageStructure:{defaultValue:null,description:"The structure of pages",name:"pageStructure",required:!0,type:{name:"{ [pageId: string]: string[]; }[]"}},dialogs:{defaultValue:null,description:"Windows (dialogs) within an experience",name:"dialogs",required:!0,type:{name:"DialogsJson"}},layouts:{defaultValue:null,description:"Layouts within an experience",name:"layouts",required:!0,type:{name:"LayoutsJson"}},controllerPanels:{defaultValue:null,description:"Floating panels for controller widget",name:"controllerPanels",required:!0,type:{name:"ControllerPanelsJson"}},sections:{defaultValue:null,description:"Sections within an experience",name:"sections",required:!1,type:{name:"SectionsJson"}},views:{defaultValue:null,description:"Views within an experience",name:"views",required:!1,type:{name:"ViewsJson"}},widgets:{defaultValue:null,description:"Widgets within an experience",name:"widgets",required:!0,type:{name:"WidgetsJson"}},screenGroups:{defaultValue:null,description:"Screen groups within an experience",name:"screenGroups",required:!0,type:{name:"ScreenGroupsJson"}},screens:{defaultValue:null,description:"Screens within an experience",name:"screens",required:!0,type:{name:"ScreensJson"}},header:{defaultValue:null,description:"The header of an experience",name:"header",required:!0,type:{name:"HeaderJson"}},footer:{defaultValue:null,description:"The footer of an experience",name:"footer",required:!0,type:{name:"FooterJson"}},theme:{defaultValue:null,description:'The theme uri, should end with "/".',name:"theme",required:!0,type:{name:"string"}},sharedThemeVariables:{defaultValue:null,description:"",name:"sharedThemeVariables",required:!1,type:{name:"SharedThemeVariables"}},customTheme:{defaultValue:null,description:"",name:"customTheme",required:!1,type:{name:"Partial<ThemeVariables>"}},customThemeOptions:{defaultValue:null,description:"",name:"customThemeOptions",required:!1,type:{name:"ThemeOptions"}},dataSources:{defaultValue:null,description:"Data sources within an experience",name:"dataSources",required:!1,type:{name:"DataSourcesJson"}},utilities:{defaultValue:null,description:"",name:"utilities",required:!1,type:{name:"UtilitiesJson"}},appProxies:{defaultValue:null,description:"",name:"appProxies",required:!1,type:{name:"ProxiesJson"}},messageConfigs:{defaultValue:null,description:"The message configs of an experience",name:"messageConfigs",required:!1,type:{name:"MessagesJson"}},attributes:{defaultValue:null,description:"",name:"attributes",required:!0,type:{name:"AttributesJson"}},analytics:{defaultValue:null,description:"@ignore",name:"analytics",required:!0,type:{name:"Analytics"}},cookieBanner:{defaultValue:null,description:"",name:"cookieBanner",required:!0,type:{name:"CookieBannerJson"}},useCachedManifest:{defaultValue:null,description:"If true, will read widget's manifest from `widgetsManifest`.\nThis value is false by default",name:"useCachedManifest",required:!1,type:{name:"boolean"}},widgetsManifest:{defaultValue:null,description:"The manifest here are raw manifest, need to be processed before use.\nWe save raw manifest here to save some network requests.\n\nWhen add a widget in builder, the manifest is not saved here because we need to fetch the latest manifest to check version info.\nHowever, we can do this manually.",name:"widgetsManifest",required:!0,type:{name:"{ [widgetUri: string]: WidgetManifest; }"}},themeManifest:{defaultValue:null,description:"",name:"themeManifest",required:!1,type:{name:"ThemeManifest"}},preloadWidgets:{defaultValue:null,description:"The widgets uri in this array will be loaded when the app loads, rather than dynamically loading the widget.",name:"preloadWidgets",required:!1,type:{name:"string[]"}},exbVersion:{defaultValue:null,description:"The framework version when the experience is created/updated.\n\nWhen an old experience is opened in a new version code, this version will be set as the new code version.",name:"exbVersion",required:!0,type:{name:"string"}},originExbVersion:{defaultValue:null,description:"As the `exbVersion` will be replaced with the code version when app is launched, we save the origin version\nin config here.",name:"originExbVersion",required:!0,type:{name:"string"}},__not_publish:{defaultValue:null,description:"Only newly created experience (unpublished) configurations have this property.",name:"__not_publish",required:!0,type:{name:"boolean"}},forBuilderAttributes:{defaultValue:null,description:"These attributes are used by builder only.",name:"forBuilderAttributes",required:!0,type:{name:"ForBuilderAttributes"}},timestamp:{defaultValue:null,description:"UTC timestamp for specific app config version. It's used for app's update.",name:"timestamp",required:!0,type:{name:"string"}},publishTimestamp:{defaultValue:null,description:"This property will be set when publishing.",name:"publishTimestamp",required:!1,type:{name:"string"}},historyLabels:{defaultValue:null,description:"History labels are saved here because the labels may be used in URL.\nThis can avoid link broken.\nThis is done while publishing, which means all labels in the published app will be saved here.",name:"historyLabels",required:!0,type:{name:"HistoryLabels"}},connections:{defaultValue:null,description:"Configure multiple portal connection information",name:"connections",required:!1,type:{name:"Connection[]"}},useAutoSortInFixedLayout:{defaultValue:null,description:"Whether adjust tab order automatically in the fixed layout.",name:"useAutoSortInFixedLayout",required:!1,type:{name:"boolean"}},urlParams:{defaultValue:null,description:"",name:"urlParams",required:!1,type:{name:"UrlParamsConfig"}},placeholderInfos:{defaultValue:null,description:"",name:"placeholderInfos",required:!1,type:{name:"{ [placeholderId: string]: PlaceholderInfo; }"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-for-builder/service.tsx#initAppConfigOfNewApp"]={docgenInfo:initAppConfigOfNewApp.__docgenInfo,name:"initAppConfigOfNewApp",path:"../jimu-for-builder/service.tsx#initAppConfigOfNewApp"})}catch(__react_docgen_typescript_loader_error){}try{getPublishStatus.displayName="getPublishStatus",getPublishStatus.__docgenInfo={description:"",displayName:"getPublishStatus",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"Web Experience Template"'},{value:'"Web Experience"'}]}},name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!1,type:{name:"any"}},username:{defaultValue:null,description:"",name:"username",required:!1,type:{name:"string"}},thumbnail:{defaultValue:null,description:"",name:"thumbnail",required:!1,type:{name:"string"}},isLocalApp:{defaultValue:null,description:"",name:"isLocalApp",required:!1,type:{name:"boolean"}},portalUrl:{defaultValue:null,description:"",name:"portalUrl",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-for-builder/service.tsx#getPublishStatus"]={docgenInfo:getPublishStatus.__docgenInfo,name:"getPublishStatus",path:"../jimu-for-builder/service.tsx#getPublishStatus"})}catch(__react_docgen_typescript_loader_error){}try{getResourceOrigin.displayName="getResourceOrigin",getResourceOrigin.__docgenInfo={description:"",displayName:"getResourceOrigin",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"Web Experience Template"'},{value:'"Web Experience"'}]}},name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!1,type:{name:"any"}},username:{defaultValue:null,description:"",name:"username",required:!1,type:{name:"string"}},thumbnail:{defaultValue:null,description:"",name:"thumbnail",required:!1,type:{name:"string"}},isLocalApp:{defaultValue:null,description:"",name:"isLocalApp",required:!1,type:{name:"boolean"}},portalUrl:{defaultValue:null,description:"",name:"portalUrl",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-for-builder/service.tsx#getResourceOrigin"]={docgenInfo:getResourceOrigin.__docgenInfo,name:"getResourceOrigin",path:"../jimu-for-builder/service.tsx#getResourceOrigin"})}catch(__react_docgen_typescript_loader_error){}}}]);