{"version":3,"file":"1623.6a5d0401.iframe.bundle.js","mappings":";AAOA;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCA;;;;AAIA;;AAEA;AACA;;;;AAIA;AACA;;;;;;;;;AASA;;;;;;;;;;;AAWA;;;;;;;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;;;AAGA;;;;;;;;;;;;AAYA;AACA;;;;;AAKA;;;;;;;;;;;;;;;;AAgBA;;AAEA;;;;;;AAMA;;;;;AAKA;;;;;AAKA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;;AAGA;;;;;;;ACxPA;;;;;;;;ACGA;;;;;;;;;;;AAYA;;;;;;;;;;;;;;;;ACHA;;;ACiLA;;;;AAIA;;;;AAIA;;;;;;;;;;AAUA;;;;;AAKA;;;;;;;;AAQA;AACA;AACA;AACA;;;;AAKA;;;;AAqDA","sources":["webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/resource-selector/styles/components/icon-viewer.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/resource-selector/styles/components/icon-picker.ts","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/resource-selector/components/image-selector/image-item.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/resource-selector/components/image-selector/image-list.tsx","webpack://arcgis-experience-builder-design-system/../jimu-ui/advanced/lib/resource-selector/components/image-selector/image-resources-panel.tsx"],"sourcesContent":["import { css } from 'jimu-core';\nexport function iconViewerStyle(props) {\n    var _a, _b;\n    const theme = props.theme;\n    const onlyMyIcons = props.groups === 'none';\n    function footerTransitionCSS(cssProps) {\n        return css `\r\n      transition-property: ${cssProps || 'all'};\r\n      transition-timing-function: ease;\r\n      transition-duration: .2s;\r\n    `;\n    }\n    return css `\r\n    width: 16.5rem;\r\n    padding: 0;\r\n    .dropdown-menu--inner {\r\n      padding-top: 0;\r\n      padding-bottom: 0;\r\n      overflow: hidden;\r\n    }\r\n    .icon-picker-viewer--selector {\r\n      padding: 4px 16px 0px;\r\n      margin-bottom: var(--sys-spacing-1);\r\n      .jimu-dropdown-button {\r\n        justify-content: flex-start;\r\n        padding-left: 0;\r\n        background: transparent;\r\n        border: transparent;\r\n      }\r\n      .jimu-dropdown-button:hover {\r\n        padding-left: 0;\r\n      }\r\n      .dropdown-button-content {\r\n        flex: none;\r\n        max-width: 232px;\r\n        overflow: hidden;\r\n      }\r\n    }\r\n    .icon-picker-viewer--content {\r\n      overflow-y: auto;\r\n      overflow-x: hidden;\r\n      position: relative;\r\n    }\r\n    .icon-picker-viewer--icons,\r\n    .icon-picker-viewer--my-icons {\r\n      ${onlyMyIcons ? 'padding: 16px;' : 'padding: 0 16px 16px;'}\r\n      .icon-picker-viewer--icon-group,\r\n      .icon-picker-viewer--my-icons-group {\r\n        .btn {\r\n          margin: 0 ${theme.sys.spacing(2)} ${theme.sys.spacing(2)} 0;\r\n          padding: 0.375rem;\r\n          background: ${theme.ref.palette.neutral[300]};\r\n          border-color: ${theme.ref.palette.neutral[300]};\r\n          &:hover,\r\n          &:not(:disabled):not(.disabled):active,\r\n          &:not(:disabled):not(.disabled).active {\r\n            border-color: ${theme.sys.color.primary.main};\r\n            background: ${theme.ref.palette.neutral[300]};\r\n          }\r\n        }\r\n      }\r\n    }\r\n    .icon-picker-viewer--icons {\r\n      .icon-picker-viewer--icon-group {\r\n        max-height: calc(60vh - 395px);\r\n        overflow: auto;\r\n        border: 1px solid ${theme.ref.palette.secondary[600]};\r\n        .icon-picker-viewer--icon-group-container {\r\n          padding: 8px 0 0 12px;\r\n        }\r\n        @media screen and (max-height: 900px) {\r\n          max-height: calc(50vh - 235px);\r\n        }\r\n      }\r\n    }\r\n    .icon-picker-viewer--my-icons {\r\n      h6 {\r\n        color: ${theme.ref.palette.neutral[1000]};\r\n        font-weight: 400;\r\n        font-size: 13px;\r\n      }\r\n      .icon-picker-viewer--my-icons-group {\r\n        max-height: 86px;\r\n        overflow: auto;\r\n        border: 1px solid ${theme.ref.palette.secondary[600]};\r\n        .icon-picker-viewer--my-icons-group-container {\r\n          padding: 8px 0 0 12px;\r\n        }\r\n      }\r\n      .btn-custom-icon-wrapper {\r\n        position: relative;\r\n        display: inline-block;\r\n        width: 30px;\r\n        height: 30px;\r\n        margin-right: 8px;\r\n        margin-bottom: 8px;\r\n        .btn-remove-resource {\r\n          display: none;\r\n          position: absolute;\r\n          top: 0;\r\n          right: 3px;\r\n          transform: translate(50%, -50%);\r\n          border-radius: 50%;\r\n          cursor: pointer;\r\n          width: 16px;\r\n          height: 16px;\r\n          margin: 0;\r\n          padding: 0;\r\n          border: 0;\r\n          .btn-remove-resource-icon {\r\n            color: ${theme.ref.palette.neutral[800]};\r\n          }\r\n          &:hover .btn-remove-resource-icon {\r\n            color: ${theme.ref.palette.neutral[1000]};\r\n          }\r\n        }\r\n        &:hover, &:focus-within {\r\n          .btn-remove-resource {\r\n            display: inline-flex;\r\n          }\r\n        }\r\n      }\r\n      .icon-uploader.btn {\r\n        display: inline-flex;\r\n        padding: 0.375rem;\r\n        border: 1px solid ${theme.ref.palette.neutral[700]};\r\n        color: ${theme.ref.palette.neutral[900]};\r\n        background: transparent;\r\n        position: relative;\r\n        width: auto !important;\r\n        &:hover {\r\n          color: ${theme.ref.palette.black};\r\n          cursor: pointer;\r\n        }\r\n        > .jimu-icon {\r\n          margin: 0;\r\n        }\r\n      }\r\n      .bottom-alert {\r\n        position: fixed;\r\n        bottom: 66px;\r\n        .alert-width {\r\n          width: calc(100% - 32px);\r\n        }\r\n      }\r\n    }\r\n    .icon-picker-viewer--preview {\r\n      border-top: 1px solid ${theme.ref.palette.neutral[600]};\r\n      margin-top: 1rem;\r\n      ${footerTransitionCSS('margin-top')}\r\n    }\r\n    .icon-picker-viewer--workshop {\r\n      .icon-preview {\r\n        opacity: 0;\r\n        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAJ0lEQVQoU2O0s7P7z4AG+Pn50YUYGIeCQl9fXwzPfPz4EdMzQ0AhAAtwISa6iOmEAAAAAElFTkSuQmCC) repeat;\r\n        padding: ${theme.sys.spacing(1)};\r\n        text-align: center;\r\n        min-height: 2rem;\r\n        width: 5.5rem;\r\n        margin-right: 0.75rem;\r\n        ${footerTransitionCSS('min-height, opacity')}\r\n      }\r\n    }\r\n    .icon-picker-settings {\r\n      opacity: 0;\r\n      ${footerTransitionCSS('opacity')}\r\n      .style-setting--input-unit {\r\n        .style-setting--unit-selector {\r\n          display: none;\r\n        }\r\n      }\r\n    }\r\n    .icon-picker-back {\r\n      position: fixed;\r\n      right: 16px;\r\n    }\r\n    &.show-settings {\r\n      .icon-picker-viewer--workshop {\r\n        label {\r\n          opacity: 1;\r\n        }\r\n      }\r\n      .icon-picker-settings {\r\n        opacity: 1;\r\n        width: 60px;\r\n        .style-setting--input-unit {\r\n          margin-left: 0.25rem;\r\n        }\r\n      }\r\n      .color-picker{\r\n        position: absolute;\r\n        right: 16px;\r\n      }\r\n      .icon-picker-viewer--preview {\r\n        margin-top: 0;\r\n      }\r\n      .icon-preview {\r\n        opacity: 1;\r\n        min-height: 3rem;\r\n      }\r\n    }\r\n    .color-picker-block {\r\n      &.active {\r\n        outline: 1px solid ${(_b = (_a = theme === null || theme === void 0 ? void 0 : theme.sys.color) === null || _a === void 0 ? void 0 : _a.primary) === null || _b === void 0 ? void 0 : _b.main};\r\n        display: none;\r\n      }\r\n    }\r\n    .theme-color-sketch {\r\n      align-items: start;\r\n      position: absolute;\r\n      z-index: 1;\r\n      left: 0;\r\n      top: 0;\r\n      height: 100%;\r\n      width: 100%;\r\n      .main-colors .color-strip,\r\n      .color-palette {\r\n        justify-content: space-between;\r\n      }\r\n    }\r\n\r\n    /* animations */\r\n    .icon-preview-transition-enter {\r\n      opacity: 1;\r\n      transition: all 300ms cubic-bezier(.4, 1, .6, 1);\r\n    }\r\n    .icon-preview-transition-enter-active {\r\n      opacity: 0;\r\n    }\r\n    .icon-preview-transition-exit {\r\n      opacity: 0;\r\n      transition: all 300ms ease-out;\r\n    }\r\n    .icon-preview-transition-exit-active {\r\n      opacity: 1;\r\n    }\r\n    .color-sketch-transition-enter {\r\n      opacity: 0;\r\n      left: 50%;\r\n      transition: all 300ms cubic-bezier(.4, 1, .6, 1);\r\n    }\r\n    .color-sketch-transition-enter-active {\r\n      opacity: 1;\r\n      left: 0%;\r\n    }\r\n    .color-sketch-transition-exit {\r\n      opacity: 1;\r\n      left: 0%;\r\n      transition: all 300ms ease-out;\r\n    }\r\n    .color-sketch-transition-exit-active {\r\n      opacity: 0;\r\n      left: 50%;\r\n    }\r\n    .color-sketch-bk {\r\n      background-color: ${theme.sys.color.surface.paper};\r\n    }\r\n  `;\n}\n","import { css } from 'jimu-core';\nexport function iconPickerStyle(props) {\n    return css `\r\n    &.widget-setting--icon-picker {\r\n      display: inline-block;\r\n      .jimu-button-group-first-button:focus {\r\n        z-index: 1;\r\n      }\r\n    }\r\n  `;\n}\n","/** @jsx jsx */\nimport { React, jsx, ImageDisplayQualityMode, css } from 'jimu-core';\nimport { Button, ImgSourceType, ImageWithParam, Tooltip, ImageFillMode } from 'jimu-ui';\nimport { TrashOutlined } from 'jimu-icons/outlined/editor/trash';\nconst imageItemStyle = css `\r\n&.image-list-item {\r\n  width: 100%;\r\n  height: 86px;\r\n  &:hover {\r\n    opacity: 0.9;\r\n  }\r\n}\r\n`;\nconst imageItemDelStyle = css `\r\n&.image-item-del{\r\n  position: absolute;\r\n  top: 2px;\r\n  right: 2px;\r\n  .image-item-del-button{\r\n    width: 26px;\r\n    height: 26px;\r\n    border-radius: 2px;\r\n  }\r\n}\r\n`;\nexport const ImageItem = (props) => {\n    const { item, selected, disableRemove, removeTitle, onClick, onRemove } = props;\n    const imageParam = {\n        url: item.url,\n        fileFormat: item.fileFormat,\n        imgSourceType: ImgSourceType.ByUpload\n    };\n    const handleClick = React.useCallback(() => {\n        onClick(item, selected);\n    }, [item, onClick, selected]);\n    const handleRemove = React.useCallback(() => {\n        onRemove(item);\n    }, [item, onRemove]);\n    return jsx(React.Fragment, null,\n        jsx(Button, { css: imageItemStyle, className: 'image-list-item border-0 m-0 p-0', role: 'option', \"aria-selected\": selected, onClick: handleClick },\n            jsx(ImageWithParam, { imageParam: imageParam, imageFillMode: ImageFillMode.Fit, altText: (item === null || item === void 0 ? void 0 : item.originalName) || (item === null || item === void 0 ? void 0 : item.fileName), imageDisplayQualityMode: ImageDisplayQualityMode.Fuzzy })),\n        jsx(Tooltip, { disableFocusListener: true, placement: 'top-end', title: removeTitle },\n            jsx(\"div\", { css: imageItemDelStyle, className: 'image-item-del' },\n                jsx(Button, { icon: true, disabled: disableRemove, className: 'p-0 image-item-del-button', onClick: handleRemove },\n                    jsx(TrashOutlined, { className: 'placeholder-icon', size: 16 })))));\n};\n","/** @jsx jsx */\nimport { jsx, React, getAppStore, hooks, classNames, css } from 'jimu-core';\nimport { AppResourceManager } from 'jimu-for-builder';\nimport { defaultMessages } from 'jimu-ui';\nimport { ImageItem } from './image-item';\nconst imageItemWrapperStyle = css `\r\n&.image-list-item-wrapper {\r\n  position: relative;\r\n  float: left;\r\n  width: 48%;\r\n  height: 90px;\r\n  cursor: pointer;\r\n  border: 2px solid var(--sys-color-divider-tertiary) !important;\r\n  background-size: cover;\r\n  background-position: center center;\r\n  background-repeat: no-repeat;\r\n  margin: 4px 2px;\r\n}\r\n&.image-list-item-wrapper-chosen {\r\n  border: 2px solid var(--sys-color-action-selected) !important;\r\n}\r\n`;\nexport default function ImageList(props) {\n    const { imageResources, selectedItem, version, onClickItem, onRemoveItem } = props;\n    const inUseOriginIds = React.useMemo(() => {\n        var _a;\n        if (!((_a = getAppStore().getState().appStateInBuilder) === null || _a === void 0 ? void 0 : _a.appConfig)) {\n            return [];\n        }\n        const inUseImageResources = AppResourceManager.getInstance().getInUseImageResources(imageResources) || {};\n        return Object.values(inUseImageResources).map((value) => value.originId);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [imageResources, selectedItem, version]);\n    const isSelected = React.useCallback((item) => {\n        return selectedItem && (((selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.fileName) === item.fileName) || ((selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.url) === item.url));\n    }, [selectedItem]);\n    const [displayedTenfolds, setDisplayedTenfolds] = React.useState([]);\n    const intersectionObserverRef = React.useRef(null);\n    const handleTenfoldRef = React.useCallback((tenfoldEl) => {\n        if (!intersectionObserverRef.current) {\n            const handleEntries = (entries) => {\n                var _a, _b;\n                for (const entry of entries) {\n                    if (entry.intersectionRatio === 0)\n                        continue;\n                    const index = parseInt((_b = (_a = entry.target) === null || _a === void 0 ? void 0 : _a.dataset) === null || _b === void 0 ? void 0 : _b.index);\n                    typeof index === 'number' && setDisplayedTenfolds(old => !old.includes(index) ? [...old, index] : old);\n                    intersectionObserverRef.current.unobserve(entry.target);\n                }\n            };\n            intersectionObserverRef.current = new IntersectionObserver(handleEntries, { threshold: [0, 1] });\n        }\n        if (tenfoldEl) {\n            intersectionObserverRef.current.observe(tenfoldEl);\n        }\n    }, []);\n    const originItemEntries = Object.entries(imageResources).filter(([key, item]) => key === item.originId);\n    const translate = hooks.useTranslation(defaultMessages);\n    const canDeleteTitle = translate('deleteOption');\n    const canNotDeleteTitle = translate('imageDeleteTips');\n    return jsx(\"div\", { className: 'w-100 pb-4', style: { overflow: 'hidden' }, role: 'listbox' }, originItemEntries.map(([key, item], index) => {\n        const selected = isSelected(item);\n        const rootClassNames = classNames('image-list-item-wrapper jimu-outline-inside', { 'image-list-item-wrapper-chosen': selected });\n        const disableRemove = inUseOriginIds.includes(item.originId) || selected;\n        const removeTitle = disableRemove ? canNotDeleteTitle : canDeleteTitle;\n        const preTenfold = Math.floor(index / 10) * 10;\n        const nextTenfold = Math.ceil(index / 10) * 10;\n        const nearbyTenfolds = [preTenfold - 10, preTenfold, nextTenfold, nextTenfold + 10];\n        const isNearbyDisplayed = nearbyTenfolds.some(tenfold => displayedTenfolds.includes(tenfold));\n        const isTenfold = index % 10 === 0;\n        return jsx(\"div\", { key: key, ref: isTenfold ? handleTenfoldRef : () => null, \"data-index\": index, css: imageItemWrapperStyle, className: rootClassNames }, isNearbyDisplayed && jsx(ImageItem, { item: item, selected: selected, disableRemove: disableRemove, removeTitle: removeTitle, onClick: onClickItem, onRemove: onRemoveItem }));\n    }));\n}\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n/** @jsx jsx */\nimport { css, jsx, React, getAppStore, classNames, polished, injectIntl, ResourceType, ReactRedux } from 'jimu-core';\nimport { UrlInput, Tabs, Tab, AlertPopup, ImgSourceType, defaultMessages, Alert, FOCUSABLE_CONTAINER_CLASS, Loading, LoadingType } from 'jimu-ui';\nimport { AppResourceManager } from 'jimu-for-builder';\nimport ResourceComponent from '../resource-component';\nimport { withTheme } from 'jimu-theme';\nimport { ClickOutlined } from 'jimu-icons/outlined/application/click';\nimport ImageList from './image-list';\nconst maxSize = '10MB';\nconst supportedURISchemes = ['https', 'data'];\nclass Widget extends React.PureComponent {\n    constructor(props) {\n        var _a, _b, _c;\n        super(props);\n        this.__unmount = false;\n        this.formatMessage = (id, values) => {\n            const messages = Object.assign({}, defaultMessages);\n            return this.props.intl.formatMessage({ id: id, defaultMessage: messages[id] }, values);\n        };\n        this.onChange = (imageResource) => {\n            var _a, _b;\n            const maxSize = 10 * 1024 * 1024;\n            if (imageResource.size > maxSize) {\n                this.setState({ isImageSizeExceeded: true });\n                return;\n            }\n            const newImageResource = {\n                originalName: imageResource.originalName,\n                fileName: imageResource.fileName,\n                size: imageResource.size,\n                url: imageResource.url,\n                created: imageResource.created,\n                resourcesPrefix: imageResource.resourcesPrefix,\n                referredIds: [],\n                originId: imageResource.fileName.split('.')[0],\n                fileFormat: imageResource.fileFormat,\n                isUseCompress: imageResource.isUseCompress,\n                originalWidth: imageResource.originalWidth,\n                originalHeight: imageResource.originalHeight\n            };\n            const imageResourceList = Object.assign({}, this.state.imageResources);\n            imageResourceList[newImageResource.fileName.split('.')[0]] = newImageResource;\n            AppResourceManager.getInstance().setResourcesInDraft({ imageResources: imageResourceList });\n            this.setState({\n                imageResources: imageResourceList\n            });\n            const imageParam = {\n                url: imageResource.url,\n                originalUrl: imageResource.url,\n                fileName: imageResource.fileName,\n                originalName: imageResource.originalName,\n                imgSourceType: ImgSourceType.ByUpload,\n                fileFormat: imageResource.fileFormat,\n                originalId: imageResource.fileName.split('.')[0],\n                isUseCompress: imageResource.isUseCompress,\n                originalWidth: imageResource.originalWidth,\n                originalHeight: imageResource.originalHeight\n            };\n            (_b = (_a = this.props).onChange) === null || _b === void 0 ? void 0 : _b.call(_a, imageParam);\n            this.setState({ isImageSizeExceeded: false });\n        };\n        this.clearChosenImageResource = () => {\n            var _a;\n            const { cacheImageTypedParam } = this.state;\n            this.setState({\n                cacheImageTypedParam: {\n                    url: cacheImageTypedParam.url,\n                    local: undefined\n                }\n            });\n            (_a = this.props) === null || _a === void 0 ? void 0 : _a.onChange({});\n        };\n        this.chooseImageResource = (chosenResourceItemInfo, isChosen) => {\n            var _a, _b;\n            const imageParam = {\n                url: chosenResourceItemInfo.url,\n                originalUrl: chosenResourceItemInfo.url,\n                fileName: chosenResourceItemInfo.fileName,\n                originalName: chosenResourceItemInfo.originalName,\n                imgSourceType: ImgSourceType.ByUpload,\n                fileFormat: chosenResourceItemInfo.fileFormat,\n                originalId: chosenResourceItemInfo.originId,\n                isUseCompress: chosenResourceItemInfo.isUseCompress,\n                originalWidth: chosenResourceItemInfo.originalWidth,\n                originalHeight: chosenResourceItemInfo.originalHeight\n            };\n            if (isChosen) {\n                this.clearChosenImageResource();\n            }\n            else {\n                (_b = (_a = this.props).onChange) === null || _b === void 0 ? void 0 : _b.call(_a, imageParam);\n            }\n            this.setState({ isImageSizeExceeded: false });\n        };\n        this.onTextInputChanged = (res) => {\n            if (!res.valid) {\n                return;\n            }\n            const value = res.value;\n            const fileName = this.getFileNameFromUrl(value);\n            this.props.onChange && this.props.onChange({\n                url: value,\n                originalUrl: value,\n                fileName: fileName,\n                originalName: fileName,\n                imgSourceType: ImgSourceType.ByURL\n            });\n        };\n        this.getFileNameFromUrl = (url) => {\n            if (!url) {\n                return null;\n            }\n            else {\n                const tempUrl = url.split('?')[0];\n                let pos = tempUrl.lastIndexOf('/');\n                if (pos === -1) {\n                    pos = tempUrl.lastIndexOf('\\\\');\n                }\n                const fileName = tempUrl.substring(pos + 1);\n                return fileName;\n            }\n        };\n        this.handleResourceNotSupported = () => {\n            this.setState({\n                isOpenUnsupportedDialog: true\n            });\n        };\n        this.handleToggleUnsupportedDialog = () => {\n            this.setState({\n                isOpenUnsupportedDialog: !this.state.isOpenUnsupportedDialog\n            });\n        };\n        this.checkUrlValidityOnAccept = (url) => __awaiter(this, void 0, void 0, function* () {\n            return new Promise(resolve => {\n                if (!url) {\n                    resolve({ valid: true });\n                    return;\n                }\n                this.imgObject = new Image();\n                this.imgObject.src = url;\n                this.src = url;\n                // eslint-disable-next-line @typescript-eslint/no-this-alias\n                const self = this;\n                this.imgObject.onload = (e) => {\n                    if (!self.imgObject || this.__unmount || url !== self.src) {\n                        resolve({ valid: false });\n                        return;\n                    }\n                    resolve({ valid: true });\n                };\n                this.imgObject.onerror = () => {\n                    resolve({ valid: false, msg: this.formatMessage('invalidUrlMessage') });\n                };\n            });\n        });\n        this.removeImageResource = (imageInfo) => {\n            const imageResources = Object.assign({}, this.state.imageResources);\n            const id = imageInfo.fileName.split('.')[0];\n            const appResourceManager = AppResourceManager.getInstance();\n            delete imageResources[id];\n            appResourceManager.setResourcesInDraft({ imageResources });\n            this.setState({ imageResources });\n        };\n        this.closeAlert = () => {\n            this.setState({ isImageSizeExceeded: false });\n        };\n        this.onTabSelect = (tabId) => {\n            var _a;\n            const { cacheImageTypedParam } = this.state;\n            const switchToParam = tabId === 'urlImage' ? cacheImageTypedParam.url : cacheImageTypedParam.local;\n            this.setState({ tabId: tabId });\n            (_a = this.props) === null || _a === void 0 ? void 0 : _a.onChange(switchToParam);\n            this.closeAlert();\n        };\n        this.state = {\n            loading: false,\n            imageResources: {},\n            isOpenUnsupportedDialog: false,\n            isImageSizeExceeded: false,\n            cacheImageTypedParam: {\n                url: ((_a = props === null || props === void 0 ? void 0 : props.imageParam) === null || _a === void 0 ? void 0 : _a.imgSourceType) === ImgSourceType.ByURL ? props === null || props === void 0 ? void 0 : props.imageParam : undefined,\n                local: ((_b = props === null || props === void 0 ? void 0 : props.imageParam) === null || _b === void 0 ? void 0 : _b.imgSourceType) === ImgSourceType.ByUpload ? props === null || props === void 0 ? void 0 : props.imageParam : undefined\n            },\n            tabId: ((_c = props === null || props === void 0 ? void 0 : props.imageParam) === null || _c === void 0 ? void 0 : _c.imgSourceType) === ImgSourceType.ByURL ? 'urlImage' : 'localImage'\n        };\n    }\n    getStyle(theme) {\n        return css `\r\n      .image-resources-panel {\r\n        .setting-header {\r\n          padding: ${polished.rem(10)} ${polished.rem(16)} ${polished.rem(0)} ${polished.rem(16)}\r\n        }\r\n\r\n        .setting-title {\r\n          font-size: ${polished.rem(16)};\r\n        }\r\n\r\n        .setting-container {\r\n          height: calc(100% - ${polished.rem(50)});\r\n        }\r\n\r\n        .url-input-h100 {\r\n          height: 80px\r\n        }\r\n\r\n        .image-list {\r\n          position: absolute;\r\n          overflow-y: auto;\r\n          height: calc(100% - ${polished.rem(44)});\r\n        }\r\n\r\n        .image-selector-blank-placeholder {\r\n          .placeholder-icon {\r\n            color: ${theme.ref.palette.neutral[800]};\r\n          }\r\n          & > div {\r\n            top: 50%;\r\n            transform: translateY(-50%);\r\n            padding: 1rem;\r\n          }\r\n          p {\r\n            font-size: ${polished.rem(14)};\r\n            margin-top: ${polished.rem(16)};\r\n            line-height: ${polished.rem(19)};\r\n            color: ${theme.ref.palette.neutral[1000]};\r\n          }\r\n        }\r\n      }\r\n    `;\n    }\n    componentDidMount() {\n        this.__unmount = false;\n        this.initImageResource();\n    }\n    initImageResource() {\n        const appId = getAppStore().getState().appStateInBuilder && getAppStore().getState().appStateInBuilder.appId;\n        const appResourceManager = AppResourceManager.getInstance();\n        this.setState({ loading: true });\n        appResourceManager.getImageResourceListFromDraft(appId).then(imageResources => {\n            appResourceManager.setResourcesInDraft({ imageResources });\n            this.setState({\n                imageResources: imageResources\n            });\n        }).finally(() => {\n            this.setState({\n                loading: false\n            });\n        });\n    }\n    componentDidUpdate(prevProps) {\n        const { imageParam } = this.props;\n        const { cacheImageTypedParam } = this.state;\n        const { appId } = this.props;\n        if (appId && appId !== (prevProps === null || prevProps === void 0 ? void 0 : prevProps.appId)) {\n            this.initImageResource();\n        }\n        if (prevProps.imageParam !== imageParam) {\n            this.setState({\n                cacheImageTypedParam: {\n                    url: this.state.tabId === 'urlImage' ? imageParam : cacheImageTypedParam.url,\n                    local: this.state.tabId === 'localImage' ? imageParam : cacheImageTypedParam.local\n                }\n            });\n        }\n    }\n    componentWillUnmount() {\n        this.imgObject = null;\n        this.__unmount = true;\n        this.src = null;\n    }\n    render() {\n        var _a, _b;\n        const { isImageSizeExceeded, imageResources, tabId } = this.state;\n        const allOriginImages = Object.entries(imageResources).filter(([key, item]) => key === item.originId);\n        return (jsx(\"div\", { className: 'w-100 h-100', css: this.getStyle(this.props.theme) },\n            jsx(\"div\", { className: 'w-100 h-100 image-resources-panel' },\n                jsx(\"div\", { className: 'setting-container' },\n                    jsx(Tabs, { className: 'h-100 ml-4 mr-4', type: 'pills', fill: true, value: tabId, onChange: this.onTabSelect, css: css `\r\n                .tab-content{\r\n                  overflow-y: inherit !important;\r\n                }\r\n              ` },\n                        jsx(Tab, { id: 'localImage', title: this.formatMessage('localImage'), className: FOCUSABLE_CONTAINER_CLASS },\n                            jsx(\"div\", { className: classNames('w-100 h-100', { [FOCUSABLE_CONTAINER_CLASS]: this.state.tabId === 'localImage' }), style: { position: 'relative' } },\n                                jsx(\"div\", { className: 'mt-2' },\n                                    jsx(ResourceComponent, { widgetId: this.props.widgetId, style: { position: 'relative' }, className: 'w-100 image-upload-btn', label: this.formatMessage('uploadImage'), title: '', ariaLabel: this.formatMessage('imageUploadTips'), ariaDescribedby: 'image-resource-empty max-upload-size', onClick: this.closeAlert, onChange: this.onChange, type: ResourceType.Image, onResourceNotSupported: this.handleResourceNotSupported })),\n                                jsx(\"div\", { className: 'mt-2', id: 'max-upload-size' }, this.formatMessage('maxUploadSize', { size: maxSize })),\n                                jsx(\"div\", { className: 'w-100 mt-1 image-list' },\n                                    this.state.loading &&\n                                        jsx(Loading, { type: LoadingType.Secondary }),\n                                    !this.state.loading && allOriginImages.length === 0 &&\n                                        jsx(\"div\", { className: 'w-100 text-center image-selector-blank-placeholder' },\n                                            jsx(\"div\", { className: \"position-absolute w-100\" },\n                                                jsx(ClickOutlined, { size: 48, className: 'placeholder-icon' }),\n                                                jsx(\"p\", { id: 'image-resource-empty' }, this.formatMessage('imageSelectorBlankStatus', { UploadString: this.formatMessage('uploadImage') })))),\n                                    !this.state.loading && allOriginImages.length > 0 &&\n                                        jsx(ImageList, { imageResources: imageResources, selectedItem: this.props.imageParam, version: this.props.version, onClickItem: this.chooseImageResource, onRemoveItem: this.removeImageResource })))),\n                        jsx(Tab, { id: 'urlImage', title: this.formatMessage('urlImage'), className: FOCUSABLE_CONTAINER_CLASS },\n                            jsx(\"div\", { className: classNames('mt-2 d-flex justify-content-between align-items-center', { [FOCUSABLE_CONTAINER_CLASS]: this.state.tabId === 'urlImage' }) },\n                                jsx(UrlInput, { className: 'w-100 url-input-h100', placeholder: this.formatMessage('enterHttpsOrBase64'), defaultValue: ((_a = this.props.imageParam) === null || _a === void 0 ? void 0 : _a.imgSourceType) === ImgSourceType.ByURL\n                                        ? (_b = this.props.imageParam) === null || _b === void 0 ? void 0 : _b.url\n                                        : '', onAcceptValue: this.onTextInputChanged, schemes: supportedURISchemes, checkValidityOnAccept: this.checkUrlValidityOnAccept }))))),\n                jsx(AlertPopup, { hideCancel: true, isOpen: this.state.isOpenUnsupportedDialog, title: this.formatMessage('uploadImageError'), toggle: this.handleToggleUnsupportedDialog },\n                    jsx(\"div\", { style: { fontSize: '1rem' } }, this.formatMessage('imageTypeError'))),\n                jsx(\"div\", { className: 'p-2 w-100', style: { position: 'absolute', bottom: 0 } },\n                    jsx(Alert, { closable: true, form: 'basic', onClose: this.closeAlert, open: isImageSizeExceeded, text: this.formatMessage('sizeExceededTips'), type: 'warning', withIcon: true, className: 'w-100' })))));\n    }\n}\nconst mapStateToProps = (state) => {\n    const appState = (window === null || window === void 0 ? void 0 : window.jimuConfig.isBuilder) ? state.appStateInBuilder : state;\n    if (appState === null || appState === void 0 ? void 0 : appState.appId) {\n        return {\n            appId: appState.appId\n        };\n    }\n    else {\n        return {};\n    }\n};\nexport const ImageResourcesPanel = ReactRedux.connect(mapStateToProps)(withTheme(injectIntl(Widget)));\n"],"names":[],"sourceRoot":""}