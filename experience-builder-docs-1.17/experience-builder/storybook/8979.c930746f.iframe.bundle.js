"use strict";(self.webpackChunkarcgis_experience_builder_design_system=self.webpackChunkarcgis_experience_builder_design_system||[]).push([[8979],{"../jimu-icons/outlined/application/grid-template.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>GridTemplateOutlined});var jimu_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../jimu-core/index.tsx"),_svg_outlined_application_grid_template_svg__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../jimu-icons/svg/outlined/application/grid-template.svg"),_svg_outlined_application_grid_template_svg__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_svg_outlined_application_grid_template_svg__WEBPACK_IMPORTED_MODULE_1__),__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const GridTemplateOutlined=props=>{const SVG=window.SVG,{className}=props,others=__rest(props,["className"]),classes=(0,jimu_core__WEBPACK_IMPORTED_MODULE_0__.xWm)("jimu-icon jimu-icon-component",className);return SVG?jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement(SVG,Object.assign({className:classes,src:_svg_outlined_application_grid_template_svg__WEBPACK_IMPORTED_MODULE_1___default()},others)):jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement("svg",Object.assign({className:classes},others))};try{GridTemplateOutlined.displayName="GridTemplateOutlined",GridTemplateOutlined.__docgenInfo={description:"",displayName:"GridTemplateOutlined",props:{children:{defaultValue:null,description:"The fallback content in case of a fetch error or unsupported browser.",name:"children",required:!1,type:{name:"ReactNode"}},title:{defaultValue:null,description:"The title of the component.",name:"title",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"Defines the styles added to the element.",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"Defines the class names added to the component.",name:"className",required:!1,type:{name:"string"}},role:{defaultValue:null,description:"To provide a role for this component.\nIt is for accessibility purposes.",name:"role",required:!1,type:{name:"AriaRole"}},"aria-hidden":{defaultValue:{value:"false"},description:"Indicates whether the element is exposed to an accessibility API.",name:"aria-hidden",required:!1,type:{name:'boolean | "true" | "false"'}},"aria-label":{defaultValue:null,description:"To provide a label for interactive components for accessibility purposes.",name:"aria-label",required:!1,type:{name:"string"}},size:{defaultValue:{value:"m"},description:"Defines the size, both width and height, of the icon.",name:"size",required:!1,type:{name:"string | number"}},loader:{defaultValue:null,description:"A component to be shown while the SVG is loading.",name:"loader",required:!1,type:{name:"ReactNode"}},isRTL:{defaultValue:null,description:"Whether it is in the RTL.\nNote: The default value is read from `getAppStore().getState().appContext?.isRTL` and is provided for use in testing and storybook environments.\n@ignore",name:"isRTL",required:!1,type:{name:"boolean"}},autoFlip:{defaultValue:{value:"false"},description:"Flips the SVG automatically for RTL.",name:"autoFlip",required:!1,type:{name:"boolean"}},currentColor:{defaultValue:{value:"true"},description:"If set to `true`, the `stroke` and `fill` properties on the child elements will be replaced with `currentColor`, in order to make `color` property effective.",name:"currentColor",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-icons/outlined/application/grid-template.tsx#GridTemplateOutlined"]={docgenInfo:GridTemplateOutlined.__docgenInfo,name:"GridTemplateOutlined",path:"../jimu-icons/outlined/application/grid-template.tsx#GridTemplateOutlined"})}catch(__react_docgen_typescript_loader_error){}},"../jimu-icons/outlined/application/template.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{v:()=>TemplateOutlined});var jimu_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../jimu-core/index.tsx"),_svg_outlined_application_template_svg__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../jimu-icons/svg/outlined/application/template.svg"),_svg_outlined_application_template_svg__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_svg_outlined_application_template_svg__WEBPACK_IMPORTED_MODULE_1__),__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const TemplateOutlined=props=>{const SVG=window.SVG,{className}=props,others=__rest(props,["className"]),classes=(0,jimu_core__WEBPACK_IMPORTED_MODULE_0__.xWm)("jimu-icon jimu-icon-component",className);return SVG?jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement(SVG,Object.assign({className:classes,src:_svg_outlined_application_template_svg__WEBPACK_IMPORTED_MODULE_1___default()},others)):jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement("svg",Object.assign({className:classes},others))};try{TemplateOutlined.displayName="TemplateOutlined",TemplateOutlined.__docgenInfo={description:"",displayName:"TemplateOutlined",props:{children:{defaultValue:null,description:"The fallback content in case of a fetch error or unsupported browser.",name:"children",required:!1,type:{name:"ReactNode"}},title:{defaultValue:null,description:"The title of the component.",name:"title",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"Defines the styles added to the element.",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"Defines the class names added to the component.",name:"className",required:!1,type:{name:"string"}},role:{defaultValue:null,description:"To provide a role for this component.\nIt is for accessibility purposes.",name:"role",required:!1,type:{name:"AriaRole"}},"aria-hidden":{defaultValue:{value:"false"},description:"Indicates whether the element is exposed to an accessibility API.",name:"aria-hidden",required:!1,type:{name:'boolean | "true" | "false"'}},"aria-label":{defaultValue:null,description:"To provide a label for interactive components for accessibility purposes.",name:"aria-label",required:!1,type:{name:"string"}},size:{defaultValue:{value:"m"},description:"Defines the size, both width and height, of the icon.",name:"size",required:!1,type:{name:"string | number"}},loader:{defaultValue:null,description:"A component to be shown while the SVG is loading.",name:"loader",required:!1,type:{name:"ReactNode"}},isRTL:{defaultValue:null,description:"Whether it is in the RTL.\nNote: The default value is read from `getAppStore().getState().appContext?.isRTL` and is provided for use in testing and storybook environments.\n@ignore",name:"isRTL",required:!1,type:{name:"boolean"}},autoFlip:{defaultValue:{value:"false"},description:"Flips the SVG automatically for RTL.",name:"autoFlip",required:!1,type:{name:"boolean"}},currentColor:{defaultValue:{value:"true"},description:"If set to `true`, the `stroke` and `fill` properties on the child elements will be replaced with `currentColor`, in order to make `color` property effective.",name:"currentColor",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-icons/outlined/application/template.tsx#TemplateOutlined"]={docgenInfo:TemplateOutlined.__docgenInfo,name:"TemplateOutlined",path:"../jimu-icons/outlined/application/template.tsx#TemplateOutlined"})}catch(__react_docgen_typescript_loader_error){}},"../jimu-icons/outlined/brand/block.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>BlockOutlined});var jimu_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../jimu-core/index.tsx"),_svg_outlined_brand_block_svg__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../jimu-icons/svg/outlined/brand/block.svg"),_svg_outlined_brand_block_svg__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_svg_outlined_brand_block_svg__WEBPACK_IMPORTED_MODULE_1__),__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const BlockOutlined=props=>{const SVG=window.SVG,{className}=props,others=__rest(props,["className"]),classes=(0,jimu_core__WEBPACK_IMPORTED_MODULE_0__.xWm)("jimu-icon jimu-icon-component",className);return SVG?jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement(SVG,Object.assign({className:classes,src:_svg_outlined_brand_block_svg__WEBPACK_IMPORTED_MODULE_1___default()},others)):jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement("svg",Object.assign({className:classes},others))};try{BlockOutlined.displayName="BlockOutlined",BlockOutlined.__docgenInfo={description:"",displayName:"BlockOutlined",props:{children:{defaultValue:null,description:"The fallback content in case of a fetch error or unsupported browser.",name:"children",required:!1,type:{name:"ReactNode"}},title:{defaultValue:null,description:"The title of the component.",name:"title",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"Defines the styles added to the element.",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"Defines the class names added to the component.",name:"className",required:!1,type:{name:"string"}},role:{defaultValue:null,description:"To provide a role for this component.\nIt is for accessibility purposes.",name:"role",required:!1,type:{name:"AriaRole"}},"aria-hidden":{defaultValue:{value:"false"},description:"Indicates whether the element is exposed to an accessibility API.",name:"aria-hidden",required:!1,type:{name:'boolean | "true" | "false"'}},"aria-label":{defaultValue:null,description:"To provide a label for interactive components for accessibility purposes.",name:"aria-label",required:!1,type:{name:"string"}},size:{defaultValue:{value:"m"},description:"Defines the size, both width and height, of the icon.",name:"size",required:!1,type:{name:"string | number"}},loader:{defaultValue:null,description:"A component to be shown while the SVG is loading.",name:"loader",required:!1,type:{name:"ReactNode"}},isRTL:{defaultValue:null,description:"Whether it is in the RTL.\nNote: The default value is read from `getAppStore().getState().appContext?.isRTL` and is provided for use in testing and storybook environments.\n@ignore",name:"isRTL",required:!1,type:{name:"boolean"}},autoFlip:{defaultValue:{value:"false"},description:"Flips the SVG automatically for RTL.",name:"autoFlip",required:!1,type:{name:"boolean"}},currentColor:{defaultValue:{value:"true"},description:"If set to `true`, the `stroke` and `fill` properties on the child elements will be replaced with `currentColor`, in order to make `color` property effective.",name:"currentColor",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-icons/outlined/brand/block.tsx#BlockOutlined"]={docgenInfo:BlockOutlined.__docgenInfo,name:"BlockOutlined",path:"../jimu-icons/outlined/brand/block.tsx#BlockOutlined"})}catch(__react_docgen_typescript_loader_error){}},"../jimu-icons/outlined/brand/screen-group.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>ScreenGroupOutlined});var jimu_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../jimu-core/index.tsx"),_svg_outlined_brand_screen_group_svg__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../jimu-icons/svg/outlined/brand/screen-group.svg"),_svg_outlined_brand_screen_group_svg__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_svg_outlined_brand_screen_group_svg__WEBPACK_IMPORTED_MODULE_1__),__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const ScreenGroupOutlined=props=>{const SVG=window.SVG,{className}=props,others=__rest(props,["className"]),classes=(0,jimu_core__WEBPACK_IMPORTED_MODULE_0__.xWm)("jimu-icon jimu-icon-component",className);return SVG?jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement(SVG,Object.assign({className:classes,src:_svg_outlined_brand_screen_group_svg__WEBPACK_IMPORTED_MODULE_1___default()},others)):jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement("svg",Object.assign({className:classes},others))};try{ScreenGroupOutlined.displayName="ScreenGroupOutlined",ScreenGroupOutlined.__docgenInfo={description:"",displayName:"ScreenGroupOutlined",props:{children:{defaultValue:null,description:"The fallback content in case of a fetch error or unsupported browser.",name:"children",required:!1,type:{name:"ReactNode"}},title:{defaultValue:null,description:"The title of the component.",name:"title",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"Defines the styles added to the element.",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"Defines the class names added to the component.",name:"className",required:!1,type:{name:"string"}},role:{defaultValue:null,description:"To provide a role for this component.\nIt is for accessibility purposes.",name:"role",required:!1,type:{name:"AriaRole"}},"aria-hidden":{defaultValue:{value:"false"},description:"Indicates whether the element is exposed to an accessibility API.",name:"aria-hidden",required:!1,type:{name:'boolean | "true" | "false"'}},"aria-label":{defaultValue:null,description:"To provide a label for interactive components for accessibility purposes.",name:"aria-label",required:!1,type:{name:"string"}},size:{defaultValue:{value:"m"},description:"Defines the size, both width and height, of the icon.",name:"size",required:!1,type:{name:"string | number"}},loader:{defaultValue:null,description:"A component to be shown while the SVG is loading.",name:"loader",required:!1,type:{name:"ReactNode"}},isRTL:{defaultValue:null,description:"Whether it is in the RTL.\nNote: The default value is read from `getAppStore().getState().appContext?.isRTL` and is provided for use in testing and storybook environments.\n@ignore",name:"isRTL",required:!1,type:{name:"boolean"}},autoFlip:{defaultValue:{value:"false"},description:"Flips the SVG automatically for RTL.",name:"autoFlip",required:!1,type:{name:"boolean"}},currentColor:{defaultValue:{value:"true"},description:"If set to `true`, the `stroke` and `fill` properties on the child elements will be replaced with `currentColor`, in order to make `color` property effective.",name:"currentColor",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-icons/outlined/brand/screen-group.tsx#ScreenGroupOutlined"]={docgenInfo:ScreenGroupOutlined.__docgenInfo,name:"ScreenGroupOutlined",path:"../jimu-icons/outlined/brand/screen-group.tsx#ScreenGroupOutlined"})}catch(__react_docgen_typescript_loader_error){}},"../jimu-icons/outlined/directional/arrow-stretched.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{W:()=>ArrowStretchedOutlined});var jimu_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../jimu-core/index.tsx"),_svg_outlined_directional_arrow_stretched_svg__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../jimu-icons/svg/outlined/directional/arrow-stretched.svg"),_svg_outlined_directional_arrow_stretched_svg__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_svg_outlined_directional_arrow_stretched_svg__WEBPACK_IMPORTED_MODULE_1__),__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const ArrowStretchedOutlined=props=>{const SVG=window.SVG,{className}=props,others=__rest(props,["className"]),classes=(0,jimu_core__WEBPACK_IMPORTED_MODULE_0__.xWm)("jimu-icon jimu-icon-component",className);return SVG?jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement(SVG,Object.assign({className:classes,src:_svg_outlined_directional_arrow_stretched_svg__WEBPACK_IMPORTED_MODULE_1___default()},others)):jimu_core__WEBPACK_IMPORTED_MODULE_0__.q_G.createElement("svg",Object.assign({className:classes},others))};try{ArrowStretchedOutlined.displayName="ArrowStretchedOutlined",ArrowStretchedOutlined.__docgenInfo={description:"",displayName:"ArrowStretchedOutlined",props:{children:{defaultValue:null,description:"The fallback content in case of a fetch error or unsupported browser.",name:"children",required:!1,type:{name:"ReactNode"}},title:{defaultValue:null,description:"The title of the component.",name:"title",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"Defines the styles added to the element.",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"Defines the class names added to the component.",name:"className",required:!1,type:{name:"string"}},role:{defaultValue:null,description:"To provide a role for this component.\nIt is for accessibility purposes.",name:"role",required:!1,type:{name:"AriaRole"}},"aria-hidden":{defaultValue:{value:"false"},description:"Indicates whether the element is exposed to an accessibility API.",name:"aria-hidden",required:!1,type:{name:'boolean | "true" | "false"'}},"aria-label":{defaultValue:null,description:"To provide a label for interactive components for accessibility purposes.",name:"aria-label",required:!1,type:{name:"string"}},size:{defaultValue:{value:"m"},description:"Defines the size, both width and height, of the icon.",name:"size",required:!1,type:{name:"string | number"}},loader:{defaultValue:null,description:"A component to be shown while the SVG is loading.",name:"loader",required:!1,type:{name:"ReactNode"}},isRTL:{defaultValue:null,description:"Whether it is in the RTL.\nNote: The default value is read from `getAppStore().getState().appContext?.isRTL` and is provided for use in testing and storybook environments.\n@ignore",name:"isRTL",required:!1,type:{name:"boolean"}},autoFlip:{defaultValue:{value:"false"},description:"Flips the SVG automatically for RTL.",name:"autoFlip",required:!1,type:{name:"boolean"}},currentColor:{defaultValue:{value:"true"},description:"If set to `true`, the `stroke` and `fill` properties on the child elements will be replaced with `currentColor`, in order to make `color` property effective.",name:"currentColor",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-icons/outlined/directional/arrow-stretched.tsx#ArrowStretchedOutlined"]={docgenInfo:ArrowStretchedOutlined.__docgenInfo,name:"ArrowStretchedOutlined",path:"../jimu-icons/outlined/directional/arrow-stretched.tsx#ArrowStretchedOutlined"})}catch(__react_docgen_typescript_loader_error){}},"../jimu-layouts/layout-builder.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AccordionLayoutBuilder:()=>accordion_layout_builder_layout,AccordionLayoutItemSetting:()=>AccordionItemSetting,CanvasPane:()=>canvas_pane_CanvasPane,ColumnLayoutBuilder:()=>column_layout_builder_layout,ColumnLayoutItemSetting:()=>ColumnItemSetting,ColumnLayoutService:()=>ColumnLayoutService,CommonLayoutItemSetting:()=>CommonLayoutItemSetting,CommonTransformSetting:()=>common_transform_setting_CommonLayoutItemSetting,DEFAULT_ROW_LAYOUT_SETTING:()=>row_layout_default_setting.r,DropArea:()=>droparea_hook_DropArea,FixedLayoutItemSetting:()=>FixedItemSetting,FixedLayoutService:()=>FixedLayoutService,FlexRowLayoutBuilder:()=>flex_row_layout_builder_layout,FlexRowLayoutItemSetting:()=>FlexRowItemSetting,FlowLayoutItemSetting:()=>FlowItemSetting,FlowLayoutService:()=>FlowLayoutService,FlowLayoutSetting:()=>layout_setting,GLOBAL_DRAGGING_CLASS_NAME:()=>GLOBAL_DRAGGING_CLASS_NAME,GLOBAL_H5_DRAGGING_CLASS_NAME:()=>GLOBAL_H5_DRAGGING_CLASS_NAME,GLOBAL_RESIZING_CLASS_NAME:()=>GLOBAL_RESIZING_CLASS_NAME,GridLayoutBuilder:()=>grid_layout_builder_layout,GridLayoutItemSetting:()=>GridItemSetting,GridLayoutService:()=>GridLayoutService,GridLayoutSetting:()=>grid_layout_layout_setting,LIMITED_BOUNDARY_CLASS_NAME:()=>LIMITED_BOUNDARY_CLASS_NAME,LayoutBuilder:()=>builder_layout,LayoutEntry:()=>layout_entry,LayoutItemInBuilder:()=>LayoutItemInBuilder,LayoutItemToolbar:()=>layout_item_toolbar_LayoutItemToolbar,PageRenderer:()=>page_renderer,RowLayoutBuilder:()=>row_layout_builder_layout,RowLayoutItemSetting:()=>RowItemSetting,RowLayoutService:()=>RowLayoutService,SectionRendererInBuilder:()=>section_renderer_SectionRendererInBuilder,ShapeL:()=>shape_l_ShapeL,ShapeRect:()=>shape_rect_ShapeRect,Toolbar:()=>Toolbar,WidgetPlaceholder:()=>widget_placeholder_WidgetPlaceholder,WidgetRendererInBuilder:()=>widget_renderer_WidgetRendererInBuilder,addItemToLayout:()=>common_layout_actions_addItemToLayout,bindDragHandler:()=>bindDragHandler,bindResizeHandler:()=>bindResizeHandler,canDeleteInExpressMode:()=>canDeleteInExpressMode,getLabelOfGridTab:()=>common_utils.T9,getRootLayoutId:()=>getRootLayoutId,sectionMenuItems:()=>sectionMenuItems,splitGridCell:()=>splitGridCell,withRnd:()=>rnd_decorator_withRnd});var jimu_core=__webpack_require__("../jimu-core/index.tsx"),jimu_for_builder=__webpack_require__("../jimu-for-builder/index.tsx"),jimu_ui=__webpack_require__("../jimu-ui/index.tsx"),default_setting=__webpack_require__("../jimu-layouts/lib/fixed-layout/default-setting.ts"),layout_runtime=__webpack_require__("../jimu-layouts/layout-runtime.tsx"),more_horizontal=__webpack_require__("../jimu-icons/outlined/application/more-horizontal.tsx"),application_more_horizontal=__webpack_require__("../jimu-icons/svg/outlined/application/more-horizontal.svg"),more_horizontal_default=__webpack_require__.n(application_more_horizontal),jimu_theme=__webpack_require__("../jimu-theme/index.ts");const ToolbarContext=jimu_core.q_G.createContext({}),flipOptions1={fallbackPlacements:["top","right"]},flipOptions2={fallbackAxisSideDirection:"start"};class _ToolbarItem extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.select=e=>{if(null==e||e.stopPropagation(),this.props.onClick){const{parentRef}=this.contextProps;this.props.onClick({layoutId:this.contextProps.layoutId,layoutItem:this.contextProps.layoutItem,clientRect:parentRef&&parentRef.getBoundingClientRect()},e),this.contextProps.onItemClick(this.props.uid)}},this.handleDoubleClick=e=>{e.stopPropagation()},this.handleMouseEnter=e=>{e.stopPropagation(),this.props.onMouseEnter&&this.props.onMouseEnter({layoutId:this.contextProps.layoutId,layoutItem:this.contextProps.layoutItem,clientRect:null},e)},this.handleMouseLeave=e=>{e.stopPropagation(),this.props.onMouseLeave&&this.props.onMouseLeave({layoutId:this.contextProps.layoutId,layoutItem:this.contextProps.layoutItem,clientRect:null},e)}}componentDidMount(){const{widgetId,extName,openWhenAdded,isNewAdded}=this.props;widgetId&&extName&&(openWhenAdded&&isNewAdded&&this.select(),window.jimuConfig.isInBuilder?(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.widgetRuntimeInfoChange(widgetId,"shouldExpandContextTool",!1)):jimu_for_builder.builderAppSync.publishWidgetRuntimeInfoChangeToApp(widgetId,"shouldExpandContextTool",!1))}componentDidUpdate(){const isVisible=this.getValue(this.props.visible,this.contextProps),isDisabled=this.getValue(this.props.disabled,this.contextProps);isVisible&&!isDisabled||this.contextProps.onItemUnSelected(this.props.uid)}componentWillUnmount(){this.contextProps.onItemUnSelected(this.props.uid)}getValue(target,props){return"function"==typeof target?target(props):target}getStyle(){const{theme}=this.contextProps;return jimu_core.AHW`
      cursor: pointer;
      width: 32px;
      min-height: 32px;
      display: flex;
      justify-content: flex-start;
      user-select: none;
      background: ${theme.ref.palette.neutral[400]};

      &:hover {
        background: ${theme.ref.palette.neutral[500]};
      }
      &.selected {
        background: ${theme.sys.color.primary.main};
      }

      &.disabled,
      &.no-action {
        cursor: default;
        &:hover {
          background: ${theme.ref.palette.neutral[400]};
        }
      }
      &.disabled {
        .jimu-btn {
          cursor: default;
          pointer-events: auto;
        }
        .jimu-btn svg, .toolbar-label {
          color: ${theme.ref.palette.neutral[800]} !important;
        }
      }

      &.msg {
        width: auto;
        font-size: 12px;
        color: ${theme.ref.palette.black};
        letter-spacing: 0.33px;
        text-align: center;
        padding: 0 8px;
      }

      .toolbar-group & {
        justify-content: flex-start;
      }

      .popper {
        border: 1px solid ${theme.ref.palette.neutral[900]};
      }

      .toolbar-label {
        color: ${theme.ref.palette.black};
      }
    `}separatorStyle(){const{theme}=this.contextProps;return this.props.isInGroup?jimu_core.AHW`
        width: 100%;
        height: 1px;
        background-color: ${theme.ref.palette.neutral[600]};
        align-self: center;
      `:jimu_core.AHW`
      div.toolbar-item + &,
      div.toolbar-group + & {
        display: block;
      }
      display: none;
      width: 1px;
      height: 30px;
      border-left: 1px solid ${theme.ref.palette.neutral[600]};
      align-self: center;
    `}tooltipStyle(){const{theme}=this.contextProps;return jimu_core.AHW`
      border: none;

      .tooltip {
        color: ${theme.ref.palette.black};
        background-color: ${theme.ref.palette.neutral[600]};
        border-color: ${theme.ref.palette.neutral[400]};
      }
    `}createButton({textContent,iconContent,tooltip,isDisabled,noAction,isChecked,rotate,iconSize,autoFlipIcon,ref}){const title=textContent?"":tooltip,titleProps=isDisabled?{title}:{},buttonComponent=(0,jimu_core.Yac)(jimu_ui.Button,Object.assign({"aria-label":textContent||tooltip,ref,className:(0,jimu_core.xWm)("px-0 w-100",{"justify-content-start":textContent}),type:"tertiary",disableHoverEffect:!0,size:"sm",icon:iconContent&&!textContent,role:"menuitem",onClick:isDisabled||noAction?null:this.select,disabled:isDisabled,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onDoubleClick:this.handleDoubleClick,"data-extname":this.props.extName},titleProps),iconContent&&(0,jimu_core.Yac)(jimu_ui.Icon,{className:(0,jimu_core.xWm)("tool-item-icon",{checked:isChecked}),icon:iconContent,rotate,size:iconSize,color:this.contextProps.theme.ref.palette.black,autoFlip:autoFlipIcon}),textContent&&(0,jimu_core.Yac)("span",{className:"toolbar-label text-nowrap"},textContent));return isDisabled?buttonComponent:(0,jimu_core.Yac)(jimu_ui.Tooltip,{placement:"bottom",title,flipOptions:flipOptions1,css:this.tooltipStyle()},buttonComponent)}render(){const{icon,autoFlipIcon,label,size,checked,disabled,visible,rotate,settingPanel,title,uid,widgetId,className,separator}=this.props;if(separator)return(0,jimu_core.Yac)(ToolbarContext.Consumer,null,(props=>(this.contextProps=props,(0,jimu_core.Yac)("div",{"data-testid":"toolbarSeparator",css:this.separatorStyle()}))));const noAction=null==this.props.onClick,iconSize=size||16,SettingPanel=settingPanel;return(0,jimu_core.Yac)(ToolbarContext.Consumer,null,(props=>{var _a;if(this.contextProps=props,widgetId&&(null===(_a=props.layoutItem)||void 0===_a?void 0:_a.widgetId)!==widgetId)return null;let tooltip="";"function"==typeof title?tooltip=title(props):"string"==typeof title&&(tooltip=title);const showSettingPanel=settingPanel&&props.activeItem===uid&&props.toggleOn,isChecked=showSettingPanel||this.getValue(checked,props),isDisabled=this.getValue(disabled,props),isVisible=this.getValue(visible,props),textContent=this.getValue(label,props),iconContent=this.getValue(icon,props);return(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("toolbar-item",className,{selected:isChecked,disabled:isDisabled,msg:textContent,"no-action":noAction,"d-none":null!=visible&&!isVisible}),css:this.getStyle(),"data-toolstate":this.props.toolState},!SettingPanel&&this.createButton({textContent,iconContent,tooltip,isDisabled,noAction,isChecked,rotate,iconSize,autoFlipIcon,ref:null}),SettingPanel&&(0,jimu_core.Yac)(jimu_theme.nD,{useTheme2:window.jimuConfig.isInBuilder},this.createButton({textContent,iconContent,tooltip,isDisabled,noAction,isChecked,rotate,iconSize,autoFlipIcon,ref:ref=>{this.reference=ref}}),(0,jimu_core.Yac)(jimu_ui.Popper,{placement:"bottom-start",reference:this.reference,flipOptions:flipOptions2,open:showSettingPanel,disablePortal:!0,autoUpdate:!0},(0,jimu_core.Yac)("div",{css:jimu_core.AHW`
                        display: flex;
                        pointer-events: all;
                        border-radius: 2px;
                        box-shadow: 0 2px 8px 1px rgba(0, 0, 0, 0.2);
                      `,className:"d-flex"},showSettingPanel&&(0,jimu_core.Yac)(SettingPanel,{layoutId:props.layoutId,layoutItemId:props.layoutItem.id,widgetId:props.layoutItem.widgetId})))))}))}}const mapFunc=(0,jimu_core.Mz0)(((state,props)=>{var _a,_b,_c;const{widgetId,extName}=props;if(widgetId&&extName){const widgetState=state.widgetsRuntimeInfo[widgetId];return null!==(_c=null===(_b=null===(_a=null==widgetState?void 0:widgetState.layoutItemTools)||void 0===_a?void 0:_a[extName])||void 0===_b?void 0:_b.version)&&void 0!==_c?_c:0}return 0}),((state,props)=>{var _a,_b;const{widgetId,extName}=props;if(widgetId&&extName){const widgetsRuntimeInfo=state.widgetsRuntimeInfo;return null!==(_b=null===(_a=null==widgetsRuntimeInfo?void 0:widgetsRuntimeInfo[widgetId])||void 0===_a?void 0:_a.shouldExpandContextTool)&&void 0!==_b&&_b}return!1}),((toolState,isNewAdded)=>({toolState,isNewAdded}))),ToolbarItem=jimu_core.E_S.connect(mapFunc)(_ToolbarItem);try{ToolbarItem.displayName="ToolbarItem",ToolbarItem.__docgenInfo={description:"",displayName:"ToolbarItem",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string | ((props: LayoutContextToolProps & { formatMessage: (id: string, values?: any) => string; }) => string)"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(props: LayoutContextToolProps, evt?: MouseEvent<any, MouseEvent>) => void"}},onMouseEnter:{defaultValue:null,description:"",name:"onMouseEnter",required:!1,type:{name:"(props: LayoutContextToolProps, evt?: MouseEvent<any, MouseEvent>) => void"}},onMouseLeave:{defaultValue:null,description:"",name:"onMouseLeave",required:!1,type:{name:"(props: LayoutContextToolProps, evt?: MouseEvent<any, MouseEvent>) => void"}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:"number"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean | ((props: LayoutContextToolProps) => boolean)"}},separator:{defaultValue:null,description:"",name:"separator",required:!1,type:{name:"boolean"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string | ((props: LayoutContextToolProps & { formatMessage: (id: string, values?: any) => string; }) => string)"}},icon:{defaultValue:null,description:"",name:"icon",required:!1,type:{name:"ComponentClass<SVGAttributes<SVGElement>, any> | ((props: LayoutContextToolProps) => ComponentClass<SVGAttributes<SVGElement>, any>)"}},checked:{defaultValue:null,description:"",name:"checked",required:!1,type:{name:"boolean | ((props: LayoutContextToolProps) => boolean)"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!1,type:{name:"string"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}},caret:{defaultValue:null,description:"",name:"caret",required:!1,type:{name:"boolean"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean | ((props: LayoutContextToolProps) => boolean)"}},uid:{defaultValue:null,description:"",name:"uid",required:!0,type:{name:"string"}},extName:{defaultValue:null,description:"",name:"extName",required:!1,type:{name:"string"}},autoFlipIcon:{defaultValue:null,description:"",name:"autoFlipIcon",required:!1,type:{name:"boolean"}},openWhenAdded:{defaultValue:null,description:"",name:"openWhenAdded",required:!1,type:{name:"boolean"}},settingPanel:{defaultValue:null,description:"",name:"settingPanel",required:!1,type:{name:"ComponentClass<ToolSettingPanelProps, any> | FunctionComponent<ToolSettingPanelProps>"}},isInGroup:{defaultValue:null,description:"",name:"isInGroup",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/toolbar-item.tsx#ToolbarItem"]={docgenInfo:ToolbarItem.__docgenInfo,name:"ToolbarItem",path:"../jimu-layouts/lib/builder/toolbar-item.tsx#ToolbarItem"})}catch(__react_docgen_typescript_loader_error){}const noAction=()=>null;class ToolbarGroup extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.togglePopToolItems=e=>{e&&e.stopPropagation(),this.contextProps.onItemClick(this.props.uid)},this.onItemClick=(toolConfig,props)=>{const{parentRef}=this.contextProps;toolConfig.onClick(Object.assign(Object.assign({},props),{clientRect:parentRef.getBoundingClientRect()})),jimu_core.CM0.defer((()=>{(0,jimu_core.u02)(this.dropdownBtnRef.current)}))},this.handleDoubleClick=e=>{e.stopPropagation()},this.dropdownBtnRef=jimu_core.q_G.createRef()}getBaseStyle(){const{theme}=this.contextProps;return jimu_core.AHW`
      cursor: pointer;
      display: flex;
      justify-content: space-around;
      align-items: center;
      background-color: ${theme.ref.palette.neutral[400]};

      &:hover {
        background-color: ${theme.ref.palette.neutral[500]} !important;
      }
    `}getValue(target,props){return"function"==typeof target?target(props):target}createToolItem(toolConfig,props,index){return toolConfig.onClick||toolConfig.separator?(0,jimu_core.Yac)(ToolbarItem,Object.assign({key:index,uid:`${this.props.uid}_${index+1}`,isInGroup:!0},toolConfig,{onClick:()=>{this.onItemClick(toolConfig,props)}})):null}getGroupMenu(selectedTool,visibleTools){const{theme}=this.contextProps;return selectedTool?(0,jimu_core.Yac)(jimu_ui.Icon,{rotate:selectedTool.rotate,icon:selectedTool.icon,size:selectedTool.size||16,color:theme.ref.palette.black}):visibleTools[0].icon?(0,jimu_core.Yac)(jimu_ui.Icon,{icon:visibleTools[0].icon,size:visibleTools[0].size||16,color:theme.ref.palette.black}):(0,jimu_core.Yac)(ToolbarItem,Object.assign({uid:`${this.props.uid}_0`,onClick:noAction},visibleTools[0]))}tooltipStyle(){const{theme}=this.contextProps;return jimu_core.AHW`
      border: none;

      .tooltip {
        color: ${theme.ref.palette.black};
        background-color: ${theme.ref.palette.neutral[600]};
        border-color: ${theme.ref.palette.neutral[400]};
      }
    `}render(){const{tools,uid}=this.props;return tools&&0!==tools.length?(0,jimu_core.Yac)(ToolbarContext.Consumer,null,(props=>{var _a;this.contextProps=props;const{visible:rootVisible,caret=!0,title}=tools[0],isRootVisible=this.getValue(rootVisible,props);if(void 0!==rootVisible&&!isRootVisible)return null;const visibleTools=tools.filter((tool=>{const{visible}=tool,isVisible=this.getValue(visible,props);return void 0===visible||isVisible}));if(0===visibleTools.length)return null;if(1===visibleTools.length)return(0,jimu_core.Yac)(ToolbarItem,Object.assign({uid:`${uid}_0`},visibleTools[0]));let selectedTool;visibleTools.some((tool=>{const{checked}=tool;return!!this.getValue(checked,props)&&(selectedTool=tool,!0)}));let tooltip="";return"function"==typeof title?tooltip=title(props):"string"==typeof title&&(tooltip=title),(0,jimu_core.Yac)("div",{className:"toolbar-group",css:this.getBaseStyle()},(0,jimu_core.Yac)(jimu_ui.Dropdown,{direction:"down",size:"sm",className:caret?"px-1":"",isOpen:null!==(_a=props.toggleOn)&&void 0!==_a&&_a&&props.activeItem===uid,toggle:this.togglePopToolItems},(0,jimu_core.Yac)(jimu_ui.Tooltip,{placement:"bottom",title:tooltip,css:this.tooltipStyle()},(0,jimu_core.Yac)(jimu_ui.DropdownButton,{icon:!0,arrow:caret,type:"tertiary",disableHoverEffect:!0,size:"sm",ref:this.dropdownBtnRef,css:jimu_core.AHW`
                      .caret-icon {
                        color: ${props.theme.ref.palette.neutral[1e3]};
                        margin-left: 0.25rem;
                      }
                    `,onDoubleClick:this.handleDoubleClick},this.getGroupMenu(selectedTool,visibleTools))),(0,jimu_core.Yac)(jimu_ui.DropdownMenu,{className:`p-0 ${window.jimuConfig.isInBuilder?jimu_theme.Dk:""}`,css:jimu_core.AHW`min-width: 5rem;`},visibleTools.map(((toolConfig,index)=>this.createToolItem(toolConfig,props,index))))))})):null}}try{ToolbarGroup.displayName="ToolbarGroup",ToolbarGroup.__docgenInfo={description:"",displayName:"ToolbarGroup",props:{uid:{defaultValue:null,description:"",name:"uid",required:!0,type:{name:"string"}},tools:{defaultValue:null,description:"",name:"tools",required:!0,type:{name:"ToolItemConfig[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/toolbar-group.tsx#ToolbarGroup"]={docgenInfo:ToolbarGroup.__docgenInfo,name:"ToolbarGroup",path:"../jimu-layouts/lib/builder/toolbar-group.tsx#ToolbarGroup"})}catch(__react_docgen_typescript_loader_error){}var lib_utils=__webpack_require__("../jimu-layouts/lib/utils.ts"),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};function getRootLayoutId(){if(layout_runtime.utils.getCurrentDialogId())return layout_runtime.utils.getCurrentDialogRootLayoutId();switch(layout_runtime.utils.getActivePagePart()){case jimu_core.xH7.Header:return layout_runtime.utils.getHeaderRootLayoutId();case jimu_core.xH7.Footer:return layout_runtime.utils.getFooterRootLayoutId();default:return layout_runtime.utils.getCurrentPageRootLayoutId()}}function updateLayoutAndSelection(appConfig,selection){if(window.jimuConfig.isBuilder){(0,jimu_for_builder.getAppConfigAction)(appConfig).exec(),jimu_for_builder.builderAppSync.publishChangeSelectionToApp(selection)}else layout_runtime.utils.changeLayout(appConfig,selection)}function pasteLayoutItem(clipboardItem,targetLayoutId){var _a,_b;const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),{layoutId,layoutItemId}=clipboardItem;if(!(null===(_b=null===(_a=appConfigAction.appConfig.layouts[layoutId])||void 0===_a?void 0:_a.content)||void 0===_b?void 0:_b[layoutItemId]))return;const layoutType=appConfigAction.appConfig.layouts[targetLayoutId].type;if(layoutType===jimu_core.p5K.FlowLayout)!function pasteToFlowLayout(clipboardItem,targetLayoutId){var _a,_b,_c;const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),{layoutId,layoutItemId,width,height}=clipboardItem,newItemId=appConfigAction.duplicateLayoutItemToOtherLayout({layoutId,layoutItemId},targetLayoutId),layoutInfo={layoutId:targetLayoutId,layoutItemId:newItemId},zoomScale=null!==(_b=null===(_a=(0,jimu_core.Vp3)().getState().appRuntimeInfo)||void 0===_a?void 0:_a.zoomScale)&&void 0!==_b?_b:1;appConfigAction.adjustOrderOfItem(layoutInfo,-1);const visibleInfo=function getFirstVisibleBlock(layoutId,width,zoomScale){if(!window.jimuConfig.isInBuilder)return{insertIndex:-1,colSpan:0};const deviceFrame=window.parent.document.querySelector('iframe[name="_appWindow"]'),childNodes=document.querySelectorAll(`div.flow-layout[data-layoutid="${layoutId}"] > div.trail-container > div.builder-layout-item`);let index=-1,colSpan=2;if(deviceFrame&&childNodes){const frameRect=deviceFrame.getBoundingClientRect();childNodes.forEach(((node,i)=>{if(-1===index){const itemRect=node.getBoundingClientRect();(itemRect.top+frameRect.top>=0||itemRect.top+itemRect.height+frameRect.top>=0)&&(index=i+1)}})),colSpan=Math.round(12*width*zoomScale/frameRect.width)}return{colSpan,insertIndex:index}}(targetLayoutId,width,zoomScale);-1===visibleInfo.insertIndex&&(visibleInfo.insertIndex=(null===(_c=appConfigAction.appConfig.layouts[targetLayoutId].order)||void 0===_c?void 0:_c.length)||0);const fromLayoutType=appConfigAction.appConfig.layouts[layoutId].type;fromLayoutType===jimu_core.p5K.FlowLayout?updateLayoutAndSelection(appConfigAction.appConfig,layoutInfo):addBlockToFlowLayout({layoutInfo},{targetLayoutId,containerRect:{left:0,top:0,width,height},itemRect:{left:0,top:0,width,height},width:visibleInfo.colSpan,insertIndex:visibleInfo.insertIndex,appConfig:appConfigAction.appConfig}).catch((err=>{console.error(err)}))}(clipboardItem,targetLayoutId);else if(layoutType===jimu_core.p5K.FixedLayout)!function pasteToFixedLayout(clipboardItem,targetLayoutId,containerRect=null){var _a,_b,_c,_d;const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),{layoutId,layoutItemId,width,height}=clipboardItem,originalLayoutItem=null===(_b=null===(_a=appConfigAction.appConfig.layouts[layoutId])||void 0===_a?void 0:_a.content)||void 0===_b?void 0:_b[layoutItemId],originalBBox=originalLayoutItem.bbox,newItemId=appConfigAction.duplicateLayoutItemToOtherLayout({layoutId,layoutItemId},targetLayoutId),layoutInfo={layoutId:targetLayoutId,layoutItemId:newItemId},zoomScale=null!==(_d=null===(_c=(0,jimu_core.Vp3)().getState().appRuntimeInfo)||void 0===_c?void 0:_c.zoomScale)&&void 0!==_d?_d:1;containerRect||(containerRect=function getVisibleWorkArea(layoutId){if(!window.jimuConfig.isInBuilder)return;const workarea=window.parent.document.querySelector('div[data-layoutid="right-sidebar-left-layout"]'),deviceFrame=window.parent.document.querySelector('iframe[name="_appWindow"]');let layoutDiv,left,top,width,height;if(workarea&&deviceFrame){const workareaRect=workarea.getBoundingClientRect(),frameRect=deviceFrame.getBoundingClientRect();if(left=frameRect.left,top=frameRect.top,width=frameRect.width,height=frameRect.height,layoutId){if(layoutDiv=(deviceFrame.contentDocument||deviceFrame.contentWindow.document).querySelector(`div.layout[data-layoutid="${layoutId}"]`),layoutDiv){const layoutRect=layoutDiv.getBoundingClientRect();left+=layoutRect.left,top+=layoutRect.top,width=layoutRect.width,height=layoutRect.height}}return{left:left>=workareaRect.left?0:workareaRect.left-left,top:top>=workareaRect.top?0:workareaRect.top-top,width,height}}return null}(targetLayoutId));if(containerRect){const containerWidth=containerRect.width/zoomScale,containerHeight=containerRect.height/zoomScale;appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",layout_runtime.utils.replaceBoundingBox(originalBBox,{left:0,top:0,right:0,bottom:0,width:Math.round(width),height:Math.round(height)},{width:containerWidth,height:containerHeight}))}appConfigAction.editLayoutItemProperty(layoutInfo,"setting.vCenter",!0).editLayoutItemProperty(layoutInfo,"setting.hCenter",!0);const bbox=appConfigAction.appConfig.layouts[layoutInfo.layoutId].content[layoutInfo.layoutItemId].bbox;appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox.set("left","50%").set("top","50%")),appConfigAction.adjustOrderOfItem(layoutInfo,-1),layout_runtime.utils.changeLayout(appConfigAction.appConfig,layoutInfo)}(clipboardItem,targetLayoutId);else if(layoutType===jimu_core.p5K.GridLayout){const[appConfig,layoutInfo]=function pasteToGridLayout(appConfig,clipboardItem,targetLayoutId){var _a,_b;let appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig);const{layoutId,layoutItemId}=clipboardItem,layout=appConfig.layouts[targetLayoutId],rootItemId=(null===(_a=layout.content)||void 0===_a?void 0:_a[null===(_b=layout.setting)||void 0===_b?void 0:_b.rootItem])?layout.setting.rootItem:null,newItemId=appConfigAction.duplicateLayoutItemToOtherLayout({layoutId,layoutItemId},targetLayoutId),newLayoutInfo={layoutId:targetLayoutId,layoutItemId:newItemId};if(!rootItemId)return appConfigAction.editLayoutItemProperty(newLayoutInfo,"gridType",jimu_core.Qwn.Plain).editLayoutItemProperty(newLayoutInfo,"bbox.width",100).editLayoutProperty(targetLayoutId,"setting.rootItem",newItemId),[appConfigAction.appConfig,newLayoutInfo];const rootLayoutInfo={layoutId:targetLayoutId,layoutItemId:rootItemId},rootLayoutItem=layout_runtime.searchUtils.findLayoutItem(appConfigAction.appConfig,rootLayoutInfo),rootType=rootLayoutItem.gridType,service=jimu_for_builder.LayoutServiceProvider.getService(appConfigAction.appConfig,targetLayoutId),result=service.createBlankItem(appConfigAction.appConfig,targetLayoutId);appConfig=result[0];const rowItemId=result[1],rowLayoutInfo={layoutId:targetLayoutId,layoutItemId:rowItemId};return appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),appConfigAction.editLayoutItemProperty(rowLayoutInfo,"gridType",rootType!==jimu_core.Qwn.Row?jimu_core.Qwn.Row:jimu_core.Qwn.Column).editLayoutItemProperty(rowLayoutInfo,"children",[rootItemId,newItemId]).editLayoutItemProperty(rowLayoutInfo,"bbox.width",100).editLayoutItemProperty(rootLayoutInfo,"bbox.width",50).editLayoutItemProperty(rootLayoutInfo,"parent",rowItemId).editLayoutItemProperty(newLayoutInfo,"bbox.width",50).editLayoutItemProperty(newLayoutInfo,"parent",rowItemId).editLayoutItemProperty(newLayoutInfo,"gridType",jimu_core.Qwn.Plain).editLayoutProperty(targetLayoutId,"setting.rootItem",rowItemId),[appConfigAction.appConfig,newLayoutInfo]}(appConfigAction.appConfig,clipboardItem,targetLayoutId);layout_runtime.utils.changeLayout(appConfig,layoutInfo)}else console.error(`unknown layout type: ${layoutType}`)}function common_layout_actions_addItemToLayout(appConfig,item,targetLayoutId){return __awaiter(this,void 0,void 0,(function*(){const layoutInfo=item.layoutInfo;return item.id?yield function addPendingItemToLayout(appConfig,item,targetLayoutId){return __awaiter(this,void 0,void 0,(function*(){var _a;const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig);let fromSizeMode;const currentSizeMode=layout_runtime.utils.getCurrentSizeMode();fromSizeMode=item.isFromCurrentSizeMode?currentSizeMode:layout_runtime.searchUtils.getBrowserSizeModeByLayoutId(appConfig,item.layoutInfo.layoutId);const originLayoutItem=layout_runtime.searchUtils.findLayoutItem(appConfigAction.appConfig,item.layoutInfo),newLayoutInfo=appConfigAction.moveLayoutItem(item.layoutInfo,targetLayoutId,fromSizeMode,currentSizeMode);return(null===(_a=originLayoutItem.setting)||void 0===_a?void 0:_a.lockParent)&&appConfigAction.editLayoutItemProperty(newLayoutInfo,"setting.lockParent",!0),yield Promise.resolve({layoutInfo:newLayoutInfo,updatedAppConfig:appConfigAction.appConfig})}))}(appConfig,item,targetLayoutId):layoutInfo&&layoutInfo.layoutId&&layoutInfo.layoutItemId?function moveLayoutItem(appConfig,item,targetLayoutId){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),currentSizeMode=layout_runtime.utils.getCurrentSizeMode(),newLayoutInfo=appConfigAction.moveLayoutItem(item.layoutInfo,targetLayoutId,currentSizeMode,currentSizeMode),pWidgetId=layout_runtime.searchUtils.getWidgetIdThatUseTheLayoutId(appConfig,targetLayoutId);pWidgetId&&shouldLockParent(appConfig.widgets[pWidgetId])&&appConfigAction.editLayoutItemProperty(newLayoutInfo,"setting.lockParent",!0);return{layoutInfo:newLayoutInfo,updatedAppConfig:appConfigAction.appConfig}}(appConfig,item,targetLayoutId):item.itemType===jimu_core.K6q.Section?function addNewSectionToLayout(appConfig,targetLayoutId){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),newItemId=appConfigAction.addNewSectionToLayout(targetLayoutId),newLayoutInfo={layoutId:targetLayoutId,layoutItemId:newItemId};return{layoutInfo:newLayoutInfo,updatedAppConfig:appConfigAction.appConfig}}(appConfig,targetLayoutId):item.uri||item.itemId?yield function addNewWidgetToLayout(appConfig,item,targetLayoutId){return __awaiter(this,void 0,void 0,(function*(){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),newItemId=yield appConfigAction.addNewWidgetToLayout(targetLayoutId,{uri:item.uri,itemId:item.itemId}),newLayoutInfo={layoutId:targetLayoutId,layoutItemId:newItemId},pWidgetId=layout_runtime.searchUtils.getWidgetIdThatUseTheLayoutId(appConfig,targetLayoutId);return pWidgetId&&shouldLockParent(appConfig.widgets[pWidgetId])&&appConfigAction.editLayoutItemProperty(newLayoutInfo,"setting.lockParent",!0),{layoutInfo:newLayoutInfo,updatedAppConfig:appConfigAction.appConfig}}))}(appConfig,item,targetLayoutId):function addPlaceholderToLayout(appConfig,targetLayoutId){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),newItemId=appConfigAction.addPlaceholderToLayout(targetLayoutId),newLayoutInfo={layoutId:targetLayoutId,layoutItemId:newItemId},pWidgetId=layout_runtime.searchUtils.getWidgetIdThatUseTheLayoutId(appConfig,targetLayoutId);pWidgetId&&shouldLockParent(appConfig.widgets[pWidgetId])&&appConfigAction.editLayoutItemProperty(newLayoutInfo,"setting.lockParent",!0);return{layoutInfo:newLayoutInfo,updatedAppConfig:appConfigAction.appConfig}}(appConfig,targetLayoutId)}))}function shouldLockParent(widgetJson){var _a,_b,_c,_d,_e,_f,_g;const type=null===(_a=null==widgetJson?void 0:widgetJson.manifest)||void 0===_a?void 0:_a.widgetType,hasEmbeddedLayout=null!==(_d=null===(_c=null===(_b=null==widgetJson?void 0:widgetJson.manifest)||void 0===_b?void 0:_b.properties)||void 0===_c?void 0:_c.hasEmbeddedLayout)&&void 0!==_d&&_d,lockChildren=null!==(_g=null===(_f=null===(_e=null==widgetJson?void 0:widgetJson.manifest)||void 0===_e?void 0:_e.properties)||void 0===_f?void 0:_f.lockChildren)&&void 0!==_g&&_g;return type!==jimu_core.xOw.Layout&&hasEmbeddedLayout&&lockChildren}function addBlockToFlowLayout(draggingItem,options){return __awaiter(this,void 0,void 0,(function*(){const{targetLayoutId,containerRect,itemRect,width,insertIndex,appConfig}=options;let appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig);const rowWidgetInfo={name:"row",label:"row",uri:"widgets/layout/row/",icon:null,itemType:jimu_core.K6q.Widget,manifest:{widgetType:jimu_core.xOw.Layout,properties:{}}},result=yield common_layout_actions_addItemToLayout(appConfigAction.appConfig,rowWidgetInfo,targetLayoutId),{updatedAppConfig,layoutInfo}=result,bbox=layout_runtime.utils.replaceBoundingBox(null,itemRect,containerRect);appConfigAction=(0,jimu_for_builder.getAppConfigAction)(updatedAppConfig),appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox).adjustOrderOfItem(layoutInfo,insertIndex);const layoutItem=layout_runtime.searchUtils.findLayoutItem(updatedAppConfig,result.layoutInfo),widgetJson=updatedAppConfig.widgets[layoutItem.widgetId],layoutName=Object.keys(widgetJson.layouts)[0],rowLayouts=widgetJson.layouts[layoutName],layoutId=layout_runtime.searchUtils.findLayoutId(rowLayouts,(0,jimu_core.Vp3)().getState().browserSizeMode,updatedAppConfig.mainSizeMode),blockLabel=jimu_core.Ruy.getIntl().formatMessage({id:"block"}),widgetLabel=jimu_core.VbA.getUniqueLabel(updatedAppConfig,"widget",blockLabel);appConfigAction.editWidgetProperty(widgetJson.id,"label",widgetLabel).editLayoutItemProperty(layoutInfo,"setting.heightMode","fixed").editLayoutItemProperty(layoutInfo,"bbox.height",itemRect.height+20).editLayoutProperty(layoutId,"parent",{id:widgetJson.id,type:jimu_core.$4y.Widget});const result1=yield common_layout_actions_addItemToLayout(appConfigAction.appConfig,draggingItem,layoutId),{layoutInfo:layoutInfo1,updatedAppConfig:updatedAppConfig1}=result1;appConfigAction=(0,jimu_for_builder.getAppConfigAction)(updatedAppConfig1),appConfigAction.editLayoutItemProperty(layoutInfo1,"setting.heightMode","fit").editLayoutItemProperty(layoutInfo1,"bbox.left",0).editLayoutItemProperty(layoutInfo1,"bbox.width",width).editLayoutItemProperty(layoutInfo1,"bbox.height",Math.round(Math.min(itemRect.height,containerRect.height))).adjustOrderOfItem(layoutInfo1,0),window.jimuConfig.isBuilder?((0,jimu_for_builder.getAppConfigAction)(appConfigAction.appConfig).exec(),jimu_for_builder.builderAppSync.publishChangeSelectionToApp(layoutInfo1)):layout_runtime.utils.changeLayout(appConfigAction.appConfig,layoutInfo1)}))}class FloatingAreaChooser extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.topLeft=this.updateFloatingArea.bind(this,1),this.topCenter=this.updateFloatingArea.bind(this,2),this.topRight=this.updateFloatingArea.bind(this,3),this.middleLeft=this.updateFloatingArea.bind(this,4),this.middleCenter=this.updateFloatingArea.bind(this,5),this.middleRight=this.updateFloatingArea.bind(this,6),this.bottomLeft=this.updateFloatingArea.bind(this,7),this.bottomCenter=this.updateFloatingArea.bind(this,8),this.bottomRight=this.updateFloatingArea.bind(this,9)}updateFloatingArea(value){const{layoutId,layoutItemId}=this.props;!function floatingLayoutItem(layoutInfo,clientRect,area){return __awaiter(this,void 0,void 0,(function*(){const rootLayoutId=layout_runtime.utils.getCurrentPageRootLayoutId();let appConfigAction=(0,jimu_for_builder.getAppConfigAction)();const result=yield common_layout_actions_addItemToLayout(appConfigAction.appConfig,{layoutInfo},rootLayoutId);appConfigAction=(0,jimu_for_builder.getAppConfigAction)(result.updatedAppConfig),appConfigAction.editLayoutItemProperty(result.layoutInfo,"bbox",{top:0,left:0,right:0,width:`${clientRect.width}px`,height:`${clientRect.height}px`}).editLayoutItemProperty(result.layoutInfo,"setting.isFloating",!0).editLayoutItemProperty(result.layoutInfo,"setting.lockParent",!0).editLayoutItemProperty(result.layoutInfo,"setting.floatingArea",area).adjustOrderOfItem(result.layoutInfo,null),window.jimuConfig.isBuilder?((0,jimu_for_builder.getAppConfigAction)(appConfigAction.appConfig).exec(),jimu_for_builder.builderAppSync.publishChangeSelectionToApp(result.layoutInfo)):layout_runtime.utils.changeLayout(appConfigAction.appConfig,result.layoutInfo)}))}({layoutId,layoutItemId},this.getSizeOfItem(),value)}getSizeOfItem(){const{layoutId,layoutItemId}=this.props;let appDoc;if(window.jimuConfig.isBuilder){const appFrame=document.querySelector(`iframe[name="${jimu_core.mXW}"]`);appDoc=(null==appFrame?void 0:appFrame.contentDocument)||(null==appFrame?void 0:appFrame.contentWindow.document)}else appDoc=document;const layoutElem=appDoc.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItemId}"]`);return layoutElem?layoutElem.getBoundingClientRect():null}getStyle(){let theme;theme=window.jimuConfig.isBuilder?(0,jimu_theme.O4)():(0,jimu_theme.wE)();const borderColor=theme.ref.palette.neutral[500];return jimu_core.AHW`
      background-color: ${theme.ref.palette.neutral[400]};
      position: relative;
      padding: 4px;

      .content {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        grid-row-gap: 0;
        grid-column-gap: 0;
        border: 1px solid ${borderColor};

        & > button {
          cursor: pointer;
          height: 50px;
          width: 50px;
          position: relative;
          border: none;
          background-color: transparent;
          border-radius: 0;

          &:after {
            content: '';
            position: absolute;
            left: 1px;
            top: 1px;
            right: 1px;
            bottom: 1px;
          }

          &:hover {
            &:after {
              outline: 1px solid ${theme.sys.color.primary.dark};
              background: ${theme.sys.color.primary.light};
            }
          }
        }

        & > button:nth-of-type(3n+1) {
          border-right: 1px solid ${borderColor};
        }
        & > button:nth-of-type(3n) {
          border-left: 1px solid ${borderColor};
        }
        & > button:nth-of-type(1), & > button:nth-of-type(2), & > button:nth-of-type(3) {
          border-bottom: 1px solid ${borderColor};
        }
        & > button:nth-of-type(7), & > button:nth-of-type(8), & > button:nth-of-type(9) {
          border-top: 1px solid ${borderColor};
        }

        .selected:after {
          content: '';
          position: absolute;
          width: 100%;
          height: 100%;
          background-color: ${theme.sys.color.primary.light};
          border: 1px solid ${theme.sys.color.primary.main};
        }
      }
    `}render(){const{area}=this.props;return(0,jimu_core.Yac)("div",{className:"floating-area-chooser d-flex",css:this.getStyle()},(0,jimu_core.Yac)("div",{className:"content w-100"},(0,jimu_core.Yac)(jimu_ui.Button,{className:(0,jimu_core.xWm)("top-left",{selected:1===area}),onClick:this.topLeft}),(0,jimu_core.Yac)(jimu_ui.Button,{className:(0,jimu_core.xWm)("top-center",{selected:2===area}),onClick:this.topCenter}),(0,jimu_core.Yac)(jimu_ui.Button,{className:(0,jimu_core.xWm)("top-right",{selected:3===area}),onClick:this.topRight}),(0,jimu_core.Yac)(jimu_ui.Button,{className:(0,jimu_core.xWm)("middle-left",{selected:4===area}),onClick:this.middleLeft}),(0,jimu_core.Yac)(jimu_ui.Button,{className:(0,jimu_core.xWm)("middle-center",{selected:5===area}),onClick:this.middleCenter}),(0,jimu_core.Yac)(jimu_ui.Button,{className:(0,jimu_core.xWm)("middle-right",{selected:6===area}),onClick:this.middleRight}),(0,jimu_core.Yac)(jimu_ui.Button,{className:(0,jimu_core.xWm)("bottom-left",{selected:7===area}),onClick:this.bottomLeft}),(0,jimu_core.Yac)(jimu_ui.Button,{className:(0,jimu_core.xWm)("bottom-center",{selected:8===area}),onClick:this.bottomCenter}),(0,jimu_core.Yac)(jimu_ui.Button,{className:(0,jimu_core.xWm)("bottom-right",{selected:9===area}),onClick:this.bottomRight})))}}FloatingAreaChooser.defaultProps={area:0};try{FloatingAreaChooser.displayName="FloatingAreaChooser",FloatingAreaChooser.__docgenInfo={description:"",displayName:"FloatingAreaChooser",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!1,type:{name:"string"}},area:{defaultValue:{value:"0"},description:"",name:"area",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/menu/floating-area-chooser.tsx#FloatingAreaChooser"]={docgenInfo:FloatingAreaChooser.__docgenInfo,name:"FloatingAreaChooser",path:"../jimu-layouts/lib/builder/menu/floating-area-chooser.tsx#FloatingAreaChooser"})}catch(__react_docgen_typescript_loader_error){}var trash=__webpack_require__("../jimu-icons/svg/outlined/editor/trash.svg"),trash_default=__webpack_require__.n(trash),pending=__webpack_require__("../jimu-icons/svg/outlined/editor/pending.svg"),pending_default=__webpack_require__.n(pending),move=__webpack_require__("../jimu-icons/svg/outlined/editor/move.svg"),move_default=__webpack_require__.n(move),duplicate=__webpack_require__("../jimu-icons/svg/outlined/editor/duplicate.svg"),duplicate_default=__webpack_require__.n(duplicate),editor_float=__webpack_require__("../jimu-icons/svg/outlined/editor/float.svg"),float_default=__webpack_require__.n(editor_float),unfloat=__webpack_require__("../jimu-icons/svg/outlined/editor/unfloat.svg"),unfloat_default=__webpack_require__.n(unfloat),setting=__webpack_require__("../jimu-icons/svg/outlined/application/setting.svg"),setting_default=__webpack_require__.n(setting);function getAppMode(){var _a;let state=(0,jimu_core.Vp3)().getState();return window.jimuConfig.isBuilder&&(state=state.appStateInBuilder),null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode}function isLockLayout(){var _a,_b,_c;let state=(0,jimu_core.Vp3)().getState();return window.jimuConfig.isBuilder&&(state=state.appStateInBuilder),null!==(_c=null===(_b=null===(_a=state.appConfig)||void 0===_a?void 0:_a.forBuilderAttributes)||void 0===_b?void 0:_b.lockLayout)&&void 0!==_c&&_c}function getLabelOfLayoutItem(layoutItem){var _a,_b,_c;const appConfig=(0,jimu_core.Vp3)().getState().appConfig;if(layoutItem.type===jimu_core.K6q.Widget){const widgetJson=appConfig.widgets[layoutItem.widgetId];return null!==(_a=null==widgetJson?void 0:widgetJson.label)&&void 0!==_a?_a:""}if(layoutItem.type===jimu_core.K6q.Section){const sectionJson=appConfig.sections[layoutItem.sectionId];return null!==(_b=null==sectionJson?void 0:sectionJson.label)&&void 0!==_b?_b:""}if(layoutItem.type===jimu_core.K6q.ScreenGroup){const sgJson=appConfig.screenGroups[layoutItem.screenGroupId];return null!==(_c=null==sgJson?void 0:sgJson.label)&&void 0!==_c?_c:""}return""}function isDesignMode(){return getAppMode()===jimu_core.$0N.Design}function isExpressMode(){return getAppMode()===jimu_core.$0N.Express}function isNormalWidget(layoutItem){var _a;let state=(0,jimu_core.Vp3)().getState();if(window.jimuConfig.isBuilder&&(state=state.appStateInBuilder),layoutItem.type===jimu_core.K6q.Widget&&layoutItem.widgetId){const widget=state.appConfig.widgets[layoutItem.widgetId];if(widget)return(null===(_a=widget.manifest)||void 0===_a?void 0:_a.widgetType)!==jimu_core.xOw.Layout}return!1}const deleteMenuItem={icon:trash_default(),title:props=>props.formatMessage("delete"),visible:props=>{const appMode=getAppMode();return(appMode===jimu_core.$0N.Design||appMode===jimu_core.$0N.Express)&&(!isLockLayout()||isNormalWidget(props.layoutItem))},onClick:props=>{const{layoutItem,layoutId}=props,layoutInfo={layoutId,layoutItemId:layoutItem.id};jimu_for_builder.appBuilderSync.publishConfirmDeleteToApp(layoutInfo)}},pendingMenuItem={icon:pending_default(),title:props=>props.formatMessage("pendingTip"),visible:props=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout()&&function hasContent(props){const{layoutItem}=props;return null!=layoutItem.widgetId||null!=layoutItem.sectionId||null!=layoutItem.screenGroupId}(props),onClick:props=>{const{layoutId,layoutItem}=props;!function pendLayoutItem(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();appConfigAction.setLayoutItemToPending(layoutInfo,!0),updateLayoutAndSelection(appConfigAction.appConfig,null)}({layoutId,layoutItemId:layoutItem.id})}},settingMenuItem={icon:setting_default(),title:props=>props.formatMessage("setting"),onClick:props=>{const{layoutId,layoutItem}=props;(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged({layoutId,layoutItemId:layoutItem.id}))}},draggingMenuItem={icon:move_default(),title:props=>{const{layoutItem}=props;return props.formatMessage("dragToMove",{label:getLabelOfLayoutItem(layoutItem)})},visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout()},duplicateMenuItem={icon:duplicate_default(),title:props=>props.formatMessage("duplicate"),visible:props=>{var _a,_b,_c;if(isLockLayout()||!isDesignMode())return!1;const{layoutId}=props,layout=null===(_a=(0,jimu_core.Vp3)().getState().appConfig)||void 0===_a?void 0:_a.layouts[layoutId];return"ROW"!==(null==layout?void 0:layout.type)||(null!==(_c=null===(_b=layout.order)||void 0===_b?void 0:_b.length)&&void 0!==_c?_c:0)<12},onClick:props=>{const{layoutId,layoutItem}=props;!function duplicateLayoutItem(layoutInfo){const{layoutId}=layoutInfo,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),newLayoutInfo={layoutId,layoutItemId:appConfigAction.duplicateLayoutItemInSameLayout(layoutInfo)};updateLayoutAndSelection(appConfigAction.appConfig,newLayoutInfo)}({layoutId,layoutItemId:layoutItem.id})}},floatingMenuItem={icon:float_default(),title:props=>props.formatMessage("floating"),visible:props=>{if(isLockLayout()||!isDesignMode())return!1;const{layoutItem,layoutId}=props;return function supportFloating(layoutInfo){var _a,_b,_c,_d,_e;const{layoutId,layoutItemId}=layoutInfo,appConfig=(0,jimu_for_builder.getAppConfigAction)().appConfig,layoutItem=null===(_c=null===(_b=null===(_a=null==appConfig?void 0:appConfig.layouts)||void 0===_a?void 0:_a[layoutId])||void 0===_b?void 0:_b.content)||void 0===_c?void 0:_c[layoutItemId];if(!layoutItem||(null===(_d=layoutItem.setting)||void 0===_d?void 0:_d.isFloating))return!1;const pagePart=layout_runtime.utils.getActivePagePart();if(pagePart!==jimu_core.xH7.Header&&pagePart!==jimu_core.xH7.Footer){const rootLayoutId=layout_runtime.utils.getCurrentPageRootLayoutId();return(null===(_e=appConfig.layouts[rootLayoutId])||void 0===_e?void 0:_e.type)===jimu_core.p5K.FlowLayout&&layoutId!==rootLayoutId}return!1}({layoutId,layoutItemId:layoutItem.id})},settingPanel:FloatingAreaChooser,onClick:()=>null},sinkingMenuItem={icon:unfloat_default(),title:props=>props.formatMessage("sinking"),visible:props=>{var _a,_b;if(isLockLayout()||!isDesignMode())return!1;const{layoutItem}=props;return null!==(_b=null===(_a=layoutItem.setting)||void 0===_a?void 0:_a.isFloating)&&void 0!==_b&&_b},onClick:props=>{const{layoutId,layoutItem,clientRect}=props;!function sinkingLayoutItem(layoutInfo,clientRect){var _a;const{layoutId,layoutItemId}=layoutInfo,appConfigAction=(0,jimu_for_builder.getAppConfigAction)();let containerRect,appDoc,insertIndex=-1,width=2;if(window.jimuConfig.isBuilder){const appFrame=document.querySelector(`iframe[name="${jimu_core.mXW}"]`);appDoc=(null==appFrame?void 0:appFrame.contentDocument)||(null==appFrame?void 0:appFrame.contentWindow.document)}else appDoc=document;if(null==clientRect){const layoutElem=appDoc.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItemId}"]`);clientRect=layoutElem?layoutElem.getBoundingClientRect():{width:100,height:100}}const childNodes=appDoc.querySelectorAll(`div.flow-layout[data-layoutid="${layoutId}"] > div.trail-container > div.builder-layout-item:not(.floating)`);if((null==childNodes?void 0:childNodes.length)>1)for(let i=0;i<childNodes.length;i++){const node=childNodes[i];if(-1===insertIndex&&node.getAttribute("data-layoutitemid")!==layoutItemId){const itemRect=node.getBoundingClientRect();if(width=Math.round(12*clientRect.width/itemRect.width),layout_runtime.utils.contains(itemRect,clientRect)){insertIndex=i,containerRect=itemRect;break}if(layout_runtime.utils.intersects(itemRect,clientRect)){insertIndex=i+1,containerRect=itemRect;break}}}else{const viewportSize=jimu_core.WpD.findViewportSize(layout_runtime.utils.getAppConfig(),layout_runtime.utils.getCurrentSizeMode());containerRect={left:0,top:0,width:viewportSize.width,height:viewportSize.height},width=Math.round(12*clientRect.width/viewportSize.width)}-1===insertIndex&&(insertIndex=(null===(_a=appConfigAction.appConfig.layouts[layoutId].order)||void 0===_a?void 0:_a.length)||0),addBlockToFlowLayout({layoutInfo},{targetLayoutId:layoutId,containerRect:containerRect||clientRect,itemRect:clientRect,width,insertIndex})}({layoutId,layoutItemId:layoutItem.id},clientRect)}};try{getLabelOfLayoutItem.displayName="getLabelOfLayoutItem",getLabelOfLayoutItem.__docgenInfo={description:"",displayName:"getLabelOfLayoutItem",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/menu/common-menu.tsx#getLabelOfLayoutItem"]={docgenInfo:getLabelOfLayoutItem.__docgenInfo,name:"getLabelOfLayoutItem",path:"../jimu-layouts/lib/builder/menu/common-menu.tsx#getLabelOfLayoutItem"})}catch(__react_docgen_typescript_loader_error){}try{isNormalWidget.displayName="isNormalWidget",isNormalWidget.__docgenInfo={description:"",displayName:"isNormalWidget",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},bbox:{defaultValue:null,description:"",name:"bbox",required:!1,type:{name:"BoundingBox | ImmutableObject<BoundingBox>"}},type:{defaultValue:null,description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"UNKNOWN"'},{value:'"WIDGET"'},{value:'"SECTION"'},{value:'"SCREEN_GROUP"'}]}},setting:{defaultValue:null,description:"",name:"setting",required:!1,type:{name:"any"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!1,type:{name:"string"}},sectionId:{defaultValue:null,description:"",name:"sectionId",required:!1,type:{name:"string"}},screenGroupId:{defaultValue:null,description:"",name:"screenGroupId",required:!1,type:{name:"string"}},isPlaceholder:{defaultValue:null,description:"",name:"isPlaceholder",required:!1,type:{name:"boolean"}},isPending:{defaultValue:null,description:"",name:"isPending",required:!1,type:{name:"boolean"}},parent:{defaultValue:null,description:"",name:"parent",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/menu/common-menu.tsx#isNormalWidget"]={docgenInfo:isNormalWidget.__docgenInfo,name:"isNormalWidget",path:"../jimu-layouts/lib/builder/menu/common-menu.tsx#isNormalWidget"})}catch(__react_docgen_typescript_loader_error){}var left=__webpack_require__("../jimu-icons/svg/outlined/directional/left.svg"),left_default=__webpack_require__.n(left),right=__webpack_require__("../jimu-icons/svg/outlined/directional/right.svg"),right_default=__webpack_require__.n(right),plus=__webpack_require__("../jimu-icons/svg/outlined/editor/plus.svg"),plus_default=__webpack_require__.n(plus),duplicate_page=__webpack_require__("../jimu-icons/svg/outlined/editor/duplicate-page.svg"),duplicate_page_default=__webpack_require__.n(duplicate_page),editor_close=__webpack_require__("../jimu-icons/svg/outlined/editor/close.svg"),close_default=__webpack_require__.n(editor_close);function findSectionInfo(layoutItem){let state=(0,jimu_core.Vp3)().getState();return window.jimuConfig.isBuilder&&(state=state.appStateInBuilder),layout_runtime.searchUtils.getSectionInfo(state,layoutItem.sectionId)}function findActiveViewId(props){var _a;const{navInfo,views,activeView}=null!=props?props:{};if(!navInfo)return null==activeView?void 0:activeView.id;if(!navInfo.useProgress)return navInfo.currentViewId;const visibleViews=(null===(_a=navInfo.visibleViews)||void 0===_a?void 0:_a.length)>0?navInfo.visibleViews:views,{currentIndex}=(0,jimu_core.Whg)(navInfo.progress,visibleViews.length);return visibleViews[currentIndex]}const duplicateViewTool={icon:duplicate_page_default(),title:props=>props.formatMessage("duplicateView"),visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout(),onClick:props=>{const{layoutItem}=props;let activeViewId=findActiveViewId(findSectionInfo(layoutItem));if(!activeViewId){activeViewId=findSectionInfo(layoutItem).views[0]}const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),newView=appConfigAction.duplicateView(activeViewId,layoutItem.sectionId,!0);appConfigAction.exec(),jimu_core.e7y.changeView(layoutItem.sectionId,newView.id)}},deleteViewTool={icon:close_default(),title:props=>props.formatMessage("deleteView"),visible:props=>{if(getAppMode()!==jimu_core.$0N.Design||isLockLayout())return!1;const{layoutItem}=props,sectionInfo=findSectionInfo(layoutItem);if(!sectionInfo)return!1;const{views}=sectionInfo;return views&&views.length>1},onClick:props=>{const{layoutItem}=props,sectionInfo=findSectionInfo(layoutItem),{views}=sectionInfo,activeViewId=findActiveViewId(sectionInfo);if(views.length>1){const indexToDelete=views.indexOf(activeViewId);let viewIdToShow;viewIdToShow=indexToDelete>0?views[indexToDelete-1]:views[1],(0,jimu_for_builder.getAppConfigAction)().removeView(activeViewId,layoutItem.sectionId).exec(),jimu_core.e7y.changeView(props.layoutItem.sectionId,viewIdToShow)}}},sectionMenuItems=[{icon:left_default(),autoFlipIcon:!0,size:10,title:props=>props.formatMessage("previousView"),onClick:props=>{const{layoutItem}=props,sectionInfo=findSectionInfo(layoutItem),{views}=sectionInfo,activeViewId=findActiveViewId(sectionInfo),index=views.indexOf(activeViewId);index>0&&jimu_core.e7y.changeView(layoutItem.sectionId,views[index-1])},disabled:props=>{const{layoutItem}=props,sectionInfo=findSectionInfo(layoutItem);if(!sectionInfo)return!0;const{views}=sectionInfo,activeViewId=findActiveViewId(sectionInfo);return views.indexOf(activeViewId)<=0}},{label:props=>{const{layoutItem}=props,sectionInfo=findSectionInfo(layoutItem);if(!sectionInfo)return"";const{views}=sectionInfo,activeViewId=findActiveViewId(sectionInfo);return`${Math.max(0,views.indexOf(activeViewId))+1} / ${views.length}`}},{icon:right_default(),autoFlipIcon:!0,size:10,title:props=>props.formatMessage("nextView"),onClick:props=>{const{layoutItem}=props,sectionInfo=findSectionInfo(layoutItem),{views}=sectionInfo,activeViewId=findActiveViewId(sectionInfo),index=views.indexOf(activeViewId);index>=0&&index<views.length-1&&jimu_core.e7y.changeView(layoutItem.sectionId,views[index+1])},disabled:props=>{const{layoutItem}=props,sectionInfo=findSectionInfo(layoutItem);if(!sectionInfo)return!0;const{views}=sectionInfo,activeViewId=findActiveViewId(sectionInfo),index=views.indexOf(activeViewId);return index<0||index>=views.length-1}},{icon:plus_default(),title:props=>props.formatMessage("addView"),visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout(),onClick:props=>{const{layoutItem}=props,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),viewId=appConfigAction.addView(layoutItem.sectionId);appConfigAction.exec(),jimu_core.e7y.changeView(layoutItem.sectionId,viewId)}},duplicateViewTool,deleteViewTool,{separator:!0}],viewMenuItems=[duplicateViewTool,deleteViewTool];try{findSectionInfo.displayName="findSectionInfo",findSectionInfo.__docgenInfo={description:"",displayName:"findSectionInfo",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},bbox:{defaultValue:null,description:"",name:"bbox",required:!1,type:{name:"ImmutableObject<BoundingBox>"}},type:{defaultValue:null,description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"UNKNOWN"'},{value:'"WIDGET"'},{value:'"SECTION"'},{value:'"SCREEN_GROUP"'}]}},setting:{defaultValue:null,description:"",name:"setting",required:!1,type:{name:"any"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!1,type:{name:"string"}},sectionId:{defaultValue:null,description:"",name:"sectionId",required:!1,type:{name:"string"}},screenGroupId:{defaultValue:null,description:"",name:"screenGroupId",required:!1,type:{name:"string"}},isPlaceholder:{defaultValue:null,description:"",name:"isPlaceholder",required:!1,type:{name:"boolean"}},isPending:{defaultValue:null,description:"",name:"isPending",required:!1,type:{name:"boolean"}},parent:{defaultValue:null,description:"",name:"parent",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/menu/section-menu.tsx#findSectionInfo"]={docgenInfo:findSectionInfo.__docgenInfo,name:"findSectionInfo",path:"../jimu-layouts/lib/builder/menu/section-menu.tsx#findSectionInfo"})}catch(__react_docgen_typescript_loader_error){}try{findActiveViewId.displayName="findActiveViewId",findActiveViewId.__docgenInfo={description:"",displayName:"findActiveViewId",props:{sectionId:{defaultValue:null,description:"",name:"sectionId",required:!0,type:{name:"string"}},views:{defaultValue:null,description:"",name:"views",required:!0,type:{name:"ImmutableArray<string>"}},activeView:{defaultValue:null,description:"",name:"activeView",required:!1,type:{name:"IMViewJson"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}},sectionStyle:{defaultValue:null,description:"",name:"sectionStyle",required:!0,type:{name:"any"}},navInfo:{defaultValue:null,description:"",name:"navInfo",required:!0,type:{name:"IMSectionNavInfo"}},transition:{defaultValue:null,description:"",name:"transition",required:!1,type:{name:"{ type: string; direction?: string; }"}},autoPlay:{defaultValue:null,description:"",name:"autoPlay",required:!1,type:{name:"boolean"}},interval:{defaultValue:null,description:"",name:"interval",required:!1,type:{name:"number"}},loop:{defaultValue:null,description:"",name:"loop",required:!1,type:{name:"boolean"}},focusable:{defaultValue:null,description:"",name:"focusable",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/menu/section-menu.tsx#findActiveViewId"]={docgenInfo:findActiveViewId.__docgenInfo,name:"findActiveViewId",path:"../jimu-layouts/lib/builder/menu/section-menu.tsx#findActiveViewId"})}catch(__react_docgen_typescript_loader_error){}const GLOBAL_DRAGGING_CLASS_NAME="interactjs-dragging",GLOBAL_H5_DRAGGING_CLASS_NAME="exb-h5-dragging",LIMITED_BOUNDARY_CLASS_NAME="limited-drag-boundary";let isItemDragging=!1;function createDraggingPlaceholder(rect){const builderTheme=(0,jimu_theme.wE)(),elem=document.createElement("div");return elem.setAttribute("id","interact_dragging_placeholder"),elem.style.position="fixed",elem.style.left=`${rect.left}px`,elem.style.top=`${rect.top}px`,elem.style.width=`${rect.width}px`,elem.style.height=`${rect.height}px`,elem.style.backgroundColor=jimu_core.PLL.rgba(builderTheme.sys.color.primary.dark,.2),elem.style.zIndex="1100",elem}function bindDragHandler(interactable,dragHandlerProps){if(!interactable)return null;let dx,dy,targetRect,parentRect,originTransform,placeholderElement;const{layoutItemId,useDragHandler,onDragStart,onDragging,onDragEnd,draggableAtRuntime=!1}=dragHandlerProps;return interactable.styleCursor(!1).draggable({inertia:!1,autoScroll:!1,allowFrom:useDragHandler?".tool-drag-handler":void 0,ignoreFrom:".no-drag-action",listeners:{start:event=>{if(isLockLayout()||!draggableAtRuntime&&!isDesignMode())return void event.interaction.stop();const target=event.target;if(target.classList.contains("no-drag-action"))return void(event.target._canDrag=!1);event.target._canDrag=!0,event.stopPropagation(),target.classList.add("is-dragging"),originTransform=target.style.transform,targetRect=event.rect;const parent=event.target.parentNode;parentRect=parent.getBoundingClientRect(),document.body.classList.add(GLOBAL_DRAGGING_CLASS_NAME);const computedTransform=getComputedStyle(target,null).getPropertyValue("transform"),[tx,ty]=function parseTransform(transform=""){let dx="0",dy="0";if(transform.includes("matrix(")){const values=transform.substring(transform.indexOf("(")+1,transform.indexOf(")")).split(",");return dx=`${parseInt(values[4],10)}px`,dy=`${parseInt(values[5],10)}px`,[dx,dy]}if(transform.includes("translate(")){const match=transform.match(/translate\((.*)\s*,\s*(.*)\)/);return 3===match.length&&(dx=match[1],dy=match[2]),[dx,dy]}if(transform.includes("translateX(")){const match=transform.match(/translateX\((.*)\)/);2===match.length&&(dx=match[1])}if(transform.includes("translateY(")){const match=transform.match(/translateY\((.*)\)/);2===match.length&&(dy=match[1])}return[dx,dy]}(computedTransform);dx=layout_runtime.utils.isPercentage(tx)?layout_runtime.utils.fromRatio(tx,targetRect.width):parseFloat(tx),dy=layout_runtime.utils.isPercentage(ty)?layout_runtime.utils.fromRatio(ty,targetRect.height):parseFloat(ty),target.setAttribute("data-translatex",dx),target.setAttribute("data-translatey",dy),onDragStart&&onDragStart(layoutItemId)},move:event=>{event.stopPropagation(),dx+=event.dx,dy+=event.dy;const target=event.target;if(!target.parentElement.classList.contains("d-none")){const x=event.client.x,y=event.client.y;if(!(x>=0&&x<=parentRect.width&&y>=0&&y<=parentRect.height)&&!placeholderElement)return placeholderElement=createDraggingPlaceholder(targetRect),placeholderElement=document.body.appendChild(placeholderElement),target.style.transform=originTransform,void(target.style.visibility="hidden");const draggingElement=placeholderElement||target;draggingElement.style.webkitTransform=draggingElement.style.transform=`translate(${Math.round(dx)}px, ${Math.round(dy)}px) translateZ(0)`,draggingElement.setAttribute("data-translatex",Math.round(dx)),draggingElement.setAttribute("data-translatey",Math.round(dy))}onDragging&&onDragging(layoutItemId,dx,dy)},end:event=>{event.stopPropagation();const target=event.target;target.classList.remove("is-dragging"),document.body.classList.remove(GLOBAL_DRAGGING_CLASS_NAME),placeholderElement&&(document.body.removeChild(placeholderElement),placeholderElement=null),target.style.visibility=null,target.style.transform=originTransform,onDragEnd&&onDragEnd(layoutItemId,dx,dy)}}})}function setIsDragging(value){isItemDragging=value}function isDragging(){return isItemDragging}var interact_min=__webpack_require__("../node_modules/interactjs/dist/interact.min.js"),interact_min_default=__webpack_require__.n(interact_min);const GLOBAL_RESIZING_CLASS_NAME="interactjs-resizing";let isItemResizing=!1;function bindResizeHandler(interactable,resizeHandlerProps){if(!interactable)return null;let dx,dy,dw,dh,lastResizeCall=null;const{layoutItemId,onResizeStart,onResizing,onResizeEnd,restrictEdges=!0}=resizeHandlerProps;return interactable.resizable({inertia:!1,edges:{top:".rnd-resize-top",left:layout_runtime.utils.isRTL()?".rnd-resize-right":".rnd-resize-left",bottom:".rnd-resize-bottom",right:layout_runtime.utils.isRTL()?".rnd-resize-left":".rnd-resize-right"},modifiers:[interact_min_default().modifiers.restrictEdges({outer:restrictEdges?"parent":null}),interact_min_default().modifiers.restrictSize({min:{width:16,height:16}})],listeners:{start:event=>{event.stopPropagation(),dx=0,dy=0,dw=0,dh=0;const rect=event.target.getBoundingClientRect();onResizeStart&&onResizeStart(layoutItemId,rect.width,rect.height),document.body.classList.add(GLOBAL_RESIZING_CLASS_NAME)},move:event=>{event.stopPropagation();const deltaRect=event.deltaRect;dx+=deltaRect.left,dy+=deltaRect.top,dw+=deltaRect.width,dh+=deltaRect.height,lastResizeCall&&(cancelAnimationFrame(lastResizeCall),lastResizeCall=null),lastResizeCall=requestAnimationFrame((()=>{onResizing&&onResizing(layoutItemId,dx,dy,dw,dh,event.shiftKey,event.speed),lastResizeCall=null}))},end:event=>{if(event.stopPropagation(),lastResizeCall&&(cancelAnimationFrame(lastResizeCall),lastResizeCall=null),onResizeEnd){const deltaRect=event.deltaRect;dx+=deltaRect.left,dy+=deltaRect.top,dw+=deltaRect.width,dh+=deltaRect.height,onResizeEnd(layoutItemId,dx,dy,dw,dh,event.shiftKey)}document.body.classList.remove(GLOBAL_RESIZING_CLASS_NAME)}}})}function setIsResizing(value){isItemResizing=value}function isResizing(){return isItemResizing}class _Toolbar extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.state={activeItem:null},this.onItemClick=value=>{let isOn=this.state.toggleOn;isOn=value!==this.state.activeItem||!isOn,this.setState({activeItem:value,toggleOn:isOn})},this.onItemUnSelected=value=>{value===this.state.activeItem&&this.setState({activeItem:null,toggleOn:!1})}}getStyle(){const{theme}=this.props;return jimu_core.AHW`
      display: flex;
      pointer-events: all;
      border-radius: 2px;
      box-shadow: 0 2px 8px 1px rgba(0,0,0,0.20);
      height: 100%;
      margin: 5px 0;
      background: ${theme.ref.palette.neutral[400]};

      .toolbar-item, .toolbar-item {
        .jimu-btn:focus, .jimu-btn:focus-visible {
          z-index: 1;
        }
      }

      .${GLOBAL_DRAGGING_CLASS_NAME} &,
      .${GLOBAL_RESIZING_CLASS_NAME} &,
      .${GLOBAL_H5_DRAGGING_CLASS_NAME} & {
        display: none;
      }
    `}reOrganizeTools(){const{tools}=this.props;if(layout_runtime.utils.getCurrentSizeMode()===jimu_core.rHp.Small){if(tools.filter((toolItem=>{let tool;tool=Array.isArray(toolItem)?toolItem[0]:toolItem;const{visible,separator=!1}=tool,isVisible="function"==typeof visible?visible(this.props):visible;return!separator&&(void 0===visible||isVisible)})).length>8){const newTools=tools.slice(0,8),groupedTools=tools.slice(8).map((tool=>Object.assign(Object.assign({},tool),{label:tool.title}))),tool=[{icon:more_horizontal_default(),caret:!1},...groupedTools];return newTools.push(tool),newTools}}return tools}render(){const{tools,isLockLayout}=this.props;if(!tools||0===tools.length)return null;const organizedTools=this.reOrganizeTools(),{activeItem,toggleOn}=this.state;return(0,jimu_core.Yac)(ToolbarContext.Provider,{value:Object.assign(Object.assign({},this.props),{activeItem,toggleOn,onItemClick:this.onItemClick,onItemUnSelected:this.onItemUnSelected,isLockLayout})},(0,jimu_core.Yac)(jimu_theme.nD,{useTheme2:window.jimuConfig.isInBuilder},(0,jimu_core.Yac)("div",{css:this.getStyle(),className:"layout-item-toolbar"},organizedTools.map(((toolConfig,index)=>Array.isArray(toolConfig)?(0,jimu_core.Yac)(ToolbarGroup,{uid:`${index}`,key:index,tools:toolConfig}):(0,jimu_core.Yac)(ToolbarItem,Object.assign({uid:`${index}`,key:index},toolConfig)))))))}}const toolbar_mapFunc=(0,jimu_core.Mz0)((state=>{var _a,_b,_c;return null!==(_c=null===(_b=null===(_a=state.appConfig)||void 0===_a?void 0:_a.forBuilderAttributes)||void 0===_b?void 0:_b.lockLayout)&&void 0!==_c&&_c}),((state,props)=>{const{layoutItem}=props;if(layoutItem.type===jimu_core.K6q.Section){const sectionInfo=findSectionInfo(layoutItem);if(sectionInfo)return findActiveViewId(sectionInfo)}return""}),((state,props)=>{const{layoutItem}=props;if(layoutItem.type===jimu_core.K6q.Section){let sectionJson;return sectionJson=window.jimuConfig.isBuilder?state.appStateInBuilder.appConfig.sections[layoutItem.sectionId]:state.appConfig.sections[layoutItem.sectionId],sectionJson.views.length}return 0}),((isLockLayout,activeViewId,numOfViews)=>({isLockLayout,activeViewId,numOfViews}))),Toolbar=jimu_core.E_S.connect(toolbar_mapFunc)(_Toolbar);try{Toolbar.displayName="Toolbar",Toolbar.__docgenInfo={description:"",displayName:"Toolbar",props:{theme:{defaultValue:null,description:"",name:"theme",required:!0,type:{name:"ImmutableObjectMixin<ThemeVariable> & { readonly uri?: string; readonly darkTheme?: boolean; readonly coloration?: ThemeColorationType; ... 19 more ...; readonly comp?: ImmutableObject<...>; }"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson | IMLayoutItemJson"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string, values?: any) => string"}},tools:{defaultValue:null,description:"",name:"tools",required:!0,type:{name:"(ToolItemConfig | ToolItemConfig[])[]"}},parentRef:{defaultValue:null,description:"",name:"parentRef",required:!0,type:{name:"HTMLElement"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/toolbar.tsx#Toolbar"]={docgenInfo:Toolbar.__docgenInfo,name:"Toolbar",path:"../jimu-layouts/lib/builder/toolbar.tsx#Toolbar"})}catch(__react_docgen_typescript_loader_error){}var translations_default=__webpack_require__("../jimu-layouts/lib/translations/default.ts");class ContextMenu extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.formatMessage=(id,values)=>this.props.intl?this.props.intl.formatMessage({id,defaultMessage:translations_default.A[id]},values):translations_default.A[id]}getPositionStyle(){const{positionType}=this.props;return"left"===positionType?jimu_core.AHW`
        position: absolute;
        top: 0;
        left: 0;
      `:"center"===positionType?jimu_core.AHW`
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
      `:jimu_core.AHW`
      position: absolute;
      top: 0;
      right: 0;
    `}getStyle(){const{size,builderTheme,rotate}=this.props;return jimu_core.AHW`
      body:not(.design-mode) & {
        display: none !important;
      }

      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      pointer-events: none;
      transform: ${rotate>0||rotate<0?`rotateZ(${rotate}deg)`:""} ;

      .content {
        ${this.getPositionStyle()};
        pointer-events: all;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: all 100ms;
        z-index: ${layout_runtime.LayoutZIndex.HandlerTools};

        .menu-hint {
          background-color: ${builderTheme.ref.palette.neutral[400]};
          width: ${size}px;
          height: 10px;
          display: flex;
          justify-content: center;
          align-items: center;
          cursor: pointer;
          line-height: 10px;
        }

        .menu-content {
          display: none;
          height: ${size}px;
          transform: ${rotate>0||rotate<0?`rotateZ(${-rotate}deg)`:""} ;

          .tool-drag-handler {
            cursor: move;
          }

          .layout-item-toolbar {
            margin: 0;
          }
        }

        &:hover {
          /* height: ${size}px; */
          /* width: auto; */

          .menu-hint {
            display: none;
          }

          .menu-content {
            display: flex;
          }
        }
      }

    `}render(){const{builderTheme,menuItems,layoutId,layoutItem,className,onMouseEnter,onMouseLeave}=this.props;return(0,jimu_core.Yac)("div",{className:`widget-context-menu ${className}`,css:this.getStyle()},(0,jimu_core.Yac)("div",{ref:el=>{this.ref=el},className:"content"},(0,jimu_core.Yac)("div",{className:"menu-hint"},(0,jimu_core.Yac)(more_horizontal.S,{color:builderTheme.ref.palette.black,size:"m"})),(0,jimu_core.Yac)("div",{className:"menu-content",onMouseLeave,onMouseEnter},(0,jimu_core.Yac)(Toolbar,{layoutId,layoutItem,theme:builderTheme,parentRef:this.ref,tools:menuItems,formatMessage:this.formatMessage})),this.props.children))}}const context_menu=(0,jimu_core.j4T)(ContextMenu);try{contextmenu.displayName="contextmenu",contextmenu.__docgenInfo={description:"",displayName:"contextmenu",props:{className:{defaultValue:null,description:"",name:"className",required:!0,type:{name:"string"}},onMouseEnter:{defaultValue:null,description:"",name:"onMouseEnter",required:!1,type:{name:"() => void"}},onMouseLeave:{defaultValue:null,description:"",name:"onMouseLeave",required:!1,type:{name:"() => void"}},size:{defaultValue:null,description:"",name:"size",required:!0,type:{name:"number"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}},iconSize:{defaultValue:null,description:"",name:"iconSize",required:!0,type:{name:"number"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"IMThemeVariables"}},positionType:{defaultValue:null,description:"",name:"positionType",required:!0,type:{name:"enum",value:[{value:'"center"'},{value:'"left"'},{value:'"right"'}]}},menuItems:{defaultValue:null,description:"",name:"menuItems",required:!0,type:{name:"ToolbarConfig"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/context-menu.tsx#contextmenu"]={docgenInfo:contextmenu.__docgenInfo,name:"contextmenu",path:"../jimu-layouts/lib/builder/context-menu.tsx#contextmenu"})}catch(__react_docgen_typescript_loader_error){}var page_context=__webpack_require__("../jimu-layouts/lib/builder/page-context.tsx");function getCursor(rotation,initAngle){const r=function clampRotation(rotation){if(isNaN(rotation))return 0;const result=rotation%360;return result<0?result+360:result}(rotation+initAngle);return r>=337.5||r<22.5||r>=157.5&&r<202.5?"ns-resize":r>=22.5&&r<67.5||r>=202.5&&r<247.5?"nesw-resize":r>=67.5&&r<112.5||r>=247.5&&r<292.5?"ew-resize":r>=112.5&&r<157.5||r>=292.5&&r<337.5?"nwse-resize":void 0}const size=9,style=jimu_core.AHW`
  width: ${size}px;
  height: ${size}px;
  background: transparent;
  position: absolute;
`;function shape_l_ShapeL(props){const{pos}=props,ref=jimu_core.q_G.useRef();return jimu_core.JLE.useEffectOnce((()=>{var _a;const ratio=null!==(_a=window.devicePixelRatio)&&void 0!==_a?_a:1;ref.current.width=size*ratio,ref.current.height=size*ratio;const ctx=ref.current.getContext("2d");ctx&&(ctx.scale(ratio,ratio),ctx.strokeStyle="#444",ctx.fillStyle="#fff",ctx.lineWidth=2,layout_runtime.utils.isRTL()?("tl"===pos&&(ctx.translate(size,0),ctx.rotate(Math.PI/2)),"br"===pos&&(ctx.translate(0,size),ctx.rotate(-Math.PI/2)),"bl"===pos&&(ctx.translate(size,size),ctx.rotate(Math.PI))):("tr"===pos&&(ctx.translate(size,0),ctx.rotate(Math.PI/2)),"br"===pos&&(ctx.translate(size,size),ctx.rotate(Math.PI)),"bl"===pos&&(ctx.translate(0,size),ctx.rotate(-Math.PI/2))),ctx.beginPath(),ctx.moveTo(1,1),ctx.lineTo(size-1,1),ctx.lineTo(size-1,size/3),ctx.lineTo(size/3,size/3),ctx.lineTo(size/3,size-1),ctx.lineTo(1,size-1),ctx.closePath(),ctx.stroke(),ctx.fill())})),(0,jimu_core.Yac)("canvas",{css:style,ref})}try{shape_l_ShapeL.displayName="ShapeL",shape_l_ShapeL.__docgenInfo={description:"",displayName:"ShapeL",props:{pos:{defaultValue:null,description:"",name:"pos",required:!0,type:{name:"enum",value:[{value:'"br"'},{value:'"tr"'},{value:'"tl"'},{value:'"bl"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/shape-l.tsx#ShapeL"]={docgenInfo:shape_l_ShapeL.__docgenInfo,name:"ShapeL",path:"../jimu-layouts/lib/builder/shape-l.tsx#ShapeL"})}catch(__react_docgen_typescript_loader_error){}const shape_rect_long=16,shape_rect_short=4,shape_rect_style=jimu_core.AHW`
  background: transparent;
  position: absolute;
`;function shape_rect_ShapeRect(props){const{direction}=props,ref=jimu_core.q_G.useRef();return jimu_core.JLE.useEffectOnce((()=>{var _a;const ratio=null!==(_a=window.devicePixelRatio)&&void 0!==_a?_a:1;"h"===direction?(ref.current.width=shape_rect_long*ratio,ref.current.height=shape_rect_short*ratio):(ref.current.width=shape_rect_short*ratio,ref.current.height=shape_rect_long*ratio);const ctx=ref.current.getContext("2d");ctx&&(ctx.scale(ratio,ratio),ctx.strokeStyle="#444",ctx.fillStyle="#fff",ctx.lineWidth=2,"h"===direction?ctx.rect(1,1,shape_rect_long-2,shape_rect_short-2):ctx.rect(1,1,shape_rect_short-2,shape_rect_long-2),ctx.stroke(),ctx.fill())})),(0,jimu_core.Yac)("canvas",{css:shape_rect_style,ref})}try{shape_rect_ShapeRect.displayName="ShapeRect",shape_rect_ShapeRect.__docgenInfo={description:"",displayName:"ShapeRect",props:{direction:{defaultValue:null,description:"",name:"direction",required:!0,type:{name:"enum",value:[{value:'"h"'},{value:'"v"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/shape-rect.tsx#ShapeRect"]={docgenInfo:shape_rect_ShapeRect.__docgenInfo,name:"ShapeRect",path:"../jimu-layouts/lib/builder/shape-rect.tsx#ShapeRect"})}catch(__react_docgen_typescript_loader_error){}const topLeftCursor=rotation=>jimu_core.AHW`
  top: 0;
  left: 0;
  position: absolute;
  /* cursor: nwse-resize; */
  cursor: ${getCursor(rotation,135)};
  .jimu-rtl & {
    /* cursor: nesw-resize; */
    cursor: ${getCursor(rotation,225)};
  }
  > svg {
    position: absolute;
    top: 0;
    left: 0;
  }
`,topRightCursor=rotation=>jimu_core.AHW`
  top: 0;
  right: 0;
  position: absolute;
  /* cursor: nesw-resize; */
  cursor: ${getCursor(rotation,225)};
  .jimu-rtl & {
    /* cursor: nwse-resize; */
    cursor: ${getCursor(rotation,315)};
  }
`,bottomLeftCursor=rotation=>jimu_core.AHW`
  bottom: 0;
  left: 0;
  position: absolute;
  /* cursor: nesw-resize; */
  cursor: ${getCursor(rotation,45)};
  .jimu-rtl & {
    /* cursor: nwse-resize; */
    cursor: ${getCursor(rotation,135)};
  }
`,bottomRightCursor=rotation=>jimu_core.AHW`
  bottom: 0;
  right: 0;
  position: absolute;
  /* cursor: nwse-resize; */
  cursor: ${getCursor(rotation,315)};
  .jimu-rtl & {
    /* cursor: nesw-resize; */
    cursor: ${getCursor(rotation,405)};
  }
`,topSideCursor=rotation=>jimu_core.AHW`
  height: ${10}px;
  left: ${10}px;
  right: ${10}px;
  top: 0px;
  position: absolute;
  /* cursor: ns-resize; */
  cursor: ${getCursor(rotation,180)};

  canvas {
    left: 50%;
    top: 0;
    width: ${16}px;
    height: ${4}px;
    margin-left: ${-8}px;
    margin-top: 1px;
  }
`,rightSideCursor=rotation=>jimu_core.AHW`
  width: ${10}px;
  top: ${10}px;
  bottom: ${10}px;
  right: 0;
  position: absolute;
  /* cursor: ew-resize; */
  cursor: ${getCursor(rotation,270)};

  canvas {
    top: 50%;
    right: 0;
    width: ${4}px;
    height: ${16}px;
    margin-top: ${-8}px;
    margin-right: 1px;
  }
`,bottomSideCursor=rotation=>jimu_core.AHW`
  height: ${10}px;
  left: ${10}px;
  right: ${10}px;
  bottom: 0;
  position: absolute;
  /* cursor: ns-resize; */
  cursor: ${getCursor(rotation,0)};

  canvas {
    left: 50%;
    bottom: 0;
    width: ${16}px;
    height: ${4}px;
    margin-left: ${-8}px;
    margin-bottom: 1px;
  }
`,leftSideCursor=rotation=>jimu_core.AHW`
  width: ${10}px;
  top: ${10}px;
  bottom: ${10}px;
  left: 0;
  position: absolute;
  /* cursor: ew-resize; */
  cursor: ${getCursor(rotation,90)};

  canvas {
    top: 50%;
    left: 0;
    width: ${4}px;
    height: ${16}px;
    margin-top: ${-8}px;
    margin-left: 1px;
  }
`;function ResizeHandlers(props){const{rotation=0}=props,{top,right,bottom,left,topLeft,topRight,bottomRight,bottomLeft}=function getResizableSides(props){const{left=!0,top=!0,right=!0,bottom=!0}=props;return{top,right,bottom,left,topRight:top&&right,bottomRight:bottom&&right,bottomLeft:bottom&&left,topLeft:top&&left}}(props),cornerHandlerStyle=jimu_core.AHW`
    width: ${11}px;
    height: ${11}px;
    padding: 1px;
    z-index: ${layout_runtime.LayoutZIndex.HandlerTools};
  `;return(0,jimu_core.Yac)("div",{className:"w-100 h-100 action-area"},top&&(0,jimu_core.Yac)("span",{key:"2","data-testid":"top",className:"rnd-resize-top handle no-drag-action",css:topSideCursor(rotation)},(0,jimu_core.Yac)(shape_rect_ShapeRect,{direction:"h"})),right&&(0,jimu_core.Yac)("span",{key:"4","data-testid":"right",className:"rnd-resize-right handle no-drag-action",css:rightSideCursor(rotation)},(0,jimu_core.Yac)(shape_rect_ShapeRect,{direction:"v"})),bottom&&(0,jimu_core.Yac)("span",{key:"6","data-testid":"bottom",className:"rnd-resize-bottom handle no-drag-action",css:bottomSideCursor(rotation)},(0,jimu_core.Yac)(shape_rect_ShapeRect,{direction:"h"})),left&&(0,jimu_core.Yac)("span",{key:"8","data-testid":"left",className:"rnd-resize-left handle no-drag-action",css:leftSideCursor(rotation)},(0,jimu_core.Yac)(shape_rect_ShapeRect,{direction:"v"})),topLeft&&(0,jimu_core.Yac)("span",{key:"1","data-testid":"topLeft",className:"rnd-resize-top rnd-resize-left handle no-drag-action",css:[cornerHandlerStyle,topLeftCursor(rotation)]},(0,jimu_core.Yac)(shape_l_ShapeL,{pos:"tl"})),topRight&&(0,jimu_core.Yac)("span",{key:"3","data-testid":"topRight",className:"rnd-resize-top rnd-resize-right handle no-drag-action",css:[cornerHandlerStyle,topRightCursor(rotation)]},(0,jimu_core.Yac)(shape_l_ShapeL,{pos:"tr"})),bottomRight&&(0,jimu_core.Yac)("span",{key:"5","data-testid":"bottomRight",className:"rnd-resize-bottom rnd-resize-right handle no-drag-action",css:[cornerHandlerStyle,bottomRightCursor(rotation)]},(0,jimu_core.Yac)(shape_l_ShapeL,{pos:"br"})),bottomLeft&&(0,jimu_core.Yac)("span",{key:"7","data-testid":"bottomLeft",className:"rnd-resize-bottom rnd-resize-left handle no-drag-action",css:[cornerHandlerStyle,bottomLeftCursor(rotation)]},(0,jimu_core.Yac)(shape_l_ShapeL,{pos:"bl"})))}try{ResizeHandlers.displayName="ResizeHandlers",ResizeHandlers.__docgenInfo={description:"",displayName:"ResizeHandlers",props:{left:{defaultValue:null,description:"",name:"left",required:!0,type:{name:"boolean"}},right:{defaultValue:null,description:"",name:"right",required:!0,type:{name:"boolean"}},top:{defaultValue:null,description:"",name:"top",required:!0,type:{name:"boolean"}},bottom:{defaultValue:null,description:"",name:"bottom",required:!0,type:{name:"boolean"}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!1,type:{name:"IMThemeVariables"}},rotation:{defaultValue:null,description:"",name:"rotation",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/resize-handlers.tsx#ResizeHandlers"]={docgenInfo:ResizeHandlers.__docgenInfo,name:"ResizeHandlers",path:"../jimu-layouts/lib/builder/resize-handlers.tsx#ResizeHandlers"})}catch(__react_docgen_typescript_loader_error){}const commonWidgetMenuItems=[duplicateMenuItem,floatingMenuItem,sinkingMenuItem,pendingMenuItem,deleteMenuItem],commonSectionMenuItems=[].concat(sectionMenuItems,commonWidgetMenuItems);let count=0;function layout_item_toolbar_LayoutItemToolbar(props){const{layoutId,layoutItem,placement="top-start",refElement,shiftOptions,flipOptions,formatMessage,builderTheme,toolItems=[],showDefaultTools=!0}=props,[extensionClassLoaded,setExtenClassLoaded]=jimu_core.q_G.useState(!1);let extTools=[],allTools=[];const isSection=layoutItem.type===jimu_core.K6q.Section,defaultTools=jimu_core.q_G.useMemo((()=>{const commonToolItems=isSection?commonSectionMenuItems:commonWidgetMenuItems;let defaultTools=showDefaultTools?[...toolItems,...commonToolItems]:toolItems;if(isExpressMode()){jimu_for_builder.placeholderService.getPlaceholderInfo((0,jimu_core.Vp3)().getState().appConfig,{layoutId,layoutItemId:layoutItem.id})&&(defaultTools=[deleteMenuItem])}return defaultTools}),[isSection,layoutItem.id,layoutId,toolItems,showDefaultTools]);return jimu_core.JLE.useEffectOnce((()=>{if(layoutItem.widgetId){const widgetJson=(0,jimu_core.Vp3)().getState().appConfig.widgets[layoutItem.widgetId];jimu_core.nH3.getInstance().registerWidgetExtensions(widgetJson,!1).then((result=>{result.length>0&&setExtenClassLoaded(!0)}))}})),extensionClassLoaded&&(extTools=function getExtensionTools(layoutId,widgetId){return widgetId?jimu_core.nH3.getInstance().getExtensions(jimu_core.vZE.R6.ContextTool).filter((ext=>ext.widgetId===widgetId)).map((ext=>{var _a;return{widgetId,icon:ext.getIcon(),title:ext.getTitle.bind(ext),onClick:ext.onClick.bind(ext),checked:ext.checked&&ext.checked.bind(ext),disabled:ext.disabled?"function"==typeof ext.disabled?ext.disabled.bind(ext):ext.disabled:null,visible:ext.visible?"function"==typeof ext.visible?ext.visible.bind(ext):ext.visible:null,openWhenAdded:null!==(_a=ext.openWhenAdded)&&void 0!==_a&&_a,settingPanel:ext.getSettingPanel({layoutId,layoutItem:{widgetId},clientRect:null}),index:ext.index,extName:ext.name}})).sort(((a,b)=>a.index-b.index)):[]}(layoutId,layoutItem.widgetId)),extTools.length>0?allTools=defaultTools.length>0?[].concat(defaultTools,{separator:!0},extTools):extTools:defaultTools.length>0&&(allTools=defaultTools),refElement&&0!==allTools.length?(0,jimu_core.Yac)(jimu_ui.Popper,{placement,reference:refElement,open:!0,unstyled:!0,shiftOptions,flipOptions,version:count++,trapFocus:!1,autoFocus:!1,css:jimu_core.AHW`
        background: transparent;
        box-shadow: none;
      `},(0,jimu_core.Yac)("div",null,(0,jimu_core.Yac)(Toolbar,{layoutId,layoutItem,theme:builderTheme,parentRef:refElement,tools:allTools,formatMessage}))):null}try{layout_item_toolbar_LayoutItemToolbar.displayName="LayoutItemToolbar",layout_item_toolbar_LayoutItemToolbar.__docgenInfo={description:"",displayName:"LayoutItemToolbar",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},placement:{defaultValue:null,description:"",name:"placement",required:!1,type:{name:"enum",value:[{value:'"bottom"'},{value:'"left"'},{value:'"right"'},{value:'"top"'},{value:'"bottom-end"'},{value:'"bottom-start"'},{value:'"left-end"'},{value:'"left-start"'},{value:'"right-end"'},{value:'"right-start"'},{value:'"top-end"'},{value:'"top-start"'}]}},refElement:{defaultValue:null,description:"",name:"refElement",required:!0,type:{name:"HTMLElement"}},shiftOptions:{defaultValue:null,description:"",name:"shiftOptions",required:!1,type:{name:"{ mainAxis?: boolean; crossAxis?: boolean; limiter?: { fn: (state: MiddlewareState) => Coords; options?: any; }; rootBoundary?: RootBoundary; elementContext?: ElementContext; altBoundary?: boolean; padding?: Padding; boundary?: Boundary; }"}},flipOptions:{defaultValue:null,description:"",name:"flipOptions",required:!1,type:{name:'{ mainAxis?: boolean; crossAxis?: boolean; rootBoundary?: RootBoundary; elementContext?: ElementContext; altBoundary?: boolean; padding?: Padding; fallbackPlacements?: Placement[]; fallbackStrategy?: "initialPlacement" | "bestFit"; fallbackAxisSideDirection?: "none" | ... 1 more ... | "start"; flipAlignment?: boolea...'}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"IMThemeVariables"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(string: any, values?: any) => string"}},toolItems:{defaultValue:null,description:"",name:"toolItems",required:!1,type:{name:"ToolbarConfig"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/layout-item-toolbar.tsx#LayoutItemToolbar"]={docgenInfo:layout_item_toolbar_LayoutItemToolbar.__docgenInfo,name:"LayoutItemToolbar",path:"../jimu-layouts/lib/builder/layout-item-toolbar.tsx#LayoutItemToolbar"})}catch(__react_docgen_typescript_loader_error){}var util_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};function canDropAtPlaceholder(draggingItem){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();if(draggingItem.layoutInfo){const{layoutId,layoutItemId}=draggingItem.layoutInfo,layoutItem=appConfigAction.appConfig.layouts[layoutId].content[layoutItemId];return!(layoutItem.type===jimu_core.K6q.Widget&&!layoutItem.widgetId)}if(jimu_core.WpD.isExpressMode()){const widgetsExcludedInExpressMode=["widgets/arcgis/arcgis-map/","widgets/common/divider/","widgets/common/menu/","widgets/common/navigator/","widgets/common/controller/","widgets/layout/fixed/","widgets/layout/sidebar/","widgets/layout/row/","widgets/layout/grid/","widgets/layout/column/","widgets/layout/accordion/","widgets/layout/flowrow/"];return draggingItem.uri&&!widgetsExcludedInExpressMode.includes(draggingItem.uri)}return!(draggingItem.itemType===jimu_core.K6q.Widget&&draggingItem.manifest&&!draggingItem.uri)}function canDeleteInExpressMode(layoutInfo,appConfig){var _a,_b;const{layoutId}=layoutInfo,layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo);if((null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Widget){const appConfig=(0,jimu_for_builder.getAppConfigAction)().appConfig,layoutJson=appConfig.layouts[layoutId];if(!layoutItem.widgetId)return layoutJson.type===jimu_core.p5K.GridLayout;const widgetJson=null===(_a=appConfig.widgets)||void 0===_a?void 0:_a[layoutItem.widgetId];return(null===(_b=null==widgetJson?void 0:widgetJson.manifest)||void 0===_b?void 0:_b.widgetType)!==jimu_core.xOw.Layout&&("widgets/arcgis/arcgis-map/"!==(null==widgetJson?void 0:widgetJson.uri)&&"widgets/common/navigator/"!==(null==widgetJson?void 0:widgetJson.uri)&&"widgets/common/controller/"!==(null==widgetJson?void 0:widgetJson.uri))}return!1}function dropAtPlaceholder(placeholderLayoutInfo,draggingItem){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();if(draggingItem.layoutInfo){const{layoutId,layoutItemId}=draggingItem.layoutInfo,layoutItem=appConfigAction.appConfig.layouts[layoutId].content[layoutItemId];appConfigAction.removeLayoutItem(draggingItem.layoutInfo,!1,!1),appConfigAction.addContentToPlaceholder(placeholderLayoutInfo,layoutItem.type,layoutItem.type===jimu_core.K6q.Widget?layoutItem.widgetId:layoutItem.sectionId),jimu_core.CM0.defer((()=>{layout_runtime.utils.changeLayout(appConfigAction.appConfig,placeholderLayoutInfo)}))}else draggingItem.itemType===jimu_core.K6q.Widget&&draggingItem.uri?addWidgetInPlaceholder(placeholderLayoutInfo,draggingItem):draggingItem.itemType===jimu_core.K6q.Section&&addSectionInPlaceholder(placeholderLayoutInfo)}function addSectionInPlaceholder(placeholderLayoutInfo){const{layoutId,layoutItemId}=placeholderLayoutInfo,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),sectionJson=appConfigAction.createSection();appConfigAction.addContentToPlaceholder(placeholderLayoutInfo,jimu_core.K6q.Section,sectionJson.id),jimu_core.CM0.defer((()=>{layout_runtime.utils.changeLayout(appConfigAction.appConfig,{layoutId,layoutItemId})}))}function addWidgetInPlaceholder(placeholderLayoutInfo,draggingItem){return util_awaiter(this,void 0,void 0,(function*(){const{layoutId,layoutItemId}=placeholderLayoutInfo,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),widgetJson=yield appConfigAction.createWidget({uri:draggingItem.uri,itemId:draggingItem.itemId});appConfigAction.addContentToPlaceholder(placeholderLayoutInfo,jimu_core.K6q.Widget,widgetJson.id),jimu_core.CM0.defer((()=>{layout_runtime.utils.changeLayout(appConfigAction.appConfig,{layoutId,layoutItemId})}))}))}var lock=__webpack_require__("../jimu-icons/outlined/editor/lock.tsx");class SelectWrapper extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.formatMessage=(id,values)=>null!=this.props.intl?this.props.intl.formatMessage({id,defaultMessage:translations_default.A[id]},values):translations_default.A[id],this.isMac=()=>{var _a,_b;return"macOS"===(null===(_b=null===(_a=window.jimuUA)||void 0===_a?void 0:_a.os)||void 0===_b?void 0:_b.name)},this.copyItem=()=>{const{layoutId,layoutItem,lockLayout}=this.props;if(!lockLayout){const rect=this.ref.getBoundingClientRect(),width=rect.width,height=rect.height;(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.clipboardChanged({layoutId,width,height,layoutItemId:layoutItem.id}))}},this.deleteSelectedItem=()=>{const{selected,layoutId,layoutItem,lockLayout,isFunctionalWidget,isDesignMode}=this.props;if(selected&&(isDesignMode||jimu_core.WpD.isExpressMode())){if(jimu_core.WpD.isExpressMode()){const appConfig=(0,jimu_for_builder.getAppConfigAction)().appConfig;if(!canDeleteInExpressMode({layoutId,layoutItemId:layoutItem.id},appConfig))return}if(!lockLayout||isFunctionalWidget){const layoutInfo={layoutId,layoutItemId:layoutItem.id};jimu_for_builder.appBuilderSync.publishConfirmDeleteToApp(layoutInfo)}}},this.state={selected:!1,updateIndex:0},this.screenGroupInfo="",this.isMac()?this.keyBindings={delete:this.deleteSelectedItem,backspace:this.deleteSelectedItem,"command+keyc":this.copyItem}:this.keyBindings={delete:this.deleteSelectedItem,backspace:this.deleteSelectedItem,"ctrl+keyc":this.copyItem}}componentDidMount(){let boundaryElement;const info=this.screenGroupInfo.split(":");if(info.length>1){const layoutId=info[0],layoutItemId=info[1];boundaryElement=document.querySelector(`div.builder-layout-item[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItemId}"]`)}this.shiftOptions={boundary:null!=boundaryElement?boundaryElement:"viewport",crossAxis:!0},this.flipOptions={fallbackPlacements:["top-start","bottom-start","right-start","left-start"]},this.props.selected&&this.setState({selected:!0})}componentDidUpdate(prevProps){this.scrollIntoView(),this.props.selected&&!prevProps.isDesignMode&&this.props.isDesignMode&&this.setState({updateIndex:this.state.updateIndex+1})}doScroll(){const{layoutId,layoutItem}=this.props,element=document.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItem.id}"]`);null!=element&&element.scrollIntoView({behavior:"auto",block:"center"})}scrollIntoView(){var _a,_b;const{selected,autoScroll}=this.props;if(!selected||!autoScroll)return;const{layoutId}=this.props;let viewChanged=!1,screenChanged=!1;const appConfig=(0,jimu_for_builder.getAppConfigAction)().appConfig,layoutJson=appConfig.layouts[layoutId];if((null===(_a=layoutJson.parent)||void 0===_a?void 0:_a.type)===jimu_core.$4y.View){const viewJson=appConfig.views[layoutJson.parent.id];null!=(null==viewJson?void 0:viewJson.parent)&&(jimu_core.e7y.changeView(viewJson.parent,viewJson.id),viewChanged=!0)}if((null===(_b=layoutJson.parent)||void 0===_b?void 0:_b.type)===jimu_core.$4y.Screen){const screenJson=appConfig.screens[layoutJson.parent.id];if(null!=(null==screenJson?void 0:screenJson.parent)){const activeIndex=appConfig.screenGroups[screenJson.parent].screens.indexOf(screenJson.id);(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(screenJson.parent,activeIndex,!0)),screenChanged=!0}}viewChanged||screenChanged?jimu_core.CM0.defer((()=>{this.doScroll()})):this.doScroll()}getStyle(){const{isFunctionalWidget,isSection,selected,isBlock,rotate=0}=this.props,defaultColor=jimu_core.PLL.rgba(this.pageContext.builderTheme.ref.palette.neutral[900],.6),selectedColor=this.pageContext.builderTheme.sys.color.primary.main,outlineStyle=!isFunctionalWidget||isSection?"dashed":"solid";return jimu_core.AHW`
      .${GLOBAL_H5_DRAGGING_CLASS_NAME} &,
      .${GLOBAL_DRAGGING_CLASS_NAME} & {
        > .action-area {
          display: none !important;
        }
        > div.selected-tip {
          .tip-content {
            outline-color: ${defaultColor};
          }
        }
      }

      transform: ${rotate>0||rotate<0?`rotateZ(${rotate}deg)`:""};
      padding: inherit;
      position: absolute;
      left: 0;
      bottom: 0;
      top: 0;
      right: 0;
      z-index: ${selected?layout_runtime.LayoutZIndex.HandlerTools:"auto"};
      pointer-events: none;

      & > div.selected-tip {
        display: block;
        padding: inherit;
        position: absolute;
        left: 0;
        bottom: 0;
        top: 0;
        right: 0;
        pointer-events: none;
        .tip-content {
          height: 100%;
          padding: 1px;
          &:after {
            content: '';
            width: 100%;
            height: 100%;
            outline: ${isBlock&&!selected?"none":`1px ${outlineStyle} ${defaultColor}`};
            display: block;
            outline-color: ${!isFunctionalWidget||isSection?defaultColor:"transparent"};
          }
        }
      }

      .exb-rnd.selected > & > div.selected-tip {
        display: block;
        .tip-content {
          &:after {
            outline-color: ${selectedColor};
          }
        }
      }

      & > .action-area {
        position: relative;
        .handle {
          position: absolute;
          pointer-events: all;
        }
      }

      .lock-layout-tip {
        background: ${this.pageContext.builderTheme.ref.palette.neutral[800]};
        border: 1px solid ${this.pageContext.builderTheme.ref.palette.neutral[600]};
        box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.5);
        width: 20px;
        height: 20px;
        position: absolute;
        left: -10px;
        top: -10px;

        svg {
          margin-bottom: 6px;
          margin-left: 4px;
        }
      }
    `}getKeyboardComponent(){return(0,jimu_core.Yac)(jimu_core.s3S,{bindings:this.keyBindings})}isResizable(){const{resizable=!0,selected,isExpressMode}=this.props;return!jimu_core.WpD.isExpressMode()&&selected&&!this.pageContext.viewOnly&&!this.props.lockLayout&&!isExpressMode&&resizable}showToolbar(){const{forbidToolbar,selected}=this.props;return!forbidToolbar&&!this.pageContext.viewOnly&&!jimu_core.WpD.isExpressMode()&&selected}render(){return(0,jimu_core.Yac)(page_context.VZ.Consumer,null,(info=>(this.screenGroupInfo=info,(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(pageContext=>{if(this.pageContext=pageContext,!this.props.isDesignMode&&!jimu_core.WpD.isExpressMode())return null;const{layoutId,layoutItem,resizable=!0,draggable=!0,selected,toolItems,showDefaultTools,left,top,right,bottom,rotate,isDesignMode}=this.props,lockBBox=!draggable&&!resizable;return(0,jimu_core.Yac)("div",{"data-testid":"select-wrapper",ref:el=>{this.ref=el},css:this.getStyle(),className:(0,jimu_core.xWm)("select-wrapper",{selected,"no-embed-layout":!this.props.hasEmbeddedLayout})},!pageContext.viewOnly&&(0,jimu_core.Yac)("div",{className:"selected-tip"},(0,jimu_core.Yac)("div",{className:"tip-content"})),this.showToolbar()&&(0,jimu_core.Yac)(layout_item_toolbar_LayoutItemToolbar,{layoutId,layoutItem,refElement:this.ref,shiftOptions:this.shiftOptions,flipOptions:this.flipOptions,builderTheme:this.pageContext.builderTheme,formatMessage:this.formatMessage,toolItems:isDesignMode?toolItems:void 0,showDefaultTools:!!isDesignMode&&showDefaultTools}),this.isResizable()&&(0,jimu_core.Yac)(ResizeHandlers,{left,right,top,bottom,rotation:rotate,builderTheme:pageContext.builderTheme}),lockBBox&&selected&&!jimu_core.WpD.isExpressMode()&&(0,jimu_core.Yac)("div",{className:"lock-layout-tip rounded-circle"},(0,jimu_core.Yac)(lock.s,{size:"s",color:pageContext.builderTheme.ref.palette.black})),selected&&this.getKeyboardComponent())})))))}}const mapStateToProps=(0,jimu_core.Mz0)([state=>{var _a,_b,_c;return null!==(_c=null===(_b=null===(_a=state.appConfig)||void 0===_a?void 0:_a.forBuilderAttributes)||void 0===_b?void 0:_b.lockLayout)&&void 0!==_c&&_c},state=>state.appRuntimeInfo.appMode===jimu_core.$0N.Design,state=>state.appRuntimeInfo.appMode===jimu_core.$0N.Express,(state,props)=>{var _a,_b;return props.isSection?null===(_b=null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.sectionNavInfos)||void 0===_b?void 0:_b[props.layoutItem.sectionId]:null}],((lockLayout,isDesignMode,isExpressMode,sectionNavInfo)=>({lockLayout,isDesignMode,isExpressMode,sectionNavInfo}))),select_wrapper=jimu_core.E_S.connect(mapStateToProps)((0,jimu_core.j4T)(SelectWrapper));try{SelectWrapper.displayName="SelectWrapper",SelectWrapper.__docgenInfo={description:"",displayName:"SelectWrapper",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},top:{defaultValue:null,description:"",name:"top",required:!1,type:{name:"boolean"}},left:{defaultValue:null,description:"",name:"left",required:!1,type:{name:"boolean"}},right:{defaultValue:null,description:"",name:"right",required:!1,type:{name:"boolean"}},bottom:{defaultValue:null,description:"",name:"bottom",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},toolItems:{defaultValue:null,description:"",name:"toolItems",required:!1,type:{name:"ToolbarConfig"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},selected:{defaultValue:null,description:"",name:"selected",required:!0,type:{name:"boolean"}},autoScroll:{defaultValue:null,description:"",name:"autoScroll",required:!1,type:{name:"boolean"}},isInlineEditing:{defaultValue:null,description:"",name:"isInlineEditing",required:!0,type:{name:"boolean"}},isFunctionalWidget:{defaultValue:null,description:"",name:"isFunctionalWidget",required:!0,type:{name:"boolean"}},hasEmbeddedLayout:{defaultValue:null,description:"",name:"hasEmbeddedLayout",required:!0,type:{name:"boolean"}},isSection:{defaultValue:null,description:"",name:"isSection",required:!0,type:{name:"boolean"}},views:{defaultValue:null,description:"",name:"views",required:!1,type:{name:"ImmutableArray<string>"}},isBlock:{defaultValue:null,description:"",name:"isBlock",required:!1,type:{name:"boolean"}},hasExtension:{defaultValue:null,description:"",name:"hasExtension",required:!1,type:{name:"boolean"}},widgetJson:{defaultValue:null,description:"",name:"widgetJson",required:!1,type:{name:"IMWidgetJson"}},widgetState:{defaultValue:null,description:"",name:"widgetState",required:!1,type:{name:"any"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}},intl:{defaultValue:null,description:"",name:"intl",required:!0,type:{name:"IntlShape"}},lockLayout:{defaultValue:null,description:"",name:"lockLayout",required:!0,type:{name:"boolean"}},isDesignMode:{defaultValue:null,description:"",name:"isDesignMode",required:!0,type:{name:"boolean"}},isExpressMode:{defaultValue:null,description:"",name:"isExpressMode",required:!0,type:{name:"boolean"}},sectionNavInfo:{defaultValue:null,description:"",name:"sectionNavInfo",required:!0,type:{name:"IMSectionNavInfo"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/select-wrapper.tsx#SelectWrapper"]={docgenInfo:SelectWrapper.__docgenInfo,name:"SelectWrapper",path:"../jimu-layouts/lib/builder/select-wrapper.tsx#SelectWrapper"})}catch(__react_docgen_typescript_loader_error){}try{selectwrapper.displayName="selectwrapper",selectwrapper.__docgenInfo={description:"",displayName:"selectwrapper",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},top:{defaultValue:null,description:"",name:"top",required:!1,type:{name:"boolean"}},left:{defaultValue:null,description:"",name:"left",required:!1,type:{name:"boolean"}},right:{defaultValue:null,description:"",name:"right",required:!1,type:{name:"boolean"}},bottom:{defaultValue:null,description:"",name:"bottom",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},toolItems:{defaultValue:null,description:"",name:"toolItems",required:!1,type:{name:"ToolbarConfig"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},selected:{defaultValue:null,description:"",name:"selected",required:!0,type:{name:"boolean"}},autoScroll:{defaultValue:null,description:"",name:"autoScroll",required:!1,type:{name:"boolean"}},isInlineEditing:{defaultValue:null,description:"",name:"isInlineEditing",required:!0,type:{name:"boolean"}},isFunctionalWidget:{defaultValue:null,description:"",name:"isFunctionalWidget",required:!0,type:{name:"boolean"}},hasEmbeddedLayout:{defaultValue:null,description:"",name:"hasEmbeddedLayout",required:!0,type:{name:"boolean"}},isSection:{defaultValue:null,description:"",name:"isSection",required:!0,type:{name:"boolean"}},views:{defaultValue:null,description:"",name:"views",required:!1,type:{name:"ImmutableArray<string>"}},isBlock:{defaultValue:null,description:"",name:"isBlock",required:!1,type:{name:"boolean"}},hasExtension:{defaultValue:null,description:"",name:"hasExtension",required:!1,type:{name:"boolean"}},widgetJson:{defaultValue:null,description:"",name:"widgetJson",required:!1,type:{name:"IMWidgetJson"}},widgetState:{defaultValue:null,description:"",name:"widgetState",required:!1,type:{name:"any"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/select-wrapper.tsx#selectwrapper"]={docgenInfo:selectwrapper.__docgenInfo,name:"selectwrapper",path:"../jimu-layouts/lib/builder/select-wrapper.tsx#selectwrapper"})}catch(__react_docgen_typescript_loader_error){}function PlaceholderSync(props){const{layoutId,layoutItemId,sizemode,onSyncChange,className}=props,translate=jimu_core.JLE.useTranslation(jimu_ui.defaultMessages),label=jimu_core.q_G.useMemo((()=>translate("syncPlaceholderTip")),[translate]),rootContainer=jimu_core.q_G.useMemo((()=>{const appConfig=(0,jimu_core.Vp3)().getState().appConfig;return layout_runtime.searchUtils.getRootContainerInfoOfLayout(appConfig,layoutId,sizemode)}),[layoutId,sizemode]),syncedPlaceholderId=jimu_core.E_S.useSelector((state=>{const placeholderInfo=jimu_for_builder.placeholderService.getPlaceholderInfo(state.appConfig,{layoutId,layoutItemId});return placeholderInfo&&placeholderInfo.layoutInfo.layoutId!==layoutId?placeholderInfo.id:-1})),availableIds=jimu_core.E_S.useSelector((state=>{const sizeMode=state.browserSizeMode,placeholderInfos=state.appConfig.placeholderInfos,result=Object.keys(null!=placeholderInfos?placeholderInfos:{}).filter((id=>{var _a;const info=placeholderInfos[id];return!!rootContainer&&(info.rootContainer.type===rootContainer.type&&info.rootContainer.id===rootContainer.id&&null==(null===(_a=info.syncs)||void 0===_a?void 0:_a[sizeMode]))})).map((id=>+id));return result.sort(),result.join(",")})),isTemplateBuilder=jimu_core.E_S.useSelector((state=>{var _a;return(null===(_a=state.appInfo)||void 0===_a?void 0:_a.type)===jimu_core.uCV.Template})),isDesignMode=jimu_core.E_S.useSelector((state=>{var _a;return(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design})),mainSizeMode=jimu_core.E_S.useSelector((state=>state.appConfig.mainSizeMode)),handleSyncChange=jimu_core.q_G.useCallback((e=>{onSyncChange(+e.target.value)}),[onSyncChange]);return isTemplateBuilder&&isDesignMode&&sizemode!==mainSizeMode?0===availableIds.length&&null==syncedPlaceholderId?null:(0,jimu_core.Yac)("div",{className:"w-100 h-100 d-flex flex-column justify-content-center align-items-center"},(0,jimu_core.Yac)(jimu_ui.Select,{css:jimu_core.AHW`width: auto; .btn, .btn:hover { border: none; border-radius: 1rem; padding: 0 24px; }`,value:syncedPlaceholderId,onChange:handleSyncChange,"aria-label":label,title:label,className},(0,jimu_core.Yac)("option",{selected:-1===syncedPlaceholderId,value:-1},translate("none")),syncedPlaceholderId>0&&(0,jimu_core.Yac)("option",{selected:!0,value:syncedPlaceholderId},syncedPlaceholderId),availableIds.split(",").map((placeholderId=>(0,jimu_core.Yac)("option",{value:+placeholderId,key:placeholderId},placeholderId)))),(0,jimu_core.Yac)("span",{className:"mt-2 px-2",css:jimu_core.AHW`font-size: 14px; color: var(--sys-color-action-text);`},label)):null}try{PlaceholderSync.displayName="PlaceholderSync",PlaceholderSync.__docgenInfo={description:"",displayName:"PlaceholderSync",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},sizemode:{defaultValue:null,description:"",name:"sizemode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},onSyncChange:{defaultValue:null,description:"",name:"onSyncChange",required:!0,type:{name:"(placeholderId: number) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-ui/advanced/placeholder-sync.tsx#PlaceholderSync"]={docgenInfo:PlaceholderSync.__docgenInfo,name:"PlaceholderSync",path:"../jimu-ui/advanced/placeholder-sync.tsx#PlaceholderSync"})}catch(__react_docgen_typescript_loader_error){}var setting_components=__webpack_require__("../jimu-ui/advanced/setting-components.tsx");function createItemFromInteractEvent(dragElement){if(dragElement&&"function"==typeof dragElement.getAttribute){const layoutId=dragElement.getAttribute("data-layoutid"),layoutItemId=dragElement.getAttribute("data-layoutitemid");if(layoutId&&layoutItemId)return function createItemFromLayoutInfo(layoutId,layoutItemId){var _a,_b,_c,_d,_e,_f;const state=(0,jimu_core.Vp3)().getState(),{layouts,widgets}=state.appConfig,fromLayout=layouts[layoutId],layoutItem=null===(_a=null==fromLayout?void 0:fromLayout.content)||void 0===_a?void 0:_a[layoutItemId];if(layoutItem){const layoutInfo={layoutId,layoutItemId},manifest=function getManifest(state,layoutItem){var _a,_b,_c;if(layoutItem.type===jimu_core.K6q.Widget){const widgetId=layoutItem.widgetId;if(widgetId)return null===(_c=null===(_b=null===(_a=state.appConfig)||void 0===_a?void 0:_a.widgets)||void 0===_b?void 0:_b[widgetId])||void 0===_c?void 0:_c.manifest}return null}(state,layoutItem);let uri=null;return layoutItem.type===jimu_core.K6q.Widget&&layoutItem.widgetId&&(uri=null===(_b=widgets[layoutItem.widgetId])||void 0===_b?void 0:_b.uri),{itemType:layoutItem.type,layoutInfo,uri,manifest,rotation:null!==(_f=null===(_e=null===(_d=null===(_c=layoutItem.setting)||void 0===_c?void 0:_c.style)||void 0===_d?void 0:_d.transform)||void 0===_e?void 0:_e.rotate)&&void 0!==_f?_f:0}}}(layoutId,layoutItemId)}return null}function restrictItemInContainer(itemRect,containerRect){const result={};return result.width=Math.min(itemRect.width,containerRect.width),result.height=Math.min(itemRect.height,containerRect.height),result.left=Math.max(0,itemRect.left),result.top=Math.max(0,itemRect.top),result.left+result.width>containerRect.width&&(result.left=containerRect.width-result.width),result.top+result.height>containerRect.height&&(result.top=containerRect.height-result.height),result}function isDraggingItemAccepted(draggingItem,layoutContext,props,layoutId){var _a,_b;if((null==draggingItem?void 0:draggingItem.itemType)===jimu_core.K6q.ScreenGroup){const currentPageId=layout_runtime.utils.getCurrentPageId(),appConfig=layout_runtime.utils.getAppConfig(),pageJson=appConfig.pages[currentPageId];return Object.keys(null!==(_a=null==pageJson?void 0:pageJson.layout)&&void 0!==_a?_a:{}).some((sizeMode=>{const layout=appConfig.layouts[pageJson.layout[sizeMode]];return layout.type===jimu_core.p5K.FlowLayout&&layout.id===layoutId}))}let isAllowed=function lockParentAllowed(layoutId,draggingItem){var _a,_b,_c,_d;if(!draggingItem)return!1;if(null!==(_a=draggingItem.isFromCurrentSizeMode)&&void 0!==_a&&!_a)return!0;const draggingLayoutInfo=draggingItem.layoutInfo;if(draggingLayoutInfo){const state=(0,jimu_core.Vp3)().getState(),{layouts}=state.appConfig,fromLayout=layouts[draggingLayoutInfo.layoutId],layoutItem=null===(_b=null==fromLayout?void 0:fromLayout.content)||void 0===_b?void 0:_b[draggingLayoutInfo.layoutItemId];if(layoutItem){const lockParent=null!==(_d=null===(_c=layoutItem.setting)||void 0===_c?void 0:_c.lockParent)&&void 0!==_d&&_d;if(fromLayout.type===jimu_core.p5K.FlowLayout||lockParent)return draggingLayoutInfo.layoutId===layoutId}}return!0}(layoutId,draggingItem);return isAllowed&&"function"==typeof layoutContext.isItemAccepted&&(isAllowed=layoutContext.isItemAccepted(draggingItem,null!==(_b=props.isPlaceholder)&&void 0!==_b&&_b)),isAllowed}function initInteractive(domRef,contextRef,acceptClassName){let draggingItem,draggingElement,handlerElement,containerRect,lastDragCall;return interact_min_default()(domRef).dropzone({accept:null!=acceptClassName?acceptClassName:".exb-rnd",checker:(dragEvent,event,dropped,dropzone,dropElement,draggable,draggableElement)=>{const{props,layoutId,pageContext,layoutContext}=contextRef.current;return"none"!==getComputedStyle(dropElement).pointerEvents&&(draggingItem=createItemFromInteractEvent(draggableElement),!pageContext.viewOnly&&dropped&&!draggableElement.contains(dropElement)&&isDraggingItemAccepted(draggingItem,layoutContext,props,layoutId))},ondragenter:event=>{var _a,_b,_c;const{props,layoutId,pageContext}=contextRef.current;if(event.stopPropagation(),event.target.classList.add("drop-target"),layoutId!==pageContext.rootLayoutId&&event.target.classList.add("drop-active"),draggingElement=document.getElementById("interact_dragging_placeholder")||event.relatedTarget,containerRect=event.dropzone.getRect(event.target),(null===(_c=null===(_b=null===(_a=event.dragEvent.interactable)||void 0===_a?void 0:_a.options)||void 0===_b?void 0:_b.drag)||void 0===_c?void 0:_c.allowFrom)&&(handlerElement=event.relatedTarget.querySelector(event.dragEvent.interactable.options.drag.allowFrom),handlerElement)){const handlerRect=handlerElement.getBoundingClientRect(),dragElementRect=event.dragEvent.rect;handlerElement.setAttribute("data-dx",""+(handlerRect.left-dragElementRect.left)),handlerElement.setAttribute("data-dy",""+(handlerRect.top-dragElementRect.top)),handlerElement.setAttribute("data-width",`${handlerRect.width}`),handlerElement.setAttribute("data-height",`${handlerRect.height}`)}props.onDragEnter&&props.onDragEnter(draggingItem),props.onToggleDragoverEffect&&props.onToggleDragoverEffect(!0,draggingItem)},ondragleave:event=>{const{props}=contextRef.current;event.stopPropagation(),event.target.classList.remove("drop-target"),event.target.classList.remove("drop-active"),draggingElement=null,containerRect=null,lastDragCall&&cancelAnimationFrame(lastDragCall),handlerElement&&(handlerElement.removeAttribute("data-dx"),handlerElement.removeAttribute("data-dy"),handlerElement.removeAttribute("data-width"),handlerElement.removeAttribute("data-height")),props.onDragLeave&&props.onDragLeave(draggingItem),props.onToggleDragoverEffect&&props.onToggleDragoverEffect(!1,draggingItem)},ondropmove:event=>{const{props}=contextRef.current;event.stopPropagation(),lastDragCall&&cancelAnimationFrame(lastDragCall),lastDragCall=requestAnimationFrame((()=>{const dragElementRect=event.dragEvent.rect,clientCoor=event.dragEvent._interaction.coords.cur.client,clientX=clientCoor.x-(null==containerRect?void 0:containerRect.left),clientY=clientCoor.y-(null==containerRect?void 0:containerRect.top);if(props.onDragOver){let handlerRect;handlerElement&&(handlerRect={left:parseFloat(handlerElement.getAttribute("data-dx"))+dragElementRect.left-(null==containerRect?void 0:containerRect.left),top:parseFloat(handlerElement.getAttribute("data-dy"))+dragElementRect.top-(null==containerRect?void 0:containerRect.top),width:parseFloat(handlerElement.getAttribute("data-width")),height:parseFloat(handlerElement.getAttribute("data-height"))}),props.onDragOver(draggingItem,draggingElement,containerRect,{left:dragElementRect.left-(null==containerRect?void 0:containerRect.left),top:dragElementRect.top-(null==containerRect?void 0:containerRect.top),width:dragElementRect.width,height:dragElementRect.height,right:dragElementRect.left-(null==containerRect?void 0:containerRect.left)+dragElementRect.width,bottom:dragElementRect.top-(null==containerRect?void 0:containerRect.top)+dragElementRect.height,handlerRect},clientX,clientY,event.dragEvent.speed)}lastDragCall=null}))},ondrop:event=>{const{props}=contextRef.current;if(event.stopPropagation(),event.target.classList.remove("drop-target"),event.target.classList.remove("drop-active"),props.onToggleDragoverEffect&&props.onToggleDragoverEffect(!1,draggingItem),lastDragCall&&cancelAnimationFrame(lastDragCall),props.onDrop){const dragElementRect=event.dragEvent.rect;let itemRect={left:dragElementRect.left-containerRect.left,top:dragElementRect.top-containerRect.top,width:dragElementRect.width,height:dragElementRect.height};itemRect=restrictItemInContainer(itemRect,{left:0,top:0,width:containerRect.width,height:containerRect.height}),itemRect.right=itemRect.left+itemRect.width,itemRect.bottom=itemRect.top+itemRect.height;const clientCoor=event.dragEvent._interaction.coords.cur.client,clientX=clientCoor.x-containerRect.left,clientY=clientCoor.y-containerRect.top;props.onDrop(draggingItem,containerRect,itemRect,clientX,clientY)}}})}function initH5(elem,contextRef){let h5DraggingItem,containerRect;const throttleDragOverHandler=jimu_core.CM0.throttle((function h5DragOverHandler(draggingItem,clientX,clientY){if(!draggingItem||isNaN(clientX)||isNaN(clientY))return;let width=200,height=100;const{props}=contextRef.current;draggingItem.manifest.defaultSize&&(width=isNaN(draggingItem.manifest.defaultSize.width)?width:draggingItem.manifest.defaultSize.width,height=isNaN(draggingItem.manifest.defaultSize.height)?height:draggingItem.manifest.defaultSize.height);props.onDragOver&&props.onDragOver(draggingItem,null,containerRect,{left:clientX-width/2-containerRect.left,top:clientY-height/2-containerRect.top,width,height,right:clientX-width/2-containerRect.left+width,bottom:clientY-height/2-containerRect.top+height},clientX-containerRect.left,clientY-containerRect.top)}),100);function initH5Dragging(){const{props,layoutId,layoutContext,pageContext}=contextRef.current;if(pageContext.viewOnly)return;const currentDraggingItem=function createItemFromH5DragEvent(){return window.jimuConfig.isInBuilder&&window.parent&&window.parent._dragging_widget_item?window.parent._dragging_widget_item:null}();h5DraggingItem&&h5DraggingItem===currentDraggingItem||(h5DraggingItem=currentDraggingItem,isDraggingItemAccepted(h5DraggingItem,layoutContext,props,layoutId)&&(elem.classList.add("drop-target"),props.onToggleDragoverEffect&&props.onToggleDragoverEffect(!0,h5DraggingItem)))}function isH5DragElementAccepted(){if(!h5DraggingItem)return!1;const{props,layoutId,pageContext,layoutContext}=contextRef.current;return!pageContext.viewOnly&&isDraggingItemAccepted(h5DraggingItem,layoutContext,props,layoutId)}elem.addEventListener("dragenter",(function onDragEnter(e){const{props}=contextRef.current;if(e.stopPropagation(),e.preventDefault(),initH5Dragging(),!isH5DragElementAccepted())return;containerRect=elem.getBoundingClientRect(),h5DraggingItem&&props.onDragEnter&&props.onDragEnter(h5DraggingItem)})),elem.addEventListener("dragleave",(function onDragLeave(e){const{props}=contextRef.current;if(e.stopPropagation(),e.preventDefault(),elem.classList.remove("drop-target"),elem.classList.remove("drop-active"),!isH5DragElementAccepted())return;props.onDragLeave&&props.onDragLeave(h5DraggingItem);props.onToggleDragoverEffect&&props.onToggleDragoverEffect(!1,h5DraggingItem);h5DraggingItem=null})),elem.addEventListener("dragover",(function onDragOver(e){const{layoutId,pageContext}=contextRef.current;if(e.stopPropagation(),e.preventDefault(),initH5Dragging(),!isH5DragElementAccepted())return void(e.dataTransfer&&(e.dataTransfer.dropEffect="none"));e.dataTransfer&&(e.dataTransfer.dropEffect="copy");if(elem.classList.contains("drop-target")){const{clientX,clientY}=e;elem.classList.contains("drop-active")||layoutId===pageContext.rootLayoutId||elem.classList.add("drop-active"),throttleDragOverHandler(h5DraggingItem,clientX,clientY)}})),elem.addEventListener("drop",(function onDrop(e){if(e.stopPropagation(),elem.classList.remove("drop-target"),elem.classList.remove("drop-active"),document.documentElement.classList.remove(GLOBAL_H5_DRAGGING_CLASS_NAME),!isH5DragElementAccepted())return void(h5DraggingItem=null);const{props}=contextRef.current,{clientX,clientY}=e,containerRect=elem.getBoundingClientRect();let width=200,height=100;h5DraggingItem.manifest.defaultSize&&(width=isNaN(h5DraggingItem.manifest.defaultSize.width)?width:h5DraggingItem.manifest.defaultSize.width,height=isNaN(h5DraggingItem.manifest.defaultSize.height)?height:h5DraggingItem.manifest.defaultSize.height);let itemRect={width,height,left:clientX-width/2-containerRect.left,top:clientY-height/2-containerRect.top};itemRect=restrictItemInContainer(itemRect,{left:0,top:0,width:containerRect.width,height:containerRect.height}),itemRect.right=itemRect.left+itemRect.width,itemRect.bottom=itemRect.top+itemRect.height,props.onToggleDragoverEffect&&props.onToggleDragoverEffect(!1,h5DraggingItem);props.onDrop&&props.onDrop(h5DraggingItem,containerRect,itemRect,clientX-containerRect.left,clientY-containerRect.top);h5DraggingItem=null}))}function droparea_hook_DropArea(props){const refObj=jimu_core.q_G.useRef(),layoutId=jimu_core.E_S.useSelector((state=>props.layouts[state.browserSizeMode])),isDesignMode=jimu_core.E_S.useSelector((state=>state.appRuntimeInfo.appMode===jimu_core.$0N.Design)),pageContext=jimu_core.q_G.useContext(layout_runtime.PageContext),layoutContext=jimu_core.q_G.useContext(layout_runtime.LayoutContext),contextRef=jimu_core.q_G.useRef();contextRef.current={props,layoutId,pageContext,layoutContext},jimu_core.q_G.useEffect((()=>{let interactble;return refObj.current&&(interactble=initInteractive(refObj.current,contextRef)),()=>{interactble&&interactble.unset()}}),[]),jimu_core.q_G.useEffect((()=>{refObj.current&&initH5(refObj.current,contextRef)}),[]);const{className,style,highlightDragover}=props,mergedClass=(0,jimu_core.xWm)("exb-drop-area d-flex",className);return(0,jimu_core.Yac)("div",{className:mergedClass,css:jimu_core.AHW`
      background: transparent;
      padding: inherit;
      pointer-events: ${isDesignMode?"auto":"none !important"};

      & > .highlight-content {
        display: none;
        pointer-events: none;
        position: relative;
      }

      &.drop-target > .highlight-content {
        display: flex;
      }

      &.drop-active {
        background: ${jimu_core.PLL.rgba(pageContext.builderTheme.sys.color.primary.dark,.2)};
      }
    `,style,ref:el=>{refObj.current=el}},highlightDragover&&(0,jimu_core.Yac)("div",{className:"w-100 highlight-content"},props.children))}try{droparea_hook_DropArea.displayName="DropArea",droparea_hook_DropArea.__docgenInfo={description:"",displayName:"DropArea",props:{layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"IMSizeModeLayoutJson"}},isPlaceholder:{defaultValue:null,description:"",name:"isPlaceholder",required:!1,type:{name:"boolean"}},highlightDragover:{defaultValue:null,description:"",name:"highlightDragover",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},onToggleDragoverEffect:{defaultValue:null,description:"",name:"onToggleDragoverEffect",required:!1,type:{name:"(isDragover: boolean, draggingItem?: LayoutItemConstructorProps) => void"}},onDragEnter:{defaultValue:null,description:"",name:"onDragEnter",required:!1,type:{name:"(draggingItem: LayoutItemConstructorProps) => void"}},onDragOver:{defaultValue:null,description:"",name:"onDragOver",required:!1,type:{name:"(draggingItem: LayoutItemConstructorProps, draggingElement: HTMLElement, containerRect: DOMRect, itemRect: DOMRect & { ...; }, clientX: number, clientY: number, speed?: number) => void"}},onDragLeave:{defaultValue:null,description:"",name:"onDragLeave",required:!1,type:{name:"(draggingItem: LayoutItemConstructorProps) => void"}},onDrop:{defaultValue:null,description:"",name:"onDrop",required:!1,type:{name:"(draggingItem: LayoutItemConstructorProps, containerRect: DOMRect, itemRect: DOMRect & { handlerRect?: DOMRect; }, clientX: number, clientY: number) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/interactive/droparea-hook.tsx#DropArea"]={docgenInfo:droparea_hook_DropArea.__docgenInfo,name:"DropArea",path:"../jimu-layouts/lib/builder/interactive/droparea-hook.tsx#DropArea"})}catch(__react_docgen_typescript_loader_error){}var editor_plus=__webpack_require__("../jimu-icons/outlined/editor/plus.tsx"),theme_tooltip=__webpack_require__("../jimu-layouts/lib/builder/theme-tooltip.tsx");const ThemeWidgetListPopper=(0,jimu_theme.ZS)(setting_components.WidgetListPopper),dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  right: 0;
  right: 0;
  display: flex;
  z-index: 0;
`;class _WidgetPlaceholder extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.toggleModal=e=>{e.stopPropagation(),(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small?this.setState((prevState=>({showModal:!prevState.showModal}))):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"widget",isPlaceholder:!0,isItemAccepted:this.isItemAccepted,onSelect:this.setContent})},this.closeModal=()=>{this.state.showModal&&this.setState({showModal:!1})},this.toggleDragoverEffect=(isDragover,draggingItem)=>{this.ref&&isDragover&&this.isItemAccepted(draggingItem)?this.ref.classList.add("dragover"):this.ref.classList.remove("dragover")},this.onDrop=draggingItem=>{if(!this.isItemAccepted(draggingItem))return;const{layoutId,layoutItemId}=this.props;dropAtPlaceholder({layoutId,layoutItemId},draggingItem)},this.setContent=item=>{const{layoutId,layoutItemId}=this.props;item.itemType===jimu_core.K6q.Widget?addWidgetInPlaceholder({layoutId,layoutItemId},item).then((()=>{this.setState({isBusy:!1})})):item.itemType===jimu_core.K6q.Section&&addSectionInPlaceholder({layoutId,layoutItemId}),this.setState({showModal:!1,isBusy:!0})},this.handleSyncChange=newPlaceholderId=>{const{browserSizeMode,layoutId,layoutItemId}=this.props;(0,jimu_for_builder.getAppConfigAction)().syncPlaceholder({layoutId,layoutItemId},newPlaceholderId,browserSizeMode).exec()},this.isItemAccepted=item=>this.layoutContext.isItemAccepted(item,!0)&&canDropAtPlaceholder(item),this.fakeLayouts=(0,jimu_core.J3Z)({[jimu_core.rHp.Large]:`${this.props.layoutId}_${this.props.layoutItemId}_tlarge`,[jimu_core.rHp.Medium]:`${this.props.layoutId}_${this.props.layoutItemId}_tmedium`,[jimu_core.rHp.Small]:`${this.props.layoutId}_${this.props.layoutItemId}_tsmall`}),this.state={showModal:!1,isBusy:!1}}componentDidUpdate(prevProps){prevProps.currentDialogId!==this.props.currentDialogId&&this.setState({showModal:!1})}getStyle(builderTheme){return jimu_core.AHW`
      position: absolute;
      left: 0;
      top: 0;
      overflow: hidden;
      container-type: inline-size;

      &.is-template {
        border: 1px dashed ${builderTheme.sys.color.primary.dark};
      }

      &.dragover .drop-tip {
        background: ${jimu_core.PLL.rgba(builderTheme.sys.color.primary.dark,.5)} !important;
      }

      .add-btn {
        z-index: 1;
      }

      .mask {
        position: absolute;
        left:0;
        top:0;
        right:0;
        bottom:0;
        z-index:2;
        background: transparent;
      }

      .placeholder-id {
        background: var(--ref-palette-white);
        color: var(--sys-color-surface-background-hint);
        font-size: min(32px, 12.5cqw, 12.5cqh);
        width: min(25cqw, 25cqh);
        height: min(25cqw, 25cqh);
        max-width: 64px;
        max-height: 64px;
        gap: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      &.aspect-ratio-wrapper {
        padding-top: ${100*(this.props.aspectRatio||0)}%;
      }

      &.aspect-ratio-wrapper > .exb-drop-area {
        position: absolute;
        padding: 0;
      }

      &.aspect-ratio-wrapper > .add-btn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
    `}getPopupStyle(){const{builderTheme}=this.pageContext;return jimu_core.AHW`
      background-color: ${builderTheme.ref.palette.neutral[400]};
      max-height: 400px;
      overflow: auto;
    `}getModalStyle(){const{builderTheme}=this.pageContext;return jimu_core.AHW`
      .modal-content {
        background-color: ${builderTheme.ref.palette.neutral[400]};
      }

      .modal-header {
        color: ${builderTheme.ref.palette.black};
        .close {
          color: ${builderTheme.ref.palette.neutral[1100]};
          &:hover {
            color: ${builderTheme.ref.palette.black};
          }
        }
      }
    `}render(){const{isTemplate,isMainSizeMode}=this.props,isExpressBuilder=jimu_core.WpD.isExpressMode();return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(pageContext=>(this.pageContext=pageContext,(0,jimu_core.Yac)(layout_runtime.LayoutContext.Consumer,null,(layoutContext=>{var _a;return this.layoutContext=layoutContext,(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("layout-widget layout-item-content no-widget h-100 w-100 d-flex justify-content-center align-items-center",{"is-template":isTemplate}),ref:el=>{this.ref=el},css:this.getStyle(pageContext.builderTheme)},!isTemplate&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(droparea_hook_DropArea,{css:dropareaStyle,className:"drop-tip",layouts:this.fakeLayouts,isPlaceholder:!0,highlightDragover:!1,onToggleDragoverEffect:this.toggleDragoverEffect,onDrop:this.onDrop}),this.state.isBusy&&(0,jimu_core.Yac)(jimu_ui.Loading,{type:jimu_ui.LoadingType.Primary}),!this.state.isBusy&&(0,jimu_core.Yac)("div",{ref:el=>{this.btnRef=el},className:(0,jimu_core.xWm)("add-btn",{"d-none":this.pageContext.viewOnly||isExpressBuilder&&!isMainSizeMode})},(0,jimu_core.Yac)(theme_tooltip.v,{title:null===(_a=this.props.intl)||void 0===_a?void 0:_a.formatMessage({id:"addWidget"})},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,css:jimu_core.AHW`width: 36px; height: 36px; padding: 0.5rem;`,onClick:this.toggleModal,"aria-haspopup":!0},(0,jimu_core.Yac)(editor_plus.b,null)))),!this.state.isBusy&&this.state.showModal&&(0,jimu_core.Yac)(ThemeWidgetListPopper,{referenceElement:this.btnRef,isAccepted:this.isItemAccepted,onSelect:this.setContent,onClose:this.closeModal}),this.pageContext.viewOnly&&(0,jimu_core.Yac)("div",{className:"mask"})),isTemplate&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,this.props.placeholderId>0&&(0,jimu_core.Yac)("div",{className:"placeholder-id rounded-circle"},this.props.placeholderId),!this.pageContext.viewOnly&&(0,jimu_core.Yac)(PlaceholderSync,{layoutId:this.props.layoutId,layoutItemId:this.props.layoutItemId,sizemode:this.props.browserSizeMode,onSyncChange:this.handleSyncChange,className:"sync-select"})))})))))}}const widget_placeholder_mapFunc=(0,jimu_core.Mz0)((state=>{var _a;return null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.currentDialogId}),(state=>state.browserSizeMode),(state=>state.browserSizeMode===state.appConfig.mainSizeMode),(state=>{var _a;return(null===(_a=state.appInfo)||void 0===_a?void 0:_a.type)===jimu_core.uCV.Template}),((state,props)=>{const{layoutId,layoutItemId}=props,placeholderInfo=jimu_for_builder.placeholderService.getPlaceholderInfo(state.appConfig,{layoutId,layoutItemId});return placeholderInfo&&placeholderInfo.layoutInfo.layoutId===layoutId?placeholderInfo.id:-1}),((currentDialogId,browserSizeMode,isMainSizeMode,isTemplate,placeholderId)=>({currentDialogId,browserSizeMode,isMainSizeMode,isTemplate,placeholderId}))),WrappedComponent=jimu_core.E_S.connect(widget_placeholder_mapFunc)(_WidgetPlaceholder),widget_placeholder_WidgetPlaceholder=(0,jimu_core.j4T)(WrappedComponent);try{_WidgetPlaceholder.displayName="_WidgetPlaceholder",_WidgetPlaceholder.__docgenInfo={description:"",displayName:"_WidgetPlaceholder",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},intl:{defaultValue:null,description:"",name:"intl",required:!0,type:{name:"IntlShape"}},browserSizeMode:{defaultValue:null,description:"",name:"browserSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},isMainSizeMode:{defaultValue:null,description:"",name:"isMainSizeMode",required:!0,type:{name:"boolean"}},isTemplate:{defaultValue:null,description:"",name:"isTemplate",required:!0,type:{name:"boolean"}},placeholderId:{defaultValue:null,description:"",name:"placeholderId",required:!0,type:{name:"number"}},currentDialogId:{defaultValue:null,description:"",name:"currentDialogId",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/widget-placeholder.tsx#_WidgetPlaceholder"]={docgenInfo:_WidgetPlaceholder.__docgenInfo,name:"_WidgetPlaceholder",path:"../jimu-layouts/lib/builder/widget-placeholder.tsx#_WidgetPlaceholder"})}catch(__react_docgen_typescript_loader_error){}try{widget_placeholder_WidgetPlaceholder.displayName="WidgetPlaceholder",widget_placeholder_WidgetPlaceholder.__docgenInfo={description:"",displayName:"WidgetPlaceholder",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/widget-placeholder.tsx#WidgetPlaceholder"]={docgenInfo:widget_placeholder_WidgetPlaceholder.__docgenInfo,name:"WidgetPlaceholder",path:"../jimu-layouts/lib/builder/widget-placeholder.tsx#WidgetPlaceholder"})}catch(__react_docgen_typescript_loader_error){}class widget_renderer_WidgetRendererInBuilder extends jimu_core.q_G.PureComponent{mask(){return(0,jimu_core.Yac)("div",{className:"widget-mask"})}getStyle(){return jimu_core.AHW`
      .${GLOBAL_DRAGGING_CLASS_NAME} & {
        overflow: visible !important;
      }
      z-index: ${this.props.isInlineEditing?layout_runtime.LayoutZIndex.HandlerTools:0};

      .widget-mask {
        position: absolute;
        background: transparent;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 1;
      }

      body:not(.design-mode) & .widget-mask {
        display: none !important;
      }
    `}getPlaceholderStyle(){return jimu_core.AHW`
      body:not(.design-mode) & {
        display: none !important;
      }
    `}render(){const{widgetId,isInlineEditing,isFunctionalWidget,hasEmbeddedLayout}=this.props,showMask=!isInlineEditing&&isFunctionalWidget&&!hasEmbeddedLayout;return(0,jimu_core.Yac)(layout_runtime.WidgetRenderer,Object.assign({className:"w-100",css:this.getStyle()},this.props),!widgetId&&(0,jimu_core.Yac)(widget_placeholder_WidgetPlaceholder,Object.assign({css:this.getPlaceholderStyle()},this.props)),showMask&&widgetId&&this.mask())}}try{widget_renderer_WidgetRendererInBuilder.displayName="WidgetRendererInBuilder",widget_renderer_WidgetRendererInBuilder.__docgenInfo={description:"",displayName:"WidgetRendererInBuilder",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!0,type:{name:"string"}},isClassLoaded:{defaultValue:null,description:"",name:"isClassLoaded",required:!0,type:{name:"boolean"}},isInlineEditing:{defaultValue:null,description:"",name:"isInlineEditing",required:!0,type:{name:"boolean"}},isFunctionalWidget:{defaultValue:null,description:"",name:"isFunctionalWidget",required:!0,type:{name:"boolean"}},isInController:{defaultValue:null,description:"",name:"isInController",required:!0,type:{name:"boolean"}},hasEmbeddedLayout:{defaultValue:null,description:"",name:"hasEmbeddedLayout",required:!0,type:{name:"boolean"}},useDragHandler:{defaultValue:null,description:"",name:"useDragHandler",required:!0,type:{name:"boolean"}},widgetState:{defaultValue:null,description:"",name:"widgetState",required:!1,type:{name:"any"}},supportInlineEditing:{defaultValue:null,description:"",name:"supportInlineEditing",required:!0,type:{name:"boolean"}},supportRepeat:{defaultValue:null,description:"",name:"supportRepeat",required:!0,type:{name:"boolean"}},canCrossLayoutBoundary:{defaultValue:null,description:"",name:"canCrossLayoutBoundary",required:!0,type:{name:"boolean"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}},widgetStyle:{defaultValue:null,description:"",name:"widgetStyle",required:!0,type:{name:"any"}},hasExtension:{defaultValue:null,description:"",name:"hasExtension",required:!1,type:{name:"boolean"}},widgetJson:{defaultValue:null,description:"",name:"widgetJson",required:!1,type:{name:"IMWidgetJson"}},onInitResizeHandler:{defaultValue:null,description:"",name:"onInitResizeHandler",required:!1,type:{name:"WidgetInitResizeCallback"}},onInitDragHandler:{defaultValue:null,description:"",name:"onInitDragHandler",required:!1,type:{name:"WidgetInitDragCallback"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/widget-renderer.tsx#WidgetRendererInBuilder"]={docgenInfo:widget_renderer_WidgetRendererInBuilder.__docgenInfo,name:"WidgetRendererInBuilder",path:"../jimu-layouts/lib/builder/widget-renderer.tsx#WidgetRendererInBuilder"})}catch(__react_docgen_typescript_loader_error){}var LayoutEntryMode,__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};!function(LayoutEntryMode){LayoutEntryMode[LayoutEntryMode.ChooseLayoutType=0]="ChooseLayoutType",LayoutEntryMode[LayoutEntryMode.RenderLayout=1]="RenderLayout"}(LayoutEntryMode||(LayoutEntryMode={}));class LayoutEntry extends jimu_core.q_G.Component{constructor(){super(...arguments),this.state={mode:LayoutEntryMode.RenderLayout},this.onLayoutTypeSelected=()=>{this.setState({mode:LayoutEntryMode.RenderLayout})},this.switchToChoosingMode=()=>{this.setState({mode:LayoutEntryMode.ChooseLayoutType})}}shouldComponentUpdate(nextProps){return!(nextProps.isPageItem&&!nextProps.visible)&&Object.keys(nextProps).some((key=>nextProps[key]!==this.props[key]))}render(){const{layout}=this.props;if(!layout)return null;const LayoutElement=(0,layout_runtime.findLayoutBuilder)(layout.type||jimu_core.p5K.FlowLayout);if(!LayoutElement)return null;const _a=this.props,{isItemAccepted}=_a,otherProps=__rest(_a,["isItemAccepted"]);return(0,jimu_core.Yac)(layout_runtime.LayoutContext.Provider,{value:{isItemAccepted:isItemAccepted||defaultWidgetFilter}},(0,jimu_core.Yac)(LayoutElement,Object.assign({},otherProps)))}}const layout_entry=jimu_core.E_S.connect(layout_runtime.utils.mapStateToLayoutProps)(LayoutEntry);function defaultWidgetFilter(item){return null!=item}try{defaultWidgetFilter.displayName="defaultWidgetFilter",defaultWidgetFilter.__docgenInfo={description:"",displayName:"defaultWidgetFilter",props:{itemType:{defaultValue:null,description:"",name:"itemType",required:!0,type:{name:"enum",value:[{value:'"UNKNOWN"'},{value:'"WIDGET"'},{value:'"SECTION"'},{value:'"SCREEN_GROUP"'}]}},id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},layoutInfo:{defaultValue:null,description:"",name:"layoutInfo",required:!1,type:{name:"LayoutInfo"}},isFromCurrentSizeMode:{defaultValue:null,description:"",name:"isFromCurrentSizeMode",required:!1,type:{name:"boolean"}},rotation:{defaultValue:null,description:"",name:"rotation",required:!1,type:{name:"number"}},isPending:{defaultValue:null,description:"",name:"isPending",required:!1,type:{name:"boolean"}},manifest:{defaultValue:null,description:"",name:"manifest",required:!0,type:{name:"Partial<WidgetManifest>"}},icon:{defaultValue:null,description:"",name:"icon",required:!0,type:{name:"string | IconResult"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},uri:{defaultValue:null,description:"",name:"uri",required:!1,type:{name:"string"}},itemId:{defaultValue:null,description:"",name:"itemId",required:!1,type:{name:"string"}},group:{defaultValue:null,description:"",name:"group",required:!1,type:{name:"number"}},order:{defaultValue:null,description:"",name:"order",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/layout-entry.tsx#defaultWidgetFilter"]={docgenInfo:defaultWidgetFilter.__docgenInfo,name:"defaultWidgetFilter",path:"../jimu-layouts/lib/builder/layout-entry.tsx#defaultWidgetFilter"})}catch(__react_docgen_typescript_loader_error){}try{layoutentry.displayName="layoutentry",layoutentry.__docgenInfo={description:"",displayName:"layoutentry",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"ImmutableObjectMixin<SizeModeLayoutJson> & { readonly [x: string]: string; }"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},isInWidget:{defaultValue:null,description:"",name:"isInWidget",required:!1,type:{name:"boolean"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},isPageItem:{defaultValue:null,description:"",name:"isPageItem",required:!1,type:{name:"boolean"}},itemDraggable:{defaultValue:null,description:"",name:"itemDraggable",required:!1,type:{name:"boolean"}},itemResizable:{defaultValue:null,description:"",name:"itemResizable",required:!1,type:{name:"boolean"}},itemSelectable:{defaultValue:null,description:"",name:"itemSelectable",required:!1,type:{name:"boolean"}},droppable:{defaultValue:null,description:"",name:"droppable",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isItemAccepted:{defaultValue:null,description:"",name:"isItemAccepted",required:!1,type:{name:"(item: LayoutItemConstructorProps, isReplacePlaceholder: boolean) => boolean"}},onItemClick:{defaultValue:null,description:"",name:"onItemClick",required:!1,type:{name:"(e: any, widgetId: string) => void"}},ignoreMinHeight:{defaultValue:null,description:"",name:"ignoreMinHeight",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/layout-entry.tsx#layoutentry"]={docgenInfo:layoutentry.__docgenInfo,name:"layoutentry",path:"../jimu-layouts/lib/builder/layout-entry.tsx#layoutentry"})}catch(__react_docgen_typescript_loader_error){}var section_renderer_base=__webpack_require__("../jimu-layouts/lib/runtime/section-renderer-base.tsx");class section_renderer_SectionRendererInBuilder extends jimu_core.q_G.PureComponent{render(){return jimu_core.q_G.createElement(section_renderer_base.S,Object.assign({},this.props,{layoutEntryComponent:layout_entry,viewVisibilityContext:layout_runtime.ViewVisibilityContext}))}}try{section_renderer_SectionRendererInBuilder.displayName="SectionRendererInBuilder",section_renderer_SectionRendererInBuilder.__docgenInfo={description:"",displayName:"SectionRendererInBuilder",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},selected:{defaultValue:null,description:"",name:"selected",required:!1,type:{name:"boolean"}},autoScroll:{defaultValue:null,description:"",name:"autoScroll",required:!1,type:{name:"boolean"}},animationPreview:{defaultValue:null,description:"",name:"animationPreview",required:!1,type:{name:"boolean"}},hoverPreview:{defaultValue:null,description:"",name:"hoverPreview",required:!1,type:{name:"boolean"}},playMode:{defaultValue:null,description:"",name:"playMode",required:!1,type:{name:"enum",value:[{value:'"AS_ONE"'},{value:'"ONE_BY_ONE"'}]}},previewId:{defaultValue:null,description:"",name:"previewId",required:!1,type:{name:"number"}},watchViewportVisibility:{defaultValue:null,description:"",name:"watchViewportVisibility",required:!1,type:{name:"boolean"}},sectionId:{defaultValue:null,description:"",name:"sectionId",required:!0,type:{name:"string"}},views:{defaultValue:null,description:"",name:"views",required:!0,type:{name:"ImmutableArray<string>"}},activeView:{defaultValue:null,description:"",name:"activeView",required:!1,type:{name:"IMViewJson"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}},sectionStyle:{defaultValue:null,description:"",name:"sectionStyle",required:!0,type:{name:"any"}},navInfo:{defaultValue:null,description:"",name:"navInfo",required:!0,type:{name:"IMSectionNavInfo"}},transition:{defaultValue:null,description:"",name:"transition",required:!1,type:{name:"{ type: string; direction?: string; }"}},autoPlay:{defaultValue:null,description:"",name:"autoPlay",required:!1,type:{name:"boolean"}},interval:{defaultValue:null,description:"",name:"interval",required:!1,type:{name:"number"}},loop:{defaultValue:null,description:"",name:"loop",required:!1,type:{name:"boolean"}},focusable:{defaultValue:null,description:"",name:"focusable",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/section-renderer.tsx#SectionRendererInBuilder"]={docgenInfo:section_renderer_SectionRendererInBuilder.__docgenInfo,name:"SectionRendererInBuilder",path:"../jimu-layouts/lib/builder/section-renderer.tsx#SectionRendererInBuilder"})}catch(__react_docgen_typescript_loader_error){}function usePreviewPlayId(option){const{isPreview,previewId}=option;return isPreview?previewId:null}function useLiveviewPlayId(type,hasParentAnimation){const[liveViewPlayId,setLiveViewPlayId]=jimu_core.q_G.useState(null),isDesignMode=jimu_core.E_S.useSelector((state=>{var _a;return(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design})),sizeMode=jimu_core.E_S.useSelector((state=>state.browserSizeMode)),isPageVisible=jimu_core.q_G.useContext(layout_runtime.PageVisibilityContext),visibleRef=jimu_core.q_G.useRef(isPageVisible),sizeModeRef=jimu_core.q_G.useRef(sizeMode);jimu_core.q_G.useEffect((()=>{null==type||hasParentAnimation||isDesignMode&&visibleRef.current||setLiveViewPlayId((0,jimu_core.RqM)())}),[isDesignMode,hasParentAnimation,type]),jimu_core.q_G.useEffect((()=>{null==type||hasParentAnimation||isDesignMode||sizeModeRef.current===sizeMode||(sizeModeRef.current=sizeMode,setLiveViewPlayId((0,jimu_core.RqM)()))}),[sizeMode,isDesignMode,hasParentAnimation,type]),jimu_core.q_G.useEffect((()=>{null==type||hasParentAnimation||isDesignMode||visibleRef.current===isPageVisible||(visibleRef.current=isPageVisible,setLiveViewPlayId((0,jimu_core.RqM)()))}),[isPageVisible,isDesignMode,hasParentAnimation,type]);const resetPlayId=jimu_core.q_G.useCallback((()=>{setLiveViewPlayId(null)}),[]);return{playId:liveViewPlayId,revert:!isDesignMode&&!isPageVisible,onAnimationEnd:resetPlayId}}var use_viewport_intersection=__webpack_require__("../jimu-layouts/lib/use-viewport-intersection.ts");const parentRestrict=interact_min_default().modifiers.restrictRect({restriction:"parent"}),boundaryRestrict=interact_min_default().modifiers.restrictRect({restriction:`div.${LIMITED_BOUNDARY_CLASS_NAME}`});function useDndBinding(props){const{layoutId,layoutItemId,layoutType,layoutItemType,useDragHandler,restrict,getCurrentRootLayoutId}=props,interactableRef=jimu_core.q_G.useRef(),widgetResizeStartHandlerRef=jimu_core.q_G.useRef(),widgetResizingHandlerRef=jimu_core.q_G.useRef(),widgetResizeEndHandlerRef=jimu_core.q_G.useRef(),widgetDragStartHandlerRef=jimu_core.q_G.useRef(),widgetDraggingHandlerRef=jimu_core.q_G.useRef(),widgetDragEndHandlerRef=jimu_core.q_G.useRef(),elementRef=jimu_core.q_G.useRef();function onItemDragStart(layoutItemId){setIsDragging(!0),setIsResizing(!1),props.onDragStart&&props.onDragStart(layoutItemId),widgetDragStartHandlerRef.current&&widgetDragStartHandlerRef.current()}function onItemDragging(id,dx,dy){props.onDragging&&props.onDragging(id,dx,dy),widgetDraggingHandlerRef.current&&widgetDraggingHandlerRef.current(dx,dy)}function onItemDragEnd(id,dx,dy){jimu_core.CM0.defer((()=>{setIsDragging(!1)})),props.onDragEnd&&props.onDragEnd(id,dx,dy),widgetDragEndHandlerRef.current&&widgetDragEndHandlerRef.current(dx,dy)}function onItemResizeStart(layoutItemId,initWidth,initHeight){setIsDragging(!1),setIsResizing(!0),props.onResizeStart&&props.onResizeStart(layoutItemId,initWidth,initHeight),widgetResizeStartHandlerRef.current&&widgetResizeStartHandlerRef.current(initWidth,initHeight)}function onItemResizing(layoutItemId,x,y,dw,dh,shiftKey,speed){props.onResizing&&props.onResizing(layoutItemId,x,y,dw,dh,shiftKey,speed),widgetResizingHandlerRef.current&&widgetResizingHandlerRef.current(x,y,dw,dh)}function onItemResizeEnd(id,x,y,dw,dh,shiftKey){jimu_core.CM0.defer((()=>{setIsResizing(!1)})),props.onResizeEnd&&props.onResizeEnd(id,x,y,dw,dh,shiftKey),widgetResizeEndHandlerRef.current&&widgetResizeEndHandlerRef.current(x,y,dw,dh)}const registerWidgetInitResizeHandler=jimu_core.q_G.useCallback(((onResizeStart,onResizing,onResizeEnd)=>{widgetResizeStartHandlerRef.current=onResizeStart,widgetResizingHandlerRef.current=onResizing,widgetResizeEndHandlerRef.current=onResizeEnd}),[]),registerWidgetInitDragHandler=jimu_core.q_G.useCallback(((onDragStart,onDragging,onDragEnd)=>{widgetDragStartHandlerRef.current=onDragStart,widgetDraggingHandlerRef.current=onDragging,widgetDragEndHandlerRef.current=onDragEnd}),[]),setRefElement=jimu_core.q_G.useCallback((element=>{elementRef.current=element,interactableRef.current||(interactableRef.current=interact_min_default()(element).origin("parent"),interactableRef.current=bindDragHandler(interactableRef.current,{layoutId,layoutItemId,useDragHandler,onDragging:onItemDragging,onDragStart:onItemDragStart,onDragEnd:onItemDragEnd,itemType:layoutItemType,rootLayoutId:getCurrentRootLayoutId,restrict:()=>restrict}),interactableRef.current=bindResizeHandler(interactableRef.current,{layoutItemId,onResizing:onItemResizing,restrictEdges:layoutType===jimu_core.p5K.FixedLayout,onResizeStart:onItemResizeStart,onResizeEnd:onItemResizeEnd})),interactableRef.current&&(restrict?interactableRef.current.draggable({modifiers:[parentRestrict]}):interactableRef.current.draggable({modifiers:[boundaryRestrict]})),props.resizeObserver&&element&&props.resizeObserver.observe(element)}),[restrict]);return jimu_core.q_G.useEffect((()=>()=>{interactableRef.current&&(interactableRef.current.unset(),interactableRef.current=null),props.resizeObserver&&elementRef.current&&props.resizeObserver.unobserve(elementRef.current)}),[props.resizeObserver]),{registerWidgetInitDragHandler,registerWidgetInitResizeHandler,setRefElement}}try{useDndBinding.displayName="useDndBinding",useDndBinding.__docgenInfo={description:"Bind drag and resize capability",displayName:"useDndBinding",props:{restrict:{defaultValue:null,description:"",name:"restrict",required:!0,type:{name:"boolean"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},layoutType:{defaultValue:null,description:"",name:"layoutType",required:!0,type:{name:"enum",value:[{value:'"FIXED"'},{value:'"FLOW"'},{value:'"GRID"'},{value:'"COLUMN"'},{value:'"ROW"'},{value:'"ACCORDION"'},{value:'"FLEX_ROW"'}]}},layoutItemType:{defaultValue:null,description:"",name:"layoutItemType",required:!0,type:{name:"enum",value:[{value:'"UNKNOWN"'},{value:'"WIDGET"'},{value:'"SECTION"'},{value:'"SCREEN_GROUP"'}]}},useDragHandler:{defaultValue:null,description:"",name:"useDragHandler",required:!0,type:{name:"boolean"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},getCurrentRootLayoutId:{defaultValue:null,description:"",name:"getCurrentRootLayoutId",required:!0,type:{name:"() => string"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!1,type:{name:"(layoutItemId: string) => void"}},onDragging:{defaultValue:null,description:"",name:"onDragging",required:!1,type:{name:"(layoutItemId: string, dx: number, dy: number) => void"}},onDragEnd:{defaultValue:null,description:"",name:"onDragEnd",required:!1,type:{name:"(layoutItemId: string, dx: number, dy: number) => void"}},onResizeStart:{defaultValue:null,description:"",name:"onResizeStart",required:!1,type:{name:"(layoutItemId: string, initWidth: number, initHeight: number) => void"}},onResizing:{defaultValue:null,description:"",name:"onResizing",required:!1,type:{name:"(layoutItemId: string, x: number, y: number, dw: number, dh: number, shiftKey?: boolean, speed?: number) => void"}},onResizeEnd:{defaultValue:null,description:"",name:"onResizeEnd",required:!1,type:{name:"(layoutItemId: string, x: number, y: number, dw: number, dh: number, shiftKey?: boolean) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/layout-item-dnd-hook.tsx#useDndBinding"]={docgenInfo:useDndBinding.__docgenInfo,name:"useDndBinding",path:"../jimu-layouts/lib/builder/layout-item-dnd-hook.tsx#useDndBinding"})}catch(__react_docgen_typescript_loader_error){}var layout_item_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const defaultConstextMenus=[settingMenuItem,draggingMenuItem,pendingMenuItem,deleteMenuItem],dragMenus=[draggingMenuItem];function LayoutItemInBuilder(props){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k;const stateProps=jimu_core.E_S.useSelector((state=>layout_item_mapStateToProps(state,props)),jimu_core.E_S.shallowEqual),allProps=Object.assign(Object.assign({},stateProps),props),pageContext=jimu_core.q_G.useContext(layout_runtime.PageContext),refObj=jimu_core.q_G.useRef(),oneByOnePlayIdRef=jimu_core.q_G.useRef(0);let mousedownX,mousedownY;const{effect,oneByOneEffect,hoverEffect}=null!==(_b=null===(_a=allProps.layoutItem)||void 0===_a?void 0:_a.setting)&&void 0!==_b?_b:{},{animationPreview,hoverPreview,previewId,playMode,layoutType}=allProps,getCurrentRootLayoutId=jimu_core.q_G.useCallback((()=>pageContext.rootLayoutId),[pageContext.rootLayoutId]),isInViewport=(0,use_viewport_intersection.l)(refObj.current,allProps.watchViewportVisibility);let effectType=null===(_c=null==effect?void 0:effect[jimu_core.Zre.ScrollIntoView])||void 0===_c?void 0:_c.type;effectType=effectType&&effectType!==jimu_core.J6N.None?effectType:null;let oneByOneEffectType=null===(_d=null==oneByOneEffect?void 0:oneByOneEffect[jimu_core.Zre.ScrollIntoView])||void 0===_d?void 0:_d.type;oneByOneEffectType=oneByOneEffectType&&oneByOneEffectType!==jimu_core.J6N.None?oneByOneEffectType:null;const[animationContext,setAnimationContext]=jimu_core.q_G.useState({setting:null==oneByOneEffect?void 0:oneByOneEffect[jimu_core.Zre.ScrollIntoView],playId:null,oid:stateProps.innerLayoutId,revert:null,playMode:null}),{setting:parentAnimationSetting}=jimu_core.q_G.useContext(jimu_core.e8P),[asOnePlayId,asOneRevert,onAsOneAnimationEnd]=function useAsOnePlayId(option){const{type,isPreview,previewId,hasParentAnimation}=option,previewPlayId=usePreviewPlayId({isPreview,previewId}),{playId:liveviewPlayId,revert:liveviewRevert,onAnimationEnd}=useLiveviewPlayId(type,hasParentAnimation);return type?isPreview?[previewPlayId,!1,null]:[liveviewPlayId,liveviewRevert,onAnimationEnd]:[null,!1,null]}({type:effectType,isPreview:animationPreview,previewId:playMode!==jimu_core.G6p.OneByOne?previewId:null,hasParentAnimation:null!=(null==parentAnimationSetting?void 0:parentAnimationSetting.type)&&parentAnimationSetting.type!==jimu_core.J6N.None}),[oneByOnePlayId,oneByOneRevert,onOnebyOneAnimationEnd]=function useOneByOnePlayId(option){const{type,isPreview,previewId,hasParentAnimation}=option,previewPlayId=usePreviewPlayId({isPreview,previewId}),{playId:liveviewPlayId,revert:liveviewRevert,onAnimationEnd}=useLiveviewPlayId(type,hasParentAnimation);return type?isPreview?[previewPlayId,!1,null]:[liveviewPlayId,liveviewRevert,onAnimationEnd]:[null,!1,null]}({type:oneByOneEffectType,isPreview:animationPreview,previewId:playMode!==jimu_core.G6p.AsOne?previewId:null,hasParentAnimation:null!=(null==parentAnimationSetting?void 0:parentAnimationSetting.type)&&parentAnimationSetting.type!==jimu_core.J6N.None}),{registerWidgetInitDragHandler,registerWidgetInitResizeHandler,setRefElement}=useDndBinding({restrict:props.restrict,layoutId:props.layoutId,layoutItemId:props.layoutItemId,layoutType,layoutItemType:null===(_e=stateProps.layoutItem)||void 0===_e?void 0:_e.type,useDragHandler:props.useDragHandler,resizeObserver:props.resizeObserver,getCurrentRootLayoutId,onDragStart:props.onDragStart,onDragging:props.onDragging,onDragEnd:props.onDragEnd,onResizeStart:props.onResizeStart,onResizing:props.onResizing,onResizeEnd:props.onResizeEnd});jimu_core.JLE.useEffectOnce((()=>{setRefElement(refObj.current)})),jimu_core.q_G.useEffect((()=>{null==asOnePlayId&&oneByOnePlayId>oneByOnePlayIdRef.current&&(oneByOnePlayIdRef.current=oneByOnePlayId,setAnimationContext({setting:null==oneByOneEffect?void 0:oneByOneEffect[jimu_core.Zre.ScrollIntoView],playId:oneByOnePlayId,oid:stateProps.innerLayoutId,revert:oneByOneRevert,playMode,onContextAnimationEnd:oneByOneRevert?null:()=>{null==onOnebyOneAnimationEnd||onOnebyOneAnimationEnd(),animationPreview&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.clearAnimationPreview()),setAnimationContext({setting:null==oneByOneEffect?void 0:oneByOneEffect[jimu_core.Zre.ScrollIntoView],oid:stateProps.innerLayoutId,playId:-1})}}))}),[asOnePlayId,oneByOnePlayId,onOnebyOneAnimationEnd,oneByOneEffect,oneByOneRevert,playMode,animationPreview,stateProps.innerLayoutId]);const shouldAnimationPassdown=()=>{var _a;if(animationPreview)return playMode!==jimu_core.G6p.AsOne;const previewInfo=null===(_a=(0,jimu_core.Vp3)().getState().appRuntimeInfo)||void 0===_a?void 0:_a.animationPreview;return null==previewInfo||previewInfo.playMode!==jimu_core.G6p.OneByOne};function canDrag(){var _a;const{selected,draggable=!0}=allProps,isInlineEditing=null!==(_a=stateProps.isInlineEditing)&&void 0!==_a&&_a,isTouchDevice=jimu_core.WpD.isTouchDevice();return draggable&&!pageContext.viewOnly&&!isInlineEditing&&(!isTouchDevice||selected)}const{layoutId,layoutItemId,top,left,right,bottom,resizable,draggable,isBlock,autoScroll,layoutItem,isFunctionalWidget,selected,isInlineEditing,hasEmbeddedLayout,hasExtension}=allProps;if(!layoutItem)return null;const{className,forbidContextMenu,onClick,onDoubleClick,children,id,isLastChild}=allProps,otherProps=layout_item_rest(allProps,["className","forbidContextMenu","onClick","onDoubleClick","children","id","isLastChild"]),isWidget=layoutItem.type===jimu_core.K6q.Widget,isSection=layoutItem.type===jimu_core.K6q.Section,showContextMenu=!forbidContextMenu&&!pageContext.viewOnly&&(layoutItem.widgetId||layoutItem.sectionId)&&(!isFunctionalWidget||isSection),effectOption=null===(_f=null==effect?void 0:effect[jimu_core.Zre.ScrollIntoView])||void 0===_f?void 0:_f.option,rotate=null!==(_k=null===(_j=null===(_h=null===(_g=layoutItem.setting)||void 0===_g?void 0:_g.style)||void 0===_h?void 0:_h.transform)||void 0===_j?void 0:_j.rotate)&&void 0!==_k?_k:0;return(0,jimu_core.Yac)(layout_runtime.ViewportVisibilityContext.Provider,{value:!!isDesignMode()||isInViewport},(0,jimu_core.Yac)(jimu_core.C6S,{id,parentId:layoutId,type:effectType,configType:null==effectOption?void 0:effectOption.configType,direction:null==effectOption?void 0:effectOption.direction,revert:asOneRevert,delay:props.delay,isLastChild,playId:asOnePlayId,hoverEffect,hoverPlayId:previewId,onAnimationStart:()=>{var _a;if(shouldAnimationPassdown()){const setting=null==oneByOneEffect?void 0:oneByOneEffect[jimu_core.Zre.ScrollIntoView],revert=(null===(_a=null==setting?void 0:setting.option)||void 0===_a?void 0:_a.start)===jimu_core.mM5.AfterPrevious;setAnimationContext({setting,playId:(0,jimu_core.RqM)(),oid:stateProps.innerLayoutId,revert,playMode,onContextAnimationEnd:revert?null:()=>{setAnimationContext({setting,oid:stateProps.innerLayoutId,playId:-1})}})}},onAnimationEnd:()=>{var _a;if(shouldAnimationPassdown()){const setting=null==oneByOneEffect?void 0:oneByOneEffect[jimu_core.Zre.ScrollIntoView];(null===(_a=null==setting?void 0:setting.option)||void 0===_a?void 0:_a.start)===jimu_core.mM5.AfterPrevious&&setAnimationContext({setting,playId:(0,jimu_core.RqM)(),oid:stateProps.innerLayoutId,revert:!1,playMode,onContextAnimationEnd:()=>{setAnimationContext({setting,oid:stateProps.innerLayoutId,playId:-1})}})}null==onAsOneAnimationEnd||onAsOneAnimationEnd(),animationPreview&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.clearAnimationPreview())},css:function getStyle(rotate){var _a;const draggable=canDrag(),isInlineEditing=null!==(_a=stateProps.isInlineEditing)&&void 0!==_a&&_a,defaultColor=jimu_core.PLL.rgba(pageContext.builderTheme.ref.palette.neutral[900],.6),hoverColor=pageContext.builderTheme.sys.color.primary.main,outlineStyle=isFunctionalWidget&&!isSection||selected?"solid":"dashed";let hoverStyle=null;return isDesignMode()||(hoverStyle=(0,jimu_core.AD2)(null==hoverEffect?void 0:hoverEffect.type,null==hoverEffect?void 0:hoverEffect.setting)),jimu_core.AHW`
      ${hoverStyle};
      position: relative;
      overflow: visible;
      cursor: ${draggable?"move":"default"};
      touch-action: ${isInlineEditing||!selected?"auto":"none"};
      user-select: ${isInlineEditing?"auto":"none"};
      min-width: ${layout_runtime.MIN_LAYOUT_ITEM_SIZE}px;
      min-height: ${layout_runtime.MIN_LAYOUT_ITEM_SIZE}px;

      & > div.widget-context-menu {
        display: none;
      }

      &:hover > div.widget-context-menu {
        display: flex;
      }

      .${GLOBAL_H5_DRAGGING_CLASS_NAME} &.functional-widget {
        pointer-events: none;
      }
      .${GLOBAL_H5_DRAGGING_CLASS_NAME} &.functional-widget .exb-drop-area {
        pointer-events: all;
      }

      .${GLOBAL_H5_DRAGGING_CLASS_NAME} &,
      .${GLOBAL_DRAGGING_CLASS_NAME} & {
        > div.highlight-tip {
          .tip-content {
            outline-color: ${defaultColor};
          }
        }
      }

      body:not(.design-mode) &,
      body.lock-layout & {
        cursor: default;
      }

      body:not(.design-mode) & > div.highlight-tip {
        display: none !important;
      }

      & > div.highlight-tip {
        display: block;
        padding: inherit;
        position: absolute;
        left: 0;
        bottom: 0;
        top: 0;
        right: 0;
        pointer-events: none;
        transform: ${rotate>0||rotate<0?`rotateZ(${rotate}deg)`:""};
        .tip-content {
          height: 100%;
          padding: 1px;
          &:after {
            content: '';
            width: 100%;
            height: 100%;
            outline: ${isBlock&&!selected?"none":`1px ${outlineStyle} ${defaultColor}`};
            display: block;
            outline-color: ${!isFunctionalWidget||isSection?defaultColor:"transparent"};
          }
        }
      }

      &:hover > div.highlight-tip,
      &.hovered > div.highlight-tip {
        display: block;
        .tip-content {
          &:after {
            outline-color: ${hoverColor};
          }
        }
      }

      &.functional-widget:not(.selected):hover > div.highlight-tip,
      &.functional-widget:not(.selected).hovered > div.highlight-tip {
        .tip-content {
          &:after {
            outline-width: 2px;
          }
        }
      }
    `}(rotate),style:props.style,ref:refObj,className:(0,jimu_core.xWm)("builder-layout-item exb-rnd",className,{selected,"is-widget":isWidget,"is-section":isSection,"functional-widget":isWidget&&isFunctionalWidget,"no-drag-action":!canDrag()}),onDoubleClick:function doubleClick(e){const{layoutId,layoutItemId}=props,{supportInlineEditing,widgetId}=stateProps;props.onDoubleClick&&props.onDoubleClick(e,{layoutId,layoutItemId});const{browserSizeMode,mainBrowserSizeMode}=stateProps;pageContext.viewOnly||jimu_core.WpD.isExpressMode()&&(browserSizeMode!==mainBrowserSizeMode||!isFunctionalWidget)||(e.stopPropagation(),supportInlineEditing&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.setWidgetIsInlineEditingState(widgetId,!0)))},onClick:function onItemClick(e){if(Math.abs(e.screenX-mousedownX)>layout_runtime.CLICK_TOLERANCE||Math.abs(e.screenY-mousedownY)>layout_runtime.CLICK_TOLERANCE)return void e.stopPropagation();const{viewOnly}=pageContext,{browserSizeMode,mainBrowserSizeMode}=stateProps;if(viewOnly||jimu_core.WpD.isExpressMode()&&(browserSizeMode!==mainBrowserSizeMode||!isFunctionalWidget))return;e.stopPropagation();const fakeEvent=new CustomEvent("click",{detail:1});if(fakeEvent.composedPath=()=>e.nativeEvent.composedPath(),window.dispatchEvent(fakeEvent),!isResizing()&&!isDragging()){if(props.onClick){const{layoutId,layoutItemId}=allProps;props.onClick(e,{layoutId,layoutItemId})}!function switchSetting(){const{layoutId,layoutItemId}=props;stateProps.selected||(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged({layoutId,layoutItemId}))}()}},onMouseDown:function onMouseDown(e){mousedownX=e.screenX,mousedownY=e.screenY},"data-layoutitemid":layoutItemId,"data-layoutid":layoutId},(0,jimu_core.Yac)(jimu_core.e8P.Provider,{value:animationContext},isWidget&&(0,jimu_core.Yac)(widget_renderer_WidgetRendererInBuilder,Object.assign({rotate,onInitDragHandler:registerWidgetInitDragHandler,onInitResizeHandler:registerWidgetInitResizeHandler},otherProps)),isSection&&(0,jimu_core.Yac)(section_renderer_SectionRendererInBuilder,Object.assign({rotate},otherProps))),(showContextMenu||stateProps.useDragHandler)&&!pageContext.viewOnly&&!stateProps.isInController&&function createContextMenu(rotate){const{builderTheme}=pageContext;return(0,jimu_core.Yac)(context_menu,{builderTheme,layoutId:props.layoutId,layoutItem:stateProps.layoutItem,positionType:"center",size:layout_runtime.CONTEXT_MENU_ITEM_SIZE,rotate,iconSize:layout_runtime.CONTEXT_MENU_ICON_SIZE,className:"widget-context-menu",menuItems:props.contextMenuItems||(stateProps.useDragHandler?dragMenus:defaultConstextMenus)})}(rotate),!pageContext.viewOnly&&selected&&(0,jimu_core.Yac)(select_wrapper,{layoutId,layoutItem,top,left,right,bottom,resizable,draggable,selected,autoScroll,forbidToolbar:props.forbidToolbar,toolItems:props.toolItems,showDefaultTools:props.showDefaultTools,isInlineEditing,isFunctionalWidget,hasEmbeddedLayout,isSection,isBlock,hasExtension:isWidget&&hasExtension,widgetJson:stateProps.widgetJson,widgetState:stateProps.widgetState,rotate}),!pageContext.viewOnly&&(0,jimu_core.Yac)("div",{className:"highlight-tip"},(0,jimu_core.Yac)("div",{className:"tip-content"})),props.children))}const layout_item_mapStateToProps=(0,jimu_core.Mz0)([(state,ownProps)=>state.browserSizeMode,(state,ownProps)=>state.appConfig.mainSizeMode,(state,ownProps)=>layout_runtime.utils.mapStateToLayoutItemProps(state,ownProps),(state,ownProps)=>{var _a;return null===(_a=state.appConfig.layouts[ownProps.layoutId])||void 0===_a?void 0:_a.type},(state,ownProps)=>{const layoutItem=layout_runtime.searchUtils.findLayoutItem(state.appConfig,{layoutId:ownProps.layoutId,layoutItemId:ownProps.layoutItemId});if((null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Widget){const innerLayoutId=function findInnerLayoutId(state,layoutId,layoutItemId){const layoutItem=state.appConfig.layouts[layoutId].content[layoutItemId];if(layoutItem.type===jimu_core.K6q.Widget){const widgetJson=state.appConfig.widgets[layoutItem.widgetId];if(null!=(null==widgetJson?void 0:widgetJson.layouts)){const names=Object.keys(widgetJson.layouts);if(1!==names.length){const output=[];return names.forEach((name=>{const sizeModeLayout=widgetJson.layouts[name];output.push(sizeModeLayout[state.browserSizeMode])})),output}{const sizeModeLayout=null==widgetJson?void 0:widgetJson.layouts[names[0]];if(sizeModeLayout)return sizeModeLayout[state.browserSizeMode]}}}return null}(state,ownProps.layoutId,ownProps.layoutItemId);return innerLayoutId}return null},(state,ownProps)=>{const layoutItem=layout_runtime.searchUtils.findLayoutItem(state.appConfig,{layoutId:ownProps.layoutId,layoutItemId:ownProps.layoutItemId});return(null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Widget?layout_runtime.utils.mapStateToWidgetProps(state,ownProps):null},(state,ownProps)=>{const layoutItem=layout_runtime.searchUtils.findLayoutItem(state.appConfig,{layoutId:ownProps.layoutId,layoutItemId:ownProps.layoutItemId});return(null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Section?layout_runtime.searchUtils.getSectionInfo(state,layoutItem.sectionId):null},(state,ownProps)=>{const layoutItem=layout_runtime.searchUtils.findLayoutItem(state.appConfig,{layoutId:ownProps.layoutId,layoutItemId:ownProps.layoutItemId});if((null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Section){const activeViewId=findActiveViewId(layout_runtime.searchUtils.getSectionInfo(state,layoutItem.sectionId));return state.appConfig.views[activeViewId]}return null}],((browserSizeMode,mainBrowserSizeMode,layoutItemProps,layoutType,innerLayoutId,widgetProps,sectionProps,activeView)=>Object.assign(Object.assign(Object.assign({browserSizeMode,mainBrowserSizeMode,layoutType,innerLayoutId,activeView},layoutItemProps),null!=widgetProps?widgetProps:{}),null!=sectionProps?sectionProps:{})));try{layoutitem.displayName="layoutitem",layoutitem.__docgenInfo={description:"",displayName:"layoutitem",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},restrict:{defaultValue:null,description:"",name:"restrict",required:!1,type:{name:"boolean"}},useDragHandler:{defaultValue:null,description:"",name:"useDragHandler",required:!1,type:{name:"boolean"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!1,type:{name:"(layoutItemId: string) => void"}},onDragging:{defaultValue:null,description:"",name:"onDragging",required:!1,type:{name:"(layoutItemId: string, dx: number, dy: number) => void"}},onDragEnd:{defaultValue:null,description:"",name:"onDragEnd",required:!1,type:{name:"(layoutItemId: string, dx: number, dy: number) => void"}},top:{defaultValue:null,description:"",name:"top",required:!1,type:{name:"boolean"}},left:{defaultValue:null,description:"",name:"left",required:!1,type:{name:"boolean"}},right:{defaultValue:null,description:"",name:"right",required:!1,type:{name:"boolean"}},bottom:{defaultValue:null,description:"",name:"bottom",required:!1,type:{name:"boolean"}},keepAspectRatio:{defaultValue:null,description:"",name:"keepAspectRatio",required:!1,type:{name:"boolean"}},onResizeStart:{defaultValue:null,description:"",name:"onResizeStart",required:!1,type:{name:"(layoutItemId: string, initWidth: number, initHeight: number) => void"}},onResizing:{defaultValue:null,description:"",name:"onResizing",required:!1,type:{name:"(layoutItemId: string, x: number, y: number, dw: number, dh: number, shiftKey?: boolean, speed?: number) => void"}},onResizeEnd:{defaultValue:null,description:"",name:"onResizeEnd",required:!1,type:{name:"(layoutItemId: string, x: number, y: number, dw: number, dh: number, shiftKey?: boolean) => void"}},id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},isBlock:{defaultValue:null,description:"",name:"isBlock",required:!1,type:{name:"boolean"}},toolItems:{defaultValue:null,description:"",name:"toolItems",required:!1,type:{name:"ToolbarConfig"}},contextMenuItems:{defaultValue:null,description:"",name:"contextMenuItems",required:!1,type:{name:"ToolbarConfig"}},delay:{defaultValue:null,description:"",name:"delay",required:!1,type:{name:"number"}},isLastChild:{defaultValue:null,description:"",name:"isLastChild",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/layout-item.tsx#layoutitem"]={docgenInfo:layoutitem.__docgenInfo,name:"layoutitem",path:"../jimu-layouts/lib/builder/layout-item.tsx#layoutitem"})}catch(__react_docgen_typescript_loader_error){}var data_layer=__webpack_require__("../jimu-icons/svg/outlined/gis/data-layer.svg"),data_layer_default=__webpack_require__.n(data_layer),max_height=__webpack_require__("../jimu-icons/svg/outlined/directional/max-height.svg"),max_height_default=__webpack_require__.n(max_height),max_width=__webpack_require__("../jimu-icons/svg/outlined/directional/max-width.svg"),max_width_default=__webpack_require__.n(max_width),max_all=__webpack_require__("../jimu-icons/svg/outlined/directional/max-all.svg"),max_all_default=__webpack_require__.n(max_all),align_left=__webpack_require__("../jimu-icons/svg/outlined/directional/align-left.svg"),align_left_default=__webpack_require__.n(align_left),snap_left=__webpack_require__("../jimu-icons/svg/outlined/directional/snap-left.svg"),snap_left_default=__webpack_require__.n(snap_left),snap_right=__webpack_require__("../jimu-icons/svg/outlined/directional/snap-right.svg"),snap_right_default=__webpack_require__.n(snap_right),snap_top=__webpack_require__("../jimu-icons/svg/outlined/directional/snap-top.svg"),snap_top_default=__webpack_require__.n(snap_top),snap_bottom=__webpack_require__("../jimu-icons/svg/outlined/directional/snap-bottom.svg"),snap_bottom_default=__webpack_require__.n(snap_bottom),snap_horizontal_middle=__webpack_require__("../jimu-icons/svg/outlined/directional/snap-horizontal-middle.svg"),snap_horizontal_middle_default=__webpack_require__.n(snap_horizontal_middle),snap_vertical_middle=__webpack_require__("../jimu-icons/svg/outlined/directional/snap-vertical-middle.svg"),snap_vertical_middle_default=__webpack_require__.n(snap_vertical_middle),send_backward=__webpack_require__("../jimu-icons/svg/outlined/directional/send-backward.svg"),send_backward_default=__webpack_require__.n(send_backward),send_forward=__webpack_require__("../jimu-icons/svg/outlined/directional/send-forward.svg"),send_forward_default=__webpack_require__.n(send_forward),bring_back=__webpack_require__("../jimu-icons/svg/outlined/directional/bring-back.svg"),bring_back_default=__webpack_require__.n(bring_back),bring_front=__webpack_require__("../jimu-icons/svg/outlined/directional/bring-front.svg"),bring_front_default=__webpack_require__.n(bring_front),editor_lock=__webpack_require__("../jimu-icons/svg/outlined/editor/lock.svg"),lock_default=__webpack_require__.n(editor_lock),unlock=__webpack_require__("../jimu-icons/svg/outlined/editor/unlock.svg"),unlock_default=__webpack_require__.n(unlock),browser=__webpack_require__("../node_modules/invariant/browser.js");function sortLayoutItems(layout,containerRect,operatingItem){const gridlines={};let element;if(window.jimuConfig.isBuilder){const appFrame=document.querySelector(`iframe[name="${jimu_core.mXW}"]`);if(appFrame){element=(appFrame.contentDocument||appFrame.contentWindow.document).querySelector(`div.fixed-layout[data-layoutid=${layout.id}]`)}}else element=document.querySelector(`div.fixed-layout[data-layoutid=${layout.id}]`);if(!element)return layout;const childElements=element.querySelectorAll(":scope > div.trail-container > div.exb-rnd");if((null==childElements?void 0:childElements.length)>0){childElements.forEach((node=>{const itemId=node.getAttribute("data-layoutitemid");if(layout.order.includes(itemId)){const rect=node.getBoundingClientRect();gridlines[itemId]=containerRect?{top:rect.top-containerRect.top,left:rect.left-containerRect.left,right:rect.right-containerRect.right,bottom:rect.bottom-containerRect.bottom,width:rect.width,height:rect.height}:rect}})),operatingItem&&(gridlines[operatingItem.layoutItemId]=operatingItem.rect);const order=[...layout.order].filter((itemId=>layout.content[itemId]&&!layout.content[itemId].isPending));return order.sort(((a,b)=>{const ra=gridlines[a],rb=gridlines[b];if(ra.top>rb.top)return 1;if(ra.top<rb.top)return-1;const leftA=(0,lib_utils.isRTL)()?ra.right:ra.left,leftB=(0,lib_utils.isRTL)()?rb.right:rb.left;return leftA>leftB?1:leftA<leftB?-1:ra.width>rb.width||ra.height>rb.height?1:ra.width<rb.width||ra.height<rb.height?-1:0})),layout.set("order",order)}return layout}function alignTo(layoutInfo,prop){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo),bbox=layoutItem.bbox;let autoProp,setting=layoutItem.setting||(0,jimu_core.J3Z)({});switch(appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox.set(prop,layout_runtime.utils.isPercentage(bbox[prop])?"0%":"0px")),setting=setting.setIn(["autoProps",prop],!1),prop){case"top":autoProp="bottom";break;case"bottom":autoProp="top";break;case"left":autoProp="right";break;case"right":autoProp="left"}if(setting=setting.setIn(["autoProps",autoProp],!0),"left"===prop||"right"===prop?setting=setting.set("hCenter",!1):"top"!==prop&&"bottom"!==prop||(setting=setting.set("vCenter",!1)),appConfigAction.editLayoutItemProperty(layoutInfo,"setting",setting),appConfigAction.appConfig.useAutoSortInFixedLayout){const sortedLayout=sortLayoutItems(appConfigAction.appConfig.layouts[layoutInfo.layoutId]);appConfigAction.editLayoutProperty(layoutInfo.layoutId,"order",sortedLayout.order)}appConfigAction.exec()}function alignCenter(layoutInfo,direction){var _a,_b;const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo);let setting=layoutItem.setting||(0,jimu_core.J3Z)({}),bbox=layoutItem.bbox;if("h"===direction)if((null===(_a=setting.autoProps)||void 0===_a?void 0:_a.width)===layout_runtime.LayoutItemSizeModes.Stretch){if(layout_runtime.utils.isPercentage(bbox.left)!==layout_runtime.utils.isPercentage(bbox.right))return;{const unit=layout_runtime.utils.isPercentage(bbox.left)?"%":"px",spacing=parseFloat(bbox.left)+parseFloat(bbox.right);bbox=bbox.set("left",`${spacing/2}${unit}`).set("right",`${spacing/2}${unit}`)}}else bbox=bbox.set("left","50%"),setting=setting.set("hCenter",!0).setIn(["autoProps","left"],!1).setIn(["autoProps","right"],!0);else if((null===(_b=setting.autoProps)||void 0===_b?void 0:_b.height)===layout_runtime.LayoutItemSizeModes.Stretch){if(layout_runtime.utils.isPercentage(bbox.top)!==layout_runtime.utils.isPercentage(bbox.bottom))return;{const unit=layout_runtime.utils.isPercentage(bbox.top)?"%":"px",spacing=parseFloat(bbox.top)+parseFloat(bbox.bottom);bbox=bbox.set("top",`${spacing/2}${unit}`).set("bottom",`${spacing/2}${unit}`)}}else bbox=bbox.set("top","50%"),setting=setting.set("vCenter",!0).setIn(["autoProps","top"],!1).setIn(["autoProps","bottom"],!0);if(appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox).editLayoutItemProperty(layoutInfo,"setting",setting),appConfigAction.appConfig.useAutoSortInFixedLayout){const sortedLayout=sortLayoutItems(appConfigAction.appConfig.layouts[layoutInfo.layoutId]);appConfigAction.editLayoutProperty(layoutInfo.layoutId,"order",sortedLayout.order)}appConfigAction.exec()}const fixedItemMenu=[[{icon:align_left_default(),visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout(),title:props=>props.formatMessage("align")},{icon:snap_left_default(),label:props=>props.formatMessage(layout_runtime.utils.isRTL()?"snapToRight":"snapToLeft"),title:props=>props.formatMessage(layout_runtime.utils.isRTL()?"snapToRight":"snapToLeft"),autoFlipIcon:!0,onClick:props=>{const{layoutItem,layoutId}=props;alignTo({layoutId,layoutItemId:layoutItem.id},"left")}},{icon:snap_horizontal_middle_default(),label:props=>props.formatMessage("alignHCenter"),title:props=>props.formatMessage("alignHCenter"),disabled:props=>{var _a,_b;const{layoutItem}=props;return(null===(_b=null===(_a=layoutItem.setting)||void 0===_a?void 0:_a.autoProps)||void 0===_b?void 0:_b.width)===layout_runtime.LayoutItemSizeModes.Stretch&&layout_runtime.utils.isPercentage(layoutItem.bbox.left)!==layout_runtime.utils.isPercentage(layoutItem.bbox.right)},onClick:props=>{const{layoutItem,layoutId}=props;!function alignHorizontalCenter(layoutInfo){alignCenter(layoutInfo,"h")}({layoutId,layoutItemId:layoutItem.id})}},{icon:snap_right_default(),label:props=>props.formatMessage(layout_runtime.utils.isRTL()?"snapToLeft":"snapToRight"),title:props=>props.formatMessage(layout_runtime.utils.isRTL()?"snapToLeft":"snapToRight"),autoFlipIcon:!0,onClick:props=>{const{layoutItem,layoutId}=props;alignTo({layoutId,layoutItemId:layoutItem.id},"right")}},{icon:snap_top_default(),label:props=>props.formatMessage("snapToTop"),title:props=>props.formatMessage("snapToTop"),onClick:props=>{const{layoutItem,layoutId}=props;alignTo({layoutId,layoutItemId:layoutItem.id},"top")}},{icon:snap_vertical_middle_default(),label:props=>props.formatMessage("alignVCenter"),title:props=>props.formatMessage("alignVCenter"),disabled:props=>{var _a,_b;const{layoutItem}=props;return(null===(_b=null===(_a=layoutItem.setting)||void 0===_a?void 0:_a.autoProps)||void 0===_b?void 0:_b.height)===layout_runtime.LayoutItemSizeModes.Stretch&&layout_runtime.utils.isPercentage(layoutItem.bbox.top)!==layout_runtime.utils.isPercentage(layoutItem.bbox.bottom)},onClick:props=>{const{layoutItem,layoutId}=props;!function alignVerticalCenter(layoutInfo){alignCenter(layoutInfo,"v")}({layoutId,layoutItemId:layoutItem.id})}},{icon:snap_bottom_default(),label:props=>props.formatMessage("snapToBottom"),title:props=>props.formatMessage("snapToBottom"),onClick:props=>{const{layoutItem,layoutId}=props;alignTo({layoutId,layoutItemId:layoutItem.id},"bottom")}},{icon:max_width_default(),label:props=>props.formatMessage("fullWidth"),title:props=>props.formatMessage("fullWidth"),onClick:props=>{const{layoutItem,layoutId}=props;!function alignFullWidth(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo),bbox=layoutItem.bbox;let setting=layoutItem.setting||(0,jimu_core.J3Z)({});if(setting=setting.set("hCenter",!1).setIn(["autoProps","left"],!1).setIn(["autoProps","right"],!1).setIn(["autoProps","width"],layout_runtime.LayoutItemSizeModes.Stretch),appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox.set("left",layout_runtime.utils.isPercentage(bbox.left)?"0%":"0px").set("right",layout_runtime.utils.isPercentage(bbox.right)?"0%":"0px").set("width","100%")).editLayoutItemProperty(layoutInfo,"setting",setting),appConfigAction.appConfig.useAutoSortInFixedLayout){const sortedLayout=sortLayoutItems(appConfigAction.appConfig.layouts[layoutInfo.layoutId]);appConfigAction.editLayoutProperty(layoutInfo.layoutId,"order",sortedLayout.order)}appConfigAction.exec()}({layoutId,layoutItemId:layoutItem.id})}},{icon:max_height_default(),label:props=>props.formatMessage("fullHeight"),title:props=>props.formatMessage("fullHeight"),onClick:props=>{const{layoutItem,layoutId}=props;!function alignFullHeight(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo),bbox=layoutItem.bbox;let setting=layoutItem.setting||(0,jimu_core.J3Z)({});if(setting=setting.set("vCenter",!1).setIn(["autoProps","top"],!1).setIn(["autoProps","bottom"],!1).setIn(["autoProps","height"],layout_runtime.LayoutItemSizeModes.Stretch),appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox.set("top",layout_runtime.utils.isPercentage(bbox.top)?"0%":"0px").set("bottom",layout_runtime.utils.isPercentage(bbox.bottom)?"0%":"0px").set("height","100%")).editLayoutItemProperty(layoutInfo,"setting",setting),appConfigAction.appConfig.useAutoSortInFixedLayout){const sortedLayout=sortLayoutItems(appConfigAction.appConfig.layouts[layoutInfo.layoutId]);appConfigAction.editLayoutProperty(layoutInfo.layoutId,"order",sortedLayout.order)}appConfigAction.exec()}({layoutId,layoutItemId:layoutItem.id})}},{icon:max_all_default(),label:props=>props.formatMessage("fullSize"),title:props=>props.formatMessage("fullSize"),onClick:props=>{const{layoutItem,layoutId}=props;!function alignFullSize(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo),bbox=layoutItem.bbox;let setting=layoutItem.setting||(0,jimu_core.J3Z)({});if(setting=setting.set("vCenter",!1).set("hCenter",!1).setIn(["autoProps","top"],!1).setIn(["autoProps","bottom"],!1).setIn(["autoProps","left"],!1).setIn(["autoProps","right"],!1).setIn(["autoProps","height"],layout_runtime.LayoutItemSizeModes.Stretch).setIn(["autoProps","width"],layout_runtime.LayoutItemSizeModes.Stretch),appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox.set("top",layout_runtime.utils.isPercentage(bbox.top)?"0%":"0px").set("bottom",layout_runtime.utils.isPercentage(bbox.bottom)?"0%":"0px").set("left",layout_runtime.utils.isPercentage(bbox.left)?"0%":"0px").set("right",layout_runtime.utils.isPercentage(bbox.right)?"0%":"0px").set("width","100%").set("height","100%")).editLayoutItemProperty(layoutInfo,"setting",setting),appConfigAction.appConfig.useAutoSortInFixedLayout){const sortedLayout=sortLayoutItems(appConfigAction.appConfig.layouts[layoutInfo.layoutId]);appConfigAction.editLayoutProperty(layoutInfo.layoutId,"order",sortedLayout.order)}appConfigAction.exec()}({layoutId,layoutItemId:layoutItem.id})}}],[{icon:data_layer_default(),visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout(),title:props=>props.formatMessage("arrange")},{icon:send_backward_default(),label:props=>props.formatMessage("sendBackward"),title:props=>props.formatMessage("sendBackward"),onClick:props=>{const{layoutItem,layoutId}=props;!function sendBackward(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,{layoutId,layoutItemId}=layoutInfo,layout=appConfig.layouts[layoutId];browser(layout.order,"parent order must not be empty to alter order");const order=[].concat(layout.order),index=order.indexOf(layoutItemId);index<=0||(order[index]=order[index-1],order[index-1]=layoutInfo.layoutItemId,appConfigAction.editLayoutProperty(layoutId,"order",order).exec())}({layoutId,layoutItemId:layoutItem.id})}},{icon:send_forward_default(),label:props=>props.formatMessage("bringForward"),title:props=>props.formatMessage("bringForward"),onClick:props=>{const{layoutItem,layoutId}=props;!function bringForward(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,{layoutId,layoutItemId}=layoutInfo,layout=appConfig.layouts[layoutId];browser(layout.order,"parent order must not be empty to alter order");const order=[].concat(layout.order),index=order.indexOf(layoutItemId);index===order.length-1||index<0||(order[index]=order[index+1],order[index+1]=layoutInfo.layoutItemId,appConfigAction.editLayoutProperty(layoutId,"order",order).exec())}({layoutId,layoutItemId:layoutItem.id})}},{icon:bring_back_default(),label:props=>props.formatMessage("sendToBack"),title:props=>props.formatMessage("sendToBack"),onClick:props=>{const{layoutItem,layoutId}=props;!function sendToBack(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,{layoutId,layoutItemId}=layoutInfo,layout=appConfig.layouts[layoutId];browser(layout.order,"parent order must not be empty to alter order");const order=[].concat(layout.order),index=order.indexOf(layoutItemId);index<=0||(order.splice(index,1),order.splice(0,0,layoutInfo.layoutItemId),appConfigAction.editLayoutProperty(layoutId,"order",order).exec())}({layoutId,layoutItemId:layoutItem.id})}},{icon:bring_front_default(),label:props=>props.formatMessage("bringToFront"),title:props=>props.formatMessage("bringToFront"),onClick:props=>{const{layoutItem,layoutId}=props;!function bringToFront(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,{layoutId,layoutItemId}=layoutInfo,layout=appConfig.layouts[layoutId];browser(layout.order,"parent order must not be empty to alter order");const order=[].concat(layout.order),index=order.indexOf(layoutItemId);index===order.length-1||index<0||(order.splice(index,1),order.push(layoutInfo.layoutItemId),appConfigAction.editLayoutProperty(layoutId,"order",order).exec())}({layoutId,layoutItemId:layoutItem.id})}}],{icon:props=>{var _a,_b;const{layoutItem}=props;return null!==(_b=null===(_a=layoutItem.setting)||void 0===_a?void 0:_a.lockLayout)&&void 0!==_b&&_b?lock_default():unlock_default()},visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout(),title:props=>{var _a,_b;const{layoutItem}=props,lockLayout=null!==(_b=null===(_a=layoutItem.setting)||void 0===_a?void 0:_a.lockLayout)&&void 0!==_b&&_b;return props.formatMessage(lockLayout?"unlockLayout":"lockLayout")},onClick:props=>{const{layoutItem,layoutId}=props;!function toggleLockLayout(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),appConfig=appConfigAction.appConfig,setting=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo).setting||(0,jimu_core.J3Z)({});appConfigAction.editLayoutItemProperty(layoutInfo,"setting.lockLayout",!setting.lockLayout).exec()}({layoutId,layoutItemId:layoutItem.id})}},{separator:!0}];var fixed_layout_util=__webpack_require__("../jimu-layouts/lib/fixed-layout/fixed-layout-util.ts"),util=__webpack_require__("../jimu-layouts/lib/fixed-layout/common/util.ts");class FixedItem extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.state={},this.handleResizeEnd=(id,dx,dy,dw,dh,shiftKey)=>{const{layoutItem}=this.props;this.props.onResizeEnd(id,dx,dy,dw,dh,shiftKey,layoutItem,this.itemSetting)},this.handleResizing=(id,dx,dy,dw,dh,shiftKey,speed)=>{this.props.onResizing(id,dx,dy,dw,dh,shiftKey,speed)},this.moveUp=()=>{this.props.onMoveByKey(this.props.layoutItemId,0,-1)},this.moveDown=()=>{this.props.onMoveByKey(this.props.layoutItemId,0,1)},this.moveLeft=()=>{this.props.onMoveByKey(this.props.layoutItemId,-1,0)},this.moveRight=()=>{this.props.onMoveByKey(this.props.layoutItemId,1,0)}}getKeyboardComponent(){return this.props.isDesignMode?(0,jimu_core.Yac)(jimu_core.s3S,{bindings:{up:this.moveUp,down:this.moveDown,left:this.moveLeft,right:this.moveRight}}):null}getPositionStyle(){var _a,_b;const{layoutItem,offsetX,offsetY,dw,dh,initRect,containerRect}=this.props;let pos=(0,fixed_layout_util.wK)(layoutItem.bbox,this.itemSetting);const setting=layoutItem.setting;null!=initRect&&(pos=(0,fixed_layout_util.D_)(initRect,containerRect,{dw,dh:"ratio"===this.itemSetting.heightMode?dw/layout_runtime.utils.parseAspectRatio(this.itemSetting.aspectRatio):dh,dx:offsetX,dy:offsetY},!0),(null==setting?void 0:setting.hCenter)&&"50%"===(null===(_a=layoutItem.bbox)||void 0===_a?void 0:_a.left)&&(pos.left="50%"),(null==setting?void 0:setting.vCenter)&&"50%"===(null===(_b=layoutItem.bbox)||void 0===_b?void 0:_b.top)&&(pos.top="50%"));const mergedStyle=Object.assign(Object.assign({},pos),(0,fixed_layout_util.WQ)(layoutItem.bbox,this.itemSetting,Boolean(initRect)));return 0===dw&&0===dh||(mergedStyle.right="auto"),util.Z(mergedStyle)}render(){const{layoutId,layoutItem,isLayoutLockChildren,draggable=!0,resizable=!0,showDefaultTools=!0}=this.props;if(null==layoutItem||layoutItem.isPending)return null;this.itemSetting=jimu_core.CM0.assign({},default_setting.E,layoutItem.setting);const lockLayout=this.itemSetting.lockLayout,ratio=layout_runtime.utils.parseAspectRatio(this.itemSetting.aspectRatio),useAspectRatio=layout_runtime.utils.shouldUseAspectRatio(this.itemSetting),widthMode=layout_runtime.utils.getLayoutItemSizeMode("width",layoutItem.bbox,this.itemSetting.autoProps),heightMode=layout_runtime.utils.getLayoutItemSizeMode("height",layoutItem.bbox,this.itemSetting.autoProps),oneByOneAnimationProps=layout_runtime.utils.handleOnebyOneAnimation(this.props),[cssStyle,transform]=this.getPositionStyle();return(0,jimu_core.Yac)(LayoutItemInBuilder,Object.assign({className:"d-flex",css:cssStyle,style:{transform},layoutId,layoutItemId:layoutItem.id,restrict:this.itemSetting.lockParent||isLayoutLockChildren,draggable:draggable&&!lockLayout,resizable:resizable&&!lockLayout,showDefaultTools,toolItems:showDefaultTools?fixedItemMenu:[],onResizeStart:this.props.onResizeStart,onResizing:this.handleResizing,onResizeEnd:this.handleResizeEnd,onClick:this.props.onClick,top:heightMode!==layout_runtime.LayoutItemSizeModes.Auto&&!useAspectRatio,bottom:heightMode!==layout_runtime.LayoutItemSizeModes.Auto&&!useAspectRatio,left:widthMode!==layout_runtime.LayoutItemSizeModes.Auto,right:widthMode!==layout_runtime.LayoutItemSizeModes.Auto,forceAspectRatio:useAspectRatio,aspectRatio:ratio,isInSection:this.props.isInSection,autoWidth:widthMode===layout_runtime.LayoutItemSizeModes.Auto,autoHeight:heightMode===layout_runtime.LayoutItemSizeModes.Auto},oneByOneAnimationProps),this.props.selected&&this.getKeyboardComponent())}}const mapStateToLayoutItemProps=(0,jimu_core.Mz0)([(state,ownProps)=>{var _a;const selection=null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.selection;return null!=selection&&(selection.layoutId===ownProps.layoutId&&selection.layoutItemId===ownProps.layoutItemId)},state=>{var _a;return(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design}],((selected,isDesignMode)=>({selected,isDesignMode}))),layout_item=jimu_core.E_S.connect(mapStateToLayoutItemProps)(FixedItem);try{layoutitem.displayName="layoutitem",layoutitem.__docgenInfo={description:"",displayName:"layoutitem",props:{index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},onResizeStart:{defaultValue:null,description:"",name:"onResizeStart",required:!0,type:{name:"(id: string) => void"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},offsetX:{defaultValue:null,description:"",name:"offsetX",required:!1,type:{name:"number"}},offsetY:{defaultValue:null,description:"",name:"offsetY",required:!1,type:{name:"number"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson | IMLayoutItemJson"}},onResizing:{defaultValue:null,description:"",name:"onResizing",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number, shiftKey: boolean, speed: number) => void"}},onResizeEnd:{defaultValue:null,description:"",name:"onResizeEnd",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number, shiftKey: boolean, layoutItem: LayoutItemJson | IMLayoutItemJson, itemSetting: FixedLayoutItemSetting) => void"}},dw:{defaultValue:null,description:"",name:"dw",required:!1,type:{name:"number"}},dh:{defaultValue:null,description:"",name:"dh",required:!1,type:{name:"number"}},initRect:{defaultValue:null,description:"",name:"initRect",required:!1,type:{name:"DOMRect"}},containerRect:{defaultValue:null,description:"",name:"containerRect",required:!1,type:{name:"DOMRect"}},isLayoutLockChildren:{defaultValue:null,description:"",name:"isLayoutLockChildren",required:!1,type:{name:"boolean"}},onMoveByKey:{defaultValue:null,description:"",name:"onMoveByKey",required:!0,type:{name:"(id: string, dx: number, dy: number) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/fixed-layout/builder/layout-item.tsx#layoutitem"]={docgenInfo:layoutitem.__docgenInfo,name:"layoutitem",path:"../jimu-layouts/lib/fixed-layout/builder/layout-item.tsx#layoutitem"})}catch(__react_docgen_typescript_loader_error){}function isRelatedHorizontal(source,target){var _a,_b,_c,_d;if(target.rect.top>source.rect.bottom||target.rect.bottom<source.rect.top)return!1;if(target.rect.right+5<source.rect.left&&null!=(null===(_a=target.right)||void 0===_a?void 0:_a.value)&&null!=(null===(_b=source.left)||void 0===_b?void 0:_b.value)){const targetUsePercentage=target.right.usePercentage;if(targetUsePercentage===source.left.usePercentage)return targetUsePercentage||target.right.origin===source.left.origin}if(source.rect.right+5<target.rect.left&&null!=(null===(_c=source.right)||void 0===_c?void 0:_c.value)&&null!=(null===(_d=target.left)||void 0===_d?void 0:_d.value)){const targetUsePercentage=target.left.usePercentage;if(targetUsePercentage===source.right.usePercentage)return targetUsePercentage||target.left.origin===source.right.origin}return!1}function isRelatedVertical(source,target){var _a,_b,_c,_d;if(target.rect.left>source.rect.right||target.rect.right<source.rect.left)return!1;if(target.rect.bottom+5<source.rect.top&&null!=(null===(_a=target.bottom)||void 0===_a?void 0:_a.value)&&null!=(null===(_b=source.top)||void 0===_b?void 0:_b.value)){const targetUsePercentage=target.bottom.usePercentage;if(targetUsePercentage===source.top.usePercentage)return targetUsePercentage||target.bottom.origin===source.top.origin}if(source.rect.bottom+5<target.rect.top&&null!=(null===(_c=source.bottom)||void 0===_c?void 0:_c.value)&&null!=(null===(_d=target.top)||void 0===_d?void 0:_d.value)){const targetUsePercentage=target.top.usePercentage;if(targetUsePercentage===source.bottom.usePercentage)return targetUsePercentage||target.top.origin===source.bottom.origin}return!1}function findPreviousHorizontallyRelated(activeItem,gridlines){let result;return gridlines.filter((item=>{var _a,_b;return(null===(_a=item.right)||void 0===_a?void 0:_a.pixelValue)<(null===(_b=activeItem.left)||void 0===_b?void 0:_b.pixelValue)})).sort(((a,b)=>b.right.pixelValue-a.right.pixelValue)).some((item=>!!isRelatedHorizontal(activeItem,item)&&(result={value:item},!0))),null!=result&&(result.next=findPreviousHorizontallyRelated(result.value,gridlines)),result}function findNextHorizontallyRelated(activeItem,gridlines){let result;return gridlines.filter((item=>{var _a,_b;return(null===(_a=item.left)||void 0===_a?void 0:_a.pixelValue)>(null===(_b=activeItem.right)||void 0===_b?void 0:_b.pixelValue)})).sort(((a,b)=>a.left.pixelValue-b.left.pixelValue)).some((item=>!!isRelatedHorizontal(activeItem,item)&&(result={value:item},!0))),null!=result&&(result.next=findNextHorizontallyRelated(result.value,gridlines)),result}function findPreviousVerticallyRelated(activeItem,gridlines){let result;return gridlines.filter((item=>{var _a,_b;return(null===(_a=item.bottom)||void 0===_a?void 0:_a.pixelValue)<(null===(_b=activeItem.top)||void 0===_b?void 0:_b.pixelValue)})).sort(((a,b)=>b.bottom.pixelValue-a.bottom.pixelValue)).some((item=>!!isRelatedVertical(activeItem,item)&&(result={value:item},!0))),null!=result&&(result.next=findPreviousVerticallyRelated(result.value,gridlines)),result}function findNextVerticallyRelated(activeItem,gridlines){let result;return gridlines.filter((item=>{var _a,_b;return(null===(_a=item.top)||void 0===_a?void 0:_a.pixelValue)>(null===(_b=activeItem.bottom)||void 0===_b?void 0:_b.pixelValue)})).sort(((a,b)=>a.top.pixelValue-b.top.pixelValue)).some((item=>!!isRelatedVertical(activeItem,item)&&(result={value:item},!0))),null!=result&&(result.next=findNextVerticallyRelated(result.value,gridlines)),result}function drawHorizontalGap(previousItem,nextItem,canvasPane,containerWidth,theme,options){const{distance,drawLabel,reverse}=options;if(null!=canvasPane&&null!=theme){const ymin=Math.max(previousItem.rect.top,nextItem.rect.top),ymax=Math.min(previousItem.rect.bottom,nextItem.rect.bottom);canvasPane.setColor(jimu_core.PLL.rgba(theme.sys.color.error.light,.35));const rect={left:reverse?nextItem.rect.left-distance:previousItem.rect.right,top:ymin,width:distance,height:ymax-ymin};if(canvasPane.drawRect(rect),drawLabel){const center=(ymin+ymax)/2,label=previousItem.right.usePercentage?jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(distance,containerWidth)):jimu_core.WpD.formatPixelNumber(`${distance}px`);canvasPane.setColor(theme.sys.color.primary.main),canvasPane.drawLine(reverse?nextItem.rect.left-distance:previousItem.rect.right,center,reverse?nextItem.rect.left:previousItem.rect.right+distance,center,!1,label)}}}function drawVerticalGap(previousItem,nextItem,canvasPane,containerHeight,theme,options){const{distance,drawLabel,reverse}=options;if(null!=canvasPane&&null!=theme){const xmin=Math.max(previousItem.rect.left,nextItem.rect.left),xmax=Math.min(previousItem.rect.right,nextItem.rect.right);canvasPane.setColor(jimu_core.PLL.rgba(theme.sys.color.error.light,.35));const rect={left:xmin,top:reverse?nextItem.rect.top-distance:previousItem.rect.bottom,width:xmax-xmin,height:distance};if(canvasPane.drawRect(rect),drawLabel){const center=(xmin+xmax)/2,label=previousItem.bottom.usePercentage?jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(distance,containerHeight)):jimu_core.WpD.formatPixelNumber(`${distance}px`);canvasPane.setColor(theme.sys.color.primary.main),canvasPane.drawLine(center,reverse?nextItem.rect.top-distance:previousItem.rect.bottom,center,reverse?nextItem.rect.top:previousItem.rect.bottom+distance,!1,label)}}}function snapByDistance(activeItem,bboxGridlines,options){var _a,_b,_c,_d,_e;let dx=0,dy=0;const{delta,containerWidth,containerHeight,canvasPane,theme}=options,isResizing=0!==delta.w||0!==delta.h;if(!isResizing||0!==delta.w){let previousItems=findPreviousHorizontallyRelated(activeItem,bboxGridlines);previousItems=function addLeftEdge(gridlineNode,usePercentage){const left={id:"",right:{value:usePercentage?"0%":"0px",pixelValue:0,usePercentage,origin:0,from:Number.NEGATIVE_INFINITY,to:Number.POSITIVE_INFINITY},rect:{left:-100,width:100,right:0,top:Number.NEGATIVE_INFINITY,bottom:Number.POSITIVE_INFINITY}};if(null==gridlineNode)return{value:left};let currentNode=gridlineNode;for(;null!=currentNode.next;)currentNode=currentNode.next;return currentNode.next={value:left},gridlineNode}(previousItems,null==(null===(_a=activeItem.left)||void 0===_a?void 0:_a.value)||(null===(_b=activeItem.left)||void 0===_b?void 0:_b.usePercentage));let nextItems=findNextHorizontallyRelated(activeItem,bboxGridlines);nextItems=function addRightEdge(gridlineNode,usePercentage,containerWidth){const right={id:"",left:{value:usePercentage?"0%":"0px",pixelValue:containerWidth,usePercentage,origin:1,from:Number.NEGATIVE_INFINITY,to:Number.POSITIVE_INFINITY},rect:{left:containerWidth,width:100,right:containerWidth+100,top:Number.NEGATIVE_INFINITY,bottom:Number.POSITIVE_INFINITY}};if(null==gridlineNode)return{value:right};let currentNode=gridlineNode;for(;null!=currentNode.next;)currentNode=currentNode.next;return currentNode.next={value:right},gridlineNode}(nextItems,null==(null===(_c=activeItem.right)||void 0===_c?void 0:_c.value)||activeItem.right.usePercentage,containerWidth),dx=function snapToNearbyHorizontal(activeItem,previousItem,nextItem,canvasPane,containerWidth,theme){if(previousItem.gridline.rect.top===Number.NEGATIVE_INFINITY&&nextItem.gridline.rect.top===Number.NEGATIVE_INFINITY||null==activeItem.left||null==activeItem.right)return 0;const distanceBefore=activeItem.left.pixelValue-previousItem.gridline.right.pixelValue,distanceAfter=nextItem.gridline.left.pixelValue-activeItem.right.pixelValue,tolerance=previousItem.fixed||nextItem.fixed?5:10;if(Math.abs(distanceAfter-distanceBefore)<tolerance){let delta,distance;return delta=previousItem.fixed||nextItem.fixed?distanceAfter-distanceBefore:(distanceAfter-distanceBefore)/2,distance=previousItem.fixed?distanceBefore:nextItem.fixed?distanceAfter:distanceBefore+delta,drawHorizontalGap(previousItem.gridline,activeItem,canvasPane,containerWidth,theme,{distance,drawLabel:!1,reverse:!1}),drawHorizontalGap(activeItem,nextItem.gridline,canvasPane,containerWidth,theme,{distance,drawLabel:!1,reverse:!0}),delta}return 0}(activeItem,{gridline:previousItems.value,fixed:0!==delta.w&&0===delta.x},{gridline:nextItems.value,fixed:0!==delta.w&&0!==delta.x},canvasPane,containerWidth,theme),0!==dx||0!==delta.w&&0===delta.x||(dx=function snapToPreviousHorizontal(activeItem,previousNode,canvasPane,containerWidth,theme){if(null==(null==previousNode?void 0:previousNode.next))return 0;const snapDistance=activeItem.rect.left-previousNode.value.rect.right;let currentNode=previousNode,selectedDistance=-1;for(;null!=currentNode.next;){const nextNode=currentNode.next,distance=currentNode.value.rect.left-nextNode.value.rect.right;-1===selectedDistance?Math.abs(distance-snapDistance)<=5&&(selectedDistance=distance,drawHorizontalGap(nextNode.value,currentNode.value,canvasPane,containerWidth,theme,{distance:selectedDistance,drawLabel:!0,reverse:!1})):distance===selectedDistance&&drawHorizontalGap(nextNode.value,currentNode.value,canvasPane,containerWidth,theme,{distance:selectedDistance,drawLabel:!0,reverse:!1}),currentNode=nextNode}if(selectedDistance>0){const delta=selectedDistance-snapDistance;return drawHorizontalGap(previousNode.value,activeItem,canvasPane,containerWidth,theme,{distance:selectedDistance,drawLabel:!1,reverse:!1}),delta}return 0}(activeItem,previousItems,canvasPane,containerWidth,theme)),0!==dx||0!==delta.w&&0!==delta.x||(dx=function snapToNextHorizontal(activeItem,node,canvasPane,containerWidth,theme){if(null==(null==node?void 0:node.next))return 0;const snapDistance=node.value.rect.left-activeItem.rect.right;let currentNode=node,selectedDistance=-1;for(;null!=currentNode.next;){const nextNode=currentNode.next,distance=nextNode.value.rect.left-currentNode.value.rect.right;-1===selectedDistance?Math.abs(distance-snapDistance)<=5&&(selectedDistance=distance,drawHorizontalGap(currentNode.value,nextNode.value,canvasPane,containerWidth,theme,{distance:selectedDistance,drawLabel:!0,reverse:!0})):distance===selectedDistance&&drawHorizontalGap(currentNode.value,nextNode.value,canvasPane,containerWidth,theme,{distance:selectedDistance,drawLabel:!0,reverse:!0}),currentNode=nextNode}if(selectedDistance>0){const delta=snapDistance-selectedDistance;return drawHorizontalGap(activeItem,node.value,canvasPane,containerWidth,theme,{distance:selectedDistance,drawLabel:!1,reverse:!0}),delta}return 0}(activeItem,nextItems,canvasPane,containerWidth,theme)),function drawHorizontalDistance(activeItem,previousItem,nextItem,canvasPane,theme,options){var _a;const{isResizing,dx,containerWidth}=options;if(null!=canvasPane&&null!=theme){canvasPane.setColor(theme.sys.color.primary.main);let isEdge=(null===(_a=previousItem.gridline)||void 0===_a?void 0:_a.rect.top)===Number.NEGATIVE_INFINITY;const previousRect=previousItem.gridline.rect;if(null!=previousRect&&null!=activeItem.left&&(!isEdge||isResizing&&!previousItem.fixed)){const center=(Math.max(activeItem.rect.top,previousRect.top)+Math.min(activeItem.rect.bottom,previousRect.bottom))/2,usePercentage=activeItem.left.usePercentage;let distance=activeItem.rect.left-previousRect.right;previousItem.fixed||(distance+=dx);const label=usePercentage?jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(distance,containerWidth)):jimu_core.WpD.formatPixelNumber(`${distance}px`);canvasPane.drawLine(previousRect.right,center,previousRect.right+distance,center,!1,label)}isEdge=nextItem.gridline.rect.top===Number.NEGATIVE_INFINITY;const nextRect=nextItem.gridline.rect;if(null!=nextRect&&null!=activeItem.right&&(!isEdge||isResizing&&!nextItem.fixed)){const center=(Math.max(activeItem.rect.top,nextRect.top)+Math.min(activeItem.rect.bottom,nextRect.bottom))/2,usePercentage=activeItem.right.usePercentage;let distance=nextRect.left-activeItem.rect.right;nextItem.fixed||(distance-=dx);const label=usePercentage?jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(distance,containerWidth)):jimu_core.WpD.formatPixelNumber(`${distance}px`);canvasPane.drawLine(nextRect.left,center,nextRect.left-distance,center,!1,label)}}}(activeItem,{gridline:previousItems.value,fixed:0!==delta.w&&0===delta.x},{gridline:nextItems.value,fixed:0!==delta.w&&0!==delta.x},canvasPane,theme,{isResizing:0!==delta.w,dx,containerWidth})}if(!isResizing||0!==delta.h){let previousItems=findPreviousVerticallyRelated(activeItem,bboxGridlines);previousItems=function addTopEdge(gridlineNode,usePercentage){const top={id:"",bottom:{value:usePercentage?"0%":"0px",pixelValue:0,usePercentage,origin:0,from:Number.NEGATIVE_INFINITY,to:Number.POSITIVE_INFINITY},rect:{top:-100,height:100,bottom:0,left:Number.NEGATIVE_INFINITY,right:Number.POSITIVE_INFINITY}};if(null==gridlineNode)return{value:top};let currentNode=gridlineNode;for(;null!=currentNode.next;)currentNode=currentNode.next;return currentNode.next={value:top},gridlineNode}(previousItems,null==(null===(_d=activeItem.top)||void 0===_d?void 0:_d.value)||activeItem.top.usePercentage);let nextItems=findNextVerticallyRelated(activeItem,bboxGridlines);nextItems=function addBottomEdge(gridlineNode,usePercentage,containerHeight){const bottom={id:"",top:{value:usePercentage?"0%":"0px",pixelValue:containerHeight,usePercentage,origin:1,from:Number.NEGATIVE_INFINITY,to:Number.POSITIVE_INFINITY},rect:{top:containerHeight,height:100,bottom:containerHeight+100,left:Number.NEGATIVE_INFINITY,right:Number.POSITIVE_INFINITY}};if(null==gridlineNode)return{value:bottom};let currentNode=gridlineNode;for(;null!=currentNode.next;)currentNode=currentNode.next;return currentNode.next={value:bottom},gridlineNode}(nextItems,null==(null===(_e=activeItem.bottom)||void 0===_e?void 0:_e.value)||activeItem.bottom.usePercentage,containerHeight),dy=function snapToNearbyVertical(activeItem,previousItem,nextItem,canvasPane,containerHeight,theme){if(previousItem.gridline.rect.left===Number.NEGATIVE_INFINITY&&nextItem.gridline.rect.left===Number.NEGATIVE_INFINITY||null==activeItem.top||null==activeItem.bottom)return 0;const distanceBefore=activeItem.top.pixelValue-previousItem.gridline.bottom.pixelValue,distanceAfter=nextItem.gridline.top.pixelValue-activeItem.bottom.pixelValue,tolerance=previousItem.fixed||nextItem.fixed?5:10;if(Math.abs(distanceAfter-distanceBefore)<tolerance){let delta,distance;return delta=previousItem.fixed||nextItem.fixed?distanceAfter-distanceBefore:(distanceAfter-distanceBefore)/2,distance=previousItem.fixed?distanceBefore:nextItem.fixed?distanceAfter:distanceBefore+delta,drawVerticalGap(previousItem.gridline,activeItem,canvasPane,containerHeight,theme,{distance,drawLabel:!1,reverse:!1}),drawVerticalGap(activeItem,nextItem.gridline,canvasPane,containerHeight,theme,{distance,drawLabel:!1,reverse:!0}),delta}return 0}(activeItem,{gridline:previousItems.value,fixed:0!==delta.h&&0===delta.y},{gridline:nextItems.value,fixed:0!==delta.h&&0!==delta.y},canvasPane,containerHeight,theme),0!==dy||0!==delta.h&&0===delta.y||(dy=function snapToPreviousVertical(activeItem,previousNode,canvasPane,containerHeight,theme){if(null==(null==previousNode?void 0:previousNode.next))return 0;const snapDistance=activeItem.rect.top-previousNode.value.rect.bottom;let currentNode=previousNode,selectedDistance=-1;for(;null!=currentNode.next;){const nextNode=currentNode.next,distance=currentNode.value.rect.top-nextNode.value.rect.bottom;-1===selectedDistance?Math.abs(distance-snapDistance)<=5&&(selectedDistance=distance,drawVerticalGap(nextNode.value,currentNode.value,canvasPane,containerHeight,theme,{distance:selectedDistance,drawLabel:!0,reverse:!1})):distance===selectedDistance&&drawVerticalGap(nextNode.value,currentNode.value,canvasPane,containerHeight,theme,{distance:selectedDistance,drawLabel:!0,reverse:!1}),currentNode=nextNode}if(selectedDistance>0){const delta=selectedDistance-snapDistance;return drawVerticalGap(previousNode.value,activeItem,canvasPane,containerHeight,theme,{distance:selectedDistance,drawLabel:!1,reverse:!1}),delta}return 0}(activeItem,previousItems,canvasPane,containerHeight,theme)),0!==dy||0!==delta.h&&0!==delta.y||(dy=function snapToNextVertical(activeItem,node,canvasPane,containerHeight,theme){if(null==(null==node?void 0:node.next))return 0;const snapDistance=node.value.rect.top-activeItem.rect.bottom;let currentNode=node,selectedDistance=-1;for(;null!=currentNode.next;){const nextNode=currentNode.next,distance=nextNode.value.rect.top-currentNode.value.rect.bottom;-1===selectedDistance?Math.abs(distance-snapDistance)<=5&&(selectedDistance=distance,drawVerticalGap(currentNode.value,nextNode.value,canvasPane,containerHeight,theme,{distance:selectedDistance,drawLabel:!0,reverse:!0})):distance===selectedDistance&&drawVerticalGap(currentNode.value,nextNode.value,canvasPane,containerHeight,theme,{distance:selectedDistance,drawLabel:!0,reverse:!0}),currentNode=nextNode}if(selectedDistance>0){const delta=snapDistance-selectedDistance;return drawVerticalGap(activeItem,node.value,canvasPane,containerHeight,theme,{distance:selectedDistance,drawLabel:!1,reverse:!0}),delta}return 0}(activeItem,nextItems,canvasPane,containerHeight,theme)),function drawVerticalDistance(activeItem,previousItem,nextItem,canvasPane,theme,options){const{isResizing,dy,containerHeight}=options;if(null!=canvasPane&&null!=theme){canvasPane.setColor(theme.sys.color.primary.main);let isEdge=previousItem.gridline.rect.left===Number.NEGATIVE_INFINITY;const previousRect=previousItem.gridline.rect;if(null!=previousRect&&null!=activeItem.top&&(!isEdge||isResizing&&!previousItem.fixed)){const center=(Math.max(activeItem.rect.left,previousRect.left)+Math.min(activeItem.rect.right,previousRect.right))/2,usePercentage=activeItem.top.usePercentage;let distance=activeItem.rect.top-previousRect.bottom;previousItem.fixed||(distance+=dy);const label=usePercentage?jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(distance,containerHeight)):jimu_core.WpD.formatPixelNumber(`${distance}px`);canvasPane.drawLine(center,previousRect.bottom,center,previousRect.bottom+distance,!1,label)}isEdge=nextItem.gridline.rect.left===Number.NEGATIVE_INFINITY;const nextRect=nextItem.gridline.rect;if(null!=nextRect&&null!=activeItem.bottom&&(!isEdge||isResizing&&!nextItem.fixed)){const center=(Math.max(activeItem.rect.left,nextRect.left)+Math.min(activeItem.rect.right,nextRect.right))/2,usePercentage=activeItem.bottom.usePercentage;let distance=nextRect.top-activeItem.rect.bottom;nextItem.fixed||(distance-=dy);const label=usePercentage?jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(distance,containerHeight)):jimu_core.WpD.formatPixelNumber(`${distance}px`);canvasPane.drawLine(center,nextRect.top,center,nextRect.top-distance,!1,label)}}}(activeItem,{gridline:null==previousItems?void 0:previousItems.value,fixed:0!==delta.h&&0===delta.y},{gridline:null==nextItems?void 0:nextItems.value,fixed:0!==delta.y&&0!==delta.y},canvasPane,theme,{isResizing:0!==delta.h,dy,containerHeight})}return{dx,dy}}function distance(source,target){return Math.abs(target.pixelValue-source.pixelValue)}function isSamePosition(source,delta,target){if(source.pixelValue+delta===target.pixelValue){const targetUsePercentage=target.usePercentage;if(targetUsePercentage===source.usePercentage)return targetUsePercentage||target.origin===source.origin}return!1}function findRelated(activeItem,gridlines){return gridlines.filter((item=>function isRelated(source,target){if(distance(target,source)<20){const targetUsePercentage=target.usePercentage;if(targetUsePercentage===source.usePercentage)return targetUsePercentage||target.origin===source.origin}return!1}(activeItem,item))).sort(((a,b)=>distance(a,activeItem)-distance(b,activeItem)))}function snapToEdge(activeItem,bboxGridlines,delta,options){let dx=0,dy=0;const{canSnapToX,canSnapToY,canvasPane,theme}=options;if(!canSnapToX&&!canSnapToY)return{dx,dy};let verticalLines=[],horizontalLines=[];if(bboxGridlines.forEach((item=>{if(canSnapToX){const v=[item.left,item.xm,item.right].filter((line=>{var _a,_b,_c;return null!=line&&(line.from=null!==(_a=item.rect.top)&&void 0!==_a?_a:item.rect.bottom,line.to=item.rect.top>=0&&item.rect.bottom>=0?item.rect.bottom:activeItem.rect.top,0!==delta.w?0===delta.x?line.pixelValue>=(null===(_b=activeItem.right)||void 0===_b?void 0:_b.pixelValue):line.pixelValue<=(null===(_c=activeItem.left)||void 0===_c?void 0:_c.pixelValue):0===delta.h)}));verticalLines=verticalLines.concat(v)}if(canSnapToY){const h=[item.top,item.ym,item.bottom].filter((line=>{var _a,_b,_c;return null!=line&&(line.from=null!==(_a=item.rect.left)&&void 0!==_a?_a:item.rect.right,line.to=item.rect.left>=0&&item.rect.right>=0?item.rect.right:activeItem.rect.left,0!==delta.h?0===delta.y?line.pixelValue>=(null===(_b=activeItem.bottom)||void 0===_b?void 0:_b.pixelValue):line.pixelValue<=(null===(_c=activeItem.top)||void 0===_c?void 0:_c.pixelValue):0===delta.w)}));horizontalLines=horizontalLines.concat(h)}})),canSnapToX){const xEdges=[activeItem.left,activeItem.xm,activeItem.right];xEdges.some((gridline=>{if(null!=gridline){const candidates=findRelated(gridline,verticalLines);if((null==candidates?void 0:candidates.length)>0){null!=canvasPane&&null!=theme&&candidates.forEach((candidate=>{!function drawVerticalCandidate(snapItem,canvasPane,theme){null!=canvasPane&&null!=theme&&(canvasPane.setColor(theme.sys.color.error.main),canvasPane.drawLine(snapItem.pixelValue,snapItem.from,snapItem.pixelValue,snapItem.to,!0))}(candidate,canvasPane,theme)}));const nearest=candidates[0];if(distance(nearest,gridline)<=5)return dx=nearest.pixelValue-gridline.pixelValue,function drawVerticalSnapLine(activeItems,otherItems,deltaX,canvasPane,theme){null!=canvasPane&&null!=theme&&(canvasPane.setColor(theme.sys.color.error.main),activeItems.forEach((activeItem=>{if(null!=activeItem){let ymin=activeItem.from,ymax=activeItem.to,hasSamePosition=!1;if(otherItems.forEach((otherItem=>{isSamePosition(activeItem,deltaX,otherItem)&&(ymin=Math.min(ymin,otherItem.from),ymax=Math.max(ymax,otherItem.to),hasSamePosition=!0)})),hasSamePosition){const x=activeItem.pixelValue+deltaX;canvasPane.drawLine(x,ymin,x,ymax)}}})))}(xEdges,verticalLines,dx,canvasPane,theme),!0}}}))}if(canSnapToY){const yEdges=[activeItem.top,activeItem.ym,activeItem.bottom];yEdges.some((gridline=>{if(null!=gridline){const candidates=findRelated(gridline,horizontalLines);if((null==candidates?void 0:candidates.length)>0){null!=canvasPane&&null!=theme&&candidates.forEach((candidate=>{!function drawHorizontalCandidate(snapItem,canvasPane,theme){null!=canvasPane&&null!=theme&&(canvasPane.setColor(theme.sys.color.error.main),canvasPane.drawLine(snapItem.from,snapItem.pixelValue,snapItem.to,snapItem.pixelValue,!0))}(candidate,canvasPane,theme)}));const nearest=candidates[0];if(distance(nearest,gridline)<=5)return dy=nearest.pixelValue-gridline.pixelValue,function drawHorizontalSnapLine(activeItems,otherItems,deltaY,canvasPane,theme){null!=canvasPane&&null!=theme&&(canvasPane.setColor(theme.sys.color.error.main),activeItems.forEach((activeItem=>{if(null!=activeItem){let xmin=activeItem.from,xmax=activeItem.to,hasSamePosition=!1;if(otherItems.forEach((otherItem=>{isSamePosition(activeItem,deltaY,otherItem)&&(xmin=Math.min(xmin,otherItem.from),xmax=Math.max(xmax,otherItem.to),hasSamePosition=!0)})),hasSamePosition){const y=activeItem.pixelValue+deltaY;canvasPane.drawLine(xmin,y,xmax,y)}}})))}(yEdges,horizontalLines,dy,canvasPane,theme),!0}}}))}return{dx,dy}}var FixedSides;function getBBoxUnits(bbox,rtl=!1){const result={};if(["left","right","width","top","bottom","height"].forEach((prop=>{null!=(null==bbox?void 0:bbox[prop])?result[prop]=layout_runtime.utils.isPercentage(bbox[prop])?"%":"px":result[prop]="%"})),rtl){const temp=result.left;result.left=result.right,result.right=temp}return result}function getRectOrigin(itemRect,containerRect){const top=itemRect.top,bottom=containerRect.height-(itemRect.top+itemRect.height),left=itemRect.left;return[containerRect.width-(itemRect.left+itemRect.width)<left?1:0,bottom<top?1:0]}function getPixelValue(value,total){return layout_runtime.utils.isPercentage(value)?Math.round(layout_runtime.utils.fromRatio(value,total)):Math.round(parseFloat(value))}function getGridlineOfLayoutItem(layoutItem,containerWidth,containerHeight){var _a,_b,_c,_d,_e,_f,_g,_h,_j;const bbox=layoutItem.bbox,bboxUnits=getBBoxUnits(bbox,(0,lib_utils.isRTL)()),setting=null!==(_a=layoutItem.setting)&&void 0!==_a?_a:{},rect=function getRectOfLayoutItem(layoutItem,containerWidth,containerHeight){var _a,_b,_c;const rect={},bbox=null!==(_a=layoutItem.bbox)&&void 0!==_a?_a:{},autoProps=null!==(_c=null===(_b=layoutItem.setting)||void 0===_b?void 0:_b.autoProps)&&void 0!==_c?_c:{};return autoProps.width===layout_runtime.LayoutItemSizeModes.Stretch?(rect.left=getPixelValue(bbox.left,containerWidth),rect.right=containerWidth-getPixelValue(bbox.right,containerWidth),rect.width=rect.right-rect.left):autoProps.width===layout_runtime.LayoutItemSizeModes.Auto?autoProps.left?rect.right=containerWidth-getPixelValue(bbox.right,containerWidth):rect.left=getPixelValue(bbox.left,containerWidth):(rect.width=getPixelValue(bbox.width,containerWidth),autoProps.left?(rect.right=containerWidth-getPixelValue(bbox.right,containerWidth),rect.left=rect.right-rect.width):(rect.left=getPixelValue(bbox.left,containerWidth),rect.right=rect.left+rect.width)),autoProps.height===layout_runtime.LayoutItemSizeModes.Stretch?(rect.top=getPixelValue(bbox.top,containerHeight),rect.bottom=containerHeight-getPixelValue(bbox.bottom,containerHeight),rect.height=rect.bottom-rect.top):autoProps.height===layout_runtime.LayoutItemSizeModes.Auto?autoProps.top?rect.bottom=containerHeight-getPixelValue(bbox.bottom,containerHeight):rect.top=getPixelValue(bbox.top,containerHeight):(rect.height=getPixelValue(bbox.height,containerHeight),autoProps.top?(rect.bottom=containerHeight-getPixelValue(bbox.bottom,containerHeight),rect.top=rect.bottom-rect.height):(rect.top=getPixelValue(bbox.top,containerHeight),rect.bottom=rect.top+rect.height)),rect}(layoutItem,containerWidth,containerHeight),result={id:layoutItem.id,rect},getRightOrBottomValue=value=>layout_runtime.utils.isPercentage(value)?100-parseFloat(value)+"%":value,flipLeftRight=value=>layout_runtime.utils.isPercentage(value)?100-parseFloat(value)+"%":containerWidth-parseFloat(value)+"px",left={value:bbox.left,pixelValue:rect.left,usePercentage:"%"===bboxUnits.left,origin:0},top={value:bbox.top,pixelValue:rect.top,usePercentage:"%"===bboxUnits.top,origin:0},right={value:getRightOrBottomValue(bbox.right),pixelValue:rect.right,usePercentage:"%"===bboxUnits.right,origin:1},bottom={value:getRightOrBottomValue(bbox.bottom),pixelValue:rect.bottom,usePercentage:"%"===bboxUnits.bottom,origin:1};if((null===(_b=setting.autoProps)||void 0===_b?void 0:_b.width)===layout_runtime.LayoutItemSizeModes.Stretch)result.left=left,result.right=right,bboxUnits.left===bboxUnits.right&&"%"===bboxUnits.left&&(result.xm={value:(parseFloat(result.left.value)+parseFloat(result.right.value))/2+"%",pixelValue:(rect.left+rect.right)/2,usePercentage:"%"===bboxUnits.left});else if((null===(_c=setting.autoProps)||void 0===_c?void 0:_c.width)===layout_runtime.LayoutItemSizeModes.Auto)(null===(_d=setting.autoProps)||void 0===_d?void 0:_d.left)?result.right=right:result.left=left;else if(null===(_e=setting.autoProps)||void 0===_e?void 0:_e.left){if(result.right=right,bboxUnits.right===bboxUnits.width){const rightValue=parseFloat(bbox.right),widthValue=parseFloat(bbox.width),leftValue="px"===bboxUnits.right?rightValue+widthValue:100-(rightValue+widthValue),centerValue="px"===bboxUnits.right?rightValue+widthValue/2:100-(rightValue+widthValue/2);result.left={value:`${leftValue}${bboxUnits.right}`,pixelValue:rect.left,usePercentage:"%"===bboxUnits.right,origin:1},result.xm={value:`${centerValue}${bboxUnits.right}`,pixelValue:rect.left+rect.width/2,usePercentage:"%"===bboxUnits.right,origin:1}}}else if(result.left=left,bboxUnits.left===bboxUnits.width){const leftValue=parseFloat(bbox.left),widthValue=parseFloat(bbox.width),rightValue=leftValue+widthValue;result.right={value:`${rightValue}${bboxUnits.left}`,pixelValue:rect.right,usePercentage:"%"===bboxUnits.left,origin:0},result.xm={value:`${leftValue+widthValue/2}${bboxUnits.left}`,pixelValue:rect.left+rect.width/2,usePercentage:"%"===bboxUnits.left,origin:0}}if((0,lib_utils.isRTL)()){let left,right,xm;result.rect.left=containerWidth-result.rect.right,result.rect.right=result.rect.left+result.rect.width,null!=result.left&&(right={value:flipLeftRight(result.left.value),pixelValue:result.rect.right,usePercentage:"%"===bboxUnits.left,origin:0===result.left.origin?1:0}),null!=result.right&&(left={value:flipLeftRight(result.right.value),pixelValue:result.rect.left,usePercentage:"%"===bboxUnits.right,origin:0===result.right.origin?1:0}),null!=result.xm&&(xm={value:flipLeftRight(result.xm.value),pixelValue:result.rect.left+result.rect.width/2,usePercentage:result.xm.usePercentage,origin:0===result.xm.origin?1:0}),result.right=right,result.left=left,result.xm=xm}if((null===(_f=setting.autoProps)||void 0===_f?void 0:_f.height)===layout_runtime.LayoutItemSizeModes.Stretch)result.top=top,result.bottom=bottom,bboxUnits.top===bboxUnits.bottom&&"%"===bboxUnits.top&&(result.ym={value:(parseFloat(result.top.value)+parseFloat(result.bottom.value))/2+"%",pixelValue:(rect.top+rect.bottom)/2,usePercentage:"%"===bboxUnits.top});else if((null===(_g=setting.autoProps)||void 0===_g?void 0:_g.height)===layout_runtime.LayoutItemSizeModes.Auto)(null===(_h=setting.autoProps)||void 0===_h?void 0:_h.top)?result.bottom=bottom:result.top=top;else if(null===(_j=setting.autoProps)||void 0===_j?void 0:_j.top){if(result.bottom=bottom,bboxUnits.bottom===bboxUnits.height){const bottomValue=parseFloat(bbox.bottom),heightValue=parseFloat(bbox.height),topValue="px"===bboxUnits.bottom?bottomValue+heightValue:100-(bottomValue+heightValue),centerValue="px"===bboxUnits.bottom?bottomValue+heightValue/2:100-(bottomValue+heightValue/2);result.top={value:`${topValue}${bboxUnits.bottom}`,pixelValue:rect.top,usePercentage:"%"===bboxUnits.bottom,origin:1},result.ym={value:`${centerValue}${bboxUnits.bottom}`,pixelValue:rect.top+rect.height/2,usePercentage:"%"===bboxUnits.bottom,origin:1}}}else if(result.top=top,bboxUnits.top===bboxUnits.height){const topValue=parseFloat(bbox.top),heightValue=parseFloat(bbox.height),bottomValue=topValue+heightValue;result.bottom={value:`${bottomValue}${bboxUnits.top}`,pixelValue:rect.bottom,usePercentage:"%"===bboxUnits.top,origin:0},result.ym={value:`${topValue+heightValue/2}${bboxUnits.top}`,pixelValue:rect.top+rect.height/2,usePercentage:"%"===bboxUnits.top,origin:0}}return result}function getGridlinesOfLayout(layout,containerWidth,containerHeight,excludeId){var _a;const gridlines=[];Object.keys(null!==(_a=layout.content)&&void 0!==_a?_a:{}).forEach((id=>{if(id!==excludeId){const layoutItem=layout.content[id];if(!layoutItem.isPending){const gridline=getGridlineOfLayoutItem(layoutItem,containerWidth,containerHeight);gridlines.push(gridline)}}}));const rect={left:0,right:containerWidth,width:containerWidth,top:0,bottom:containerHeight,height:containerHeight};return gridlines.push({id:"",left:{value:"0px",pixelValue:0,usePercentage:!1,origin:0,from:0,to:containerHeight},right:{value:"0px",pixelValue:containerWidth,usePercentage:!1,origin:1,from:0,to:containerHeight},top:{value:"0px",pixelValue:0,origin:0,usePercentage:!1,from:0,to:containerWidth},bottom:{value:"0px",pixelValue:containerHeight,usePercentage:!1,origin:1,from:0,to:containerWidth},rect}),gridlines.push({id:"",left:{value:"0%",pixelValue:0,usePercentage:!0,origin:0,from:0,to:containerHeight},xm:{value:"50%",pixelValue:Math.round(containerWidth/2),usePercentage:!0,origin:0,from:0,to:containerHeight},right:{value:"0%",pixelValue:containerWidth,usePercentage:!0,origin:1,from:0,to:containerHeight},top:{value:"0%",pixelValue:0,usePercentage:!0,origin:0,from:0,to:containerWidth},ym:{value:"50%",pixelValue:Math.round(containerHeight/2),usePercentage:!0,origin:0,from:0,to:containerWidth},bottom:{value:"0%",pixelValue:containerHeight,usePercentage:!0,origin:1,from:0,to:containerWidth},rect}),gridlines}function moveGuide(activeLayoutItem,containerRect,draggingBound,bboxGridlines,options){var _a,_b;const{delta,shiftKey,canvasPane,theme}=options,setting=null!==(_a=null==activeLayoutItem?void 0:activeLayoutItem.setting)&&void 0!==_a?_a:{},bbox=null!==(_b=null==activeLayoutItem?void 0:activeLayoutItem.bbox)&&void 0!==_b?_b:{},isResizing=0!==delta.w||0!==delta.h;if(isResizing&&(setting.hCenter&&"50%"===bbox.left||setting.vCenter&&"50%"===bbox.top))return delta;let limitedDelta=function keepMinimalSize(draggingBound,delta){if(0!==delta.w||0!==delta.h){const result={x:delta.x,y:delta.y,w:delta.w,h:delta.h};return draggingBound.width+delta.w<16&&(result.w=16-draggingBound.width,0!==delta.x&&(result.x=-result.w)),draggingBound.height+delta.h<16&&(result.h=16-draggingBound.height,0!==delta.y&&(result.y=-result.h)),result}return delta}(draggingBound,delta);shiftKey&&(limitedDelta=function keepAspectRatio(draggingBound,delta){if(0===delta.w&&0===delta.h)return delta;const ratio=draggingBound.height/draggingBound.width;let w=delta.w,h=delta.h,x=delta.x,y=delta.y;Math.abs(w)*ratio>Math.abs(h)?h=Math.round(w*ratio):w=Math.round(h/ratio);0!==x&&(x=-w);0!==y&&(y=-h);return{x,y,w,h}}(draggingBound,limitedDelta));const activeItem=function getGridlineOfActiveItem(layoutItem,itemRect,containerWidth,containerHeight,delta){var _a,_b,_c,_d,_e,_f,_g;const{x:dx,y:dy,w:dw,h:dh}=null!=delta?delta:{x:0,y:0,w:0,h:0},setting=null!==(_a=null==layoutItem?void 0:layoutItem.setting)&&void 0!==_a?_a:{},currentRect={left:Math.round(itemRect.left+dx),width:Math.round(itemRect.width+dw),right:0,top:Math.round(itemRect.top+dy),height:Math.round(itemRect.height+dh),bottom:0};currentRect.right=currentRect.left+currentRect.width,currentRect.bottom=currentRect.top+currentRect.height;const result={id:null==layoutItem?void 0:layoutItem.id,rect:currentRect},rectOrigin=getRectOrigin(currentRect,{width:containerWidth,height:containerHeight}),bboxUnits=getBBoxUnits(null==layoutItem?void 0:layoutItem.bbox,(0,lib_utils.isRTL)());if((0,lib_utils.isRTL)()){const left=bboxUnits.left;bboxUnits.left=bboxUnits.right,bboxUnits.right=left}return(null===(_b=setting.autoProps)||void 0===_b?void 0:_b.width)===layout_runtime.LayoutItemSizeModes.Stretch?(result.left={value:`1${bboxUnits.left}`,pixelValue:currentRect.left,usePercentage:"%"===bboxUnits.left,origin:rectOrigin[0],from:currentRect.top,to:currentRect.bottom},result.right={value:`1${bboxUnits.right}`,pixelValue:currentRect.left+currentRect.width,usePercentage:"%"===bboxUnits.right,origin:rectOrigin[1],from:currentRect.top,to:currentRect.bottom}):0===rectOrigin[0]?(result.left={value:`1${bboxUnits.left}`,pixelValue:currentRect.left,usePercentage:"%"===bboxUnits.left,origin:rectOrigin[0],from:currentRect.top,to:currentRect.bottom},bboxUnits.width===bboxUnits.left&&(null===(_c=setting.autoProps)||void 0===_c?void 0:_c.width)!==layout_runtime.LayoutItemSizeModes.Auto&&(result.xm={value:`1${bboxUnits.left}`,pixelValue:currentRect.left+currentRect.width/2,usePercentage:"%"===bboxUnits.left,origin:rectOrigin[0],from:currentRect.top,to:currentRect.bottom},result.right={value:`1${bboxUnits.left}`,pixelValue:currentRect.left+currentRect.width,usePercentage:"%"===bboxUnits.left,origin:rectOrigin[0],from:currentRect.top,to:currentRect.bottom})):(result.right={value:`1${bboxUnits.right}`,pixelValue:currentRect.left+currentRect.width,usePercentage:"%"===bboxUnits.right,origin:rectOrigin[0],from:currentRect.top,to:currentRect.bottom},bboxUnits.width===bboxUnits.right&&(null===(_d=setting.autoProps)||void 0===_d?void 0:_d.width)!==layout_runtime.LayoutItemSizeModes.Auto&&(result.xm={value:`1${bboxUnits.right}`,pixelValue:currentRect.left+currentRect.width/2,usePercentage:"%"===bboxUnits.right,origin:rectOrigin[0],from:currentRect.top,to:currentRect.bottom},result.left={value:`1${bboxUnits.right}`,pixelValue:currentRect.left,usePercentage:"%"===bboxUnits.right,origin:rectOrigin[0],from:currentRect.top,to:currentRect.bottom})),(null===(_e=setting.autoProps)||void 0===_e?void 0:_e.height)===layout_runtime.LayoutItemSizeModes.Stretch?(result.top={value:`1${bboxUnits.top}`,pixelValue:currentRect.top,usePercentage:"%"===bboxUnits.top,origin:rectOrigin[1],from:currentRect.left,to:currentRect.right},result.bottom={value:`1${bboxUnits.bottom}`,pixelValue:currentRect.top+currentRect.height,usePercentage:"%"===bboxUnits.bottom,origin:rectOrigin[1],from:currentRect.left,to:currentRect.right}):0===rectOrigin[1]?(result.top={value:`1${bboxUnits.top}`,pixelValue:currentRect.top,usePercentage:"%"===bboxUnits.top,origin:rectOrigin[1],from:currentRect.left,to:currentRect.right},bboxUnits.height===bboxUnits.top&&(null===(_f=setting.autoProps)||void 0===_f?void 0:_f.height)!==layout_runtime.LayoutItemSizeModes.Auto&&(result.ym={value:`1${bboxUnits.top}`,pixelValue:currentRect.top+currentRect.height/2,usePercentage:"%"===bboxUnits.top,origin:rectOrigin[1],from:currentRect.left,to:currentRect.right},result.bottom={value:`1${bboxUnits.top}`,pixelValue:currentRect.top+currentRect.height,usePercentage:"%"===bboxUnits.top,origin:rectOrigin[1],from:currentRect.left,to:currentRect.right})):(result.bottom={value:`1${bboxUnits.bottom}`,pixelValue:currentRect.top+currentRect.height,usePercentage:"%"===bboxUnits.bottom,origin:rectOrigin[1],from:currentRect.left,to:currentRect.right},bboxUnits.height===bboxUnits.bottom&&(null===(_g=setting.autoProps)||void 0===_g?void 0:_g.height)!==layout_runtime.LayoutItemSizeModes.Auto&&(result.ym={value:`1${bboxUnits.bottom}`,pixelValue:currentRect.top+currentRect.height/2,usePercentage:"%"===bboxUnits.bottom,origin:rectOrigin[1],from:currentRect.left,to:currentRect.right},result.top={value:`1${bboxUnits.bottom}`,pixelValue:currentRect.top,usePercentage:"%"===bboxUnits.bottom,origin:rectOrigin[1],from:currentRect.left,to:currentRect.right})),result}(activeLayoutItem,draggingBound,containerRect.width,containerRect.height,limitedDelta);let{dx,dy}=snapByDistance(activeItem,bboxGridlines,{delta:limitedDelta,containerWidth:containerRect.width,containerHeight:containerRect.height,canvasPane,theme});const edgeSnapResult=snapToEdge(activeItem,bboxGridlines,limitedDelta,{canSnapToX:0===dx&&(!isResizing||0!==delta.w),canSnapToY:0===dy&&(!isResizing||0!==delta.h),canvasPane,theme});dx=0!==dx?dx:edgeSnapResult.dx,dy=0!==dy?dy:edgeSnapResult.dy;let updatedDelta=limitedDelta;return 0===dx&&0===dy||(updatedDelta=function updateDelta(delta,dx,dy){let fixedX,fixedY,{x,y,w,h}=delta;fixedX=0===w?FixedSides.None:0===x?FixedSides.Start:FixedSides.End;fixedY=0===h?FixedSides.None:0===y?FixedSides.Start:FixedSides.End;0!==dx&&(fixedX===FixedSides.None?x+=dx:fixedX===FixedSides.End?(x+=dx,w+=-dx):w+=dx);0!==dy&&(fixedY===FixedSides.None?y+=dy:fixedY===FixedSides.End?(y+=dy,h+=-dy):h+=dy);return{x,y,w,h}}(limitedDelta,dx,dy)),updatedDelta}!function(FixedSides){FixedSides[FixedSides.Start=0]="Start",FixedSides[FixedSides.End=1]="End",FixedSides[FixedSides.None=2]="None"}(FixedSides||(FixedSides={}));var jimu_for_builder_templates=__webpack_require__("../jimu-for-builder/templates.ts"),template=__webpack_require__("../jimu-icons/outlined/application/template.tsx");const buttonStyle=jimu_core.AHW`
  pointer-events: all;
`;function getStyle(builderTheme){return jimu_core.AHW`
    position: relative;
    height: 200px;
    padding: 1rem;
    pointer-events: none;
    z-index: 1;
    .btn-text {
      line-height: 32px;
    }
    .btn {
      background: ${builderTheme.ref.palette.neutral[600]};
      &:hover {
        background: ${builderTheme.ref.palette.neutral[700]};
      }
    }
    .action-item {
      width: 32px;
    }
    .action-separator {
      width: 300px;
      height: 1px;
      background-color: ${builderTheme.ref.palette.neutral[1100]};
    }
  `}function ActionBlock(props){const{pageContext,onPageTemplateSelected}=props,{builderTheme,formatMessage,isHeader,isFooter}=pageContext,[showTemplatePopper,setShowTemplatePopper]=jimu_core.q_G.useState(!1),templateRef=jimu_core.q_G.useRef(null),show=jimu_core.E_S.useSelector((state=>{var _a,_b,_c;const lockLayout=null!==(_c=null===(_b=null===(_a=state.appConfig)||void 0===_a?void 0:_a.forBuilderAttributes)||void 0===_b?void 0:_b.lockLayout)&&void 0!==_c&&_c;return state.appRuntimeInfo.appMode===jimu_core.$0N.Design&&!lockLayout})),closeTemplatePopover=()=>{setShowTemplatePopper(!1)};let tooltip;return tooltip=pageContext.isHeader?formatMessage("chooseHeaderTemplate"):pageContext.isFooter?formatMessage("chooseFooterTemplate"):formatMessage("chooseTemplate",{type:pageContext.isDialog?formatMessage("dialog").toLocaleLowerCase():formatMessage("page").toLocaleLowerCase()}),show?(0,jimu_core.Yac)("div",{className:"d-flex w-100 flex-column justify-content-center align-items-center",css:getStyle(builderTheme)},(0,jimu_core.Yac)("div",{className:"d-flex flex-column justify-content-center align-items-center"},(0,jimu_core.Yac)(theme_tooltip.v,{placement:"bottom",title:tooltip},(0,jimu_core.Yac)("div",{className:"action-item",ref:templateRef},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,onClick:e=>{if(e.stopPropagation(),(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small)setShowTemplatePopper(!showTemplatePopper);else if(pageContext.isDialog)jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"templateBlock",templateMethod:"getWindowTemplates",onSelect:onPageTemplateSelected});else{const name=isHeader?"getHeaderTemplates":isFooter?"getFooterTemplates":"getFullScreenPageTemplates",templateType="getFullScreenPageTemplates"===name?"template":"templateBlock";jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:templateType,templateMethod:name,onSelect:onPageTemplateSelected})}},css:buttonStyle,className:"rounded-circle"},(0,jimu_core.Yac)(template.v,{autoFlip:!0,size:"m",color:builderTheme.ref.palette.neutral[1100]})))),(0,jimu_core.Yac)("div",{className:"action-separator mt-4"}),(0,jimu_core.Yac)("h5",{className:"btn-text mt-2"},formatMessage("dropWidgetToAdd"))),showTemplatePopper&&!pageContext.isDialog&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:isHeader?(0,jimu_for_builder_templates.getHeaderTemplates)():isFooter?(0,jimu_for_builder_templates.getFooterTemplates)():(0,jimu_for_builder_templates.getFullScreenPageTemplates)(!1),referenceElement:templateRef.current,onItemSelect:onPageTemplateSelected,onClose:closeTemplatePopover}),showTemplatePopper&&pageContext.isDialog&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getWindowTemplates)(!1),referenceElement:templateRef.current,onItemSelect:onPageTemplateSelected,onClose:closeTemplatePopover})):null}try{ActionBlock.displayName="ActionBlock",ActionBlock.__docgenInfo={description:"",displayName:"ActionBlock",props:{pageContext:{defaultValue:null,description:"",name:"pageContext",required:!0,type:{name:"PageContextProps"}},onPageTemplateSelected:{defaultValue:null,description:"",name:"onPageTemplateSelected",required:!0,type:{name:"(templatePageJson: any) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/fixed-layout/builder/action-block.tsx#ActionBlock"]={docgenInfo:ActionBlock.__docgenInfo,name:"ActionBlock",path:"../jimu-layouts/lib/fixed-layout/builder/action-block.tsx#ActionBlock"})}catch(__react_docgen_typescript_loader_error){}class canvas_pane_CanvasPane{constructor(element,theme){this.canvas=element,this.ctx=element.getContext("2d"),this.ctx.font="1rem",this.theme=theme}setSize(width,height,ratio=1){const scaleHeight=Math.round(height*ratio),scaleWidth=Math.round(width*ratio);ratio<1?(this.canvas.style.width=`${width}px`,this.canvas.style.height=`${height}px`,this.canvas.width=width,this.canvas.height=height,this.ctx.scale(1,1)):this.canvas.width===scaleWidth&&this.canvas.height===scaleHeight||(this.canvas.style.width=`${width}px`,this.canvas.style.height=`${height}px`,this.canvas.width=scaleWidth,this.canvas.height=scaleHeight,this.ctx.scale(ratio,ratio))}setColor(color){this.ctx.fillStyle=color,this.ctx.strokeStyle=color}drawRect(rect){this.ctx.fillRect(rect.left,rect.top,rect.width,rect.height)}drawLine(x1,y1,x2,y2,dashed=!1,label){if(dashed?this.ctx.setLineDash([5,3]):this.ctx.setLineDash([]),this.ctx.beginPath(),x1===x2){let delta=x1<this.canvas.width/2?.5:-.5;delta=Number.isInteger(x1)?delta:0,this.ctx.moveTo(x1+delta,y1),this.ctx.lineTo(x2+delta,y2)}if(y1===y2){let delta=y1<this.canvas.height/2?.5:-.5;delta=Number.isInteger(y1)?delta:0,this.ctx.moveTo(x1,y1+delta),this.ctx.lineTo(x2,y2+delta)}if(this.ctx.stroke(),null!=label){const centerX=(x1+x2)/2,centerY=(y1+y2)/2;this.drawLabel(centerX,centerY,label,y1===y2)}}drawTailedLine(x1,y1,x2,y2,dashed=!1,label){if(dashed?this.ctx.setLineDash([5,3]):this.ctx.setLineDash([]),this.ctx.beginPath(),x1===x2){let delta=x1<this.canvas.width/2?.5:-.5;delta=Number.isInteger(x1)?delta:0;const from=Math.min(y1,y2);let fromDelta=from<this.canvas.height/2?.5:-.5;fromDelta=Number.isInteger(from)?fromDelta:0;const to=Math.max(y1,y2);let toDelta=to<this.canvas.height/2?.5:-.5;toDelta=Number.isInteger(to)?toDelta:0,this.ctx.moveTo(x1+delta,y1),this.ctx.lineTo(x2+delta,y2),this.ctx.moveTo(x1-5,from+fromDelta),this.ctx.lineTo(x1+5,from+fromDelta),this.ctx.moveTo(x2-5,to+toDelta),this.ctx.lineTo(x2+5,to+toDelta)}if(y1===y2){let delta=y1<this.canvas.height/2?.5:-.5;delta=Number.isInteger(y1)?delta:0;const from=Math.min(x1,x2);let fromDelta=from<this.canvas.width/2?.5:-.5;fromDelta=Number.isInteger(from)?fromDelta:0;const to=Math.max(x1,x2);let toDelta=to<this.canvas.width/2?.5:-.5;toDelta=Number.isInteger(to)?toDelta:0,this.ctx.moveTo(x1,y1+delta),this.ctx.lineTo(x2,y2+delta),this.ctx.moveTo(from+fromDelta,y1-5),this.ctx.lineTo(from+fromDelta,y1+5),this.ctx.moveTo(to+toDelta,y2-5),this.ctx.lineTo(to+toDelta,y2+5)}if(this.ctx.stroke(),null!=label){const centerX=(x1+x2)/2,centerY=(y1+y2)/2;this.drawLabel(centerX,centerY,label,y1===y2)}}drawLabel(x,y,label,isHorizontal=!0){const metrics=this.ctx.measureText(label),lineWidth=metrics.width,lineHeight=metrics.actualBoundingBoxAscent+metrics.actualBoundingBoxDescent,width=lineWidth+8,height=lineHeight+8,signal=layout_runtime.utils.isRTL()?-1:1;this.ctx.save(),this.theme?this.ctx.fillStyle=this.theme.sys.color.primary.main:this.ctx.fillStyle="var(--sys-color-primary-main)",isHorizontal?(this.drawRoundRect(x-width/2,y-height-8,width,height),this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(label,x-lineWidth*signal/2,y-12)):(this.drawRoundRect(x+8,y-height/2,width,height),this.ctx.fillStyle="#FFFFFF",-1===signal?this.ctx.fillText(label,x+lineWidth+12,y+lineHeight/2):this.ctx.fillText(label,x+12,y+lineHeight/2)),this.ctx.restore()}drawRoundRect(x,y,width,height,radius=2){const tl=radius,tr=radius,bl=radius,br=radius;this.ctx.beginPath(),this.ctx.moveTo(x+tl,y),this.ctx.lineTo(x+width-tr,y),this.ctx.quadraticCurveTo(x+width,y,x+width,y+tr),this.ctx.lineTo(x+width,y+height-br),this.ctx.quadraticCurveTo(x+width,y+height,x+width-br,y+height),this.ctx.lineTo(x+bl,y+height),this.ctx.quadraticCurveTo(x,y+height,x,y+height-bl),this.ctx.lineTo(x,y+tl),this.ctx.quadraticCurveTo(x,y,x+tl,y),this.ctx.closePath(),this.ctx.fill()}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}var layout_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const layout_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  bottom: 0;
  top: 0;
  right: 0;
  background: transparent;
`,guideOverlay=jimu_core.AHW`
  ${layout_dropareaStyle};
  pointer-events: none;
`;class Layout extends jimu_core.q_G.PureComponent{constructor(props){if(super(props),this.handleActivate=e=>{if(!isDesignMode()&&!isExpressMode())return;if(Math.abs(e.screenX-this.mousedownX)>layout_runtime.CLICK_TOLERANCE||Math.abs(e.screenY-this.mousedownY)>layout_runtime.CLICK_TOLERANCE)return void e.stopPropagation();const{isInSection,isInWidget}=this.props;this.pageContext.viewOnly||isInSection||isInWidget||isResizing()||isDragging()||(e.stopPropagation(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged(null)))},this.handleMouseDown=e=>{this.mousedownX=e.screenX,this.mousedownY=e.screenY},this.updateDeviceRatio=()=>{this.canvasPane.setSize(this.ref.clientWidth,this.ref.clientHeight,window.devicePixelRatio)},this.handleResizeStart=id=>{const{layout}=this.props;this.rndingLayoutId=id;const draggingChild=this.ref.querySelector(`div.exb-rnd[data-layoutid="${layout.id}"][data-layoutitemid="${id}"]`);this.domRect=this.ref.getBoundingClientRect(),this.bboxGridlines=getGridlinesOfLayout(this.props.layout,this.domRect.width,this.domRect.height,id);const rect=draggingChild.getBoundingClientRect(),units=this.getPositionUnit(id);this.resizingRect=Object.assign({units},layout_runtime.utils.relativeClientRect(rect,this.domRect))},this.handleResizing=(id,dx,dy,dw,dh,shiftKey,speed)=>{if(this.canvasPane.clear(),speed>500)return void this.setState({offsetX:dx,offsetY:dy,dw,dh});const rndDelta=this.getResizingDelta(id,dx,dy,dw,dh,shiftKey);this.setState({offsetX:rndDelta.x,offsetY:rndDelta.y,dw:rndDelta.w,dh:rndDelta.h})},this.handleResizeEnd=(id,dx,dy,dw,dh,shiftKey,layoutItem,itemSetting)=>{var _a,_b;this.rndingLayoutId=null;const{layout}=this.props,delta=this.getResizingDelta(id,dx,dy,dw,dh,shiftKey);this.canvasPane.clear();const newPos=(0,fixed_layout_util.D_)(this.resizingRect,this.domRect,{dx:delta.x,dy:delta.y,dw:delta.w,dh:delta.h}),appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),layoutInfo={layoutId:layout.id,layoutItemId:id},{bbox,setting}=(0,fixed_layout_util.Ov)((0,jimu_core.J3Z)(layoutItem.bbox),layoutItem.setting,this.domRect,newPos);let newBBox=bbox;if((null==itemSetting?void 0:itemSetting.hCenter)&&"50%"===(null===(_a=layoutItem.bbox)||void 0===_a?void 0:_a.left)&&(newBBox=newBBox.set("left","50%")),(null==itemSetting?void 0:itemSetting.vCenter)&&"50%"===(null===(_b=layoutItem.bbox)||void 0===_b?void 0:_b.top)&&(newBBox=newBBox.set("top","50%")),appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",this.flipLeftRight?(0,fixed_layout_util.fF)(newBBox):newBBox).editLayoutItemProperty(layoutInfo,"setting",setting),appConfigAction.appConfig.useAutoSortInFixedLayout){const sortedLayout=sortLayoutItems(appConfigAction.appConfig.layouts[layoutInfo.layoutId]);appConfigAction.editLayoutProperty(layoutInfo.layoutId,"order",sortedLayout.order)}appConfigAction.exec(),this.bboxGridlines=null,this.setState({offsetX:0,offsetY:0,dw:0,dh:0})},this.handleMoveItemByKey=(id,dx,dy)=>{var _a,_b,_c;const{layout}=this.props;let itemWidth,itemHeight,bbox=layout.content[id].bbox,setting=null!==(_a=layout.content[id].setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({});const isAlignCenter=null!==(_b=null==setting?void 0:setting.hCenter)&&void 0!==_b&&_b||null!==(_c=null==setting?void 0:setting.vCenter)&&void 0!==_c&&_c;if(isAlignCenter){const element=this.ref.querySelector(`div[data-layoutitemid="${id}"]`);itemWidth=element.clientWidth,itemHeight=element.clientHeight}if(0!==dx){if(layout_runtime.utils.isPercentage(bbox.left)){const pValue=parseFloat(bbox.left);bbox=(null==setting?void 0:setting.hCenter)?bbox.set("left",`${(50-100*itemWidth/2/this.ref.clientWidth+.1*dx).toFixed(1)}%`):bbox.set("left",`${(pValue+.1*dx).toFixed(1)}%`)}else{const pValue=parseFloat(bbox.left);bbox=(null==setting?void 0:setting.hCenter)?bbox.set("left",`${(this.ref.clientWidth-itemWidth)/2+dx}px`):bbox.set("left",`${pValue+dx}px`)}if(layout_runtime.utils.isPercentage(bbox.right)){const pValue=parseFloat(bbox.right);bbox=(null==setting?void 0:setting.hCenter)?bbox.set("right",`${(50+100*itemWidth/2/this.ref.clientWidth-.1*dx).toFixed(1)}%`):bbox.set("right",`${(pValue-.1*dx).toFixed(1)}%`)}else{const pValue=parseFloat(bbox.right);bbox=(null==setting?void 0:setting.hCenter)?bbox.set("right",(this.ref.clientWidth+itemWidth)/2-dx+"px"):bbox.set("right",pValue-dx+"px")}(null==setting?void 0:setting.hCenter)&&(setting=setting.set("hCenter",!1))}if(0!==dy){if(layout_runtime.utils.isPercentage(bbox.top)){const pValue=parseFloat(bbox.top);bbox=(null==setting?void 0:setting.vCenter)?bbox.set("top",`${(50-100*itemHeight/2/this.ref.clientHeight+.1*dy).toFixed(1)}%`):bbox.set("top",`${(pValue+.1*dy).toFixed(1)}%`)}else{const pValue=parseFloat(bbox.top);bbox=(null==setting?void 0:setting.vCenter)?bbox.set("top",`${(this.ref.clientHeight-itemHeight)/2+dy}px`):bbox.set("top",`${pValue+dy}px`)}if(layout_runtime.utils.isPercentage(bbox.bottom)){const pValue=parseFloat(bbox.bottom);bbox=(null==setting?void 0:setting.vCenter)?bbox.set("bottom",`${(50+100*itemHeight/2/this.ref.clientHeight-.1*dy).toFixed(1)}%`):bbox.set("bottom",`${(pValue-.1*dy).toFixed(1)}%`)}else{const pValue=parseFloat(bbox.bottom);bbox=(null==setting?void 0:setting.hCenter)?bbox.set("bottom",(this.ref.clientHeight+itemHeight)/2-dy+"px"):bbox.set("bottom",pValue-dy+"px")}(null==setting?void 0:setting.vCenter)&&(setting=setting.set("vCenter",!1))}const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();if(isAlignCenter&&appConfigAction.editLayoutItemProperty({layoutId:layout.id,layoutItemId:id},"setting",setting),appConfigAction.editLayoutItemProperty({layoutId:layout.id,layoutItemId:id},"bbox",bbox),appConfigAction.appConfig.useAutoSortInFixedLayout){const sortedLayout=sortLayoutItems(appConfigAction.appConfig.layouts[layout.id]);appConfigAction.editLayoutProperty(layout.id,"order",sortedLayout.order)}appConfigAction.exec()},this.handleDragOver=(draggingItem,draggingElement,containerRect,itemRect,clientX,clientY,speed)=>{var _a,_b,_c;if(this.canvasPane.clear(),!this.state.isDragover||speed>500)return;let excludeItemId,layoutItem,units,deltaX=0,deltaY=0;(null===(_a=draggingItem.layoutInfo)||void 0===_a?void 0:_a.layoutId)===this.props.layout.id?(excludeItemId=draggingItem.layoutInfo.layoutItemId,units=this.getPositionUnit(excludeItemId),layoutItem=this.props.layout.content[excludeItemId]):units=getBBoxUnits({},this.flipLeftRight);const hasRotation=draggingItem.rotation>0||draggingItem.rotation<0,rndDelta=moveGuide(layoutItem,this.domRect,itemRect,this.bboxGridlines,{delta:{x:0,w:0,y:0,h:0},shiftKey:!1,canvasPane:hasRotation?null:this.canvasPane,theme:hasRotation?null:this.pageContext.builderTheme});if(null!=draggingElement&&(0!==rndDelta.x||0!==rndDelta.y)){const tx=null!==(_b=parseFloat(draggingElement.getAttribute("data-translatex")))&&void 0!==_b?_b:0,ty=null!==(_c=parseFloat(draggingElement.getAttribute("data-translatey")))&&void 0!==_c?_c:0;draggingElement.style.transform=`translate(${tx+rndDelta.x}px, ${ty+rndDelta.y}px)`}deltaX=rndDelta.x,deltaY=rndDelta.y,this.canvasPane.setColor(this.pageContext.builderTheme.sys.color.primary.main);if(function drawPosition(itemRect,containerRect,canvasPane){const right=containerRect.width-(itemRect.left+itemRect.width),bottom=containerRect.height-(itemRect.top+itemRect.height),leftValue="px"===itemRect.units.left?jimu_core.WpD.formatPixelNumber(`${Math.round(itemRect.left)}px`):jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(itemRect.left,containerRect.width)),rightValue="px"===itemRect.units.right?jimu_core.WpD.formatPixelNumber(`${Math.round(right)}px`):jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(right,containerRect.width)),topValue="px"===itemRect.units.top?jimu_core.WpD.formatPixelNumber(`${Math.round(itemRect.top)}px`):jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(itemRect.top,containerRect.height)),bottomValue="px"===itemRect.units.bottom?jimu_core.WpD.formatPixelNumber(`${Math.round(bottom)}px`):jimu_core.WpD.formatPercentageNumber(layout_runtime.utils.toRatio(bottom,containerRect.height));itemRect.left<=right?itemRect.top<=bottom?(canvasPane.drawLine(0,itemRect.top,itemRect.left,itemRect.top,!1,leftValue),canvasPane.drawLine(itemRect.left,0,itemRect.left,itemRect.top,!1,topValue)):(canvasPane.drawLine(0,itemRect.top+itemRect.height,itemRect.left,itemRect.top+itemRect.height,!1,leftValue),canvasPane.drawLine(itemRect.left,itemRect.top+itemRect.height,itemRect.left,containerRect.height,!1,bottomValue)):itemRect.top<=bottom?(canvasPane.drawLine(itemRect.left+itemRect.width,itemRect.top,containerRect.width,itemRect.top,!1,rightValue),canvasPane.drawLine(itemRect.left+itemRect.width,0,itemRect.left+itemRect.width,itemRect.top,!1,topValue)):(canvasPane.drawLine(itemRect.left+itemRect.width,itemRect.top+itemRect.height,containerRect.width,itemRect.top+itemRect.height,!1,rightValue),canvasPane.drawLine(itemRect.left+itemRect.width,itemRect.top+itemRect.height,itemRect.left+itemRect.width,containerRect.height,!1,bottomValue))}({width:itemRect.width,height:itemRect.height,left:itemRect.left+deltaX,top:itemRect.top+deltaY,units},this.domRect,this.canvasPane),null==draggingItem.layoutInfo||draggingItem.isPending){this.canvasPane.setColor(jimu_core.PLL.rgba(this.pageContext.builderTheme.sys.color.primary.light,.2));const rect={left:itemRect.left+deltaX,top:itemRect.top+deltaY,width:itemRect.width,height:itemRect.height};this.canvasPane.drawRect(rect)}},this.handleToggleDragoverEffect=(value,draggingItem)=>{var _a;if(this.canvasPane.clear(),value){let excludeId;this.domRect=this.ref.getBoundingClientRect(),(null===(_a=draggingItem.layoutInfo)||void 0===_a?void 0:_a.layoutId)===this.props.layout.id&&(excludeId=draggingItem.layoutInfo.layoutItemId),this.bboxGridlines=getGridlinesOfLayout(this.props.layout,this.domRect.width,this.domRect.height,excludeId)}this.setState({isDragover:value})},this.handleDragEnter=draggingItem=>null,this.handleDragLeave=()=>null,this.handleDrop=(draggingItem,containerRect,itemRect)=>{let units;units=null==draggingItem.layoutInfo||draggingItem.layoutInfo.layoutId!==this.props.layout.id?getBBoxUnits({},this.flipLeftRight):this.getPositionUnit(draggingItem.layoutInfo.layoutItemId);const{snappedRect,delta}=this.calSnappedRect(draggingItem,containerRect,Object.assign({units},itemRect),draggingItem.layoutInfo);this.canvasPane.clear();const rect={left:itemRect.left+delta.x,top:itemRect.top+delta.y,width:itemRect.width,height:itemRect.height,right:containerRect.width-(itemRect.left+delta.x+itemRect.width),bottom:containerRect.height-(itemRect.top+delta.y+itemRect.height)};this.addWidgetToLayout(draggingItem,containerRect,rect,snappedRect).catch((err=>{console.error(err)})),this.bboxGridlines=null},this.toggleShowWidgetList=e=>{e.stopPropagation(),this.setState({showWidgetList:!this.state.showWidgetList})},this.closeWidgetList=()=>{this.state.showWidgetList&&this.setState({showWidgetList:!1})},this.handlePageTemplateSelected=templatePageJson=>{const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();this.setState({isLoadingTemplate:!0}),this.pageContext.isHeader?appConfigAction.applyHeaderTemplate(templatePageJson).then((()=>{appConfigAction.exec(),jimu_core.CM0.defer((()=>{this.setState({isLoadingTemplate:!1})}))})).catch((err=>{console.error(err)})):this.pageContext.isFooter?appConfigAction.applyFooterTemplate(templatePageJson).then((()=>{appConfigAction.exec(),jimu_core.CM0.defer((()=>{this.setState({isLoadingTemplate:!1})}))})).catch((err=>{console.error(err)})):this.pageContext.isDialog?appConfigAction.applyDialogTemplate(this.pageContext.dialogId,templatePageJson).then((()=>{appConfigAction.exec(),jimu_core.CM0.defer((()=>{this.setState({isLoadingTemplate:!1})}))})).catch((err=>{console.error(err)})):appConfigAction.applyPageBodyTemplate(this.pageContext.pageId,templatePageJson).then((()=>{appConfigAction.exec(),jimu_core.CM0.defer((()=>{this.setState({isLoadingTemplate:!1})}))})).catch((err=>{console.error(err)}))},null==this.props.layout)return;const exts=jimu_core.nH3.getInstance().getExtensions(`${jimu_core.vZE.R6.LayoutTransformer}`);if((null==exts?void 0:exts.length)>0){const ext=exts.find((item=>item.layoutType===this.props.layout.type));this.layoutTransform=null==ext?void 0:ext.transformLayout}this.flipLeftRight=layout_runtime.utils.isRTL(),this.state={offsetX:0,offsetY:0,dw:0,dh:0,isDragover:!1,showWidgetList:!1,isLoadingTemplate:!1}}componentDidMount(){var _a,_b,_c;this.canvasPane=new canvas_pane_CanvasPane(this.canvasRef,this.pageContext.builderTheme),this.updateDeviceRatio();const mqString=`(resolution: ${window.devicePixelRatio}dppx)`;this.mediaQueryList=null===(_a=window.matchMedia)||void 0===_a?void 0:_a.call(window,mqString);const{name,version}=window.jimuUA.browser;"safari"===name.toLowerCase()&&parseInt(version)<14?null===(_b=this.mediaQueryList)||void 0===_b||_b.addEventListener("change",this.updateDeviceRatio):null===(_c=this.mediaQueryList)||void 0===_c||_c.addEventListener("change",this.updateDeviceRatio)}componentWillUnmount(){var _a,_b;const{name,version}=window.jimuUA.browser;"safari"===name.toLowerCase()&&parseInt(version)<14?null===(_a=this.mediaQueryList)||void 0===_a||_a.removeEventListener("change",this.updateDeviceRatio):null===(_b=this.mediaQueryList)||void 0===_b||_b.removeEventListener("change",this.updateDeviceRatio)}componentDidUpdate(){this.updateDeviceRatio()}isResizingItem(){return 0!==this.state.dh||0!==this.state.dw}getResizingDelta(id,dx,dy,dw,dh,shiftKey){return moveGuide(this.props.layout.content[id],this.domRect,this.resizingRect,this.bboxGridlines,{delta:{x:dx,w:dw,y:dy,h:dh},shiftKey,canvasPane:this.canvasPane,theme:this.pageContext.builderTheme})}calSnappedRect(draggingItem,containerRect,itemRect,layoutInfo){let layoutItem;(null==layoutInfo?void 0:layoutInfo.layoutId)===this.props.layout.id&&(layoutItem=this.props.layout.content[layoutInfo.layoutItemId]);const delta=moveGuide(layoutItem,this.domRect,itemRect,this.bboxGridlines,{delta:{x:0,y:0,w:0,h:0},shiftKey:!1}),snappedRect={left:itemRect.left+delta.x,top:itemRect.top+delta.y,width:itemRect.width,height:itemRect.height};return snappedRect.right=containerRect.width-(+snappedRect.left+ +snappedRect.width),snappedRect.bottom=containerRect.height-(+snappedRect.top+ +snappedRect.height),itemRect.width>containerRect.width&&(snappedRect.width=containerRect.width,snappedRect.left=0),itemRect.height>containerRect.height&&(snappedRect.height=containerRect.height,snappedRect.top=0),snappedRect.left=layout_runtime.utils.toRatio(snappedRect.left,containerRect.width),snappedRect.top=layout_runtime.utils.toRatio(snappedRect.top,containerRect.height),snappedRect.width=layout_runtime.utils.toRatio(snappedRect.width,containerRect.width),snappedRect.height=layout_runtime.utils.toRatio(snappedRect.height,containerRect.height),snappedRect.right=layout_runtime.utils.toRatio(snappedRect.right,containerRect.width),snappedRect.bottom=layout_runtime.utils.toRatio(snappedRect.bottom,containerRect.height),{snappedRect,delta}}addWidgetToLayout(draggingItem,containerRect,itemRect,snapResult,appConfig){return layout_awaiter(this,void 0,void 0,(function*(){const{layout,browserSizeMode}=this.props,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),result=yield common_layout_actions_addItemToLayout(appConfigAction.appConfig,draggingItem,layout.id),{layoutInfo,updatedAppConfig}=result,outAppConfig=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.FixedLayout).processAfterItemAdded(updatedAppConfig,draggingItem,layoutInfo,{currentSizeMode:browserSizeMode,containerRect,itemRect,insertIndex:null,others:{snapResult}});layout_runtime.utils.changeLayout(outAppConfig,layoutInfo)}))}getPositionUnit(layoutItemId){return getBBoxUnits(this.props.layout.content[layoutItemId].bbox,this.flipLeftRight)}createItem(targetLayout,layoutItemId,key){const{itemResizable,itemDraggable,itemSelectable,showDefaultTools}=this.props,{offsetX,offsetY,dw,dh}=this.state,deltaX=layoutItemId===this.rndingLayoutId?offsetX:0,deltaY=layoutItemId===this.rndingLayoutId?offsetY:0,deltaW=layoutItemId===this.rndingLayoutId?dw:0,deltaH=layoutItemId===this.rndingLayoutId?dh:0,initRect=layoutItemId===this.rndingLayoutId?this.resizingRect:void 0,containerRect=layoutItemId===this.rndingLayoutId?this.domRect:void 0,layoutItem=targetLayout.content[layoutItemId];return(0,jimu_core.Yac)(layout_item,{key:`${targetLayout.id}_${layoutItemId}`,index:key,layoutItem,offsetX:deltaX,offsetY:deltaY,dw:deltaW,dh:deltaH,initRect,containerRect,layoutId:targetLayout.id,layoutItemId,draggable:itemDraggable,resizable:itemResizable,selectable:itemSelectable,showDefaultTools,isLayoutLockChildren:this.layoutSetting.lockChildren,onResizeStart:this.handleResizeStart,onResizing:this.handleResizing,onResizeEnd:this.handleResizeEnd,onMoveByKey:this.handleMoveItemByKey,isInSection:this.props.isInSection})}render(){const{layout,className,style,layouts,isPageItem,mainSizeMode,browserSizeMode}=this.props;return null==layout?null:(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(props=>{var _a,_b;this.pageContext=props;let targetLayout=layout;const viewOnly=layouts[browserSizeMode]!==layout.id;viewOnly&&null!=this.layoutTransform&&(targetLayout=this.layoutTransform(layout,mainSizeMode,browserSizeMode)),this.layoutSetting=jimu_core.CM0.assign({},default_setting.i,viewOnly?{}:layout.setting);const content=null!==(_a=targetLayout.order)&&void 0!==_a?_a:[],mergedClasses=(0,jimu_core.xWm)("layout fixed-layout",className,{[LIMITED_BOUNDARY_CLASS_NAME]:null===(_b=layout.setting)||void 0===_b?void 0:_b.lockDescendants}),isResizing=0!==this.state.dh||0!==this.state.dw,mergedStyle=Object.assign(Object.assign(Object.assign({height:"auto",position:"relative"},style),jimu_ui.styleUtils.toCSSStyle(this.layoutSetting.style)),{width:"100%",overflow:"hidden"}),guideVisibleStyle={display:this.state.isDragover||isResizing?"block":"none",zIndex:content.length+1},showActionBlock=!this.state.isLoadingTemplate&&layout_runtime.utils.isEmptyLayout(targetLayout)&&!props.viewOnly&&layout.id===props.rootLayoutId;return(0,jimu_core.Yac)("div",{className:mergedClasses,ref:el=>{this.ref=el},onClick:this.handleActivate,onMouseDown:this.handleMouseDown,style:mergedStyle,"data-layoutid":targetLayout.id},(0,jimu_core.Yac)(jimu_core.zKZ.Provider,{value:{monitor:!1}},(0,jimu_core.Yac)(jimu_core._kc,{oid:targetLayout.id,"data-layoutid":targetLayout.id,className:"trail-container",css:jimu_core.AHW`
                    position: absolute;
                    left: 0;
                    right: 0;
                    top: 0;
                    bottom: 0;
                  `},(0,jimu_core.Yac)(droparea_hook_DropArea,{css:layout_dropareaStyle,layouts:this.props.layouts,highlightDragover:!isPageItem,onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDragOver:this.handleDragOver,onDrop:this.handleDrop,onToggleDragoverEffect:this.handleToggleDragoverEffect,isRepeat:this.props.isRepeat}),content.map(((layoutItemId,index)=>this.createItem(targetLayout,layoutItemId,index))))),showActionBlock&&(0,jimu_core.Yac)(ActionBlock,{pageContext:this.pageContext,onPageTemplateSelected:this.handlePageTemplateSelected}),this.state.isLoadingTemplate&&(0,jimu_core.Yac)(jimu_ui.Loading,{type:jimu_ui.LoadingType.Primary}),(0,jimu_core.Yac)("canvas",{css:guideOverlay,style:guideVisibleStyle,ref:el=>{this.canvasRef=el}}))}))}}Layout.displayName="FixedLayout";const builder_layout=jimu_core.E_S.connect(layout_runtime.utils.mapStateToLayoutProps)(Layout);try{layout.displayName="layout",layout.__docgenInfo={description:"",displayName:"layout",props:{layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"IMSizeModeLayoutJson"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},isInWidget:{defaultValue:null,description:"",name:"isInWidget",required:!1,type:{name:"boolean"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},isPageItem:{defaultValue:null,description:"",name:"isPageItem",required:!1,type:{name:"boolean"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},itemDraggable:{defaultValue:null,description:"",name:"itemDraggable",required:!1,type:{name:"boolean"}},itemResizable:{defaultValue:null,description:"",name:"itemResizable",required:!1,type:{name:"boolean"}},itemSelectable:{defaultValue:null,description:"",name:"itemSelectable",required:!1,type:{name:"boolean"}},droppable:{defaultValue:null,description:"",name:"droppable",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isItemAccepted:{defaultValue:null,description:"",name:"isItemAccepted",required:!1,type:{name:"(item: LayoutItemConstructorProps, isReplacePlaceholder: boolean) => boolean"}},onItemClick:{defaultValue:null,description:"",name:"onItemClick",required:!1,type:{name:"(e: any, widgetId: string) => void"}},ignoreMinHeight:{defaultValue:null,description:"",name:"ignoreMinHeight",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/fixed-layout/builder/layout.tsx#layout"]={docgenInfo:layout.__docgenInfo,name:"layout",path:"../jimu-layouts/lib/fixed-layout/builder/layout.tsx#layout"})}catch(__react_docgen_typescript_loader_error){}function calInsertPositionForColumn(boundingRect,itemRect,childRects){const centerY=itemRect.top+itemRect.height/2;let result,refId,found=!1;if(childRects.some(((rect,i)=>{if(rect.top+rect.height/2>centerY){if(0===i)result=rect.top/2;else{const previousItem=childRects[i-1];result=(rect.top+previousItem.top+previousItem.height)/2}found=!0,refId=rect.id}return found})),!found){const lastItem=childRects[childRects.length-1];result=(lastItem.top+lastItem.height+boundingRect.height)/2}return{refId,insertY:result}}var column_layout_default_setting=__webpack_require__("../jimu-layouts/lib/column-layout/default-setting.ts"),types=__webpack_require__("../jimu-layouts/lib/types.ts"),common_util=__webpack_require__("../jimu-layouts/lib/column-layout/common/util.ts");class ColumnItem extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.state={isResizing:!1,dw:0,dh:0},this.onResizeStart=(id,initW,initH)=>{this.initWidth=initW,this.initHeight=initH,this.props.onResizeStart(id),this.setState({isResizing:!0})},this.onResizing=(id,x,y,dw,dh)=>{this.props.onResizing(id,x,y,dw,dh),this.setState({dw,dh,isResizing:!0})},this.onResizeEnd=(id,x,y,dw,dh,shiftKey)=>{const{layoutItem}=this.props;this.props.onResizeEnd(id,x,y,dw,dh,layoutItem),this.setState({isResizing:!1,dw:0,dh:0})}}isStretchInCrossAxis(){const{layoutItem}=this.props;return common_util.IW(layoutItem)}calHeight(itemSetting,bbox){return common_util.WW(itemSetting,bbox)}getStyle(layoutSetting,isStretch){const{layoutItem}=this.props,{dw,dh,isResizing}=this.state,bbox=layoutItem.bbox||{},style=this.calHeight(layoutSetting,bbox);return style.width=isStretch?"auto":bbox.width,isResizing&&(dw||dh)&&(style.height=this.initHeight+dh,style.width=this.initWidth+dw),this.autoHeight="auto"===style.height,common_util.jX(style,layoutSetting,isStretch)}render(){var _a,_b;const{layoutId,layoutItem,draggable,resizable,selectable,showDefaultTools}=this.props;if(!layoutItem||layoutItem.isPending)return null;const layoutSetting=layoutItem.setting||{},heightMode=null!==(_b=null===(_a=layoutSetting.autoProps)||void 0===_a?void 0:_a.height)&&void 0!==_b?_b:types.Dy.Custom,mergedClass=(0,jimu_core.xWm)("flexbox-layout-item",{"d-flex":heightMode!==types.Dy.Auto}),isStretch=this.isStretchInCrossAxis(),keepAspectRatio=layout_runtime.utils.shouldUseAspectRatio(layoutSetting),ratio=layout_runtime.utils.parseAspectRatio(layoutSetting.aspectRatio),oneByOneAnimationProps=layout_runtime.utils.handleOnebyOneAnimation(this.props);return(0,jimu_core.Yac)(LayoutItemInBuilder,Object.assign({css:this.getStyle(layoutSetting,isStretch),layoutId,layoutItemId:layoutItem.id,onResizeStart:this.onResizeStart,onResizing:this.onResizing,onResizeEnd:this.onResizeEnd,left:!isStretch,right:!isStretch,top:!1,bottom:heightMode===types.Dy.Custom&&!keepAspectRatio,draggable,resizable,selectable,showDefaultTools,onClick:this.props.onClick,className:mergedClass,forceAspectRatio:keepAspectRatio,aspectRatio:ratio,autoHeight:this.autoHeight},oneByOneAnimationProps))}}try{ColumnItem.displayName="ColumnItem",ColumnItem.__docgenInfo={description:"",displayName:"ColumnItem",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"ImmutableObjectMixin<LayoutItemJson> & { readonly id?: string; readonly bbox?: ImmutableObject<BoundingBox>; ... 8 more ...; readonly children?: ImmutableArray<...>; }"}},selected:{defaultValue:null,description:"",name:"selected",required:!1,type:{name:"boolean"}},autoScroll:{defaultValue:null,description:"",name:"autoScroll",required:!1,type:{name:"boolean"}},animationPreview:{defaultValue:null,description:"",name:"animationPreview",required:!1,type:{name:"boolean"}},hoverPreview:{defaultValue:null,description:"",name:"hoverPreview",required:!1,type:{name:"boolean"}},playMode:{defaultValue:null,description:"",name:"playMode",required:!1,type:{name:"enum",value:[{value:'"AS_ONE"'},{value:'"ONE_BY_ONE"'}]}},previewId:{defaultValue:null,description:"",name:"previewId",required:!1,type:{name:"number"}},watchViewportVisibility:{defaultValue:null,description:"",name:"watchViewportVisibility",required:!1,type:{name:"boolean"}},activeIds:{defaultValue:null,description:"",name:"activeIds",required:!1,type:{name:"string"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},space:{defaultValue:null,description:"",name:"space",required:!0,type:{name:"number"}},onResizeStart:{defaultValue:null,description:"",name:"onResizeStart",required:!0,type:{name:"(id: string) => void"}},onResizing:{defaultValue:null,description:"",name:"onResizing",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number) => void"}},onResizeEnd:{defaultValue:null,description:"",name:"onResizeEnd",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number, layoutItem: LayoutItemJson | IMLayoutItemJson) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/column-layout/builder/layout-item.tsx#ColumnItem"]={docgenInfo:ColumnItem.__docgenInfo,name:"ColumnItem",path:"../jimu-layouts/lib/column-layout/builder/layout-item.tsx#ColumnItem"})}catch(__react_docgen_typescript_loader_error){}var common_style=__webpack_require__("../jimu-layouts/lib/column-layout/common/style.ts");const builder_layout_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  bottom: 0;
  top: 0;
  right: 0;
  background: transparent;
`,layout_guideOverlay=jimu_core.AHW`
  ${builder_layout_dropareaStyle};
  z-index: 20;
  pointer-events: none;
`;class layout_Layout extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.state={isDragover:!1},this.handleItemResizeStart=id=>{const{layout}=this.props;this.domRect=this.ref.getBoundingClientRect();const rect=this.ref.querySelector(`div.exb-rnd[data-layoutid="${layout.id}"][data-layoutitemid="${id}"]`).getBoundingClientRect();this.resizingRect=layout_runtime.utils.relativeClientRect(rect,this.domRect)},this.handleItemResizing=()=>null,this.handleItemResizeEnd=(id,x,y,dw,dh,layoutItem)=>{const{layout}=this.props,bbox=layout.content[id].bbox;let width;width=layout_runtime.utils.isPercentage(bbox.width)?`${(100*(this.resizingRect.width+dw)/this.domRect.width).toFixed(4)}%`:`${Math.round(this.resizingRect.width+dw)}px`;const newPos={width,height:Math.round(this.resizingRect.height+dh)};this.childRects=[],this.domRect=null;(0,jimu_for_builder.getAppConfigAction)().editLayoutItemProperty({layoutId:this.props.layout.id,layoutItemId:id},"bbox",newPos).exec()},this.handleDragOver=(draggingItem,draggingElement,containerRect,itemRect)=>{var _a;let rect=itemRect;if(this.canvasPane.clear(),(null===(_a=this.childRects)||void 0===_a?void 0:_a.length)>0){const{insertY,refId}=calInsertPositionForColumn(containerRect,rect,this.childRects);this.referenceId=refId,rect={top:insertY-5+this.ref.scrollTop,width:containerRect.width-10,left:5,height:10}}else rect={top:containerRect.height/2-5,width:containerRect.width-10,left:5,height:10};this.canvasPane.setColor(jimu_core.PLL.rgba(this.builderTheme.sys.color.primary.light,.5)),this.canvasPane.drawRect(rect)},this.handleToggleDragoverEffect=value=>{value&&(this.referenceId=null,this.collectBounds(null)),this.setState({isDragover:value})},this.handleDrop=(draggingItem,containerRect,itemRect)=>{this.canvasPane.clear();const{layout}=this.props;let insertIndex=0;null!=this.referenceId?insertIndex=layout.order.indexOf(this.referenceId):null!=layout.order&&(insertIndex=layout.order.length);common_layout_actions_addItemToLayout((0,jimu_for_builder.getAppConfigAction)().appConfig,draggingItem,layout.id).then((result=>{const{layoutInfo,updatedAppConfig}=result,outAppConfig=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.ColumnLayout).processAfterItemAdded(updatedAppConfig,draggingItem,layoutInfo,{currentSizeMode:null,containerRect,itemRect,insertIndex});layout_runtime.utils.changeLayout(outAppConfig,layoutInfo)})).finally(null),this.referenceId=null,this.childRects=[]}}componentDidMount(){this.canvasPane=new canvas_pane_CanvasPane(this.canvasRef),this.canvasPane.setSize(this.ref.clientWidth,this.ref.clientHeight)}componentDidUpdate(){this.canvasPane.setSize(this.ref.clientWidth,this.ref.clientHeight)}collectBounds(id){const{layout}=this.props;this.childRects=[],this.domRect=this.ref.getBoundingClientRect();const draggableChildren=this.ref.parentNode.querySelectorAll(`div[data-layoutid="${layout.id}"] > .trail-container > div.exb-rnd`);return(null==draggableChildren?void 0:draggableChildren.length)>0&&draggableChildren.forEach((node=>{const itemId=node.getAttribute("data-layoutitemid");if(id!==itemId&&layout.order.includes(itemId)){const rect=layout_runtime.utils.relativeClientRect(node.getBoundingClientRect(),this.domRect);rect.id=itemId,this.childRects.push(rect)}})),this.childRects.sort(((a,b)=>a.top-b.top))}createItem(itemId,index,layoutSetting){const{layout,itemDraggable,itemResizable,itemSelectable,showDefaultTools}=this.props;return(0,jimu_core.Yac)(ColumnItem,{key:itemId,index,space:layoutSetting.space,layoutId:layout.id,layoutItemId:itemId,layoutItem:layout.content[itemId],draggable:itemDraggable,resizable:itemResizable,selectable:itemSelectable,showDefaultTools,onResizeStart:this.handleItemResizeStart,onResizing:this.handleItemResizing,onResizeEnd:this.handleItemResizeEnd})}isEmpty(){var _a;const{layout}=this.props,content=null!==(_a=layout.order)&&void 0!==_a?_a:[];return!(content.length>0&&content.some((id=>!layout.content[id].isPending)))}render(){var _a;const{layout,className}=this.props,content=null!==(_a=layout.order)&&void 0!==_a?_a:[],layoutSetting=Object.assign({},column_layout_default_setting.R,layout.setting),isEmpty=this.isEmpty();return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(pageContext=>{this.builderTheme=pageContext.builderTheme,this.theme=pageContext.theme;const mergedStyle={position:"relative",minWidth:layoutSetting.min},outClass=(0,jimu_core.xWm)("layout column-layout",className),guideVisibleStyle={display:this.state.isDragover?"block":"none"};return(0,jimu_core.Yac)("div",{className:outClass,ref:el=>{this.ref=el},style:mergedStyle,"data-layoutid":layout.id},(0,jimu_core.Yac)(jimu_core.zKZ.Provider,{value:{monitor:!0,layoutId:layout.id}},(0,jimu_core.Yac)(jimu_core._kc,{oid:layout.id,className:"trail-container d-flex flex-column w-100",css:jimu_core.AHW`
                    position: ${isEmpty?"absolute":null};
                    padding: ${jimu_ui.styleUtils.toCSSPadding(layoutSetting.padding)};
                    ${(0,common_style.A)(layoutSetting)};
                  `},(0,jimu_core.Yac)(droparea_hook_DropArea,{css:builder_layout_dropareaStyle,layouts:this.props.layouts,highlightDragover:!0,onDragOver:this.handleDragOver,onDrop:this.handleDrop,onToggleDragoverEffect:this.handleToggleDragoverEffect}),content.map(((layoutItem,index)=>this.createItem(layoutItem,index,layoutSetting))))),isEmpty&&this.props.children,(0,jimu_core.Yac)("canvas",{css:layout_guideOverlay,style:guideVisibleStyle,ref:el=>{this.canvasRef=el}}))}))}}const column_layout_builder_layout=jimu_core.E_S.connect(layout_runtime.utils.mapStateToLayoutProps)(layout_Layout);try{layout.displayName="layout",layout.__docgenInfo={description:"",displayName:"layout",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"ImmutableObjectMixin<SizeModeLayoutJson> & { readonly [x: string]: string; }"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},isInWidget:{defaultValue:null,description:"",name:"isInWidget",required:!1,type:{name:"boolean"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},isPageItem:{defaultValue:null,description:"",name:"isPageItem",required:!1,type:{name:"boolean"}},itemDraggable:{defaultValue:null,description:"",name:"itemDraggable",required:!1,type:{name:"boolean"}},itemResizable:{defaultValue:null,description:"",name:"itemResizable",required:!1,type:{name:"boolean"}},itemSelectable:{defaultValue:null,description:"",name:"itemSelectable",required:!1,type:{name:"boolean"}},droppable:{defaultValue:null,description:"",name:"droppable",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isItemAccepted:{defaultValue:null,description:"",name:"isItemAccepted",required:!1,type:{name:"(item: LayoutItemConstructorProps, isReplacePlaceholder: boolean) => boolean"}},onItemClick:{defaultValue:null,description:"",name:"onItemClick",required:!1,type:{name:"(e: any, widgetId: string) => void"}},ignoreMinHeight:{defaultValue:null,description:"",name:"ignoreMinHeight",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/column-layout/builder/layout.tsx#layout"]={docgenInfo:layout.__docgenInfo,name:"layout",path:"../jimu-layouts/lib/column-layout/builder/layout.tsx#layout"})}catch(__react_docgen_typescript_loader_error){}var row_layout_default_setting=__webpack_require__("../jimu-layouts/lib/row-layout/default-setting.ts"),row_layout_types=__webpack_require__("../jimu-layouts/lib/row-layout/types.ts"),row_layout_utils=__webpack_require__("../jimu-layouts/lib/row-layout/utils.ts"),row_layout_common_util=__webpack_require__("../jimu-layouts/lib/row-layout/common/util.ts");const layout_item_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  max-height: 40px;
  height: 20%;
  right: 0;
  z-index: ${layout_runtime.LayoutZIndex.BoundaryDropArea};
  display: flex;
  pointer-events: all;
  display: flex;

  &.drop-active {
    background: transparent !important;
  }

  body:not(.design-mode) & {
    display: none !important;
  }
`,topDropareaStyle=jimu_core.AHW`
  ${layout_item_dropareaStyle};
  top: 0;
`,bottomDropareaStyle=jimu_core.AHW`
  ${layout_item_dropareaStyle};
  bottom: 0;
`;class RowItem extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.state={isResizing:!1,dh:0},this.handleResizeStart=(id,initW,initH)=>{this.initWidth=initW,this.initHeight=initH,this.props.onResizeStart(id),this.setState({isResizing:!0})},this.handleResizing=(id,x,y,dw,dh)=>{this.props.onResizing(id,x,y,dw,dh),this.setState({dh,isResizing:!0})},this.handleResizeEnd=(id,x,y,dw,dh,shiftKey)=>{const{layoutItem}=this.props;this.props.onResizeEnd(id,x,y,dw,dh,layoutItem),this.setState({isResizing:!1,dh:0})},this.handleDropAtTop=(draggingItem,containerRect,itemRect)=>{this.dropAtBoundary(draggingItem,containerRect,itemRect,"top")},this.handleDropAtBottom=(draggingItem,containerRect,itemRect)=>{this.dropAtBoundary(draggingItem,containerRect,itemRect,"bottom")},this.dropAtBoundary=(draggingItem,containerRect,itemRect,side)=>{let appConfigAction=(0,jimu_for_builder.getAppConfigAction)();(function mergeWidgetsIntoColumn(appConfig,draggingItem,containerRect,itemRect,refLayoutInfo,side){return __awaiter(this,void 0,void 0,(function*(){var _a;let appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig);const layoutItem=appConfig.layouts[refLayoutInfo.layoutId].content[refLayoutInfo.layoutItemId],sizeMode=(0,lib_utils.getCurrentSizeMode)(),cleanRefLayoutItem=layoutItem.without("id").without("type").without("widgetId").without("sectionId").without("screenGroupId"),columnJson=yield appConfigAction.createWidget({uri:"widgets/layout/column/"}),result=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.RowLayout).createBlankItem(appConfigAction.appConfig,refLayoutInfo.layoutId);let updatedAppConfig=result[0];const blankItemId=result[1],originOrder=updatedAppConfig.layouts[refLayoutInfo.layoutId].order;appConfigAction=(0,jimu_for_builder.getAppConfigAction)(updatedAppConfig),appConfigAction.editLayoutProperty(refLayoutInfo.layoutId,"order",[].concat(originOrder,blankItemId));const layoutName=Object.keys(columnJson.layouts)[0],sizemodeLayouts=columnJson.layouts[layoutName],embedLayoutId=layout_runtime.searchUtils.findLayoutId(sizemodeLayouts,sizeMode,appConfigAction.appConfig.mainSizeMode),layoutService=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.ColumnLayout),refLayoutInfo2=appConfigAction.moveLayoutItem(refLayoutInfo,embedLayoutId,sizeMode,sizeMode);updatedAppConfig=layoutService.processAfterItemAdded(appConfigAction.appConfig,draggingItem,refLayoutInfo2,{currentSizeMode:null,containerRect,itemRect,insertIndex:0});const addResult=yield common_layout_actions_addItemToLayout(updatedAppConfig,draggingItem,embedLayoutId);updatedAppConfig=layoutService.processAfterItemAdded(addResult.updatedAppConfig,draggingItem,addResult.layoutInfo,{currentSizeMode:null,containerRect,itemRect,insertIndex:"top"===side?0:1}),appConfigAction=(0,jimu_for_builder.getAppConfigAction)(updatedAppConfig),appConfigAction.editLayoutProperty(refLayoutInfo.layoutId,`content.${refLayoutInfo.layoutItemId}`,cleanRefLayoutItem).editLayoutItemProperty(refLayoutInfo,"id",refLayoutInfo.layoutItemId).editLayoutItemProperty(refLayoutInfo,"type",jimu_core.K6q.Widget).editLayoutItemProperty(refLayoutInfo,"widgetId",columnJson.id).editLayoutItemProperty(refLayoutInfo2,"bbox.height",cleanRefLayoutItem.bbox.height).editWidgetProperty(columnJson.id,`parent.${sizeMode}`,[refLayoutInfo]);let bbox=cleanRefLayoutItem.bbox;const updatedHeight=Math.round(parseFloat(bbox.height)+itemRect.height+20);return bbox=bbox.set("height",`${updatedHeight}px`),appConfigAction.editLayoutItemProperty(refLayoutInfo,"bbox",bbox),appConfigAction.editLayoutProperty(refLayoutInfo.layoutId,"content",appConfigAction.appConfig.layouts[refLayoutInfo.layoutId].content.without(blankItemId)),(null===(_a=draggingItem.layoutInfo)||void 0===_a?void 0:_a.layoutId)===refLayoutInfo.layoutId?appConfigAction.editLayoutProperty(refLayoutInfo.layoutId,"order",originOrder.filter((itemId=>itemId!==draggingItem.layoutInfo.layoutItemId))):appConfigAction.editLayoutProperty(refLayoutInfo.layoutId,"order",originOrder),{updatedAppConfig:appConfigAction.appConfig,layoutInfo:refLayoutInfo}}))})(appConfigAction.appConfig,draggingItem,containerRect,itemRect,{layoutId:this.props.layoutId,layoutItemId:this.props.layoutItemId},side).then((({updatedAppConfig})=>{appConfigAction=(0,jimu_for_builder.getAppConfigAction)(updatedAppConfig),appConfigAction.exec()})).finally(null)},this.fakeTopLayouts=(0,jimu_core.J3Z)({[jimu_core.rHp.Large]:`${this.props.layoutId}_${this.props.layoutItemId}_tlarge`,[jimu_core.rHp.Medium]:`${this.props.layoutId}_${this.props.layoutItemId}_tmedium`,[jimu_core.rHp.Small]:`${this.props.layoutId}_${this.props.layoutItemId}_tsmall`}),this.fakeBottomLayouts=(0,jimu_core.J3Z)({[jimu_core.rHp.Large]:`${this.props.layoutId}_${this.props.layoutItemId}_blarge`,[jimu_core.rHp.Medium]:`${this.props.layoutId}_${this.props.layoutItemId}_bmedium`,[jimu_core.rHp.Small]:`${this.props.layoutId}_${this.props.layoutItemId}_bsmall`})}isFunctionalWidget(){var _a,_b,_c;const{layoutItem}=this.props;if(layoutItem.type===jimu_core.K6q.Widget){let isLayoutWidget=!1;const widget=null===(_b=null===(_a=(0,jimu_core.Vp3)().getState().appConfig)||void 0===_a?void 0:_a.widgets)||void 0===_b?void 0:_b[layoutItem.widgetId];return null!=(null===(_c=null==widget?void 0:widget.manifest)||void 0===_c?void 0:_c.properties)&&(isLayoutWidget=widget.manifest.widgetType===jimu_core.xOw.Layout||widget.manifest.properties.hasEmbeddedLayout),!isLayoutWidget}return!1}getStyle(itemSetting){const{gutter,layoutItem,isMultiRow}=this.props,{dh,isResizing}=this.state,bbox=layoutItem.bbox,sign=layout_runtime.utils.isRTL()?-1:1,mergedStyle=(0,row_layout_utils.lD)(itemSetting,bbox,isMultiRow);return isResizing&&0!==dh&&(mergedStyle.height=this.initHeight+dh),row_layout_common_util.j(isMultiRow,sign,gutter,mergedStyle,itemSetting)}render(){var _a;const{order,span,offset,layoutId,layoutItem,draggable,resizable,selectable}=this.props;if(null==layoutItem||layoutItem.isPending)return null;const itemSetting=jimu_core.CM0.assign({},row_layout_default_setting.i,layoutItem.setting),isRatio=layout_runtime.utils.shouldUseAspectRatio(itemSetting),heightMode=null===(_a=itemSetting.autoProps)||void 0===_a?void 0:_a.height,mergedClass=(0,jimu_core.xWm)("row-layout-item d-flex",`col-${span}`,`offset-${offset}`,`order-${order}`,{"fix-height":heightMode===layout_runtime.LayoutItemSizeModes.Custom}),canDropAtBoundary=this.isFunctionalWidget(),highlightStyle=jimu_core.AHW`
      width: 100%;
      height: 10px;
      background: ${jimu_core.PLL.rgba(this.props.builderTheme.sys.color.primary.light,.5)};
    `,ratio=layout_runtime.utils.parseAspectRatio(itemSetting.aspectRatio),oneByOneAnimationProps=layout_runtime.utils.handleOnebyOneAnimation(this.props),[cssStyle,transform]=this.getStyle(itemSetting);return(0,jimu_core.Yac)(LayoutItemInBuilder,Object.assign({css:cssStyle,style:{transform},layoutId,layoutItemId:layoutItem.id,onResizeStart:this.handleResizeStart,onResizing:this.handleResizing,onResizeEnd:this.handleResizeEnd,left:!0,right:!0,top:!1,bottom:heightMode===layout_runtime.LayoutItemSizeModes.Custom&&!isRatio,draggable,resizable,selectable,onClick:this.props.onClick,className:mergedClass,forceAspectRatio:isRatio,aspectRatio:ratio,autoHeight:heightMode===layout_runtime.LayoutItemSizeModes.Auto},oneByOneAnimationProps),(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,canDropAtBoundary&&(0,jimu_core.Yac)(droparea_hook_DropArea,{css:jimu_core.AHW`
                ${topDropareaStyle};
              `,layouts:this.fakeTopLayouts,highlightDragover:!0,onDrop:this.handleDropAtTop},(0,jimu_core.Yac)("div",{css:highlightStyle})),canDropAtBoundary&&(0,jimu_core.Yac)(droparea_hook_DropArea,{css:jimu_core.AHW`
                ${bottomDropareaStyle};
              `,layouts:this.fakeBottomLayouts,highlightDragover:!0,onDrop:this.handleDropAtBottom},(0,jimu_core.Yac)("div",{css:jimu_core.AHW`${highlightStyle};position: absolute; bottom:0;`}))))}}try{layoutitem.displayName="layoutitem",layoutitem.__docgenInfo={description:"",displayName:"layoutitem",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},isMultiRow:{defaultValue:null,description:"",name:"isMultiRow",required:!0,type:{name:"boolean"}},offset:{defaultValue:null,description:"",name:"offset",required:!0,type:{name:"number"}},span:{defaultValue:null,description:"",name:"span",required:!0,type:{name:"number"}},order:{defaultValue:null,description:"",name:"order",required:!0,type:{name:"number"}},gutter:{defaultValue:null,description:"",name:"gutter",required:!0,type:{name:"number"}},alignItems:{defaultValue:null,description:"",name:"alignItems",required:!1,type:{name:"string"}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"IMThemeVariables"}},onResizeStart:{defaultValue:null,description:"",name:"onResizeStart",required:!0,type:{name:"(id: string) => void"}},onResizing:{defaultValue:null,description:"",name:"onResizing",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number) => void"}},onResizeEnd:{defaultValue:null,description:"",name:"onResizeEnd",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number, layoutItem: LayoutItemJson | IMLayoutItemJson) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/row-layout/builder/layout-item.tsx#layoutitem"]={docgenInfo:layoutitem.__docgenInfo,name:"layoutitem",path:"../jimu-layouts/lib/row-layout/builder/layout-item.tsx#layoutitem"})}catch(__react_docgen_typescript_loader_error){}function indexOfChildRect(id,rects){let index=-1;return rects.some(((item,idx)=>item.id===id&&(index=idx,!0))),index}function resizeItem(id,dx,dw,allRects){const rects=allRects.map((item=>(0,jimu_core.J3Z)(item))),index=indexOfChildRect(id,rects);if(layout_runtime.utils.isRTL()&&(dx=0!==dx?0:-dw),dx>0){const target=rects[index],delta=Math.min(dx,target.width-1);return rects[index]=target.set("left",target.left+delta).set("width",target.width-delta),rects}if(dx<0){let previousSize=0;for(let i=0;i<index;i+=1)previousSize+=Math.min(rects[i].width,row_layout_types.A);const totalAvailable=rects[index].left-previousSize,toExpand=Math.abs(dx);if(totalAvailable>0){let expanded=0;for(let i=index;i>=0;i-=1){const current=rects[i];let gap=0;if(i>0){const previous=rects[i-1];gap=current.left-(previous.left+previous.width)}else gap=current.left;if(0===gap)continue;const toMove=expanded+gap>=toExpand?toExpand-expanded:gap;rects[index]=rects[index].set("width",rects[index].width+toMove);for(let j=i;j<=index;j+=1)rects[j]=rects[j].set("left",rects[j].left-toMove);if(expanded+gap>=toExpand)return rects;expanded+=gap}if(index>0)for(let i=index-1;i>=0;i-=1){const current=rects[i],gap=current.width-row_layout_types.A;if(gap<=0)continue;const toMove=expanded+gap>=toExpand?toExpand-expanded:gap;rects[index]=rects[index].set("width",rects[index].width+toMove),rects[i]=current.set("width",current.width-toMove);for(let j=i+1;j<=index;j+=1)rects[j]=rects[j].set("left",rects[j].left-toMove);if(expanded+gap>=toExpand)return rects;expanded+=gap}}return rects}if(dw<0){const delta=Math.min(Math.abs(dw),rects[index].width-1);return rects[index]=rects[index].set("width",rects[index].width-delta),rects}if(dw>0){let nextSize=0;for(let i=index+1;i<rects.length;i+=1)nextSize+=Math.min(rects[i].width,row_layout_types.A);const toExpand=dw;if(row_layout_types.$-(rects[index].left+rects[index].width)-nextSize>0){let expanded=0;for(let i=index;i<rects.length;i+=1){const current=rects[i];let gap=0;if(i!==rects.length-1){gap=rects[i+1].left-(current.left+current.width)}else gap=row_layout_types.$-(current.left+current.width);if(0===gap)continue;const toMove=expanded+gap>=toExpand?toExpand-expanded:gap;rects[index]=rects[index].set("width",rects[index].width+toMove);for(let j=index+1;j<=i;j+=1)rects[j]=rects[j].set("left",rects[j].left+toMove);if(expanded+gap>=toExpand)return rects;expanded+=gap}if(index!==rects.length-1)for(let i=index+1;i<rects.length;i+=1){const current=rects[i],gap=current.width-row_layout_types.A;if(gap<=0)continue;const toMove=expanded+gap>=toExpand?toExpand-expanded:gap;rects[index]=rects[index].set("width",rects[index].width+toMove),rects[i]=current.set("width",current.width-toMove);for(let j=index+1;j<=i;j+=1)rects[j]=rects[j].set("left",rects[j].left+toMove);if(expanded+gap>=toExpand)return rects;expanded+=gap}}return rects}return rects}function moveItem(id,x,allRects){const rects=allRects.map((item=>(0,jimu_core.J3Z)(item))),index=indexOfChildRect(id,rects),target=rects[index];return rects.splice(index,1),insertItem(target,x,rects)}function insertItem(rect,pos,allRects){const rects=allRects.map((item=>(0,jimu_core.J3Z)(item)));let target=(0,jimu_core.J3Z)(rect);const x=Math.max(pos,0);if(target=target.set("left",x),null==rects||0===rects.length)return target=target.set("width",Math.min(target.width,row_layout_types.$-target.left)),[target];let end,insertIndex=rects.length;const checkpoint=()=>{if(0===insertIndex)used=rects[insertIndex].left,end=used;else{const previous=rects[insertIndex-1];used=insertIndex<rects.length?rects[insertIndex].left-(previous.left+previous.width):row_layout_types.$-(previous.left+previous.width),end=previous.left+previous.width+used}};rects.some(((r,index)=>x<=r.left&&(insertIndex=index,!0)));let used=insertIndex<rects.length?rects[insertIndex].left-x:row_layout_types.$-x;if(used>=target.width)return rects.splice(insertIndex,0,target),rects;const oldUsed=used;if(checkpoint(),used>=target.width)return target=target.set("left",end-target.width),rects.splice(insertIndex,0,target),rects;used=oldUsed;for(let i=insertIndex;i<rects.length;i+=1){const current=rects[i];let gap=0;if(i!==rects.length-1){gap=rects[i+1].left-(current.left+current.width)}else gap=row_layout_types.$-(current.left+current.width);if(0===gap)continue;const toMove=used+gap>=target.width?target.width-used:gap;for(let j=insertIndex;j<=i;j+=1)rects[j]=rects[j].set("left",rects[j].left+toMove);if(used+gap>=target.width)return rects.splice(insertIndex,0,target),rects;used+=gap}if(checkpoint(),used>=target.width)return target=target.set("left",end-target.width),rects.splice(insertIndex,0,target),rects;for(let i=insertIndex-1;i>=0;i-=1){const current=rects[i];let gap=0;if(i>0){const previous=rects[i-1];gap=current.left-(previous.left+previous.width)}else gap=current.left;if(0===gap)continue;const toMove=used+gap>=target.width?target.width-used:gap;for(let j=i;j<=insertIndex-1;j+=1)rects[j]=rects[j].set("left",rects[j].left-toMove);if(used+gap>=target.width)return target=target.set("left",end-target.width),rects.splice(insertIndex,0,target),rects;used+=gap}if(checkpoint(),used>=row_layout_types.A)return target=target.set("left",end-used).set("width",used),rects.splice(insertIndex,0,target),rects;if(insertIndex!==rects.length)for(let i=insertIndex;i<rects.length;i+=1){const current=rects[i],gap=current.width-row_layout_types.A;if(gap<=0)continue;const toMove=used+gap>=row_layout_types.A?row_layout_types.A-used:gap;rects[i]=current.set("width",current.width-toMove);for(let j=insertIndex;j<=i;j+=1)rects[j]=rects[j].set("left",rects[j].left+toMove);if(used+gap>=row_layout_types.A)return target=target.set("left",rects[insertIndex].left-row_layout_types.A).set("width",row_layout_types.A),rects.splice(insertIndex,0,target),rects;used+=gap}if(checkpoint(),used>=row_layout_types.A)return target=target.set("left",end-used).set("width",used),rects.splice(insertIndex,0,target),rects;for(let i=insertIndex-1;i>=0;i-=1){const current=rects[i],gap=current.width-row_layout_types.A;if(gap<=0)continue;const toMove=used+gap>=row_layout_types.A?row_layout_types.A-used:gap;rects[i]=current.set("width",current.width-toMove);for(let j=i+1;j<=insertIndex-1;j+=1)rects[j]=rects[j].set("left",rects[j].left-toMove);if(used+gap>=row_layout_types.A)return target=target.set("left",end-row_layout_types.A).set("width",row_layout_types.A),rects.splice(insertIndex,0,target),rects;used+=gap}return rects}function ColumnHint(props){const{builderTheme,visible,gutter=0}=props;return(0,jimu_core.Yac)("div",{css:jimu_core.AHW`
        pointer-events: none;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0px;
        position: absolute;
        z-index: 1;
        display: ${visible?"flex":"none"};
      `},[0,1,2,3,4,5,6,7,8,9,10,11].map((key=>(0,jimu_core.Yac)("div",{key,css:jimu_core.AHW`
              width: 8.333333%;
            `},(0,jimu_core.Yac)("div",{css:jimu_core.AHW`
                padding-left: ${gutter/2}px;
                padding-right: ${gutter/2}px;
                height: 100%;
                width: 100%;
                overflow: hidden;
              `},(0,jimu_core.Yac)("div",{css:jimu_core.AHW`
                  transform: translateY(-5%);
                  border: 1px dashed ${jimu_core.PLL.rgba(builderTheme.ref.palette.neutral[900],.6)};
                  height: 110%;
                  width: 100%;
                `}))))))}try{ColumnHint.displayName="ColumnHint",ColumnHint.__docgenInfo={description:"",displayName:"ColumnHint",props:{builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"IMThemeVariables"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},gutter:{defaultValue:null,description:"",name:"gutter",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/row-layout/builder/column-hint.tsx#ColumnHint"]={docgenInfo:ColumnHint.__docgenInfo,name:"ColumnHint",path:"../jimu-layouts/lib/row-layout/builder/column-hint.tsx#ColumnHint"})}catch(__react_docgen_typescript_loader_error){}const row_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
`,row_guideOverlay=jimu_core.AHW`
  ${row_dropareaStyle};
  bottom: 0;
  top: 0;
  z-index: ${layout_runtime.LayoutZIndex.DragMoveTip};
  pointer-events: none;
`;class Row extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.state={isResizing:!1,updatingRects:null,isDragoverCenter:!1},this.handleItemResizeStart=id=>{this.domRect=this.ref.getBoundingClientRect(),this.setState({isResizing:!0})},this.handleItemResizing=(id,x,y,dw,dh)=>{const colWidth=this.domRect.width/row_layout_types.$,resizingRects=resizeItem(id,Math.round(x/colWidth),Math.round(dw/colWidth),this.childRects);this.setState({updatingRects:resizingRects})},this.handleItemResizeEnd=(id,x,y,dw,dh,layoutItem)=>{const{layout}=this.props,colWidth=this.domRect.width/row_layout_types.$,deltaX=Math.round(x/colWidth),deltaW=Math.round(dw/colWidth),appConfigAction=(0,jimu_for_builder.getAppConfigAction)();resizeItem(id,deltaX,deltaW,this.childRects).forEach((rectItem=>{const bbox=layout.content[rectItem.id].bbox;let updatedHeight=bbox.height;rectItem.id===id&&(updatedHeight=layout_runtime.utils.isPercentage(bbox.height)?`${(parseFloat(rectItem.height)+100*dh/this.domRect.height).toFixed(4)}%`:`${Math.round(parseFloat(rectItem.height)+dh)}px`);const rect={left:rectItem.left,width:rectItem.width,height:updatedHeight};appConfigAction.editLayoutItemProperty({layoutId:layout.id,layoutItemId:rectItem.id},"bbox",rect)})),appConfigAction.exec(),this.setState({isResizing:!1,updatingRects:null})},this.handleToggleDragoverCenterEffect=value=>{this.referenceId=null,value&&this.collectBounds(),this.setState({isDragoverCenter:value})},this.handleDragOver=(draggingItem,draggingElement,containerRect,itemRect,clientX,clientY)=>{var _a;const layoutInfo=null!==(_a=draggingItem.layoutInfo)&&void 0!==_a?_a:{layoutId:null},updatedRects=this.reCalculateRects(draggingItem,containerRect,itemRect,clientX);let targetRect;updatedRects.some((childRect=>(null==childRect.id||childRect.layoutId===layoutInfo.layoutId&&childRect.id===layoutInfo.layoutItemId)&&(targetRect=childRect,!0)));let available=!0,insertPos=targetRect.left;if(this.flippedChildRects.some((childRect=>{if(childRect.layoutId===targetRect.layoutId&&childRect.id===targetRect.id)return!1;if(childRect.left<=targetRect.left&&childRect.left+childRect.width>targetRect.left&&(available=!1),!available){const updatedChildRect=updatedRects.find((item=>item.layoutId===childRect.layoutId&&item.id===childRect.id));return insertPos=updatedChildRect.left+updatedChildRect.width<=targetRect.left?childRect.left+childRect.width:childRect.left,!0}return!1})),this.dragInsertPos=insertPos,this.canvasPane.clear(),available)this.canvasPane.drawRect({left:insertPos*this.colWidth+this.space/2,top:0,width:targetRect.width*this.colWidth-this.space,height:itemRect.height});else{const restrainedInsertPos=Math.min(containerRect.width-this.space/2,Math.max(0,insertPos*this.colWidth-this.space/2));this.canvasPane.drawRect({left:restrainedInsertPos,top:0,width:10,height:containerRect.height})}},this.handleDragEnter=()=>{this.canvasPane.setSize(this.ref.clientWidth,this.ref.clientHeight),this.canvasPane.setColor(jimu_core.PLL.rgba(this.builderTheme.sys.color.primary.light,.5))},this.handleDragLeave=()=>{this.canvasPane.clear()},this.handleDrop=(draggingItem,containerRect,itemRect)=>{const{layout}=this.props,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),{addedItemRect,insertIndex,appConfig}=this.calDropPosition(appConfigAction.appConfig,draggingItem,containerRect,itemRect,!1);null!=addedItemRect?common_layout_actions_addItemToLayout(appConfig,draggingItem,layout.id).then((result=>{const{layoutInfo,updatedAppConfig}=result,outAppConfig=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.RowLayout).processAfterItemAdded(updatedAppConfig,draggingItem,layoutInfo,{currentSizeMode:null,containerRect,itemRect:addedItemRect,insertIndex});layout_runtime.utils.changeLayout(outAppConfig,layoutInfo)})).finally(null):layout_runtime.utils.changeLayout(appConfig,draggingItem.layoutInfo),this.canvasPane.clear()},this.flipLeftRight=layout_runtime.utils.isRTL()}componentDidMount(){this.canvasPane=new canvas_pane_CanvasPane(this.guideDragOverRef)}getConfig(){var _a;const{layout}=this.props;return null!==(_a=layout.setting)&&void 0!==_a?_a:row_layout_default_setting.r}reCalculateRects(draggingItem,containerRect,itemRect,clientX){var _a,_b;const layoutInfo=null!==(_a=draggingItem.layoutInfo)&&void 0!==_a?_a:{layoutId:null},{layout}=this.props,config=this.getConfig();this.space=null!==(_b=config.space)&&void 0!==_b?_b:0;const rowWidth=this.maxPageWidth>0?Math.min(this.maxPageWidth,containerRect.width):containerRect.width,cursorLeft=clientX-(containerRect.width-rowWidth)/2,itemLeft=itemRect.left-(containerRect.width-rowWidth)/2;this.colWidth=rowWidth/row_layout_types.$;const cursorLeftInRow1=Math.round(cursorLeft/this.colWidth),itemLeftInRow=Math.round(itemLeft/this.colWidth),span=Math.max(1,Math.ceil(itemRect.width/this.colWidth)),cursorLeftInRow=function snapLeft(droppableLayoutId,draggingItem,itemLeft,itemWidth,value,allRects){var _a;let left;const layoutInfo=null!==(_a=draggingItem.layoutInfo)&&void 0!==_a?_a:{layoutId:null},sameLayout=layoutInfo.layoutId===droppableLayoutId;return allRects.some((cItem=>(!sameLayout||cItem.id!==layoutInfo.layoutItemId)&&(cItem.left>=itemLeft&&cItem.left<itemLeft+itemWidth||itemLeft>=cItem.left&&itemLeft<cItem.left+cItem.width)))?(allRects.some(((cItem,index)=>{if(sameLayout&&cItem.id===layoutInfo.layoutItemId)return!1;if(value>=cItem.left&&value<=cItem.left+cItem.width)return value>=cItem.left&&value<cItem.left+cItem.width/2?(left=cItem.left,!0):(left=cItem.left+cItem.width,!0);if(itemLeft<cItem.left&&itemLeft+itemWidth>cItem.left){let available=0;if(0===index)available=cItem.left;else{let previousItem;for(let j=index-1;j>=0&&(previousItem=allRects[j],sameLayout&&previousItem.id===layoutInfo.layoutItemId);j-=1);available=null!=previousItem?cItem.left-(previousItem.left+previousItem.width):cItem.left}return left=available>=itemWidth?cItem.left-itemWidth:cItem.left-available,!0}return itemLeft>cItem.left&&itemLeft<cItem.left+cItem.width&&(left=cItem.left+cItem.width,!0)})),left):itemLeft}(layout.id,draggingItem,itemLeftInRow,span,cursorLeftInRow1,this.flippedChildRects);return null==draggingItem.id&&this.isInRow(layoutInfo)?moveItem(layoutInfo.layoutItemId,cursorLeftInRow,this.flippedChildRects):insertItem({width:span,height:itemRect.height,layoutId:layoutInfo.layoutId,id:layoutInfo.layoutItemId},cursorLeftInRow,this.flippedChildRects)}calDropPosition(appConfig,draggingItem,containerRect,itemRect,isPaste){var _a;const rowWidth=this.maxPageWidth>0?Math.min(this.maxPageWidth,containerRect.width):containerRect.width,layoutInfo=null!==(_a=draggingItem.layoutInfo)&&void 0!==_a?_a:{layoutId:null},{layout}=this.props,colWidth=rowWidth/row_layout_types.$,cursorLeftInRow=this.dragInsertPos,span=Math.max(1,Math.ceil(itemRect.width/colWidth)),appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig);let updatedRects,addedItemRect,insertIndex;return updatedRects=!isPaste&&null==draggingItem.id&&this.isInRow(layoutInfo)?moveItem(layoutInfo.layoutItemId,cursorLeftInRow,this.flippedChildRects):insertItem({width:span,height:itemRect.height,layoutId:layoutInfo.layoutId,id:layoutInfo.layoutItemId},cursorLeftInRow,this.flippedChildRects),updatedRects.forEach(((rectItem,index)=>{var _a;let rect={left:rectItem.left,width:rectItem.width,height:rectItem.height};if(this.flipLeftRight&&(rect=(0,row_layout_utils.Js)(rect)),rectItem.layoutId===layout.id)appConfigAction.editLayoutItemProperty({layoutId:rectItem.layoutId,layoutItemId:rectItem.id},"bbox",rect),rectItem.id===(null===(_a=draggingItem.layoutInfo)||void 0===_a?void 0:_a.layoutItemId)&&null!=draggingItem.id&&appConfigAction.setLayoutItemToPending({layoutId:rectItem.layoutId,layoutItemId:rectItem.id},!1);else{addedItemRect=rect,insertIndex=0+index}})),{addedItemRect,insertIndex,appConfig:appConfigAction.appConfig}}isInRow(layoutInfo){const{layout}=this.props;return(null==layoutInfo?void 0:layoutInfo.layoutId)===layout.id}collectBounds(){var _a;const{transformedLayout}=this.props,content=null!==(_a=transformedLayout.order)&&void 0!==_a?_a:[];return this.childRects=[],content.forEach((itemId=>{var _a,_b;if(transformedLayout.content[itemId].isPending)return;const bbox=null===(_b=null===(_a=transformedLayout.content)||void 0===_a?void 0:_a[itemId])||void 0===_b?void 0:_b.bbox;null!=bbox&&this.childRects.push({layoutId:transformedLayout.id,id:itemId,left:parseInt(bbox.left,10),width:parseInt(bbox.width,10),height:bbox.height})})),this.childRects.sort(((a,b)=>a.left-b.left)),this.flipLeftRight?(this.flippedChildRects=[],this.childRects.forEach((item=>{let rect={left:item.left,width:item.width,height:item.height};rect=(0,row_layout_utils.Js)(rect),this.flippedChildRects.push({layoutId:item.layoutId,id:item.id,left:rect.left,width:rect.width,height:rect.height})})),this.flippedChildRects.sort(((a,b)=>a.left-b.left))):this.flippedChildRects=this.childRects,this.childRects}createItem(childRects,index){var _a;const{transformedLayout,itemDraggable,itemResizable,itemSelectable,isMultiRow}=this.props,config=this.getConfig(),childRect=childRects[index],gutter=null!==(_a=config.space)&&void 0!==_a?_a:0;let offset;if(0===index)offset=childRect.left;else{const previousBBox=childRects[index-1];offset=childRect.left-previousBBox.left-previousBBox.width}return(0,jimu_core.Yac)(RowItem,{key:`${childRect.layoutId}_${childRect.id}`,order:index+1,offset,span:childRect.width,gutter,isMultiRow,builderTheme:this.builderTheme,layoutId:transformedLayout.id,layoutItemId:childRect.id,layoutItem:transformedLayout.content[childRect.id],draggable:itemDraggable,resizable:itemResizable,selectable:itemSelectable,onResizeStart:this.handleItemResizeStart,onResizing:this.handleItemResizing,onResizeEnd:this.handleItemResizeEnd})}render(){var _a;const{transformedLayout,className}=this.props,{isResizing,isDragoverCenter}=this.state,config=this.getConfig(),isDragover=isDragoverCenter;let content;isResizing&&null!=this.state.updatingRects?content=this.state.updatingRects:(this.collectBounds(),content=this.childRects);const gutter=null!==(_a=config.space)&&void 0!==_a?_a:0;return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(props=>(this.maxPageWidth=props.maxWidth,this.builderTheme=props.builderTheme,(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("row-layout",className,{"row-rtl":this.flipLeftRight}),css:row_layout_utils.z$,"data-layoutid":transformedLayout.id},(0,jimu_core.Yac)("div",{css:jimu_core.AHW`
                width: 100%;
                max-width: ${props.maxWidth>0?`${props.maxWidth}px`:"none"};
              `},(0,jimu_core.Yac)("div",{ref:el=>{this.ref=el},css:jimu_core.AHW`
                    position: relative;
                    height: 100%;
                    margin-left: ${-gutter/2}px;
                    margin-right: ${-gutter/2}px;
                    display: flex;
                    flex-direction: column;
                    .row {
                      overflow: ${this.props.isMultiRow?"auto":"unset"};
                    }
                    & > .jimu-widget-placeholder {
                      width: calc(100% - ${gutter}px);
                      align-self: center;
                    }
                  `},(0,jimu_core.Yac)(jimu_core.zKZ.Provider,{value:{monitor:!1}},(0,jimu_core.Yac)(jimu_core._kc,{className:(0,jimu_core.xWm)("row m-0",{"flex-nowrap":!this.props.isMultiRow,"h-100":content.length>0}),oid:transformedLayout.id,"data-layoutid":transformedLayout.id},(0,jimu_core.Yac)(droparea_hook_DropArea,{css:row_dropareaStyle,layouts:this.props.layouts,highlightDragover:!1,onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDragOver:this.handleDragOver,onDrop:this.handleDrop,onToggleDragoverEffect:this.handleToggleDragoverCenterEffect}),content.map(((_,index)=>this.createItem(content,index))))),0===content.length&&this.props.children,(0,jimu_core.Yac)(ColumnHint,{visible:isDragover||isResizing,builderTheme:props.builderTheme,gutter}),(0,jimu_core.Yac)("canvas",{css:jimu_core.AHW`
                      ${row_guideOverlay};
                      display: ${isDragover?"block":"none"};
                    `,ref:el=>{this.guideDragOverRef=el}})))))))}}try{Row.displayName="Row",Row.__docgenInfo={description:"",displayName:"Row",props:{layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"IMSizeModeLayoutJson"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},isInWidget:{defaultValue:null,description:"",name:"isInWidget",required:!1,type:{name:"boolean"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},isPageItem:{defaultValue:null,description:"",name:"isPageItem",required:!1,type:{name:"boolean"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},itemDraggable:{defaultValue:null,description:"",name:"itemDraggable",required:!1,type:{name:"boolean"}},itemResizable:{defaultValue:null,description:"",name:"itemResizable",required:!1,type:{name:"boolean"}},itemSelectable:{defaultValue:null,description:"",name:"itemSelectable",required:!1,type:{name:"boolean"}},droppable:{defaultValue:null,description:"",name:"droppable",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isItemAccepted:{defaultValue:null,description:"",name:"isItemAccepted",required:!1,type:{name:"(item: LayoutItemConstructorProps, isReplacePlaceholder: boolean) => boolean"}},onItemClick:{defaultValue:null,description:"",name:"onItemClick",required:!1,type:{name:"(e: any, widgetId: string) => void"}},ignoreMinHeight:{defaultValue:null,description:"",name:"ignoreMinHeight",required:!1,type:{name:"boolean"}},layout:{defaultValue:null,description:"",name:"layout",required:!0,type:{name:"IMLayoutJson"}},transformedLayout:{defaultValue:null,description:"",name:"transformedLayout",required:!0,type:{name:"IMLayoutJson"}},isMultiRow:{defaultValue:null,description:"",name:"isMultiRow",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/row-layout/builder/row.tsx#Row"]={docgenInfo:Row.__docgenInfo,name:"Row",path:"../jimu-layouts/lib/row-layout/builder/row.tsx#Row"})}catch(__react_docgen_typescript_loader_error){}class RowLayout extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.layoutConRef=jimu_core.q_G.createRef(),this.onResize=({width,height})=>{var _a;if(this.props.browserSizeMode!==this.props.mainSizeMode)return;if(0===height)return;const{widgetId}=this.props;null!=(null===(_a=window.runtimeInfo.widgets)||void 0===_a?void 0:_a[widgetId])?window.runtimeInfo.widgets[widgetId].height=height:window.runtimeInfo.widgets[widgetId]={height}},this.handleDebounceResize=jimu_core.CM0.debounce(this.onResize,200)}findExtension(){const exts=jimu_core.nH3.getInstance().getExtensions(`${jimu_core.vZE.R6.LayoutTransformer}`);if((null==exts?void 0:exts.length)>0){const ext=exts.find((item=>"ROW"===item.layoutType));this.layoutTransform=null==ext?void 0:ext.transformLayout}}collectRowItems(){var _a;const{layout,layouts,browserSizeMode,mainSizeMode}=this.props;null==this.layoutTransform&&this.findExtension();let targetLayout=layout;layouts[browserSizeMode]!==layout.id&&null!=this.layoutTransform&&(targetLayout=this.layoutTransform(layout,mainSizeMode,browserSizeMode,layout_runtime.utils.getAppConfig())),this.finalLayout=targetLayout;const content=null!==(_a=targetLayout.order)&&void 0!==_a?_a:[],rows=[];let row=[],rowIndex=0;return rows.push(row),content.forEach((itemId=>{if(targetLayout.content[itemId].isPending)return;const bbox=targetLayout.content[itemId].bbox,left=parseInt(bbox.left,10),rowNum=Math.floor(left/row_layout_types.$);rowNum>rowIndex&&(row=[],rowIndex=rowNum,rows.push(row)),row.push(itemId)})),rows}createRow(){const{layout,layouts}=this.props;return(0,jimu_core.Yac)(Row,{layouts,layout,transformedLayout:this.finalLayout,isMultiRow:this.numOfRows>1},this.props.children)}render(){var _a,_b;const{layout,className}=this.props,style=null!==(_b=(null!==(_a=layout.setting)&&void 0!==_a?_a:row_layout_default_setting.r).style)&&void 0!==_b?_b:row_layout_default_setting.r.style;return this.numOfRows=this.collectRowItems().length,(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("layout d-flex",className),css:jimu_core.AHW`
          width: 100%;
          padding: ${jimu_ui.styleUtils.toCSSPadding(style.padding)};
        `,"data-layoutid":layout.id,ref:this.layoutConRef},this.createRow(),(0,jimu_core.Yac)(jimu_core.cQZ,{targetRef:this.layoutConRef,handleHeight:!0,onResize:this.handleDebounceResize}))}}const row_layout_builder_layout=jimu_core.E_S.connect(layout_runtime.utils.mapStateToLayoutProps)(RowLayout);try{layout.displayName="layout",layout.__docgenInfo={description:"",displayName:"layout",props:{layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"IMSizeModeLayoutJson"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},isInWidget:{defaultValue:null,description:"",name:"isInWidget",required:!1,type:{name:"boolean"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},isPageItem:{defaultValue:null,description:"",name:"isPageItem",required:!1,type:{name:"boolean"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},itemDraggable:{defaultValue:null,description:"",name:"itemDraggable",required:!1,type:{name:"boolean"}},itemResizable:{defaultValue:null,description:"",name:"itemResizable",required:!1,type:{name:"boolean"}},itemSelectable:{defaultValue:null,description:"",name:"itemSelectable",required:!1,type:{name:"boolean"}},droppable:{defaultValue:null,description:"",name:"droppable",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isItemAccepted:{defaultValue:null,description:"",name:"isItemAccepted",required:!1,type:{name:"(item: LayoutItemConstructorProps, isReplacePlaceholder: boolean) => boolean"}},onItemClick:{defaultValue:null,description:"",name:"onItemClick",required:!1,type:{name:"(e: any, widgetId: string) => void"}},ignoreMinHeight:{defaultValue:null,description:"",name:"ignoreMinHeight",required:!1,type:{name:"boolean"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!0,type:{name:"string"}},parentLayoutId:{defaultValue:null,description:"",name:"parentLayoutId",required:!1,type:{name:"string"}},parentLayoutItemId:{defaultValue:null,description:"",name:"parentLayoutItemId",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/row-layout/builder/layout.tsx#layout"]={docgenInfo:layout.__docgenInfo,name:"layout",path:"../jimu-layouts/lib/row-layout/builder/layout.tsx#layout"})}catch(__react_docgen_typescript_loader_error){}var SideType;!function(SideType){SideType.Top="top",SideType.Bottom="bottom",SideType.Left="left",SideType.Right="right",SideType.Center="center"}(SideType||(SideType={}));var common_utils=__webpack_require__("../jimu-layouts/lib/grid-layout/common/utils.ts");function createEmptyGridItem(layout,type){const outItem={id:`${layout_runtime.utils.getMaximumId(layout)+1}`,gridType:type};return{outLayout:layout.setIn(["content",outItem.id],outItem),outItem}}function updateSize(layout,itemId,size){return layout.setIn(["content",itemId,"bbox"],{width:size})}function updateGridItem(layout,itemId,propName,value){return layout.setIn(["content",itemId,propName],value)}function addChild(layout,itemIdToAdd,targetItemId,index,insertBefore){const targetLayoutItem=(0,common_utils.a2)(layout,targetItemId),items=[].concat(targetLayoutItem.children),position=insertBefore?index:index+1;return items.splice(position,0,itemIdToAdd),updateGridItem(layout,targetItemId,"children",items)}function mergeIntoANewGroup(layout,source,target,type,beforeTarget,shareSpace){const targetLayoutItem=(0,common_utils.a2)(layout,target),{parent}=targetLayoutItem,size=+targetLayoutItem.bbox.width,parentLayoutItem=(0,common_utils.a2)(layout,parent),r=createEmptyGridItem(layout,type);let outLayout=r.outLayout;const group=r.outItem;if(outLayout=updateGridItem(outLayout,group.id,"parent",parent),outLayout=updateSize(outLayout,group.id,size),parentLayoutItem){const index=parentLayoutItem.children.indexOf(target);outLayout=function replaceChild(layout,itemIdToAdd,targetItemId,index){const items=[...(0,common_utils.a2)(layout,targetItemId).children];return items.splice(index,1,itemIdToAdd),updateGridItem(layout,targetItemId,"children",items)}(outLayout,group.id,parent,index)}return outLayout=updateGridItem(outLayout,source,"parent",group.id),outLayout=updateGridItem(outLayout,target,"parent",group.id),outLayout=updateSize(outLayout,source,shareSpace?100:50),outLayout=updateSize(outLayout,target,shareSpace?100:50),outLayout=updateGridItem(outLayout,group.id,"children",beforeTarget?[source,target]:[target,source]),type===jimu_core.Qwn.Tab&&(outLayout=updateGridItem(outLayout,group.id,"activeTab",1)),target===outLayout.setting.rootItem&&(outLayout=outLayout.setIn(["setting","rootItem"],group.id)),outLayout}function attach(layout,source,target,type,beforeTarget,shareSpace){const sourceLayoutItem=(0,common_utils.a2)(layout,source),{gridType:sourceType}=sourceLayoutItem;switch(sourceType){case jimu_core.Qwn.Column:case jimu_core.Qwn.Row:return function attachColumnOrRow(layout,sourceItem,target,type,beforeTarget,shareSpace){const sourceType=sourceItem.gridType,targetLayoutItem=(0,common_utils.a2)(layout,target),{parent}=targetLayoutItem,size=+targetLayoutItem.bbox.width,parentLayoutItem=(0,common_utils.a2)(layout,parent);let outLayout=layout;if((null==parentLayoutItem?void 0:parentLayoutItem.gridType)===type){const index=parentLayoutItem.children.indexOf(target);if(sourceType===type){const sourceContent=sourceItem.children,parentContent=[...parentLayoutItem.children];beforeTarget?parentContent.splice(index,0,...sourceContent):parentContent.splice(index+1,0,...sourceContent),outLayout=updateGridItem(outLayout,parent,"children",parentContent),outLayout=outLayout.set("content",outLayout.content.without(sourceItem.id)),sourceContent.forEach((childId=>{const childSize=+outLayout.content[childId].bbox.width;outLayout=updateSize(outLayout,childId,childSize*size/200),outLayout=updateGridItem(outLayout,childId,"parent",parent)})),outLayout=updateSize(outLayout,target,size/2)}else outLayout=addChild(outLayout,sourceItem.id,parent,index,beforeTarget),outLayout=updateGridItem(outLayout,sourceItem.id,"parent",parent),outLayout=updateSize(outLayout,sourceItem.id,shareSpace?100:size/2),outLayout=updateSize(outLayout,target,shareSpace?100:size/2),type===jimu_core.Qwn.Tab&&(outLayout=updateGridItem(outLayout,parent,"activeTab",index+1));return outLayout}if(sourceType===type){const index=parentLayoutItem.children.indexOf(target);outLayout=addChild(outLayout,target,sourceItem.id,beforeTarget?sourceItem.children.length:0,!beforeTarget),outLayout=updateGridItem(outLayout,target,"parent",sourceItem.id),outLayout=updateSize(outLayout,target,50),sourceItem.children.forEach((childId=>{const childSize=+outLayout.content[childId].bbox.width;outLayout=updateSize(outLayout,childId,.5*childSize)}));const parentContent=[...parentLayoutItem.children];return parentContent.splice(index,1,sourceItem.id),outLayout=updateGridItem(outLayout,parent,"children",parentContent),outLayout=updateGridItem(outLayout,sourceItem.id,"parent",parent),outLayout}return mergeIntoANewGroup(outLayout,sourceItem.id,target,type,beforeTarget,shareSpace)}(layout,sourceLayoutItem,target,type,beforeTarget,shareSpace);case jimu_core.Qwn.Tab:return function attachTab(layout,sourceItem,target,type,beforeTarget,shareSpace){const targetLayoutItem=(0,common_utils.a2)(layout,target),{parent}=targetLayoutItem,size=+targetLayoutItem.bbox.width,parentLayoutItem=(0,common_utils.a2)(layout,parent);let outLayout=layout;if(type===jimu_core.Qwn.Tab){if((null==parentLayoutItem?void 0:parentLayoutItem.gridType)===jimu_core.Qwn.Tab){const index=parentLayoutItem.children.indexOf(target),items=[].concat(parentLayoutItem.children);return items.splice(index+1,0,...sourceItem.children),outLayout=updateGridItem(layout,parent,"children",items),sourceItem.children.forEach((childId=>{outLayout=updateGridItem(outLayout,childId,"parent",parent)})),outLayout=outLayout.set("content",outLayout.content.without(sourceItem.id)),outLayout}const index=parentLayoutItem.children.indexOf(target),items=[].concat(parentLayoutItem.children);return items.splice(index,1,sourceItem.id),outLayout=updateGridItem(layout,parent,"children",items),outLayout=addChild(outLayout,target,sourceItem.id,0,!0),outLayout=updateGridItem(outLayout,target,"parent",sourceItem.id),outLayout=updateGridItem(outLayout,sourceItem.id,"parent",parent),outLayout}if((null==parentLayoutItem?void 0:parentLayoutItem.gridType)===type){const index=parentLayoutItem.children.indexOf(target);return outLayout=addChild(outLayout,sourceItem.id,parent,index,beforeTarget),outLayout=updateGridItem(outLayout,sourceItem.id,"parent",parent),outLayout=updateSize(outLayout,sourceItem.id,shareSpace?100:size/2),outLayout=updateSize(outLayout,target,shareSpace?100:size/2),outLayout}return mergeIntoANewGroup(outLayout,sourceItem.id,target,type,beforeTarget,shareSpace)}(layout,sourceLayoutItem,target,type,beforeTarget,shareSpace);default:return function attachPlain(layout,sourceItem,target,type,beforeTarget,shareSpace){const targetLayoutItem=(0,common_utils.a2)(layout,target),{parent}=targetLayoutItem,size=+targetLayoutItem.bbox.width,parentLayoutItem=(0,common_utils.a2)(layout,parent);let outLayout=layout;if((null==parentLayoutItem?void 0:parentLayoutItem.gridType)===type){const index=parentLayoutItem.children.indexOf(target);return outLayout=addChild(outLayout,sourceItem.id,parent,index,beforeTarget),outLayout=updateGridItem(outLayout,sourceItem.id,"parent",parent),outLayout=updateSize(outLayout,sourceItem.id,shareSpace?100:size/2),outLayout=updateSize(outLayout,target,shareSpace?100:size/2),type===jimu_core.Qwn.Tab&&(outLayout=updateGridItem(outLayout,parent,"activeTab",index+1)),outLayout}return mergeIntoANewGroup(outLayout,sourceItem.id,target,type,beforeTarget,shareSpace)}(layout,sourceLayoutItem,target,type,beforeTarget,shareSpace)}}function splitGridCell(layoutInfo,direction){const{layoutId,layoutItemId}=layoutInfo,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),{layouts}=appConfigAction.appConfig;let outLayout=layouts[layoutId];const r=createEmptyGridItem(outLayout,jimu_core.Qwn.Plain);outLayout=r.outLayout,outLayout=outLayout.setIn(["content",r.outItem.id,"type"],jimu_core.K6q.Widget);const newItem=outLayout.content[r.outItem.id];outLayout=attach(outLayout,newItem.id,layoutItemId,"h"===direction?jimu_core.Qwn.Row:jimu_core.Qwn.Column,!1,!1);const appConfig=appConfigAction.appConfig.setIn(["layouts",layoutId],outLayout);(0,jimu_for_builder.getAppConfigAction)(appConfig).exec()}var utils_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};function addItem(appConfig,item,parentLayoutInfo){return utils_awaiter(this,void 0,void 0,(function*(){var _a;const{layoutInfo:{layoutId,layoutItemId},updatedAppConfig}=yield common_layout_actions_addItemToLayout(appConfig,item,parentLayoutInfo.layoutId);let outAppConfig=updatedAppConfig;return(null===(_a=item.layoutInfo)||void 0===_a?void 0:_a.layoutId)!==parentLayoutInfo.layoutId&&(outAppConfig=updatedAppConfig.setIn(["layouts",layoutId,"content",layoutItemId,"gridType"],jimu_core.Qwn.Plain)),{newLayoutItemId:layoutItemId,updatedAppConfig:outAppConfig}}))}function addItemToGrid(appConfig,item,parentLayoutInfo,referenceItemId,side){return utils_awaiter(this,void 0,void 0,(function*(){const{layoutId:pLayoutId}=parentLayoutInfo;let outAppConfig=appConfig;const result=yield addItem(appConfig,item,parentLayoutInfo),newLayoutItemId=result.newLayoutItemId;if(outAppConfig=result.updatedAppConfig,referenceItemId){const outLayout=function attachToGridItem(layout,source,target,side){switch(side){case SideType.Center:return attach(layout,source,target,jimu_core.Qwn.Tab,!1,!0);case SideType.Top:return attach(layout,source,target,jimu_core.Qwn.Column,!0,!1);case SideType.Bottom:return attach(layout,source,target,jimu_core.Qwn.Column,!1,!1);case SideType.Left:return attach(layout,source,target,jimu_core.Qwn.Row,!0,!1);case SideType.Right:return attach(layout,source,target,jimu_core.Qwn.Row,!1,!1)}}(outAppConfig.layouts[pLayoutId],newLayoutItemId,referenceItemId,side);outAppConfig=outAppConfig.setIn(["layouts",pLayoutId],outLayout)}else outAppConfig=outAppConfig.setIn(["layouts",pLayoutId,"content",newLayoutItemId,"bbox"],{width:100}).setIn(["layouts",pLayoutId,"content",newLayoutItemId,"gridType"],jimu_core.Qwn.Plain).setIn(["layouts",pLayoutId,"setting","rootItem"],newLayoutItemId);return{appConfig:outAppConfig,layoutInfo:{layoutId:pLayoutId,layoutItemId:newLayoutItemId}}}))}function detachGridItem(layout,layoutItemId){const layoutItem=layout.content[layoutItemId],{parent}=layoutItem;if(!parent)return layout.setting.rootItem===layoutItemId?layout.setIn(["setting","rootItem"],null):layout;let outLayout=layout.setIn(["content",layoutItemId],layoutItem.without("parent"));const parentLayoutItem=layout.content[parent];if(!parentLayoutItem||null==(null==parentLayoutItem?void 0:parentLayoutItem.children))return layout;const index=parentLayoutItem.children.indexOf(layoutItemId);if(index<0)return layout;const remainItems=parentLayoutItem.children.filter((itemId=>itemId!==layoutItemId));if(1===remainItems.length){const child=remainItems[0];if(outLayout=outLayout.setIn(["content",child,"bbox","width"],parentLayoutItem.bbox.width),null!=parentLayoutItem.parent){outLayout=outLayout.setIn(["content",child,"parent"],parentLayoutItem.parent);const grandParentItem=layout.content[parentLayoutItem.parent];if(grandParentItem){const order=[...grandParentItem.children],index=order.indexOf(parent);order.splice(index,1,child),outLayout=outLayout.setIn(["content",parentLayoutItem.parent,"children"],order)}}else outLayout=outLayout.setIn(["content",child],outLayout.content[child].without("parent")),outLayout=outLayout.setIn(["setting","rootItem"],child);outLayout=outLayout.set("content",outLayout.content.without(parent))}else if(remainItems.length>1){if(index<remainItems.length){const itemToUpdate=outLayout.content[remainItems[index]];outLayout=outLayout.setIn(["content",remainItems[index],"bbox","width"],itemToUpdate.bbox.width+layoutItem.bbox.width)}else{const itemToUpdate=outLayout.content[remainItems[remainItems.length-1]];outLayout=outLayout.setIn(["content",remainItems[remainItems.length-1],"bbox","width"],itemToUpdate.bbox.width+layoutItem.bbox.width)}outLayout=outLayout.setIn(["content",parent,"children"],remainItems)}return outLayout}var insert_after=__webpack_require__("../jimu-icons/svg/outlined/editor/insert-after.svg"),insert_after_default=__webpack_require__.n(insert_after),insert_below=__webpack_require__("../jimu-icons/svg/outlined/editor/insert-below.svg"),insert_below_default=__webpack_require__.n(insert_below);const gridItemMenu=[{icon:insert_after_default(),autoFlipIcon:!0,title:props=>props.formatMessage("splitHorizontally"),visible:()=>!isLockLayout(),onClick:props=>{const{layoutId,layoutItem}=props;splitGridCell({layoutId,layoutItemId:layoutItem.id},"h")}},{icon:insert_below_default(),title:props=>props.formatMessage("splitVertically"),visible:()=>!isLockLayout(),onClick:props=>{const{layoutId,layoutItem}=props;splitGridCell({layoutId,layoutItemId:layoutItem.id},"v")}},{icon:duplicate_default(),title:props=>props.formatMessage("duplicate"),visible:()=>!isLockLayout(),onClick:props=>{const{layoutId,layoutItem}=props;!function duplicateItem(layoutInfo){const{layoutId,layoutItemId}=layoutInfo,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),newLayoutInfo={layoutId,layoutItemId:appConfigAction.duplicateLayoutItemInSameLayout({layoutId,layoutItemId})};updateLayoutAndSelection(appConfigAction.appConfig,newLayoutInfo)}({layoutId,layoutItemId:layoutItem.id})}},floatingMenuItem,{icon:pending_default(),title:props=>props.formatMessage("pendingTip"),visible:props=>{const{layoutItem}=props,isPlaceholder=layoutItem.type===jimu_core.K6q.Widget&&null==layoutItem.widgetId;return getAppMode()===jimu_core.$0N.Design&&!isLockLayout()&&!isPlaceholder},onClick:props=>{const{layoutId,layoutItem}=props;!function pendGridLayoutItem(layoutInfo){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();appConfigAction.setLayoutItemToPending(layoutInfo,!0),updateLayoutAndSelection(appConfigAction.appConfig,null)}({layoutId,layoutItemId:layoutItem.id})}},{icon:trash_default(),title:props=>props.formatMessage("delete"),visible:props=>getAppMode()===jimu_core.$0N.Design&&(!isLockLayout()||isNormalWidget(props.layoutItem)),onClick:props=>{const{layoutItem,layoutId}=props,layoutInfo={layoutId,layoutItemId:layoutItem.id};jimu_for_builder.appBuilderSync.publishConfirmDeleteToApp(layoutInfo)}}];var maxgrid=__webpack_require__("../jimu-icons/outlined/application/maxgrid.tsx"),editor_unlock=__webpack_require__("../jimu-icons/outlined/editor/unlock.tsx"),outlined_editor_close=__webpack_require__("../jimu-icons/outlined/editor/close.tsx");const layout_item_ThemeWidgetListPopper=(0,jimu_theme.ZS)(setting_components.WidgetListPopper),sectionMenu=[].concat(sectionMenuItems,gridItemMenu),builder_layout_item_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  z-index: 10;
  display: flex;
`,layout_item_guideOverlay=jimu_core.AHW`
  ${builder_layout_item_dropareaStyle};
  pointer-events: none;
`,layout_item_getStyle=isPlaceholder=>{const theme=(0,jimu_theme.wE)();return jimu_core.AHW`
    & > .max-grid-item-btn {
      display: none;
      background: var(--ref-palette-neutral-500);
      width: 26px;
      height: 26px;
      position: absolute;
      top: 0;
      right: 0;
    }

    & > .layout-widget > .add-btn {
      display: ${isPlaceholder?"none":"block"};
    }

    & > .add-btn {
      z-index: 20;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .lock-mask {
      position: absolute;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      z-index: 20;
      pointer-events: none;
      transition: all 400ms;

      .mask {
        width: 100%;
        height: 100%;
        background: ${theme.ref.palette.white};
        opacity: 0.1;
      }

      .lock-btn {
        background: ${jimu_core.PLL.rgba(theme.ref.palette.white,.6)};
        border-color: ${theme.ref.palette.black} !important;
        box-shadow: 0px 0px 8px 0px rgba(0, 0, 0, 0.3);
        width: 38px;
        height: 38px;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        transition: all 400ms;
        pointer-events: all;
      }

      &.unlock {
        width: 32px;
        height: 32px;

        .mask {
          background: transparent;
        }

        .lock-btn {
          width: 26px;
          height: 26px;
        }
      }
    }

    body:not(.design-mode) &:hover > .max-grid-item-btn {
      display: flex;
      justify-content: center;
      align-items: center;
    }
  `},maximizedStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  top: 0;
  width: 100% !important;
  height: 100% !important;
  z-index: 30;
  background: var(--ref-palette-neutral-200);
`;function GridLayoutItem(props){const{layoutId,layoutItemId,onDragStart,onDragging,onDragEnd,delay,isLastChild,className}=props,[maximized,setMaximized]=jimu_core.q_G.useState(!1),[showWidgetListPopper,setShowWidgetListPopper]=jimu_core.q_G.useState(!1),[locked,setLocked]=jimu_core.q_G.useState(!0),canvasPaneRef=jimu_core.q_G.useRef(),canvasRef=jimu_core.q_G.useRef(),resizeRef=jimu_core.q_G.useRef(),isEnter=jimu_core.q_G.useRef(!1),btnRef=jimu_core.q_G.useRef(),theme2=(0,jimu_theme.wE)(),translate=jimu_core.JLE.useTranslation(translations_default.A),expandable=jimu_core.E_S.useSelector((state=>common_utils.tq(state,layoutId,layoutItemId))),isLockLayout=jimu_core.E_S.useSelector((state=>{var _a,_b,_c;const lockLayout=null!==(_c=null===(_b=null===(_a=state.appConfig)||void 0===_a?void 0:_a.forBuilderAttributes)||void 0===_b?void 0:_b.lockLayout)&&void 0!==_c&&_c;return!(state.appRuntimeInfo.appMode===jimu_core.$0N.Design)||lockLayout})),hasEmbeddedLayout=jimu_core.E_S.useSelector((state=>{var _a,_b,_c;const layoutItem=state.appConfig.layouts[layoutId].content[layoutItemId];if((null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Section)return!0;if((null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Widget){const widgetJson=state.appConfig.widgets[layoutItem.widgetId];if((null===(_a=null==widgetJson?void 0:widgetJson.manifest)||void 0===_a?void 0:_a.widgetType)===jimu_core.xOw.Layout||(null===(_c=null===(_b=null==widgetJson?void 0:widgetJson.manifest)||void 0===_b?void 0:_b.properties)||void 0===_c?void 0:_c.hasEmbeddedLayout))return null!=widgetJson.layouts}return!1})),isPlaceholder=jimu_core.E_S.useSelector((state=>{const layoutItem=state.appConfig.layouts[layoutId].content[layoutItemId];return(null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Widget&&null==(null==layoutItem?void 0:layoutItem.widgetId)})),isSection=jimu_core.E_S.useSelector((state=>{const layoutItem=state.appConfig.layouts[layoutId].content[layoutItemId];return(null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Section})),fakeLayouts=jimu_core.q_G.useMemo((()=>(0,jimu_core.J3Z)({[jimu_core.rHp.Large]:`${layoutId}_${layoutItemId}_tlarge`,[jimu_core.rHp.Medium]:`${layoutId}_${layoutItemId}_tmedium`,[jimu_core.rHp.Small]:`${layoutId}_${layoutItemId}_tsmall`})),[layoutId,layoutItemId]);jimu_core.JLE.useEffectOnce((()=>{const theme=(0,jimu_theme.O4)();canvasPaneRef.current=new canvas_pane_CanvasPane(canvasRef.current,theme)}));const handleResize=jimu_core.JLE.useEventCallback((({width,height})=>{width&&height&&canvasPaneRef.current.setSize(width,height,window.devicePixelRatio)})),handleToggleDragoverEffect=jimu_core.JLE.useEventCallback((isIn=>{isEnter.current=isIn,document.querySelectorAll("div.grid-layout").forEach((element=>{element.getAttribute("data-layoutid")===layoutId?isIn&&!element.classList.contains("drop-target")&&element.classList.add("drop-target"):element.classList.contains("drop-target")&&element.classList.remove("drop-target")})),canvasPaneRef.current.clear()})),onDragOver=jimu_core.q_G.useCallback(((draggingItem,draggingElement,containerRect,itemRect,clientX,clientY)=>{if(!isEnter.current)return;const{width,height}=containerRect;canvasPaneRef.current.clear();const theme=(0,jimu_theme.O4)();if(canvasPaneRef.current.setColor(jimu_core.PLL.rgba(theme.sys.color.primary.light,.2)),isPlaceholder&&canDropAtPlaceholder(draggingItem))return void canvasPaneRef.current.drawRect({left:0,top:0,width,height});let rect;rect=clientY<=.2*height?{left:0,top:0,width,height:height/2}:clientY>=.8*height?{left:0,top:height/2,width,height:height/2}:clientX<=.2*width?{left:0,top:0,width:width/2,height}:clientX>=.8*width?{left:width/2,top:0,width:width/2,height}:{left:.2*width,top:.2*height,width:.6*width,height:.6*height},canvasPaneRef.current.drawRect(rect)}),[isPlaceholder]),onDrop=jimu_core.q_G.useCallback(((draggingItem,containerRect,itemRect,clientX,clientY)=>{let appConfigAction=(0,jimu_for_builder.getAppConfigAction)();if(isPlaceholder&&canDropAtPlaceholder(draggingItem))return void dropAtPlaceholder({layoutId,layoutItemId},draggingItem);const{width,height}=containerRect;let side;side=clientY<=.2*height?SideType.Top:clientY>=.8*height?SideType.Bottom:clientX<=.2*width?layout_runtime.utils.isRTL()?SideType.Right:SideType.Left:clientX>=.8*width?layout_runtime.utils.isRTL()?SideType.Left:SideType.Right:SideType.Center;const layoutInfo={layoutId};addItemToGrid(appConfigAction.appConfig,draggingItem,layoutInfo,layoutItemId,side).then((result=>{const{appConfig,layoutInfo:newLayoutInfo}=result;appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),appConfigAction.exec(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged(newLayoutInfo))}))}),[isPlaceholder,layoutId,layoutItemId]),setWidget=jimu_core.q_G.useCallback((item=>{item.itemType===jimu_core.K6q.Section?addSectionInPlaceholder({layoutId,layoutItemId}):addWidgetInPlaceholder({layoutId,layoutItemId},item),setShowWidgetListPopper(!1)}),[layoutId,layoutItemId]),toggleShowWidgetListPopper=jimu_core.q_G.useCallback((e=>{e.stopPropagation(),(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small?setShowWidgetListPopper(!showWidgetListPopper):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"widget",isPlaceholder:!0,isItemAccepted:canDropAtPlaceholder,onSelect:setWidget})}),[showWidgetListPopper,setWidget]),toggleMaximize=jimu_core.q_G.useCallback((()=>{setMaximized(!maximized)}),[maximized]),toggleLockMode=jimu_core.q_G.useCallback((()=>{setLocked(!locked)}),[locked]);return(0,jimu_core.Yac)(LayoutItemInBuilder,{layoutId,layoutItemId,resizable:!1,className,showDefaultTools:!1,toolItems:isSection?sectionMenu:gridItemMenu,delay,isLastChild,onDragStart,onDragging,onDragEnd,css:jimu_core.AHW`${layout_item_getStyle(isPlaceholder)};${maximized?maximizedStyle:""}`},(!hasEmbeddedLayout||locked)&&!isLockLayout&&(0,jimu_core.Yac)(droparea_hook_DropArea,{css:builder_layout_item_dropareaStyle,layouts:fakeLayouts,highlightDragover:!0,onDragOver,onDrop,onToggleDragoverEffect:handleToggleDragoverEffect}),isPlaceholder&&(0,jimu_core.Yac)("div",{className:"add-btn"},(0,jimu_core.Yac)(theme_tooltip.v,{title:translate("addWidget")},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,ref:btnRef,css:jimu_core.AHW`width: 36px; height: 36px; padding: 0.5rem;`,onClick:toggleShowWidgetListPopper,"aria-haspopup":!0},(0,jimu_core.Yac)(editor_plus.b,null)))),isPlaceholder&&showWidgetListPopper&&(0,jimu_core.Yac)(layout_item_ThemeWidgetListPopper,{referenceElement:btnRef.current,isAccepted:canDropAtPlaceholder,onSelect:setWidget,onClose:()=>{setShowWidgetListPopper(!1)}}),(0,jimu_core.Yac)("canvas",{css:layout_item_guideOverlay,ref:canvasRef}),(0,jimu_core.Yac)("div",{css:jimu_core.AHW`
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: transparent;
        pointer-events: none;
      `,ref:resizeRef}),(0,jimu_core.Yac)(jimu_core.cQZ,{handleWidth:!0,handleHeight:!0,onResize:handleResize,targetRef:resizeRef}),expandable&&(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,type:"tertiary",className:"max-grid-item-btn p-0",onClick:toggleMaximize,title:translate(maximized?"restore":"maximize")},maximized&&(0,jimu_core.Yac)(outlined_editor_close.r,null),!maximized&&(0,jimu_core.Yac)(maxgrid.z,null)),hasEmbeddedLayout&&!isLockLayout&&(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("lock-mask",{unlock:!locked})},(0,jimu_core.Yac)("div",{className:"mask"}),(0,jimu_core.Yac)(jimu_ui.Tooltip,{title:translate(locked?"unlockGridItem":"lockGridItem")},(0,jimu_core.Yac)(jimu_ui.Button,{className:"lock-btn rounded-circle",size:"sm",type:"tertiary",icon:!0,onClick:toggleLockMode},!locked&&(0,jimu_core.Yac)(editor_unlock.R,{size:14,color:theme2.ref.palette.black}),locked&&(0,jimu_core.Yac)(lock.s,{size:20,color:theme2.ref.palette.black})))))}try{GridLayoutItem.displayName="GridLayoutItem",GridLayoutItem.__docgenInfo={description:"",displayName:"GridLayoutItem",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},delay:{defaultValue:null,description:"",name:"delay",required:!0,type:{name:"number"}},isLastChild:{defaultValue:null,description:"",name:"isLastChild",required:!0,type:{name:"boolean"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!0,type:{name:"(id: string) => void"}},onDragging:{defaultValue:null,description:"",name:"onDragging",required:!0,type:{name:"(id: string, dx: number, dy: number) => void"}},onDragEnd:{defaultValue:null,description:"",name:"onDragEnd",required:!0,type:{name:"(id: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/grid-layout/builder/layout-item.tsx#GridLayoutItem"]={docgenInfo:GridLayoutItem.__docgenInfo,name:"GridLayoutItem",path:"../jimu-layouts/lib/grid-layout/builder/layout-item.tsx#GridLayoutItem"})}catch(__react_docgen_typescript_loader_error){}var splitter=__webpack_require__("../jimu-layouts/lib/grid-layout/common/splitter.tsx"),draggable_tab_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};const draggable_tab_style=jimu_core.AHW`
  .nav-link.grid-tab.highlight-pre {
    position: relative;
    &:after {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 50%;
      height: 100%;
      background-color: var(--sys-color-primary-light);
    }
  }

  .nav-link.grid-tab.highlight-next {
    position: relative;
    &:after {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      width: 50%;
      height: 100%;
      background-color: var(--sys-color-primary-light);
    }
  }
`;function DraggableTab(props){const{layoutId,layoutItemId,onDragStart,title}=props,otherProps=draggable_tab_rest(props,["layoutId","layoutItemId","onDragStart","title"]),btnRef=jimu_core.q_G.useRef(),isInRef=jimu_core.q_G.useRef(!1),translate=jimu_core.JLE.useTranslation(jimu_ui.defaultMessages),pageContext=jimu_core.q_G.useContext(layout_runtime.PageContext),layoutContext=jimu_core.q_G.useContext(layout_runtime.LayoutContext),itemType=jimu_core.E_S.useSelector((state=>{const layoutItem=state.appConfig.layouts[layoutId].content[layoutItemId];return null==layoutItem?void 0:layoutItem.type})),label=jimu_core.E_S.useSelector((state=>(0,common_utils.T9)(state.appConfig,{layoutId,layoutItemId},translate))),getCurrentRootLayoutId=jimu_core.q_G.useCallback((()=>pageContext.rootLayoutId),[pageContext.rootLayoutId]),handleDragStart=jimu_core.JLE.useEventCallback((()=>{onDragStart(layoutItemId)})),handleOnDragOver=jimu_core.JLE.useEventCallback(((draggingItem,draggingElement,containerRect,itemRect,clientX,clientY)=>{isInRef.current&&(clientX<=containerRect.width/2?(btnRef.current.classList.add("highlight-pre"),btnRef.current.classList.remove("highlight-next")):(btnRef.current.classList.remove("highlight-pre"),btnRef.current.classList.add("highlight-next")))})),handleOnDrop=jimu_core.JLE.useEventCallback(((draggingItem,containerRect,itemRect,clientX,clientY)=>{const layoutInfo={layoutId};let appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),isBeforeReferenceItem=!1;isBeforeReferenceItem=clientX<=containerRect.width/2?!layout_runtime.utils.isRTL():layout_runtime.utils.isRTL(),addItemToGrid(appConfigAction.appConfig,draggingItem,layoutInfo,layoutItemId,SideType.Center).then((result=>{const{appConfig,layoutInfo:newLayoutInfo}=result;if(appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),isBeforeReferenceItem){const parentId=appConfig.layouts[layoutId].content[layoutItemId].parent,childIds=[...appConfig.layouts[layoutId].content[parentId].children];childIds.splice(childIds.indexOf(layoutItemId),2,newLayoutInfo.layoutItemId,layoutItemId),appConfigAction.editLayoutItemProperty({layoutId,layoutItemId:parentId},"children",childIds)}appConfigAction.exec(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged(newLayoutInfo))}))})),handleToggleDragoverEffect=jimu_core.JLE.useEventCallback((isIn=>{isInRef.current=isIn,isIn||(btnRef.current.classList.remove("highlight-pre"),btnRef.current.classList.remove("highlight-next"))}));return jimu_core.q_G.useEffect((()=>{btnRef.current.setAttribute("data-layoutid",layoutId),btnRef.current.setAttribute("data-layoutitemid",layoutItemId);const dragInteractable=interact_min_default()(btnRef.current).origin("parent");bindDragHandler(dragInteractable,{layoutId,layoutItemId,itemType,useDragHandler:!1,onDragStart:handleDragStart,rootLayoutId:getCurrentRootLayoutId,restrict:()=>!0}).draggable({modifiers:[interact_min_default().modifiers.restrictRect({restriction:btnRef.current.parentElement.parentElement})]});const contextRef={current:{props:{layouts:(0,jimu_core.J3Z)({[jimu_core.rHp.Large]:`${layoutId}_${layoutItemId}_tlarge`,[jimu_core.rHp.Medium]:`${layoutId}_${layoutItemId}_tmedium`,[jimu_core.rHp.Small]:`${layoutId}_${layoutItemId}_tsmall`}),highlightDragover:!0,onDragOver:handleOnDragOver,onDrop:handleOnDrop,onToggleDragoverEffect:handleToggleDragoverEffect},layoutId,pageContext,layoutContext}},dropInteractable=initInteractive(btnRef.current,contextRef,".grid-tab");return initH5(btnRef.current,contextRef),()=>{dragInteractable.unset(),dropInteractable.unset()}}),[layoutId,layoutItemId]),(0,jimu_core.Yac)(jimu_ui.Tab,Object.assign({},otherProps,{title:label,innerRef:btnRef,innerClassName:"grid-tab",css:draggable_tab_style}))}try{DraggableTab.displayName="DraggableTab",DraggableTab.__docgenInfo={description:"",displayName:"DraggableTab",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!0,type:{name:"(layoutItemId: string) => void"}},disabled:{defaultValue:{value:"false"},description:"If true, the tab will be disabled.",name:"disabled",required:!1,type:{name:"boolean"}},active:{defaultValue:null,description:"If `true`, the tab is active.\nNote: `active` is an internal prop, should not be used in widget.\n@ignore",name:"active",required:!1,type:{name:"boolean"}},closeable:{defaultValue:{value:"false"},description:"If `true`, a close icon will be shown on the tab.",name:"closeable",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"Callback fired when the close icon be clicked.\nValid only closeable is true.\nNote: `onClose` is an internal prop, should not be used in widget.\n@ignore",name:"onClose",required:!1,type:{name:"(id: string) => void"}},onClick:{defaultValue:null,description:"The callback will fire when the tab is clicked.",name:"onClick",required:!1,type:{name:"(evt: MouseEvent<HTMLElement, MouseEvent>) => void"}},onKeyDown:{defaultValue:null,description:"Fired at an Element when a key is pressed down and that key normally produces a character value.",name:"onKeyDown",required:!1,type:{name:"KeyboardEventHandler<HTMLElement>"}},title:{defaultValue:null,description:"The title of the tab.",name:"title",required:!0,type:{name:"string | Element"}},id:{defaultValue:null,description:"Serves as the identifier of the tab.",name:"id",required:!0,type:{name:"string"}},children:{defaultValue:null,description:"The content of the tab, which will be displayed in the tab panel when opened.",name:"children",required:!0,type:{name:"Element | Element[]"}},className:{defaultValue:null,description:"Defines the class names added to the element",name:"className",required:!1,type:{name:"string"}},innerClassName:{defaultValue:null,description:"Defines the class names added to `NavLink` element.\n@ignore",name:"innerClassName",required:!1,type:{name:"string"}},innerRef:{defaultValue:null,description:"The ref to access the DOM node.\n@ignore",name:"innerRef",required:!1,type:{name:"Ref<HTMLButtonElement>"}},style:{defaultValue:null,description:"Defines the styles added to the element.",name:"style",required:!1,type:{name:"CSSProperties"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/grid-layout/builder/draggable-tab.tsx#DraggableTab"]={docgenInfo:DraggableTab.__docgenInfo,name:"DraggableTab",path:"../jimu-layouts/lib/grid-layout/builder/draggable-tab.tsx#DraggableTab"})}catch(__react_docgen_typescript_loader_error){}var row=__webpack_require__("../jimu-icons/svg/outlined/data/row.svg"),row_default=__webpack_require__.n(row);let grid_item_toolbar_count=0;const shiftOptions={rootBoundary:"viewport",crossAxis:!0},flipOptions={boundary:document.body,fallbackPlacements:["top-start","bottom-start","right-start","left-start"]},gridRowColTools=[{icon:row_default(),title:props=>{const{layoutItem,formatMessage}=props,type=layoutItem.gridType;let labelId;return type===jimu_core.Qwn.Row?labelId="distributeSpaceH":type===jimu_core.Qwn.Column&&(labelId="distributeSpaceV"),formatMessage(labelId)},visible:props=>{const{layoutItem}=props,type=layoutItem.gridType;return(type===jimu_core.Qwn.Row||type===jimu_core.Qwn.Column)&&!isLockLayout()},onClick:props=>{const{layoutId}=props,layoutItem=props.layoutItem,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),size=100/layoutItem.children.length;layoutItem.children.forEach((childId=>{appConfigAction.editLayoutItemProperty({layoutId,layoutItemId:childId},"bbox",{width:size})})),appConfigAction.exec()},onMouseEnter:props=>{const{layoutId,layoutItem}=props;document.querySelector(`div.grid-layout[data-layoutid="${layoutId}"]`).querySelector(`div[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItem.id}"]`).classList.add("menu-active")},onMouseLeave:props=>{const{layoutId,layoutItem}=props;document.querySelector(`div.grid-layout[data-layoutid="${layoutId}"]`).querySelector(`div[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItem.id}"]`).classList.remove("menu-active")}}];function GridItemToolbar(props){const{layoutId,layoutItem,refElement}=props,translate=jimu_core.JLE.useTranslation(jimu_ui.defaultMessages);return refElement?(0,jimu_core.Yac)(jimu_ui.Popper,{placement:"top-start",reference:refElement,open:!0,unstyled:!0,shiftOptions,flipOptions,version:grid_item_toolbar_count++,trapFocus:!1,autoFocus:!1,css:jimu_core.AHW`
        background: transparent;
        box-shadow: none;
      `},(0,jimu_core.Yac)("div",null,(0,jimu_core.Yac)(Toolbar,{layoutId,layoutItem,theme:(0,jimu_theme.wE)(),parentRef:refElement,tools:gridRowColTools,formatMessage:translate}))):null}try{GridItemToolbar.displayName="GridItemToolbar",GridItemToolbar.__docgenInfo={description:"",displayName:"GridItemToolbar",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},refElement:{defaultValue:null,description:"",name:"refElement",required:!0,type:{name:"HTMLElement"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/grid-layout/builder/grid-item-toolbar.tsx#GridItemToolbar"]={docgenInfo:GridItemToolbar.__docgenInfo,name:"GridItemToolbar",path:"../jimu-layouts/lib/grid-layout/builder/grid-item-toolbar.tsx#GridItemToolbar"})}catch(__react_docgen_typescript_loader_error){}function GridItemComponent(props){const{layout,layoutItemId,isLast,onDragStart,onDragging,onDragEnd,className}=props,layoutItem=jimu_core.q_G.useMemo((()=>(0,common_utils.a2)(layout,layoutItemId)),[layout,layoutItemId]),parentType=jimu_core.q_G.useMemo((()=>{if(null==layoutItem?void 0:layoutItem.parent){return(0,common_utils.a2)(layout,layoutItem.parent).gridType}return null}),[layoutItem,layout]),splitSpace=jimu_core.E_S.useSelector((state=>{var _a,_b;const size=null!==(_b=null===(_a=layout.setting)||void 0===_a?void 0:_a.splitSize)&&void 0!==_b?_b:8;let numOfChildren=0;if(null==layoutItem?void 0:layoutItem.parent){numOfChildren=(0,common_utils.a2)(layout,layoutItem.parent).children.length}return size*(numOfChildren-1)/numOfChildren})),animationContext=jimu_core.q_G.useContext(jimu_core.e8P),interval=jimu_core.q_G.useMemo((()=>{var _a,_b;return(null===(_b=null===(_a=null==animationContext?void 0:animationContext.setting)||void 0===_a?void 0:_a.option)||void 0===_b?void 0:_b.parentMode)===jimu_core.Qkq.AllAtOnce?0:250}),[animationContext]),getStyle=jimu_core.q_G.useCallback((()=>{let size;return size=splitSpace>0?`calc(${+layoutItem.bbox.width}% - ${splitSpace.toFixed(2)}px)`:+layoutItem.bbox.width+"%",parentType===jimu_core.Qwn.Row?jimu_core.AHW`
        height: 100%;
        width: ${size};
      `:parentType===jimu_core.Qwn.Column?jimu_core.AHW`
        width: 100%;
        height: ${size};
      `:jimu_core.AHW`
      width: 100%;
      height: 100%;
    `}),[layoutItem.bbox.width,splitSpace,parentType]);if(layoutItem.gridType===jimu_core.Qwn.Row)return(0,jimu_core.Yac)(RowContainer,{className,css:getStyle(),layout,layoutItemId,items:layoutItem.children});if(layoutItem.gridType===jimu_core.Qwn.Column)return(0,jimu_core.Yac)(ColContainer,{className,css:getStyle(),layout,layoutItemId,items:layoutItem.children});if(layoutItem.gridType===jimu_core.Qwn.Tab)return(0,jimu_core.Yac)(TabContainer,{className,css:getStyle(),layout,layoutItemId,items:layoutItem.children,onDragStart,onDragEnd});const idx=(0,common_utils.jG)(layout,layoutItemId),isLastChild=(0,common_utils.be)(layout,layoutItemId);return(0,jimu_core.Yac)(GridLayoutItem,{css:getStyle(),className:(0,jimu_core.xWm)(`d-flex ${className}`,{"is-last":isLast}),layoutId:layout.id,layoutItemId,delay:idx*interval,isLastChild,onDragStart,onDragging,onDragEnd})}function RowContainer(props){const{layout,layoutItemId,items,className}=props,domRef=jimu_core.q_G.useRef(),isDesignMode=jimu_core.E_S.useSelector((state=>{var _a;return(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design})),selected=jimu_core.E_S.useSelector((state=>{const selection=state.appRuntimeInfo.selection;return(null==selection?void 0:selection.layoutId)===layout.id&&(null==selection?void 0:selection.layoutItemId)===layoutItemId})),handleResizeEnd=jimu_core.JLE.useEventCallback(((id,dx)=>{const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),index=items.indexOf(id),nextId=items[index+1],layoutItem=layout.content[id],nextLayoutItem=layout.content[nextId];appConfigAction.editLayoutItemProperty({layoutId:layout.id,layoutItemId:id},"bbox",{width:+layoutItem.bbox.width+dx},!0).editLayoutItemProperty({layoutId:layout.id,layoutItemId:nextId},"bbox",{width:+nextLayoutItem.bbox.width-dx},!0).exec()})),handleDragStart=jimu_core.JLE.useEventCallback((id=>{var _a;const targetElement=domRef.current.querySelector(`div[data-layoutitemid="${id}"]`);let splitter,neighborItem;(null===(_a=targetElement.nextElementSibling)||void 0===_a?void 0:_a.classList.contains("grid-split"))?(splitter=targetElement.nextElementSibling,neighborItem=splitter.nextElementSibling):(splitter=targetElement.previousElementSibling,neighborItem=splitter.previousElementSibling);const parentRect=targetElement.parentElement.getBoundingClientRect(),targetRect=targetElement.getBoundingClientRect();targetElement.style.width=`${targetElement.clientWidth}px`,targetElement.style.height=`${targetElement.clientHeight}px`,targetElement.style.left=targetRect.left-parentRect.left+"px",targetElement.style.top=targetRect.top-parentRect.top+"px",targetElement.style.position="absolute",neighborItem.style.width=`${targetElement.clientWidth+splitter.clientWidth+neighborItem.clientWidth}px`,splitter.style.display="none"})),handleDragEnd=jimu_core.JLE.useEventCallback((id=>{var _a;const targetElement=domRef.current.querySelector(`div[data-layoutitemid="${id}"]`);let splitter,neighborItem;(null===(_a=targetElement.nextElementSibling)||void 0===_a?void 0:_a.classList.contains("grid-split"))?(splitter=targetElement.nextElementSibling,neighborItem=splitter.nextElementSibling):(splitter=targetElement.previousElementSibling,neighborItem=splitter.previousElementSibling),targetElement.style.width=null,targetElement.style.height=null,targetElement.style.left=null,targetElement.style.top=null,targetElement.style.position=null,neighborItem.style.width=null,splitter.style.display=null})),theme2=(0,jimu_theme.wE)();return(0,jimu_core.Yac)("div",{className:`d-flex ${className}`,css:jimu_core.AHW`
        position: ${isDesignMode?"relative":"initial"};
        .is-last {
          width: auto;
          flex-grow: 1;
          flex-shrink: 1;
          flex-basis: 0;
        }
        &.menu-active > .grid-row-item {
          &:after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0.3;
            background: ${theme2.sys.color.primary.main};
          }
        }
        &.menu-active > .grid-row-item:nth-of-type(4n-1):after {
          background: ${theme2.sys.color.error.dark};
          opacity: 0.6;
        }
      `,"data-layoutid":layout.id,"data-layoutitemid":layoutItemId,ref:domRef},items.map(((item,index)=>{return itemId=item,isLast=index===items.length-1,(0,jimu_core.Yac)(jimu_core.q_G.Fragment,{key:itemId},(0,jimu_core.Yac)(GridItemComponent,{key:itemId,className:"grid-row-item",layout,layoutItemId:itemId,onDragStart:handleDragStart,onDragEnd:handleDragEnd}),!isLast&&(0,jimu_core.Yac)(splitter.O,{referenceItemId:itemId,layoutId:layout.id,direction:"row",onResizeEnd:handleResizeEnd}));var itemId,isLast})),selected&&(0,jimu_core.Yac)(GridItemToolbar,{layoutId:layout.id,layoutItem:layout.content[layoutItemId],refElement:domRef.current}))}function ColContainer(props){const{layout,layoutItemId,items,className}=props,domRef=jimu_core.q_G.useRef(),isDesignMode=jimu_core.E_S.useSelector((state=>{var _a;return(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design})),selected=jimu_core.E_S.useSelector((state=>{const selection=state.appRuntimeInfo.selection;return(null==selection?void 0:selection.layoutId)===layout.id&&(null==selection?void 0:selection.layoutItemId)===layoutItemId})),handleResizeEnd=jimu_core.JLE.useEventCallback(((id,dx,dy)=>{const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),index=items.indexOf(id),nextId=items[index+1],layoutItem=layout.content[id],nextLayoutItem=layout.content[nextId];appConfigAction.editLayoutItemProperty({layoutId:layout.id,layoutItemId:id},"bbox",{width:+layoutItem.bbox.width+dy},!0).editLayoutItemProperty({layoutId:layout.id,layoutItemId:nextId},"bbox",{width:+nextLayoutItem.bbox.width-dy},!0).exec()})),handleDragStart=jimu_core.JLE.useEventCallback((id=>{var _a;const targetElement=domRef.current.querySelector(`div[data-layoutitemid="${id}"]`);let splitter,neighborItem;(null===(_a=targetElement.nextElementSibling)||void 0===_a?void 0:_a.classList.contains("grid-split"))?(splitter=targetElement.nextElementSibling,neighborItem=splitter.nextElementSibling):(splitter=targetElement.previousElementSibling,neighborItem=splitter.previousElementSibling);const parentRect=targetElement.parentElement.getBoundingClientRect(),targetRect=targetElement.getBoundingClientRect();targetElement.style.width=`${targetElement.clientWidth}px`,targetElement.style.height=`${targetElement.clientHeight}px`,targetElement.style.left=targetRect.left-parentRect.left+"px",targetElement.style.top=targetRect.top-parentRect.top+"px",targetElement.style.position="absolute",neighborItem.style.height=`${targetElement.clientHeight+splitter.clientHeight+neighborItem.clientHeight}px`,splitter.style.display="none"})),handleDragEnd=jimu_core.JLE.useEventCallback((id=>{var _a;const targetElement=domRef.current.querySelector(`div[data-layoutitemid="${id}"]`);let splitter,neighborItem;(null===(_a=targetElement.nextElementSibling)||void 0===_a?void 0:_a.classList.contains("grid-split"))?(splitter=targetElement.nextElementSibling,neighborItem=splitter.nextElementSibling):(splitter=targetElement.previousElementSibling,neighborItem=splitter.previousElementSibling),targetElement.style.width=null,targetElement.style.height=null,targetElement.style.left=null,targetElement.style.top=null,targetElement.style.position=null,neighborItem.style.height=null,splitter.style.display=null})),theme2=(0,jimu_theme.wE)();return(0,jimu_core.Yac)("div",{className:`d-flex flex-column ${className}`,css:jimu_core.AHW`
        position: ${isDesignMode?"relative":"initial"};
        .is-last {
          height: auto;
          flex-grow: 1;
          flex-shrink: 1;
          flex-basis: 0;
        }
        &.menu-active > .grid-col-item {
          &:after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0.3;
            background: ${theme2.sys.color.primary.main};
          }
        }
        &.menu-active > .grid-col-item:nth-of-type(4n-1):after {
          background: ${theme2.sys.color.error.dark};
          opacity: 0.6;
        }
      `,"data-layoutid":layout.id,"data-layoutitemid":layoutItemId,ref:domRef},items.map(((item,index)=>{return itemId=item,isLast=index===items.length-1,(0,jimu_core.Yac)(jimu_core.q_G.Fragment,{key:itemId},(0,jimu_core.Yac)(GridItemComponent,{key:itemId,className:"grid-col-item",layout,layoutItemId:itemId,onDragStart:handleDragStart,onDragEnd:handleDragEnd}),!isLast&&(0,jimu_core.Yac)(splitter.O,{referenceItemId:itemId,layoutId:layout.id,direction:"col",onResizeEnd:handleResizeEnd}));var itemId,isLast})),selected&&(0,jimu_core.Yac)(GridItemToolbar,{layoutId:layout.id,layoutItem:layout.content[layoutItemId],refElement:domRef.current}))}function TabContainer(props){var _a;const{layout,layoutItemId,items,className,onDragStart,onDragEnd}=props,isDesignMode=jimu_core.E_S.useSelector((state=>{var _a;return(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design})),[activeTab,setActiveTab]=jimu_core.q_G.useState(0),domRef=jimu_core.q_G.useRef(),originRectRef=jimu_core.q_G.useRef(),dragPlaceholderRef=jimu_core.q_G.useRef(),isRootItem=(null===(_a=layout.setting)||void 0===_a?void 0:_a.rootItem)===layoutItemId;jimu_core.JLE.useEffectOnce((()=>{let interactable=interact_min_default()(domRef.current).origin("parent");return interactable=bindDragHandler(interactable,{layoutId:layout.id,layoutItemId,useDragHandler:!1,itemType:jimu_core.K6q.Widget,rootLayoutId:null,restrict:null,onDragStart,onDragEnd}),interactable.draggable({modifiers:[interact_min_default().modifiers.restrictRect({restriction:`div.grid-layout[data-layoutid="${layout.id}"]`})]}),()=>{interactable&&(interactable.unset(),interactable=null)}})),jimu_core.q_G.useEffect((()=>{domRef.current&&(isRootItem?interact_min_default()(domRef.current).draggable(!1):interact_min_default()(domRef.current).draggable(!0))}),[isRootItem]);const active=jimu_core.q_G.useMemo((()=>{var _a;return null!==(_a=(0,common_utils.a2)(layout,layoutItemId).activeTab)&&void 0!==_a?_a:0}),[layout,layoutItemId]);jimu_core.q_G.useEffect((()=>{setActiveTab(active)}),[active]);const handleTabChange=jimu_core.JLE.useEventCallback((id=>{const index=items.indexOf(id);setActiveTab(index)})),handleTabDragStart=jimu_core.JLE.useEventCallback((id=>{const idx=items.indexOf(id);idx===items.length-1?setActiveTab(items.length-2):setActiveTab(idx+1)})),handleDragStart=jimu_core.JLE.useEventCallback((id=>{const targetRect=domRef.current.querySelector(`div[data-layoutitemid="${id}"]`).getBoundingClientRect();originRectRef.current=targetRect;const elem=createDraggingPlaceholder(targetRect);dragPlaceholderRef.current=document.body.appendChild(elem);const idx=items.indexOf(id);idx===items.length-1?setActiveTab(items.length-2):setActiveTab(idx+1)})),handleDragging=jimu_core.JLE.useEventCallback(((id,dx,dy)=>{const ox=dx-originRectRef.current.left,oy=dy-originRectRef.current.top;dragPlaceholderRef.current.style.transform=`translate(${Math.round(ox)}px, ${Math.round(oy)}px) translateZ(0)`})),handleDragEnd=jimu_core.JLE.useEventCallback((id=>{document.body.removeChild(dragPlaceholderRef.current),dragPlaceholderRef.current=null}));return(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)(className,"exb-rnd"),"data-layoutid":layout.id,"data-layoutitemid":layoutItemId,css:jimu_core.AHW`${isDesignMode?"relative":"initial"};`,ref:domRef},(0,jimu_core.Yac)(jimu_ui.Tabs,{type:"tabs",fill:!0,scrollable:!0,className:"w-100 h-100",value:items[activeTab],onChange:handleTabChange,css:jimu_core.AHW`
          & > .tab-content {
            overflow: hidden;
          }
        `},[...items].map(((item,index)=>((itemId,index)=>(0,jimu_core.Yac)(DraggableTab,{key:itemId,id:itemId,title:`${index}`,layoutId:layout.id,layoutItemId:itemId,onDragStart:handleTabDragStart},(0,jimu_core.Yac)(GridItemComponent,{layout,layoutItemId:itemId,onDragStart:handleDragStart,onDragging:handleDragging,onDragEnd:handleDragEnd})))(item,index)))))}try{GridItemComponent.displayName="GridItemComponent",GridItemComponent.__docgenInfo={description:"",displayName:"GridItemComponent",props:{layout:{defaultValue:null,description:"",name:"layout",required:!0,type:{name:"IMLayoutJson"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},isLast:{defaultValue:null,description:"",name:"isLast",required:!1,type:{name:"boolean"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!1,type:{name:"((id: string) => void) & DragEventHandler<HTMLDivElement>"}},onDragging:{defaultValue:null,description:"",name:"onDragging",required:!1,type:{name:"(id: string, dx: number, dy: number) => void"}},onDragEnd:{defaultValue:null,description:"",name:"onDragEnd",required:!1,type:{name:"((id: string) => void) & DragEventHandler<HTMLDivElement>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/grid-layout/builder/grid-item.tsx#GridItemComponent"]={docgenInfo:GridItemComponent.__docgenInfo,name:"GridItemComponent",path:"../jimu-layouts/lib/grid-layout/builder/grid-item.tsx#GridItemComponent"})}catch(__react_docgen_typescript_loader_error){}var grid_template=__webpack_require__("../jimu-icons/outlined/application/grid-template.tsx");const action_block_ThemeWidgetListPopper=(0,jimu_theme.ZS)(setting_components.WidgetListPopper),action_block_buttonStyle=jimu_core.AHW`
  pointer-events: auto;
`;function action_block_getStyle(isGridPage){return jimu_core.AHW`
    body.lock-layout &,
    body:not(.design-mode) & {
      display: none !important;
    }

    display: flex;
    height: ${isGridPage?"200px":"100%"};
    padding: 1rem;
    pointer-events: none;
    position: relative;
    z-index: 1;
    .btn-text {
      line-height: 32px;
    }
    .btn {
      margin-right: 8px;
    }
    .action-item {
      width: 32px;
    }
    .action-separator {
      width: 300px;
      height: 1px;
      background-color: var(--ref-palette-neutral-400);
    }
  `}function action_block_ActionBlock(props){const{layoutId,pageContext,onTemplateSelected,onPageTemplateSelected}=props,{formatMessage,rootLayoutId}=pageContext,[showTemplatePopper,setShowTemplatePopper]=jimu_core.q_G.useState(!1),[showPageTemplatePopper,setShowPageTemplatePopper]=jimu_core.q_G.useState(!1),[showWidgetPopper,setShowWidgetPopper]=jimu_core.q_G.useState(!1),isGridPage=layoutId===rootLayoutId,placeholderRef=jimu_core.q_G.useRef(null),templateRef=jimu_core.q_G.useRef(null),pageTemplateRef=jimu_core.q_G.useRef(null),show=jimu_core.E_S.useSelector((state=>{var _a,_b,_c;const lockLayout=null!==(_c=null===(_b=null===(_a=state.appConfig)||void 0===_a?void 0:_a.forBuilderAttributes)||void 0===_b?void 0:_b.lockLayout)&&void 0!==_c&&_c;return state.appRuntimeInfo.appMode===jimu_core.$0N.Design&&!lockLayout}));jimu_core.JLE.useEffectOnce((()=>{isGridPage||(0,jimu_core.Vp3)().getState().browserSizeMode===jimu_core.rHp.Small||setShowTemplatePopper(!0)}));const templateTooltip=formatMessage("chooseTemplate",{type:formatMessage("grid").toLocaleLowerCase()}),pageTemplateTooltip=formatMessage("chooseTemplate",{type:formatMessage("page").toLocaleLowerCase()}),handleTemplateSelected=template=>{setShowTemplatePopper(!1),onTemplateSelected(template)},handlePageTemplateSelected=template=>{setShowPageTemplatePopper(!1),onPageTemplateSelected(template)},handleWidgetSelected=item=>{setShowWidgetPopper(!1);const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();let res;res=item.itemType===jimu_core.K6q.Section?new Promise((resolve=>{resolve(appConfigAction.addNewSectionToLayout(layoutId))})):appConfigAction.addNewWidgetToLayout(layoutId,{uri:item.uri,itemId:item.itemId}),res.then((layoutItemId=>{const rootLayoutInfo={layoutId,layoutItemId};appConfigAction.editLayoutProperty(layoutId,"setting.rootItem",layoutItemId).editLayoutItemProperty(rootLayoutInfo,"bbox",{width:100}).editLayoutItemProperty(rootLayoutInfo,"gridType",jimu_core.Qwn.Plain),updateLayoutAndSelection(appConfigAction.appConfig,rootLayoutInfo)}))};return show?(0,jimu_core.Yac)("div",{className:"w-100 flex-column justify-content-center align-items-center",css:action_block_getStyle(isGridPage)},(0,jimu_core.Yac)("div",{className:"d-flex justify-content-center align-items-center"},!isGridPage&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(theme_tooltip.v,{placement:"bottom",title:formatMessage("addWidget")},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,ref:placeholderRef,css:action_block_buttonStyle,onClick:e=>{e.stopPropagation(),(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small?setShowWidgetPopper(!showWidgetPopper):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"widget",isPlaceholder:!1,isItemAccepted:()=>!0,onSelect:handleWidgetSelected})},"aria-haspopup":!0},(0,jimu_core.Yac)(editor_plus.b,{size:16}))),(0,jimu_core.Yac)(theme_tooltip.v,{placement:"bottom",title:templateTooltip},(0,jimu_core.Yac)("div",{className:"action-item"},(0,jimu_core.Yac)(jimu_ui.Button,{ref:templateRef,icon:!0,onClick:e=>{e.stopPropagation(),(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small?setShowTemplatePopper(!showTemplatePopper):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"template",templateMethod:"getGridTemplates",onSelect:handleTemplateSelected})},css:action_block_buttonStyle,"aria-haspopup":!0},(0,jimu_core.Yac)(grid_template.$,{autoFlip:!0,size:16}))))),isGridPage&&(0,jimu_core.Yac)(theme_tooltip.v,{placement:"bottom",title:pageTemplateTooltip},(0,jimu_core.Yac)("div",{className:"action-item"},(0,jimu_core.Yac)(jimu_ui.Button,{ref:pageTemplateRef,icon:!0,onClick:e=>{e.stopPropagation(),(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small?setShowPageTemplatePopper(!showPageTemplatePopper):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"template",templateMethod:"getFullScreenGridPageTemplates",onSelect:handlePageTemplateSelected})},css:action_block_buttonStyle,className:"rounded-circle","aria-haspopup":!0},(0,jimu_core.Yac)(grid_template.$,{autoFlip:!0,size:16}))))),isGridPage&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)("div",{className:"action-separator mt-4"}),(0,jimu_core.Yac)("div",null,(0,jimu_core.Yac)("h5",{className:"btn-text mt-2"},formatMessage("dropWidgetToAdd")))),showTemplatePopper&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getGridTemplates)(),referenceElement:templateRef.current,onItemSelect:handleTemplateSelected,onClose:()=>{setShowTemplatePopper(!1)}}),showWidgetPopper&&(0,jimu_core.Yac)(action_block_ThemeWidgetListPopper,{referenceElement:placeholderRef.current,isAccepted:()=>!0,onSelect:handleWidgetSelected,onClose:()=>{setShowWidgetPopper(!1)}}),showPageTemplatePopper&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getFullScreenGridPageTemplates)(!1),referenceElement:pageTemplateRef.current,onItemSelect:handlePageTemplateSelected,onClose:()=>{setShowPageTemplatePopper(!1)}})):null}try{action_block_ActionBlock.displayName="ActionBlock",action_block_ActionBlock.__docgenInfo={description:"",displayName:"ActionBlock",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},pageContext:{defaultValue:null,description:"",name:"pageContext",required:!0,type:{name:"PageContextProps"}},onTemplateSelected:{defaultValue:null,description:"",name:"onTemplateSelected",required:!0,type:{name:"(templateBlockJson: any) => void"}},onPageTemplateSelected:{defaultValue:null,description:"",name:"onPageTemplateSelected",required:!0,type:{name:"(templatePageJson: any) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/grid-layout/builder/action-block.tsx#ActionBlock"]={docgenInfo:action_block_ActionBlock.__docgenInfo,name:"ActionBlock",path:"../jimu-layouts/lib/grid-layout/builder/action-block.tsx#ActionBlock"})}catch(__react_docgen_typescript_loader_error){}var builder_layout_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const grid_layout_builder_layout_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  bottom: 0;
  top: 0;
  right: 0;
  background: transparent;
  display: flex;
`,layout_getStyle=layoutSetting=>{const theme2=(0,jimu_theme.wE)(),padding=(0,common_utils.lC)(layoutSetting);return jimu_core.AHW`
    overflow: hidden;
    position: relative;
    ${padding}

    .grid-root-drop-area {
      position: absolute;
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(255, 255, 255, 0.04);
      box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
      border-radius: 7px;
      display: none !important;
      z-index: 30;

      &.top {
        top: 2px;
        left: 50%;
        width: 60px;
        height: 10px;
        transform: translateX(-50%);
      }

      &.bottom {
        bottom: 2px;
        left: 50%;
        width: 60px;
        height: 10px;
        transform: translateX(-50%);
      }

      &.right {
        right: 2px;
        top: 50%;
        height: 60px;
        width: 10px;
        transform: translateY(-50%);
      }

      &.left {
        left: 2px;
        top: 50%;
        height: 60px;
        width: 10px;
        transform: translateY(-50%);
      }
    }

    .${GLOBAL_H5_DRAGGING_CLASS_NAME} &.drop-target > .grid-root-drop-area,
    .${GLOBAL_DRAGGING_CLASS_NAME} &.drop-target > .grid-root-drop-area {
      display: flex !important;
    }

    .highlight-area {
      background: ${jimu_core.PLL.rgba(theme2.sys.color.primary.dark,.2)};
      position: absolute;
      opacity: 0.6;
      pointer-events: none;
      display: none;

      &.active {
        display: block;
      }

      &.top {
        top: 0;
        width: 100%;
        height: 50%;
      }
      &.bottom {
        bottom: 0;
        width: 100%;
        height: 50%;
      }
      &.left {
        left: 0;
        width: 50%;
        height: 100%;
      }
      &.right {
        right: 0;
        width: 50%;
        height: 100%;
      }
      &.center {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    }
  `};class GridLayout extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.handleDragOver=()=>null,this.handleDragEnter=()=>null,this.handleDragLeave=()=>null,this.handleDrop=(draggingItem,containerRect,itemRect)=>{const{layout}=this.props,layoutInfo={layoutId:layout.id};let appConfigAction=(0,jimu_for_builder.getAppConfigAction)();addItemToGrid(appConfigAction.appConfig,draggingItem,layoutInfo,null,SideType.Center).then((result=>{const{appConfig,layoutInfo:newLayoutInfo}=result;appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),appConfigAction.exec(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged(newLayoutInfo))}))},this.handleTemplateSelected=templateGridJson=>builder_layout_awaiter(this,void 0,void 0,(function*(){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),{layout}=this.props;yield appConfigAction.applyGridTemplate(layout.parent.id,templateGridJson),appConfigAction.exec()})),this.handlePageTemplateSelected=templatePageJson=>{const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();this.setState({isLoadingTemplate:!0}),appConfigAction.applyPageBodyTemplate(this.pageContext.pageId,templatePageJson).then((()=>{appConfigAction.exec(),jimu_core.CM0.defer((()=>{this.setState({isLoadingTemplate:!1})}))})).finally(null)},this.highlight=side=>{this.tipRef.current.classList.add("active",side)},this.clearHighlight=side=>{this.tipRef.current.classList.remove("active",side)};const{layout}=this.props;this.fakeLayouts=(0,jimu_core.J3Z)({[jimu_core.rHp.Large]:`${layout.id}_tlarge`,[jimu_core.rHp.Medium]:`${layout.id}_tmedium`,[jimu_core.rHp.Small]:`${layout.id}_tsmall`}),this.tipRef=jimu_core.q_G.createRef()}findExtension(){const exts=jimu_core.nH3.getInstance().getExtensions(`${jimu_core.vZE.R6.LayoutTransformer}`);if((null==exts?void 0:exts.length)>0){const ext=exts.find((item=>item.layoutType===jimu_core.p5K.GridLayout));this.layoutTransform=null==ext?void 0:ext.transformLayout}}handleDropAtSide(draggingItem,side){this.clearHighlight(side);const layoutId=this.props.layout.id;let appConfigAction=(0,jimu_for_builder.getAppConfigAction)();this.tipRef.current.parentElement.classList.remove("drop-target"),function splitGrid(appConfig,item,gridLayoutId,side){return utils_awaiter(this,void 0,void 0,(function*(){const{layoutInfo}=item;let newLayoutItemId,outAppConfig=appConfig;if((null==layoutInfo?void 0:layoutInfo.layoutId)===gridLayoutId){const layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo);if(layoutItem.isPending)outAppConfig=outAppConfig.setIn(["layouts",gridLayoutId,"content",layoutInfo.layoutItemId],layoutItem.without("isPending"));else{const updateLayout=detachGridItem(outAppConfig.layouts[gridLayoutId],layoutInfo.layoutItemId);outAppConfig=outAppConfig.setIn(["layouts",gridLayoutId],updateLayout)}newLayoutItemId=layoutInfo.layoutItemId}else{const result=yield addItem(appConfig,item,{layoutId:gridLayoutId});newLayoutItemId=result.newLayoutItemId,outAppConfig=result.updatedAppConfig}const layout=outAppConfig.layouts[gridLayoutId],rootLayoutItemId=layout.setting.rootItem,rootItem=layout.content[rootLayoutItemId];let newRootItem;if(side===SideType.Left||side===SideType.Right){if(rootItem.gridType===jimu_core.Qwn.Row){let outLayout=layout;outLayout=updateSize(outLayout,rootLayoutItemId,100),outLayout=updateSize(outLayout,newLayoutItemId,50),outLayout=updateGridItem(outLayout,newLayoutItemId,"parent",rootLayoutItemId),rootItem.children.forEach((id=>{const childItem=outLayout.content[id];outLayout=updateSize(outLayout,id,+childItem.bbox.width/2)}));const content=[...rootItem.children];return side===SideType.Left?content.unshift(newLayoutItemId):content.push(newLayoutItemId),outLayout=outLayout.setIn(["content",rootLayoutItemId,"children"],content),outAppConfig=outAppConfig.setIn(["layouts",gridLayoutId],outLayout),{appConfig:outAppConfig,itemId:newLayoutItemId}}newRootItem=createEmptyGridItem(layout,jimu_core.Qwn.Row)}else{if(rootItem.gridType===jimu_core.Qwn.Column){let outLayout=layout;outLayout=updateSize(outLayout,rootLayoutItemId,100),outLayout=updateSize(outLayout,newLayoutItemId,50),outLayout=updateGridItem(outLayout,newLayoutItemId,"parent",rootLayoutItemId),rootItem.children.forEach((id=>{const childItem=outLayout.content[id];outLayout=updateSize(outLayout,id,+childItem.bbox.width/2)}));const content=[...rootItem.children];return side===SideType.Top?content.unshift(newLayoutItemId):content.push(newLayoutItemId),outLayout=outLayout.setIn(["content",rootLayoutItemId,"children"],content),outAppConfig=outAppConfig.setIn(["layouts",gridLayoutId],outLayout),{appConfig:outAppConfig,itemId:newLayoutItemId}}newRootItem=createEmptyGridItem(layout,jimu_core.Qwn.Column)}let{outLayout,outItem}=newRootItem;return outLayout=outLayout.setIn(["setting","rootItem"],outItem.id),outLayout=updateSize(outLayout,outItem.id,100),outLayout=updateSize(outLayout,rootLayoutItemId,50),outLayout=updateGridItem(outLayout,rootLayoutItemId,"parent",outItem.id),outLayout=updateSize(outLayout,newLayoutItemId,50),outLayout=updateGridItem(outLayout,newLayoutItemId,"parent",outItem.id),outLayout=side===SideType.Left||side===SideType.Top?updateGridItem(outLayout,outItem.id,"children",[newLayoutItemId,rootLayoutItemId]):updateGridItem(outLayout,outItem.id,"children",[rootLayoutItemId,newLayoutItemId]),outAppConfig=outAppConfig.setIn(["layouts",gridLayoutId],outLayout),{appConfig:outAppConfig,itemId:newLayoutItemId}}))}(appConfigAction.appConfig,draggingItem,layoutId,side).then((({appConfig,itemId})=>{appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),appConfigAction.exec(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged({layoutId,layoutItemId:itemId}))}))}render(){var _a,_b,_c;const{layouts,layout,browserSizeMode,mainSizeMode,className}=this.props,viewOnly=layouts[browserSizeMode]!==layout.id;let finalLayout=layout;viewOnly&&(null==this.layoutTransform&&this.findExtension(),null!=this.layoutTransform&&(finalLayout=this.layoutTransform(layout,mainSizeMode,browserSizeMode)));const{rootItem:rootItemId}=null!==(_a=finalLayout.setting)&&void 0!==_a?_a:{},rootItem=(0,common_utils.a2)(finalLayout,rootItemId),outClass=(0,jimu_core.xWm)("layout grid-layout d-flex w-100 h-100",className),childrenSize=null!==(_c=null===(_b=null==rootItem?void 0:rootItem.children)||void 0===_b?void 0:_b.length)&&void 0!==_c?_c:0;return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(props=>(this.pageContext=props,(0,jimu_core.Yac)("div",{className:outClass,css:layout_getStyle(finalLayout.setting),"data-layoutid":finalLayout.id},(0,jimu_core.Yac)(jimu_core.zKZ.Provider,{value:{monitor:!1}},(0,jimu_core.Yac)(jimu_core._kc,{oid:finalLayout.id,"data-layoutid":finalLayout.id,className:"trail-container d-flex w-100 h-100",css:jimu_core.AHW`
                    width: 100%;
                  `},null==rootItem&&(0,jimu_core.Yac)(droparea_hook_DropArea,{css:grid_layout_builder_layout_dropareaStyle,layouts:this.props.layouts,highlightDragover:!0,onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDragOver:this.handleDragOver,onDrop:this.handleDrop},(0,jimu_core.Yac)("div",{css:jimu_core.AHW`
                          width: 100%;
                          background: var(--cyan-500);
                        `})),null==rootItem&&!viewOnly&&(0,jimu_core.Yac)(action_block_ActionBlock,{layoutId:layout.id,pageContext:props,onTemplateSelected:this.handleTemplateSelected,onPageTemplateSelected:this.handlePageTemplateSelected}),rootItem?(0,jimu_core.Yac)(GridItemComponent,{className:"w-100 h-100",layout:finalLayout,layoutItemId:rootItemId}):this.props.children)),childrenSize>1&&[SideType.Top,SideType.Right,SideType.Bottom,SideType.Left].map((side=>(0,jimu_core.Yac)(droparea_hook_DropArea,{key:side,className:`${side} grid-root-drop-area shadow-sm`,layouts:this.fakeLayouts,onDrop:draggingItem=>{this.handleDropAtSide(draggingItem,side)},onDragEnter:()=>{this.highlight(side)},onDragLeave:()=>{this.clearHighlight(side)}}))),(0,jimu_core.Yac)("div",{ref:this.tipRef,className:"highlight-area"})))))}}const grid_layout_builder_layout=jimu_core.E_S.connect(layout_runtime.utils.mapStateToLayoutProps)(GridLayout);try{layout.displayName="layout",layout.__docgenInfo={description:"",displayName:"layout",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"ImmutableObjectMixin<SizeModeLayoutJson> & { readonly [x: string]: string; }"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},isInWidget:{defaultValue:null,description:"",name:"isInWidget",required:!1,type:{name:"boolean"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},isPageItem:{defaultValue:null,description:"",name:"isPageItem",required:!1,type:{name:"boolean"}},itemDraggable:{defaultValue:null,description:"",name:"itemDraggable",required:!1,type:{name:"boolean"}},itemResizable:{defaultValue:null,description:"",name:"itemResizable",required:!1,type:{name:"boolean"}},itemSelectable:{defaultValue:null,description:"",name:"itemSelectable",required:!1,type:{name:"boolean"}},droppable:{defaultValue:null,description:"",name:"droppable",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isItemAccepted:{defaultValue:null,description:"",name:"isItemAccepted",required:!1,type:{name:"(item: LayoutItemConstructorProps, isReplacePlaceholder: boolean) => boolean"}},onItemClick:{defaultValue:null,description:"",name:"onItemClick",required:!1,type:{name:"(e: any, widgetId: string) => void"}},ignoreMinHeight:{defaultValue:null,description:"",name:"ignoreMinHeight",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/grid-layout/builder/layout.tsx#layout"]={docgenInfo:layout.__docgenInfo,name:"layout",path:"../jimu-layouts/lib/grid-layout/builder/layout.tsx#layout"})}catch(__react_docgen_typescript_loader_error){}var item_title=__webpack_require__("../jimu-layouts/lib/accordion-layout/common/item-title.tsx"),down=__webpack_require__("../jimu-icons/svg/outlined/directional/down.svg"),down_default=__webpack_require__.n(down),up=__webpack_require__("../jimu-icons/svg/outlined/directional/up.svg"),up_default=__webpack_require__.n(up);const accordionItemMenus=[{icon:down_default(),title:props=>props.formatMessage("movedown"),disabled:props=>{const{layoutId,layoutItem}=props,layoutJson=(0,jimu_for_builder.getAppConfigAction)().appConfig.layouts[layoutId];return layoutJson.order.indexOf(layoutItem.id)===layoutJson.order.length-1},visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout(),onClick:props=>{const{layoutId,layoutItem}=props,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),layoutJson=appConfigAction.appConfig.layouts[layoutId],order=[].concat(layoutJson.order),index=order.indexOf(layoutItem.id);order.splice(index,2,layoutJson.order[index+1],layoutJson.order[index]),appConfigAction.editLayoutProperty(layoutId,"order",order),appConfigAction.exec()}},{icon:up_default(),title:props=>props.formatMessage("moveup"),disabled:props=>{var _a;const{layoutId,layoutItem}=props;return(null===(_a=(0,jimu_for_builder.getAppConfigAction)().appConfig.layouts[layoutId].order)||void 0===_a?void 0:_a[0])===layoutItem.id},visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout(),onClick:props=>{const{layoutId,layoutItem}=props,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),layoutJson=appConfigAction.appConfig.layouts[layoutId],order=[].concat(layoutJson.order),index=order.indexOf(layoutItem.id);order.splice(index-1,2,layoutJson.order[index],layoutJson.order[index-1]),appConfigAction.editLayoutProperty(layoutId,"order",order),appConfigAction.exec()}},{separator:!0}],panel_getStyle=options=>{const{height,gap,headerConfig,panelConfig,isFunctionalWidget,isInlineEditing,isSection}=options,config=null!=headerConfig?headerConfig:{},pConfig=null!=panelConfig?panelConfig:{},{padding,expandedColor,collapsedColor,border,borderLeft,borderRight,borderTop,borderBottom,borderRadius}=config,{padding:panelPadding,border:panelBorder,borderRadius:panelBD,backgroundColor}=pConfig;return jimu_core.AHW`
  position: relative;
  touch-action: none;
  user-select: ${isInlineEditing?"auto":"none"};
  & + .foldable-panel {
    margin-top: ${gap}px;
  }
  .panel-header {
    padding: ${jimu_ui.styleUtils.toCSSPadding(padding)};
    border: ${jimu_ui.styleUtils.toCSSBorder(border)};
    border-left: ${jimu_ui.styleUtils.toCSSBorder(borderLeft)};
    border-right: ${jimu_ui.styleUtils.toCSSBorder(borderRight)};
    border-top: ${jimu_ui.styleUtils.toCSSBorder(borderTop)};
    border-bottom: ${jimu_ui.styleUtils.toCSSBorder(borderBottom)};
    border-radius: ${jimu_ui.styleUtils.toCSSBorderRadius(borderRadius)};
    background-color: ${null!=expandedColor?expandedColor:"var(--sys-color-primary-main)"};
    .tool-drag-handler {
      cursor: pointer;
      flex-grow: 1;
      flex-shrink: 1;
    }
  }
  .panel-content {
    padding: ${jimu_ui.styleUtils.toCSSPadding(panelPadding)};
    border: ${jimu_ui.styleUtils.toCSSBorder(panelBorder)};
    border-left: ${jimu_ui.styleUtils.toCSSBorder(pConfig.borderLeft)};
    border-right: ${jimu_ui.styleUtils.toCSSBorder(pConfig.borderRight)};
    border-top: ${jimu_ui.styleUtils.toCSSBorder(pConfig.borderTop)};
    border-bottom: ${jimu_ui.styleUtils.toCSSBorder(pConfig.borderBottom)};
    border-radius: ${jimu_ui.styleUtils.toCSSBorderRadius(panelBD)};
    overflow: auto;
    background-color: ${null!=backgroundColor?backgroundColor:"none"};
    position: relative;
    height: ${height};
    opacity: 1;
    transition: opacity 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
  }
  &.collapsed {
    .panel-header {
      background-color: ${null!=collapsedColor?collapsedColor:"var(--sys-color-primary-main)"};
    }
    .panel-content {
      height: 0;
      padding: unset;
      border: none;
      visibility: hidden;
      .layout-item {
        display: none;
      }
    }
  }
  .${GLOBAL_H5_DRAGGING_CLASS_NAME} &.functional-widget {
     pointer-events: none;
   }
   .${GLOBAL_H5_DRAGGING_CLASS_NAME} &.functional-widget .exb-drop-area {
     pointer-events: all;
   }

   .${GLOBAL_H5_DRAGGING_CLASS_NAME} &,
   .${GLOBAL_DRAGGING_CLASS_NAME} & {
     > div.highlight-tip {
       .tip-content {
         outline-color: var(--ref-palette-neutral-900);
       }
     }
   }
   body:not(.design-mode) &,
      body.lock-layout & {
        cursor: default;
      }

      body:not(.design-mode) & > div.highlight-tip {
        display: none !important;
      }

      & > div.highlight-tip {
        display: block;
        padding: inherit;
        position: absolute;
        left: 0;
        bottom: 0;
        top: 0;
        right: 0;
        pointer-events: none;
        .tip-content {
          height: 100%;
          padding: 1px;
          &:after {
            content: '';
            width: 100%;
            height: 100%;
            outline: 1px dashed var(--ref-palette-neutral-900);
            display: block;
            outline-color: ${!isFunctionalWidget||isSection?"var(--ref-palette-neutral-900)":"transparent"};
          }
        }
      }

      &:hover > div.highlight-tip,
      &.hovered > div.highlight-tip {
        display: block;
        .tip-content {
          &:after {
            outline-color: var(--sys-color-primary-main);
          }
        }
      }

      &.functional-widget:not(.selected):hover > div.highlight-tip,
      &.functional-widget:not(.selected).hovered > div.highlight-tip {
        .tip-content {
          &:after {
            outline-width: 2px;
          }
        }
      }
  `};function Panel(props){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p;const{layoutId,layoutItemId,expanded,selected,resizable,isResizing,isInlineEditing,height,gap,onExpandedChange,onClick,onDoubleClick,onResizeStart,onResizeEnd,onResizing}=props,dragElementRef=jimu_core.q_G.useRef(null),resizeElementRef=jimu_core.q_G.useRef(null),mousedownPositionRef=jimu_core.q_G.useRef({x:0,y:0}),translate=jimu_core.JLE.useTranslation(),{viewOnly}=jimu_core.q_G.useContext(layout_runtime.PageContext),layoutItem=jimu_core.E_S.useSelector((state=>layout_runtime.searchUtils.findLayoutItem(state.appConfig,{layoutId,layoutItemId}))),label=jimu_core.E_S.useSelector((state=>{var _a,_b;if(layoutItem.type===jimu_core.K6q.Widget){const widgetId=layoutItem.widgetId,widgetJson=state.appConfig.widgets[widgetId];return null!==(_a=null==widgetJson?void 0:widgetJson.label)&&void 0!==_a?_a:""}const sectionId=layoutItem.sectionId,sectionJson=state.appConfig.sections[sectionId];return null!==(_b=null==sectionJson?void 0:sectionJson.label)&&void 0!==_b?_b:""})),isFunctionalWidget=jimu_core.E_S.useSelector((state=>layoutItem.type===jimu_core.K6q.Widget&&layout_runtime.utils.isFunctionalWidget(layoutItem.widgetId,state.appConfig))),headerConfig=jimu_core.E_S.useSelector((state=>{var _a;const parentWidgetId=state.appConfig.layouts[layoutId].parent.id;return null===(_a=state.appConfig.widgets[parentWidgetId].config)||void 0===_a?void 0:_a.header})),panelConfig=jimu_core.E_S.useSelector((state=>{var _a;const parentWidgetId=state.appConfig.layouts[layoutId].parent.id;return null===(_a=state.appConfig.widgets[parentWidgetId].config)||void 0===_a?void 0:_a.panel})),isSection=jimu_core.E_S.useSelector((state=>layoutItem.type===jimu_core.K6q.Section));jimu_core.q_G.useEffect((()=>{let dragInteractable=interact_min_default()(dragElementRef.current).origin("parent");dragInteractable=bindDragHandler(dragInteractable,{layoutId,layoutItemId,onDragging:null,useDragHandler:!0,itemType:null,rootLayoutId:()=>"",restrict:()=>!1});let resizeInteractable=interact_min_default()(resizeElementRef.current).origin("parent");return resizeInteractable=bindResizeHandler(resizeInteractable,{layoutItemId,restrictEdges:!1,onResizeStart:(id,initWidth,initHeight)=>{const panelHeader=resizeElementRef.current.querySelector(".panel-header");let contentHeight=initHeight;panelHeader&&(contentHeight=initHeight-panelHeader.clientHeight),onResizeStart(id,initWidth,contentHeight)},onResizing,onResizeEnd}),()=>{null==dragInteractable||dragInteractable.unset(),null==resizeInteractable||resizeInteractable.unset()}}),[layoutId,layoutItemId,onResizeStart,onResizing,onResizeEnd]),jimu_core.q_G.useEffect((()=>{interact_min_default()(dragElementRef.current).resizable(resizable)}),[resizable]);const toggleCollapse=jimu_core.q_G.useCallback((e=>{const{x,y}=mousedownPositionRef.current;Math.abs(e.screenX-x)>layout_runtime.CLICK_TOLERANCE||Math.abs(e.screenY-y)>layout_runtime.CLICK_TOLERANCE?e.stopPropagation():onExpandedChange(layoutItemId,!expanded)}),[layoutItemId,expanded,onExpandedChange]),handlePanelClick=jimu_core.q_G.useCallback((e=>{!viewOnly&&(!isLockLayout()&&isDesignMode()||isFunctionalWidget||layoutItem.type===jimu_core.K6q.Section)&&(e.stopPropagation(),onClick())}),[viewOnly,isFunctionalWidget,layoutItem.type,onClick]),handleDoubleClick=jimu_core.q_G.useCallback((e=>{viewOnly||(e.stopPropagation(),onDoubleClick())}),[viewOnly,onDoubleClick]),handleMouseDown=jimu_core.q_G.useCallback((e=>{mousedownPositionRef.current={x:e.screenX,y:e.screenY}}),[]);const togglePosition=null!==(_a=null==headerConfig?void 0:headerConfig.togglePosition)&&void 0!==_a?_a:"right",isAutoHeight=(null===(_c=null===(_b=layoutItem.setting)||void 0===_b?void 0:_b.autoProps)||void 0===_c?void 0:_c.height)===layout_runtime.LayoutItemSizeModes.Auto,useAspectRatio=layout_runtime.utils.shouldUseAspectRatio(null!==(_d=layoutItem.setting)&&void 0!==_d?_d:{});let calHeight=height;isResizing?calHeight=height:(isAutoHeight||useAspectRatio)&&(calHeight="auto");const icon=expanded?null===(_e=null==headerConfig?void 0:headerConfig.collapseIcon)||void 0===_e?void 0:_e.svg:null===(_f=null==headerConfig?void 0:headerConfig.expandIcon)||void 0===_f?void 0:_f.svg;return(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("builder-layout-item exb-rnd foldable-panel",{selected,collapsed:!expanded,"no-drag-action":!function canDrag(){const isTouchDevice=jimu_core.WpD.isTouchDevice();return!viewOnly&&!isInlineEditing&&(!isTouchDevice||selected)}(),"functional-widget":isFunctionalWidget}),"data-layoutid":layoutId,"data-layoutitemid":layoutItemId,ref:dragElementRef,onClick:handlePanelClick,onDoubleClick:handleDoubleClick,onKeyDown:null,css:panel_getStyle({height:calHeight,gap,headerConfig,panelConfig,isFunctionalWidget,isInlineEditing,isSection})},(0,jimu_core.Yac)("div",{className:"panel d-flex flex-column",ref:resizeElementRef},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("panel-header d-flex align-items-center",{"flex-row-reverse":"left"===togglePosition}),onClick:toggleCollapse,onMouseDown:handleMouseDown,onKeyDown:null,role:"group","aria-label":label},(0,jimu_core.Yac)("div",{className:"tool-drag-handler"},layoutId&&layoutItemId&&(0,jimu_core.Yac)(item_title.E,{layoutId,layoutItemId})),icon&&(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("actions",{"ml-auto":"right"===togglePosition})},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,type:"tertiary",size:"sm","aria-expanded":expanded,title:translate(expanded?"clickToHide":"clickToShow"),"aria-label":translate(expanded?"clickToHide":"clickToShow")},(0,jimu_core.Yac)(jimu_ui.Icon,{icon,size:expanded?null===(_h=null===(_g=null==headerConfig?void 0:headerConfig.collapseIcon)||void 0===_g?void 0:_g.properties)||void 0===_h?void 0:_h.size:null===(_k=null===(_j=null==headerConfig?void 0:headerConfig.expandIcon)||void 0===_j?void 0:_j.properties)||void 0===_k?void 0:_k.size,color:expanded?null===(_m=null===(_l=null==headerConfig?void 0:headerConfig.collapseIcon)||void 0===_l?void 0:_l.properties)||void 0===_m?void 0:_m.color:null===(_p=null===(_o=null==headerConfig?void 0:headerConfig.expandIcon)||void 0===_o?void 0:_o.properties)||void 0===_p?void 0:_p.color})))),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("panel-content d-flex flex-grow-1 flex-shrink-1")},props.children),selected&&(0,jimu_core.Yac)(select_wrapper,{layoutId,layoutItem,top:!1,left:!1,right:!1,bottom:expanded&&!isAutoHeight&&!useAspectRatio,resizable:expanded&&!isAutoHeight&&!useAspectRatio,draggable:!0,selected:!0,forbidToolbar:!1,toolItems:accordionItemMenus,showDefaultTools:!0,isInlineEditing:!1,isFunctionalWidget:!0,hasEmbeddedLayout:!1,isSection:!1,hasExtension:!1})),(0,jimu_core.Yac)("div",{className:"highlight-tip"},(0,jimu_core.Yac)("div",{className:"tip-content"})))}try{Panel.displayName="Panel",Panel.__docgenInfo={description:"",displayName:"Panel",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!1,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!1,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((e: any, layoutInfo: LayoutInfo) => void) & (() => void)"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"((e: any, layoutInfo: LayoutInfo) => void) & (() => void)"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},selected:{defaultValue:null,description:"",name:"selected",required:!0,type:{name:"boolean"}},expanded:{defaultValue:null,description:"",name:"expanded",required:!0,type:{name:"boolean"}},isResizing:{defaultValue:null,description:"",name:"isResizing",required:!0,type:{name:"boolean"}},isInlineEditing:{defaultValue:null,description:"",name:"isInlineEditing",required:!0,type:{name:"boolean"}},height:{defaultValue:null,description:"",name:"height",required:!0,type:{name:"string"}},gap:{defaultValue:null,description:"",name:"gap",required:!0,type:{name:"number"}},onExpandedChange:{defaultValue:null,description:"",name:"onExpandedChange",required:!0,type:{name:"(layoutItemId: string, expanded: boolean) => void"}},onResizeStart:{defaultValue:null,description:"",name:"onResizeStart",required:!0,type:{name:"(id: string, initWidth: number, initHeight: number) => void"}},onResizing:{defaultValue:null,description:"",name:"onResizing",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number, shiftKey: boolean, speed: number) => void"}},onResizeEnd:{defaultValue:null,description:"",name:"onResizeEnd",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number, shiftKey: boolean) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/accordion-layout/builder/panel.tsx#Panel"]={docgenInfo:Panel.__docgenInfo,name:"Panel",path:"../jimu-layouts/lib/accordion-layout/builder/panel.tsx#Panel"})}catch(__react_docgen_typescript_loader_error){}function AccordionItem(props){var _a,_b,_c,_d;const{layoutId,layoutItem,layoutItemId,gap,expanded,onResizeEnd,onResizeStart,onExpandedChange}=props,[isResizing,setIsResizing]=jimu_core.q_G.useState(!1),[deltaH,setDeltaH]=jimu_core.q_G.useState(0),initHeightRef=jimu_core.q_G.useRef(0),initWidthRef=jimu_core.q_G.useRef(0),isWidget=layoutItem.type===jimu_core.K6q.Widget,isSection=layoutItem.type===jimu_core.K6q.Section,widgetProps=jimu_core.E_S.useSelector((state=>{if(isWidget)return lib_utils.mapStateToWidgetProps(state,props)}),jimu_core.E_S.shallowEqual),sectionProps=jimu_core.E_S.useSelector((state=>{if(isSection)return layout_runtime.searchUtils.getSectionInfo(state,layoutItem.sectionId)}),jimu_core.E_S.shallowEqual),selected=jimu_core.E_S.useSelector((state=>{const selection=state.appRuntimeInfo.selection;return(null==selection?void 0:selection.layoutId)===layoutId&&(null==selection?void 0:selection.layoutItemId)===layoutItemId})),handleResizeEnd=jimu_core.q_G.useCallback(((id,dx,dy,dw,dh)=>{setIsResizing(!1),onResizeEnd(id,dx,dy,dw,dh)}),[onResizeEnd]),handleResizeStart=jimu_core.q_G.useCallback(((id,initWidth,initHeight)=>{initWidthRef.current=initWidth,initHeightRef.current=initHeight,setIsResizing(!0),onResizeStart(id,initWidth,initHeight)}),[onResizeStart]),handleResizing=jimu_core.q_G.useCallback(((id,dx,dy,dw,dh)=>{setDeltaH(dh)}),[]),resizable=(null===(_b=null===(_a=layoutItem.setting)||void 0===_a?void 0:_a.autoProps)||void 0===_b?void 0:_b.height)!==layout_runtime.LayoutItemSizeModes.Auto,useAspectRatio=layout_runtime.utils.shouldUseAspectRatio(null!==(_c=layoutItem.setting)&&void 0!==_c?_c:{}),aspectRatio=layout_runtime.utils.parseAspectRatio(null===(_d=layoutItem.setting)||void 0===_d?void 0:_d.aspectRatio);let height;return height=isResizing?`${initHeightRef.current+deltaH}px`:layoutItem.bbox.height,(0,jimu_core.Yac)(Panel,{layoutId,layoutItemId,resizable,selected,isResizing,isInlineEditing:null==widgetProps?void 0:widgetProps.isInlineEditing,height,expanded,onExpandedChange,onClick:()=>{selected||(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged({layoutId,layoutItemId}))},onDoubleClick:()=>{(null==widgetProps?void 0:widgetProps.supportInlineEditing)&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.setWidgetIsInlineEditingState(widgetProps.widgetId,!0))},onResizeStart:handleResizeStart,onResizing:handleResizing,onResizeEnd:handleResizeEnd,gap},isWidget&&(0,jimu_core.Yac)(widget_renderer_WidgetRendererInBuilder,Object.assign({layoutId,layoutItemId,forceAspectRatio:useAspectRatio,aspectRatio},widgetProps)),isSection&&(0,jimu_core.Yac)(section_renderer_SectionRendererInBuilder,Object.assign({layoutId,layoutItemId},sectionProps)))}try{AccordionItem.displayName="AccordionItem",AccordionItem.__docgenInfo={description:"",displayName:"AccordionItem",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson | IMLayoutItemJson"}},gap:{defaultValue:null,description:"",name:"gap",required:!0,type:{name:"number"}},expanded:{defaultValue:null,description:"",name:"expanded",required:!0,type:{name:"boolean"}},dw:{defaultValue:null,description:"",name:"dw",required:!1,type:{name:"number"}},dh:{defaultValue:null,description:"",name:"dh",required:!1,type:{name:"number"}},onExpandedChange:{defaultValue:null,description:"",name:"onExpandedChange",required:!0,type:{name:"(layoutItemId: string, expanded: boolean) => void"}},onResizeStart:{defaultValue:null,description:"",name:"onResizeStart",required:!0,type:{name:"(id: string, initWidth: number, initHeight: number) => void"}},onResizeEnd:{defaultValue:null,description:"",name:"onResizeEnd",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/accordion-layout/builder/layout-item.tsx#AccordionItem"]={docgenInfo:AccordionItem.__docgenInfo,name:"AccordionItem",path:"../jimu-layouts/lib/accordion-layout/builder/layout-item.tsx#AccordionItem"})}catch(__react_docgen_typescript_loader_error){}var toggle_all=__webpack_require__("../jimu-layouts/lib/accordion-layout/common/toggle-all.tsx"),accordion_layout_util=__webpack_require__("../jimu-layouts/lib/accordion-layout/util.ts");const accordion_layout_builder_layout_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  bottom: 0;
  top: 0;
  right: 0;
  background: transparent;
`,builder_layout_guideOverlay=jimu_core.AHW`
  ${accordion_layout_builder_layout_dropareaStyle};
  z-index: 20;
  pointer-events: none;
`;function findTheMissingItem(less,more){return more.find((item=>!less.includes(item)))}class builder_layout_Layout extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.handleExpandedChange=(layoutItemId,expanded)=>{expanded?this.props.singleMode?this.setState({expandedItems:[layoutItemId]}):this.state.expandedItems.includes(layoutItemId)||this.setState({expandedItems:[...this.state.expandedItems,layoutItemId]}):this.state.expandedItems.includes(layoutItemId)&&this.setState({expandedItems:this.state.expandedItems.filter((id=>id!==layoutItemId))})},this.expandAll=()=>{const{layout}=this.props;this.setState({expandedItems:[...layout.order]})},this.collapseAll=()=>{this.setState({expandedItems:[]})},this.handleItemResizeStart=(id,initWidth,initHeight)=>{const{layout}=this.props,bbox=layout.content[id].bbox;layout_runtime.utils.isPercentage(bbox.height)&&(this.domRect=this.ref.getBoundingClientRect()),this.resizingRect={width:initWidth,height:initHeight}},this.handleItemResizeEnd=(id,x,y,dw,dh)=>{const{layout}=this.props,bbox=layout.content[id].bbox;let height;height=layout_runtime.utils.isPercentage(bbox.height)?`${(100*(this.resizingRect.height+dh)/this.domRect.height).toFixed(2)}%`:`${Math.round(this.resizingRect.height+dh)}px`,this.childRects=[],this.domRect=null;(0,jimu_for_builder.getAppConfigAction)().editLayoutItemProperty({layoutId:this.props.layout.id,layoutItemId:id},"bbox",{height}).exec()},this.handleDragOver=(draggingItem,draggingElement,containerRect,itemRect)=>{var _a,_b;let rect=null!==(_a=itemRect.handlerRect)&&void 0!==_a?_a:itemRect;if(this.canvasPane.clear(),(null===(_b=this.childRects)||void 0===_b?void 0:_b.length)>0){const{insertY,refId}=calInsertPositionForColumn(containerRect,rect,this.childRects);this.referenceId=refId,rect={top:insertY-5,width:containerRect.width-10,left:5,height:10}}else rect={top:containerRect.height/2-5,width:containerRect.width-10,left:5,height:10};this.canvasPane.setColor(this.builderTheme.sys.color.primary.light),this.canvasPane.drawRect(rect)},this.handleToggleDragoverEffect=value=>{value&&(this.referenceId=null,this.collectBounds(null)),this.setState({isDragover:value})},this.handleDrop=(draggingItem,containerRect,itemRect)=>{this.canvasPane.clear();const{layout}=this.props;let insertIndex=0;null!=this.referenceId?insertIndex=layout.order.indexOf(this.referenceId):null!=layout.order&&(insertIndex=layout.order.length);common_layout_actions_addItemToLayout((0,jimu_for_builder.getAppConfigAction)().appConfig,draggingItem,layout.id).then((result=>{const{layoutInfo,updatedAppConfig}=result,outAppConfig=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.AccordionLayout).processAfterItemAdded(updatedAppConfig,draggingItem,layoutInfo,{currentSizeMode:null,containerRect,itemRect,insertIndex});layout_runtime.utils.changeLayout(outAppConfig,layoutInfo)})).finally(null),this.referenceId=null,this.childRects=[]},this.state={isDragover:!1,expandedItems:this.props.expandByDefault.includes(",")?this.props.expandByDefault.split(","):[]}}componentDidMount(){this.canvasPane=new canvas_pane_CanvasPane(this.canvasRef),this.canvasPane.setSize(this.ref.clientWidth,this.ref.scrollHeight)}componentDidUpdate(prevProps){var _a,_b,_c,_d,_e,_f,_g,_h,_j;if(this.canvasPane.setSize(this.ref.clientWidth,this.ref.scrollHeight),prevProps.singleMode!==this.props.singleMode&&this.props.singleMode)this.state.expandedItems.length>1&&this.setState({expandedItems:[this.state.expandedItems[0]]});else if((null===(_a=prevProps.layout.order)||void 0===_a?void 0:_a.length)!==(null===(_b=this.props.layout.order)||void 0===_b?void 0:_b.length)){const prevLength=null!==(_d=null===(_c=prevProps.layout.order)||void 0===_c?void 0:_c.length)&&void 0!==_d?_d:0,currentLength=null!==(_f=null===(_e=this.props.layout.order)||void 0===_e?void 0:_e.length)&&void 0!==_f?_f:0;if(prevLength<currentLength){const addedItem=findTheMissingItem(null!==(_g=prevProps.layout.order)&&void 0!==_g?_g:[],this.props.layout.order);this.props.singleMode?this.setState({expandedItems:[addedItem]}):this.setState({expandedItems:[...this.state.expandedItems,addedItem]})}if(prevLength>currentLength){const deletedItem=findTheMissingItem(null!==(_h=this.props.layout.order)&&void 0!==_h?_h:[],prevProps.layout.order);if(null===(_j=this.state.expandedItems)||void 0===_j?void 0:_j.includes(deletedItem)){const remaining=this.state.expandedItems.filter((item=>item!==deletedItem));this.setState({expandedItems:remaining})}}}}collectBounds(id){const{layout}=this.props;this.childRects=[],this.domRect=this.ref.getBoundingClientRect();const draggableChildren=this.ref.querySelectorAll(":scope > div.exb-rnd");return(null==draggableChildren?void 0:draggableChildren.length)>0&&draggableChildren.forEach((node=>{const itemId=node.getAttribute("data-layoutitemid");if(id!==itemId&&layout.order.includes(itemId)){const rect=layout_runtime.utils.relativeClientRect(node.getBoundingClientRect(),this.domRect);rect.id=itemId,this.childRects.push(rect)}})),this.childRects.sort(((a,b)=>a.top-b.top))}isEmpty(){var _a;const{layout}=this.props,content=null!==(_a=layout.order)&&void 0!==_a?_a:[];return!(content.length>0&&content.some((id=>!layout.content[id].isPending)))}createItem(itemId,index,layoutSetting){const{layout,showDefaultTools,gap}=this.props;return layout.content[itemId].isPending?null:(0,jimu_core.Yac)(AccordionItem,{key:itemId,layoutId:layout.id,layoutItemId:itemId,gap,expanded:this.state.expandedItems.includes(itemId),layoutItem:layout.content[itemId],draggable:!0,resizable:!0,showDefaultTools,onExpandedChange:this.handleExpandedChange,onResizeStart:this.handleItemResizeStart,onResizeEnd:this.handleItemResizeEnd})}render(){var _a;const{layout,className,showToggleAll,padding}=this.props,content=null!==(_a=layout.order)&&void 0!==_a?_a:[],layoutSetting=Object.assign({},layout.setting);return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(pageContext=>{this.builderTheme=pageContext.builderTheme;const guideVisibleStyle={display:this.state.isDragover?"block":"none"};return(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("layout foldable-layout w-100",className),css:jimu_core.AHW`position: relative;`,"data-layoutid":layout.id},(0,jimu_core.Yac)("div",{className:"h-100 w-100 d-flex flex-column",ref:el=>{this.ref=el},css:jimu_core.AHW`
                  overflow: auto;
                  overflow-x: hidden;
                  padding: ${jimu_ui.styleUtils.toCSSPadding(padding)}
                `},showToggleAll&&(0,jimu_core.Yac)(toggle_all.h,{onExpandAll:this.expandAll,onCollapseAll:this.collapseAll}),(0,jimu_core.Yac)(droparea_hook_DropArea,{css:accordion_layout_builder_layout_dropareaStyle,layouts:this.props.layouts,highlightDragover:!0,onDragOver:this.handleDragOver,onDrop:this.handleDrop,onToggleDragoverEffect:this.handleToggleDragoverEffect}),content.map(((layoutItem,index)=>this.createItem(layoutItem,index,layoutSetting))),this.isEmpty()&&this.props.children,(0,jimu_core.Yac)("canvas",{css:builder_layout_guideOverlay,style:guideVisibleStyle,ref:el=>{this.canvasRef=el}})))}))}}const layout_mapStateToProps=(0,jimu_core.Mz0)([(state,ownProps)=>layout_runtime.utils.mapStateToLayoutProps(state,ownProps),(state,ownProps)=>{var _a,_b;return null!==(_b=null===(_a=(0,accordion_layout_util.H)(ownProps.layouts,state).config)||void 0===_a?void 0:_a.singleMode)&&void 0!==_b&&_b},(state,ownProps)=>{var _a,_b;return null!==(_b=null===(_a=(0,accordion_layout_util.H)(ownProps.layouts,state).config)||void 0===_a?void 0:_a.showToggleAll)&&void 0!==_b&&_b},(state,ownProps)=>{var _a,_b;return null!==(_b=null===(_a=(0,accordion_layout_util.H)(ownProps.layouts,state).config)||void 0===_a?void 0:_a.gap)&&void 0!==_b?_b:4},(state,ownProps)=>{var _a;return null===(_a=(0,accordion_layout_util.H)(ownProps.layouts,state).config)||void 0===_a?void 0:_a.padding},(state,ownProps)=>{var _a,_b,_c;const layoutId=ownProps.layouts[state.browserSizeMode]||ownProps.layouts[state.appConfig.mainSizeMode],layoutJson=state.appConfig.layouts[layoutId],list=null!==(_b=null===(_a=(0,accordion_layout_util.H)(ownProps.layouts,state).config)||void 0===_a?void 0:_a.expandedItems)&&void 0!==_b?_b:[],result=[];return list.length>0&&Object.keys(null!==(_c=layoutJson.content)&&void 0!==_c?_c:{}).forEach((layoutItemId=>{const layoutItem=layoutJson.content[layoutItemId];list.includes(layoutItem.widgetId)&&result.push(layoutItemId)})),result.join(",")}],((layoutProps,singleMode,showToggleAll,gap,padding,expandedItems)=>Object.assign({singleMode,showToggleAll,gap,padding,expandByDefault:expandedItems},layoutProps))),accordion_layout_builder_layout=jimu_core.E_S.connect(layout_mapStateToProps)(builder_layout_Layout);try{layout.displayName="layout",layout.__docgenInfo={description:"",displayName:"layout",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},gap:{defaultValue:null,description:"",name:"gap",required:!0,type:{name:"number"}},padding:{defaultValue:null,description:"",name:"padding",required:!0,type:{name:"FourSidesUnit"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"ImmutableObjectMixin<SizeModeLayoutJson> & { readonly [x: string]: string; }"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},isInWidget:{defaultValue:null,description:"",name:"isInWidget",required:!1,type:{name:"boolean"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},isPageItem:{defaultValue:null,description:"",name:"isPageItem",required:!1,type:{name:"boolean"}},itemDraggable:{defaultValue:null,description:"",name:"itemDraggable",required:!1,type:{name:"boolean"}},itemResizable:{defaultValue:null,description:"",name:"itemResizable",required:!1,type:{name:"boolean"}},itemSelectable:{defaultValue:null,description:"",name:"itemSelectable",required:!1,type:{name:"boolean"}},droppable:{defaultValue:null,description:"",name:"droppable",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isItemAccepted:{defaultValue:null,description:"",name:"isItemAccepted",required:!1,type:{name:"(item: LayoutItemConstructorProps, isReplacePlaceholder: boolean) => boolean"}},onItemClick:{defaultValue:null,description:"",name:"onItemClick",required:!1,type:{name:"(e: any, widgetId: string) => void"}},ignoreMinHeight:{defaultValue:null,description:"",name:"ignoreMinHeight",required:!1,type:{name:"boolean"}},singleMode:{defaultValue:null,description:"",name:"singleMode",required:!0,type:{name:"boolean"}},showToggleAll:{defaultValue:null,description:"",name:"showToggleAll",required:!0,type:{name:"boolean"}},expandByDefault:{defaultValue:null,description:"",name:"expandByDefault",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/accordion-layout/builder/layout.tsx#layout"]={docgenInfo:layout.__docgenInfo,name:"layout",path:"../jimu-layouts/lib/accordion-layout/builder/layout.tsx#layout"})}catch(__react_docgen_typescript_loader_error){}var flex_row_layout_default_setting=__webpack_require__("../jimu-layouts/lib/flex-row-layout/default-setting.ts"),flex_row_layout_common_util=__webpack_require__("../jimu-layouts/lib/flex-row-layout/common/util.ts");class FlexRowItem extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.state={isResizing:!1,dw:0,dh:0},this.onResizeStart=(id,initW,initH)=>{this.initWidth=initW,this.initHeight=initH,this.props.onResizeStart(id),this.setState({isResizing:!0})},this.onResizing=(id,x,y,dw,dh)=>{this.setState({dw,dh,isResizing:!0})},this.onResizeEnd=(id,x,y,dw,dh,shiftKey)=>{const{layoutItem}=this.props;this.props.onResizeEnd(id,x,y,dw,dh,layoutItem),this.setState({isResizing:!1,dw:0,dh:0})}}isStretchInCrossAxis(){const{layoutItem}=this.props;return flex_row_layout_common_util.IW(layoutItem)}calWidth(itemSetting,bbox){return flex_row_layout_common_util.pg(itemSetting,bbox)}getStyle(layoutSetting,isHeightStretch,keepAspectRatio,isAutoHeight){const{layoutItem}=this.props,{dw,dh,isResizing}=this.state,bbox=layoutItem.bbox||{},style=this.calWidth(layoutSetting,bbox);return style.height=isHeightStretch||keepAspectRatio||isAutoHeight?"auto":bbox.height,isResizing&&(dw||dh)&&(style.height=this.initHeight+dh,style.width=this.initWidth+dw),flex_row_layout_common_util.jX(style,layoutSetting,isHeightStretch)}render(){var _a,_b,_c;const{layoutId,layoutItem,draggable,resizable,selectable,showDefaultTools}=this.props;if(!layoutItem||layoutItem.isPending)return null;const layoutSetting=layoutItem.setting||{},widthMode=null!==(_b=null===(_a=layoutSetting.autoProps)||void 0===_a?void 0:_a.width)&&void 0!==_b?_b:types.Dy.Custom,isAutoHeight=(null===(_c=layoutSetting.autoProps)||void 0===_c?void 0:_c.height)===types.Dy.Auto,mergedClass=(0,jimu_core.xWm)("flex-row-layout-item",{"d-flex":widthMode!==types.Dy.Auto}),isStretch=this.isStretchInCrossAxis(),keepAspectRatio=layout_runtime.utils.shouldUseAspectRatio(layoutSetting),ratio=layout_runtime.utils.parseAspectRatio(layoutSetting.aspectRatio),oneByOneAnimationProps=layout_runtime.utils.handleOnebyOneAnimation(this.props);return(0,jimu_core.Yac)(LayoutItemInBuilder,Object.assign({css:this.getStyle(layoutSetting,isStretch,keepAspectRatio,isAutoHeight),layoutId,layoutItemId:layoutItem.id,onResizeStart:this.onResizeStart,onResizing:this.onResizing,onResizeEnd:this.onResizeEnd,top:!isAutoHeight&&!isStretch&&!keepAspectRatio,bottom:!isAutoHeight&&!isStretch&&!keepAspectRatio,left:widthMode===types.Dy.Custom||keepAspectRatio,right:widthMode===types.Dy.Custom||keepAspectRatio,draggable,resizable,selectable,showDefaultTools,onClick:this.props.onClick,className:mergedClass,forceAspectRatio:keepAspectRatio,aspectRatio:ratio,autoHeight:isAutoHeight},oneByOneAnimationProps))}}try{FlexRowItem.displayName="FlexRowItem",FlexRowItem.__docgenInfo={description:"",displayName:"FlexRowItem",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"ImmutableObjectMixin<LayoutItemJson> & { readonly id?: string; readonly bbox?: ImmutableObject<BoundingBox>; ... 8 more ...; readonly children?: ImmutableArray<...>; }"}},selected:{defaultValue:null,description:"",name:"selected",required:!1,type:{name:"boolean"}},autoScroll:{defaultValue:null,description:"",name:"autoScroll",required:!1,type:{name:"boolean"}},animationPreview:{defaultValue:null,description:"",name:"animationPreview",required:!1,type:{name:"boolean"}},hoverPreview:{defaultValue:null,description:"",name:"hoverPreview",required:!1,type:{name:"boolean"}},playMode:{defaultValue:null,description:"",name:"playMode",required:!1,type:{name:"enum",value:[{value:'"AS_ONE"'},{value:'"ONE_BY_ONE"'}]}},previewId:{defaultValue:null,description:"",name:"previewId",required:!1,type:{name:"number"}},watchViewportVisibility:{defaultValue:null,description:"",name:"watchViewportVisibility",required:!1,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},onResizeStart:{defaultValue:null,description:"",name:"onResizeStart",required:!0,type:{name:"(id: string) => void"}},onResizeEnd:{defaultValue:null,description:"",name:"onResizeEnd",required:!0,type:{name:"(id: string, x: number, y: number, dw: number, dh: number, layoutItem: LayoutItemJson | IMLayoutItemJson) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flex-row-layout/builder/layout-item.tsx#FlexRowItem"]={docgenInfo:FlexRowItem.__docgenInfo,name:"FlexRowItem",path:"../jimu-layouts/lib/flex-row-layout/builder/layout-item.tsx#FlexRowItem"})}catch(__react_docgen_typescript_loader_error){}var flex_row_layout_common_style=__webpack_require__("../jimu-layouts/lib/flex-row-layout/common/style.ts");const flex_row_layout_builder_layout_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  bottom: 0;
  top: 0;
  right: 0;
  background: transparent;
`,flex_row_layout_builder_layout_guideOverlay=jimu_core.AHW`
  ${flex_row_layout_builder_layout_dropareaStyle};
  z-index: 20;
  pointer-events: none;
`;class flex_row_layout_builder_layout_Layout extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.state={isDragover:!1},this.handleItemResizeStart=id=>{const{layout}=this.props;this.domRect=this.ref.getBoundingClientRect();const rect=this.ref.querySelector(`div.exb-rnd[data-layoutid="${layout.id}"][data-layoutitemid="${id}"]`).getBoundingClientRect();this.resizingRect=layout_runtime.utils.relativeClientRect(rect,this.domRect)},this.handleItemResizeEnd=(id,x,y,dw,dh,layoutItem)=>{const{layout}=this.props,bbox=layout.content[id].bbox;let width;width=layout_runtime.utils.isPercentage(bbox.width)?`${(100*(this.resizingRect.width+dw)/this.domRect.width).toFixed(4)}%`:`${Math.round(this.resizingRect.width+dw)}px`;const newPos={width,height:Math.round(this.resizingRect.height+dh)};this.childRects=[],this.domRect=null;(0,jimu_for_builder.getAppConfigAction)().editLayoutItemProperty({layoutId:this.props.layout.id,layoutItemId:id},"bbox",newPos).exec()},this.handleDragOver=(draggingItem,draggingElement,containerRect,itemRect)=>{var _a;let rect=itemRect;if(this.canvasPane.clear(),(null===(_a=this.childRects)||void 0===_a?void 0:_a.length)>0){const{insertX,refId}=function calInsertPosition(boundingRect,itemRect,childRects){const isRTL=layout_runtime.utils.isRTL(),centerX=itemRect.left+itemRect.width/2;let result,refId,found=!1;if(childRects.some(((rect,i)=>{const rectX=rect.left+rect.width/2;if(isRTL){if(rectX<centerX){if(0===i)result=rect.left+rect.width+(boundingRect.width-rect.left-rect.width)/2;else{const previousItem=childRects[i-1];result=(rect.left+rect.width+previousItem.left)/2}found=!0,refId=rect.id}}else if(rectX>centerX){if(0===i)result=rect.left/2;else{const previousItem=childRects[i-1];result=(rect.left+previousItem.left+previousItem.width)/2}found=!0,refId=rect.id}return found})),!found){const lastItem=childRects[childRects.length-1];result=isRTL?lastItem.left/2:(lastItem.left+lastItem.width+boundingRect.width)/2}return{refId,insertX:result}}(containerRect,rect,this.childRects);this.referenceId=refId,rect={left:insertX-5+this.ref.scrollLeft,height:containerRect.height-10,top:5,width:10}}else rect={left:containerRect.width/2-5,height:containerRect.height-10,top:5,width:10};this.canvasPane.setColor(jimu_core.PLL.rgba(this.builderTheme.sys.color.primary.light,.5)),this.canvasPane.drawRect(rect)},this.handleToggleDragoverEffect=(value,draggingItem)=>{var _a;value&&(this.referenceId=null,this.collectBounds((null===(_a=draggingItem.layoutInfo)||void 0===_a?void 0:_a.layoutId)===this.props.layout.id?draggingItem.layoutInfo.layoutItemId:null)),this.setState({isDragover:value})},this.handleDrop=(draggingItem,containerRect,itemRect)=>{var _a;this.canvasPane.clear();const{layout}=this.props;let insertIndex=0;if(null!=this.referenceId){if(insertIndex=layout.order.indexOf(this.referenceId),(null===(_a=draggingItem.layoutInfo)||void 0===_a?void 0:_a.layoutId)===layout.id){layout.order.indexOf(draggingItem.layoutInfo.layoutItemId)<insertIndex&&(insertIndex-=1)}}else null!=layout.order&&(insertIndex=layout.order.length);common_layout_actions_addItemToLayout((0,jimu_for_builder.getAppConfigAction)().appConfig,draggingItem,layout.id).then((result=>{const{layoutInfo,updatedAppConfig}=result,outAppConfig=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.FlexRowLayout).processAfterItemAdded(updatedAppConfig,draggingItem,layoutInfo,{currentSizeMode:null,containerRect,itemRect,insertIndex});layout_runtime.utils.changeLayout(outAppConfig,layoutInfo)})).finally(null),this.referenceId=null,this.childRects=[]}}componentDidMount(){this.canvasPane=new canvas_pane_CanvasPane(this.canvasRef),this.canvasPane.setSize(this.ref.clientWidth,this.ref.clientHeight)}componentDidUpdate(){this.canvasPane.setSize(this.ref.clientWidth,this.ref.clientHeight)}collectBounds(id){const{layout}=this.props;this.childRects=[],this.domRect=this.ref.getBoundingClientRect();const draggableChildren=this.ref.parentNode.querySelectorAll(`div[data-layoutid="${layout.id}"] > .trail-container > div.exb-rnd`);return(null==draggableChildren?void 0:draggableChildren.length)>0&&draggableChildren.forEach((node=>{const itemId=node.getAttribute("data-layoutitemid");if(id!==itemId&&layout.order.includes(itemId)){const rect=layout_runtime.utils.relativeClientRect(node.getBoundingClientRect(),this.domRect);rect.id=itemId,this.childRects.push(rect)}})),this.childRects.sort(((a,b)=>layout_runtime.utils.isRTL()?b.left-a.left:a.left-b.left))}createItem(itemId,index){const{layout,itemDraggable,itemResizable,itemSelectable,showDefaultTools}=this.props;return(0,jimu_core.Yac)(FlexRowItem,{key:itemId,index,layoutId:layout.id,layoutItemId:itemId,layoutItem:layout.content[itemId],draggable:itemDraggable,resizable:itemResizable,selectable:itemSelectable,showDefaultTools,onResizeStart:this.handleItemResizeStart,onResizeEnd:this.handleItemResizeEnd})}isEmpty(){var _a;const{layout}=this.props,content=null!==(_a=layout.order)&&void 0!==_a?_a:[];return!(content.length>0&&content.some((id=>!layout.content[id].isPending)))}render(){var _a;const{layout,className}=this.props,content=null!==(_a=layout.order)&&void 0!==_a?_a:[],layoutSetting=Object.assign({},flex_row_layout_default_setting.N,layout.setting),isEmpty=this.isEmpty();return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(pageContext=>{this.builderTheme=pageContext.builderTheme,this.theme=pageContext.theme;const mergedStyle={position:"relative",minWidth:layoutSetting.min},outClass=(0,jimu_core.xWm)("layout flex-row-layout",className),guideVisibleStyle={display:this.state.isDragover?"block":"none"};return(0,jimu_core.Yac)("div",{className:outClass,ref:el=>{this.ref=el},style:mergedStyle,"data-layoutid":layout.id},(0,jimu_core.Yac)(jimu_core.zKZ.Provider,{value:{monitor:!0,layoutId:layout.id}},(0,jimu_core.Yac)(jimu_core._kc,{oid:layout.id,className:"trail-container d-flex w-100",css:jimu_core.AHW`
                    position: ${isEmpty?"absolute":null};
                    padding: ${jimu_ui.styleUtils.toCSSPadding(layoutSetting.padding)};
                    ${(0,flex_row_layout_common_style.A)(layoutSetting)};
                  `},(0,jimu_core.Yac)(droparea_hook_DropArea,{css:flex_row_layout_builder_layout_dropareaStyle,layouts:this.props.layouts,highlightDragover:!0,onDragOver:this.handleDragOver,onDrop:this.handleDrop,onToggleDragoverEffect:this.handleToggleDragoverEffect}),content.map(((layoutItem,index)=>this.createItem(layoutItem,index))))),isEmpty&&!isExpressMode()&&this.props.children,(0,jimu_core.Yac)("canvas",{css:flex_row_layout_builder_layout_guideOverlay,style:guideVisibleStyle,ref:el=>{this.canvasRef=el}}))}))}}const flex_row_layout_builder_layout=jimu_core.E_S.connect(layout_runtime.utils.mapStateToLayoutProps)(flex_row_layout_builder_layout_Layout);try{layout.displayName="layout",layout.__docgenInfo={description:"",displayName:"layout",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"ImmutableObjectMixin<SizeModeLayoutJson> & { readonly [x: string]: string; }"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},isInWidget:{defaultValue:null,description:"",name:"isInWidget",required:!1,type:{name:"boolean"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},isPageItem:{defaultValue:null,description:"",name:"isPageItem",required:!1,type:{name:"boolean"}},itemDraggable:{defaultValue:null,description:"",name:"itemDraggable",required:!1,type:{name:"boolean"}},itemResizable:{defaultValue:null,description:"",name:"itemResizable",required:!1,type:{name:"boolean"}},itemSelectable:{defaultValue:null,description:"",name:"itemSelectable",required:!1,type:{name:"boolean"}},droppable:{defaultValue:null,description:"",name:"droppable",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isItemAccepted:{defaultValue:null,description:"",name:"isItemAccepted",required:!1,type:{name:"(item: LayoutItemConstructorProps, isReplacePlaceholder: boolean) => boolean"}},onItemClick:{defaultValue:null,description:"",name:"onItemClick",required:!1,type:{name:"(e: any, widgetId: string) => void"}},ignoreMinHeight:{defaultValue:null,description:"",name:"ignoreMinHeight",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flex-row-layout/builder/layout.tsx#layout"]={docgenInfo:layout.__docgenInfo,name:"layout",path:"../jimu-layouts/lib/flex-row-layout/builder/layout.tsx#layout"})}catch(__react_docgen_typescript_loader_error){}var style_setting_components=__webpack_require__("../jimu-ui/advanced/style-setting-components.tsx");class LayoutItemAnimationSetting extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"100%",height:"auto",paddingBottom:"1px"},this.onTransitionSettingChange=setting=>{const{layoutId,layoutItemId}=this.props,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),layoutItem=appConfigAction.appConfig.layouts[layoutId].content[layoutItemId];appConfigAction.editSectionProperty(layoutItem.sectionId,"transition",setting).exec(),(null==setting?void 0:setting.type)!==jimu_core.ESD.None&&this.previewTransition()},this.onHoverEffectChange=effect=>{var _a,_b;const{layoutId,layoutItemId}=this.props,appConfigAction=(0,jimu_for_builder.getAppConfigAction)();(null===(_b=(null!==(_a=appConfigAction.appConfig.layouts[layoutId].content[layoutItemId].setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({})).hoverEffect)||void 0===_b?void 0:_b.type)!==effect.type&&appConfigAction.editLayoutItemProperty({layoutId,layoutItemId},"setting.hoverEffect",effect).exec(),effect.type!==jimu_core.Rwz.None&&jimu_for_builder.builderAppSync.publishHoverPreviewToApp({layoutInfo:{layoutId,layoutItemId},id:(0,jimu_core.RqM)()})},this.onEffectSettingChange=(mode,effectSetting)=>{const trigger=jimu_core.Zre.ScrollIntoView,{layoutId,layoutItemId,setting}=this.props,oldSetting=setting||(0,jimu_core.J3Z)({}),propName=mode===jimu_core.G6p.OneByOne?"oneByOneEffect":"effect";this.props.onSettingChange({layoutId,layoutItemId},oldSetting.setIn([propName,trigger],effectSetting)),(null==effectSetting?void 0:effectSetting.type)!==jimu_core.J6N.None&&jimu_for_builder.builderAppSync.publishAnimationPreviewToApp({layoutInfo:{layoutId,layoutItemId},playMode:mode,id:(0,jimu_core.RqM)()})},this.onSectionOneByOneEffectSettingChange=effectSetting=>{this.onEffectSettingChange(jimu_core.G6p.OneByOne,effectSetting)},this.previewAnimation=mode=>{this.hasAnimationEffect()&&jimu_for_builder.builderAppSync.publishAnimationPreviewToApp({layoutInfo:{layoutId:this.props.layoutId,layoutItemId:this.props.layoutItemId},playMode:mode,id:(0,jimu_core.RqM)()})},this.previewTransition=(withOneByOne=!1)=>{var _a,_b,_c;const{sectionId}=this.props,sectionProps=layout_runtime.searchUtils.getSectionInfo((0,jimu_core.Vp3)().getState().appStateInBuilder,sectionId),{views}=sectionProps;if((null==views?void 0:views.length)>1){let navInfo=null===(_c=null===(_b=null===(_a=(0,jimu_core.Vp3)().getState().appStateInBuilder)||void 0===_a?void 0:_a.appRuntimeInfo)||void 0===_b?void 0:_b.sectionNavInfos)||void 0===_c?void 0:_c[sectionId];if(!navInfo){const activeViewId=findActiveViewId(sectionProps),currentIndex=views.indexOf(activeViewId),previousIndex=currentIndex>0?currentIndex-1:currentIndex+1;navInfo=(0,jimu_core.J3Z)({currentViewId:activeViewId,previousViewId:views[previousIndex]})}jimu_for_builder.builderAppSync.publishSectionNavInfoToApp(sectionId,navInfo.set("playId",(0,jimu_core.RqM)()).set("withOneByOne",withOneByOne).asMutable())}},this.previewTransitionAndOnebyOne=()=>{this.previewTransition(!0)},this.previewOneByOneInSection=()=>{this.previewAnimation(jimu_core.G6p.OneByOne)},this.previewHover=()=>{this.hasHoverEffect()&&jimu_for_builder.builderAppSync.publishHoverPreviewToApp({layoutInfo:{layoutId:this.props.layoutId,layoutItemId:this.props.layoutItemId},id:(0,jimu_core.RqM)()})},this.onPlayModeChange=mode=>{const{layoutId,layoutItemId}=this.props;(0,jimu_for_builder.getAppConfigAction)().editLayoutItemProperty({layoutId,layoutItemId},"setting.effectPlayMode",mode).exec()},this.switchToIn=()=>{this.setState({animationType:"in"})},this.switchToTransition=()=>{this.setState({animationType:"transition"})},this.switchToHover=()=>{this.setState({animationType:"hover"})},this.state={animationType:"in"}}hasAnimationEffect(){var _a,_b;const{setting}=this.props,effect=null===(_a=null==setting?void 0:setting.effect)||void 0===_a?void 0:_a[jimu_core.Zre.ScrollIntoView],oneByOneEffect=null===(_b=null==setting?void 0:setting.oneByOneEffect)||void 0===_b?void 0:_b[jimu_core.Zre.ScrollIntoView];return effect&&effect.type!==jimu_core.J6N.None||oneByOneEffect&&oneByOneEffect.type!==jimu_core.J6N.None}hasHoverEffect(){const{setting}=this.props,effect=null==setting?void 0:setting.hoverEffect;return effect&&effect.type!==jimu_core.Rwz.None}render(){var _a,_b;const{formatMessage,supportOneByOne,isSection,transitionType,transitionDirection,setting}=this.props,{animationType}=this.state,asoneEffect=null===(_a=null==setting?void 0:setting.effect)||void 0===_a?void 0:_a[jimu_core.Zre.ScrollIntoView],oneByOneEffect=null===(_b=null==setting?void 0:setting.oneByOneEffect)||void 0===_b?void 0:_b[jimu_core.Zre.ScrollIntoView];return(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group","aria-label":formatMessage("animation"),title:formatMessage("animation")},isSection&&(0,jimu_core.Yac)(setting_components.SettingRow,null,(0,jimu_core.Yac)(jimu_ui.AdvancedButtonGroup,{className:"w-100",css:jimu_core.AHW`
              border-bottom: 1px solid var(--sys-color-primary-main);
              .jimu-btn {
                width: 50%;
                border-radius: 2px 2px 0 0;
              }
            `},(0,jimu_core.Yac)(jimu_ui.Button,{active:"in"===animationType,onClick:this.switchToIn},formatMessage("in")),(0,jimu_core.Yac)(jimu_ui.Button,{className:"ml-1",active:"transition"===animationType,onClick:this.switchToTransition},formatMessage("transition")))),"in"===animationType&&(0,jimu_core.Yac)(setting_components.SettingRow,null,(0,jimu_core.Yac)(style_setting_components.cK,{effectSetting:asoneEffect,oneByOneSetting:oneByOneEffect,onSettingChange:this.onEffectSettingChange,previewEnabled:!0,supportAsOne:!0,supportOneByOne,onPreviewClicked:this.previewAnimation,formatMessage})),"transition"===animationType&&(0,jimu_core.Yac)(setting_components.SettingRow,{flow:"wrap"},(0,jimu_core.Yac)(style_setting_components.il,{transition:{type:transitionType,direction:transitionDirection},transitionLabel:formatMessage("view"),oneByOneEffect,onOneByOneChange:this.onSectionOneByOneEffectSettingChange,onTransitionChange:this.onTransitionSettingChange,onPreviewTransitionClicked:this.previewTransition,onPreviewOneByOneClicked:this.previewOneByOneInSection,onPreviewAsAWhoneClicked:this.previewTransitionAndOnebyOne,formatMessage})))}}const mapFunction=(0,jimu_core.Mz0)([(state,ownProps)=>{var _a,_b;const{layoutId,layoutItemId}=ownProps,layoutItem=null===(_b=null===(_a=state.appStateInBuilder)||void 0===_a?void 0:_a.appConfig)||void 0===_b?void 0:_b.layouts[layoutId].content[layoutItemId];return null==layoutItem?void 0:layoutItem.setting},(state,ownProps)=>{var _a,_b;const{layoutId,layoutItemId}=ownProps,layoutItem=null===(_b=null===(_a=state.appStateInBuilder)||void 0===_a?void 0:_a.appConfig)||void 0===_b?void 0:_b.layouts[layoutId].content[layoutItemId];return(null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Widget},(state,ownProps)=>{var _a,_b,_c,_d,_e,_f;const{layoutId,layoutItemId}=ownProps,layoutItem=null===(_b=null===(_a=state.appStateInBuilder)||void 0===_a?void 0:_a.appConfig)||void 0===_b?void 0:_b.layouts[layoutId].content[layoutItemId];if((null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Widget){const widget=null===(_c=state.appStateInBuilder)||void 0===_c?void 0:_c.appConfig.widgets[layoutItem.widgetId],forbidOneByOne=null===(_e=null===(_d=null==widget?void 0:widget.manifest)||void 0===_d?void 0:_d.properties)||void 0===_e?void 0:_e.forbidOneByOneEffect;return(null===(_f=null==widget?void 0:widget.manifest)||void 0===_f?void 0:_f.widgetType)===jimu_core.xOw.Layout&&!forbidOneByOne}return!1},(state,ownProps)=>{var _a,_b,_c;const{layoutId,layoutItemId}=ownProps,layoutItem=null===(_b=null===(_a=state.appStateInBuilder)||void 0===_a?void 0:_a.appConfig)||void 0===_b?void 0:_b.layouts[layoutId].content[layoutItemId];if((null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Section)return null===(_c=state.appStateInBuilder)||void 0===_c?void 0:_c.appConfig.sections[layoutItem.sectionId]}],((setting,isWidget,supportOneByOne,section)=>{var _a,_b;return{setting,isWidget,supportOneByOne,isSection:null!=section,transitionType:null===(_a=null==section?void 0:section.transition)||void 0===_a?void 0:_a.type,transitionDirection:null===(_b=null==section?void 0:section.transition)||void 0===_b?void 0:_b.direction,sectionId:null==section?void 0:section.id}})),animation_setting=jimu_core.E_S.connect(mapFunction)(LayoutItemAnimationSetting);try{animationsetting.displayName="animationsetting",animationsetting.__docgenInfo={description:"",displayName:"animationsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!1,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/animation-setting.tsx#animationsetting"]={docgenInfo:animationsetting.__docgenInfo,name:"animationsetting",path:"../jimu-layouts/lib/builder/animation-setting.tsx#animationsetting"})}catch(__react_docgen_typescript_loader_error){}class CommonLayoutItemSetting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.onBackgroundStyleChange=config=>{this.updateStyle("background",config)},this.updateBorder=bd=>{var _a;this.updateStyle("border",bd);const style=(0,jimu_core.J3Z)(null!==(_a=this.props.style)&&void 0!==_a?_a:{});this.props.onStyleChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItemId},style.set("border",bd).without("borderTop").without("borderLeft").without("borderRight").without("borderBottom"))},this.updateBorderSide=(side,bd)=>{var _a;const style=(0,jimu_core.J3Z)(null!==(_a=this.props.style)&&void 0!==_a?_a:{});this.props.onStyleChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItemId},style.set(jimu_core.CM0.camelCase(`border-${side}`),bd).without("border"))},this.updateRadius=value=>{this.updateStyle("borderRadius",value)},this.updateShadow=value=>{this.updateStyle("boxShadow",value)},this.formatMessage=id=>this.props.formatMessage(id)}updateStyle(key,value){var _a;const style=(0,jimu_core.J3Z)(null!==(_a=this.props.style)&&void 0!==_a?_a:{});this.props.onStyleChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItemId},style.set(key,value))}allowCoverBackground(){var _a,_b,_c;const{layoutId,layoutItemId}=this.props,appConfig=(0,jimu_for_builder.getAppConfigAction)().appConfig,layoutItem=appConfig.layouts[layoutId].content[layoutItemId];if(layoutItem.type===jimu_core.K6q.Widget){const widgetId=layoutItem.widgetId;return null===(_c=null===(_b=null===(_a=appConfig.widgets[widgetId])||void 0===_a?void 0:_a.manifest)||void 0===_b?void 0:_b.properties)||void 0===_c?void 0:_c.coverLayoutBackground}return!1}allowAnimation(){const{layoutId}=this.props;return(0,jimu_for_builder.getAppConfigAction)().appConfig.layouts[layoutId].type!==jimu_core.p5K.AccordionLayout}render(){const{layoutId,layoutItemId}=this.props,style=this.props.style||{};return(0,jimu_core.Yac)("div",{className:"common-layout-item-setting"},this.allowAnimation()&&(0,jimu_core.Yac)(animation_setting,{layoutId,layoutItemId,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}),!this.props.isSection&&!this.allowCoverBackground()&&(0,jimu_core.Yac)(style_setting_components.lY,{background:style.background,onChange:this.onBackgroundStyleChange}),(0,jimu_core.Yac)(style_setting_components.Z$,{key:`${layoutId}-${layoutItemId}`,border:style.border,borderTop:style.borderTop,borderLeft:style.borderLeft,borderRight:style.borderRight,borderBottom:style.borderBottom,borderRadius:style.borderRadius,onBorderChange:this.updateBorder,onBorderSideChange:this.updateBorderSide,onBorderRadiusChange:this.updateRadius}),(0,jimu_core.Yac)(style_setting_components.QQ,{value:style.boxShadow,onChange:this.updateShadow}))}}try{commonlayoutitemsetting.displayName="commonlayoutitemsetting",commonlayoutitemsetting.__docgenInfo={description:"",displayName:"commonlayoutitemsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},isSection:{defaultValue:null,description:"",name:"isSection",required:!0,type:{name:"boolean"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!1,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},setting:{defaultValue:null,description:"",name:"setting",required:!1,type:{name:"any"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/common-layout-item-setting.tsx#commonlayoutitemsetting"]={docgenInfo:commonlayoutitemsetting.__docgenInfo,name:"commonlayoutitemsetting",path:"../jimu-layouts/lib/builder/common-layout-item-setting.tsx#commonlayoutitemsetting"})}catch(__react_docgen_typescript_loader_error){}class common_transform_setting_CommonLayoutItemSetting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.updateRotation=value=>{var _a;const setting=(0,jimu_core.J3Z)(null!==(_a=this.props.setting)&&void 0!==_a?_a:{});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItemId},setting.setIn(["style","transform","rotate"],value))},this.formatMessage=id=>this.props.formatMessage(id)}render(){var _a,_b,_c;const setting=this.props.setting||{};return(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("rotation"),className:"rotation-setting"},(0,jimu_core.Yac)(jimu_ui.NumericInput,{"aria-label":this.formatMessage("rotation"),value:null!==(_c=null===(_b=null===(_a=setting.style)||void 0===_a?void 0:_a.transform)||void 0===_b?void 0:_b.rotate)&&void 0!==_c?_c:0,min:-360,max:360,precision:2,onChange:this.updateRotation,formatter:value=>`${value}°`,parser:value=>value.replace("°",""),css:jimu_core.AHW`width: 72px;`,size:"sm"}))}}try{commontransformsetting.displayName="commontransformsetting",commontransformsetting.__docgenInfo={description:"",displayName:"commontransformsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!1,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},setting:{defaultValue:null,description:"",name:"setting",required:!0,type:{name:"any"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/common-transform-setting.tsx#commontransformsetting"]={docgenInfo:commontransformsetting.__docgenInfo,name:"commontransformsetting",path:"../jimu-layouts/lib/builder/common-transform-setting.tsx#commontransformsetting"})}catch(__react_docgen_typescript_loader_error){}var arrow_stretched=__webpack_require__("../jimu-icons/outlined/directional/arrow-stretched.tsx");const availableUnits=[jimu_ui.DistanceUnits.PIXEL,jimu_ui.DistanceUnits.PERCENTAGE];class ItemPositionSetting extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.updateBBox=(prop,value)=>{const bbox=this.props.layoutItem.bbox,{distance,unit}=value,originalValue=bbox[prop];let newValue=distance.toFixed(2);if(layout_runtime.utils.isPercentage(originalValue)&&unit===jimu_ui.DistanceUnits.PIXEL){const containerRect=this.getSizeOfContainer();null!=containerRect&&(newValue="left"===prop||"right"===prop||"width"===prop?Math.round(parseFloat(originalValue)*containerRect.width/100):Math.round(parseFloat(originalValue)*containerRect.height/100))}else if(!layout_runtime.utils.isPercentage(originalValue)&&unit===jimu_ui.DistanceUnits.PERCENTAGE){const containerRect=this.getSizeOfContainer();null!=containerRect&&(newValue="left"===prop||"right"===prop||"width"===prop?(100*parseFloat(originalValue)/containerRect.width).toFixed(2):(100*parseFloat(originalValue)/containerRect.height).toFixed(2))}this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox.set(prop,value.unit===jimu_ui.DistanceUnits.PERCENTAGE?`${newValue}%`:`${newValue}px`))},this.flipLeftRight=layout_runtime.utils.isRTL()}getStyle(){return jimu_core.AHW`
      .position-setting {
        background-color: var(--ref-palette-neutral-500);
        position: relative;
        width: 100%;
        padding-top: 60%;
        overflow: visible;
      }

      .content {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        padding: 7px;
      }

      .w-half {
        width: calc(50% - 16px);
        position: relative;
        z-index: 0;
      }
      .h-half {
        height: calc(50% - 16px);
        position: relative;
        z-index: 0;
      }
      .pos-label {
        z-index: 1;
      }

      .box-column {
        width: 32px;
        overflow: visible;
      }

      .box-item {
        width: 24px;
        height: 24px;
        background-color: var(--ref-palette-neutral-800);
        margin: 4px 0;
        position: relative;
        overflow: visible;

        &.stretch {
          background-color: transparent;
          border: 1px solid var(--ref-palette-neutral-800);
        }
        .h-arrow, .v-arrow {
          display: none;
          .arrow-icon {
            color: var(--ref-palette-neutral-800);
            width: 100%;
            height: 100%;
          }
          position: absolute;
          width: 100%;
        }
        .h-arrow {
          top: 50%;
          transform: translateY(-50%);
        }
        .v-arrow {
          left: 50%;
          transform: translateX(-50%);
        }
        &.stretch-w .h-arrow,
        &.stretch-h .v-arrow {
          display: block;
        }
      }

      .anchor {
        position: absolute;
        width: 16px;
        height: 16px;
        background: transparent;
        overflow: visible;

        &.selected {
          width: 10px;
          height: 10px;
          opacity: 1;
          background: var(--sys-color-primary-dark);
          border: 2px solid var(--sys-color-primary-main) !important;
          border-radius: 3px !important;
        }
        &.top.left {
          border-radius: 3px 0 0 0;
        }
        &.top.right {
          border-radius: 0 3px 0 0;
        }
        &.bottom.right {
          border-radius: 0 0 3px 0;
        }
        &.bottom.left {
          border-radius: 0 0 0 3px;
        }
        &.left {
          left: 6px;
          border-left: 2px solid var(--ref-palette-neutral-800);
          &.selected:before {
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            content: '';
            height: 2px;
            width: 10px;
            background-color: var(--sys-color-primary-main);
          }
        }
        &.top {
          top: 6px;
          border-top: 2px solid var(--ref-palette-neutral-800);
          &.selected:after {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            content: '';
            width: 2px;
            height: 10px;
            background-color: var(--sys-color-primary-main);
          }
        }
        &.bottom {
          bottom: 6px;
          border-bottom: 2px solid var(--ref-palette-neutral-800);
          &.selected:after {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            content: '';
            width: 2px;
            height: 10px;
            background-color: var(--sys-color-primary-main);
          }
        }
        &.right {
          right: 6px;
          border-right: 2px solid var(--ref-palette-neutral-800);
          &.selected:before {
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            content: '';
            height: 2px;
            width: 10px;
            background-color: var(--sys-color-primary-main);
          }
        }
      }

      .from-left {
        border-left: 2px solid var(--sys-color-primary-main);
        &.is-auto {
          border-left-color: var(--ref-palette-neutral-800);
        }
        &.allow-change:hover {
          border-left-color: var(--sys-color-primary-main);
        }
      }
      .from-top {
        border-top: 2px solid var(--sys-color-primary-main);
        &.is-auto {
          border-top-color: var(--ref-palette-neutral-800);
        }
        &.allow-change:hover {
          border-top-color: var(--sys-color-primary-main);
        }
      }
      .from-right {
        border-right: 2px solid var(--sys-color-primary-main);
        &.is-auto {
          border-right-color: var(--ref-palette-neutral-800);
        }
        &.allow-change:hover {
          border-right-color: var(--sys-color-primary-main);
        }
      }
      .from-bottom {
        border-bottom: 2px solid var(--sys-color-primary-main);
        &.is-auto {
          border-bottom-color: var(--ref-palette-neutral-800);
        }
        &.allow-change:hover {
          border-bottom-color: var(--sys-color-primary-main);
        }
      }
      /* .line-h.is-auto,
      .line-v.is-auto {
        border-color: var(--ref-palette-neutral-800);
      } */
      .line-h {
        position: absolute;
        width: 100%;
        top: 50%;
        transform: translateY(-50%);
        height: 12px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        z-index: 0;

        &.allow-change {
          cursor: pointer;
          &:hover:after {
            border-top-color: var(--sys-color-primary-main);
          }
        }
        &:after {
          content: '';
          height: 0;
          width: 100%;
          border-top: 2px solid var(--sys-color-primary-main);
        }
        &.is-auto:after {
          border-top-style: dashed;
          border-top-color: var(--ref-palette-neutral-800);
        }
      }
      .line-v {
        position: absolute;
        height: 100%;
        width: 12px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        justify-content: center;
        z-index: 0;

        &.allow-change {
          cursor: pointer;
          &:hover:after {
            border-left-color: var(--sys-color-primary-main);
          }
        }
        &:after {
          content: '';
          width: 0;
          height: 100%;
          border-left: 2px solid var(--sys-color-primary-main);
        }
        &.is-auto:after {
          border-left-style: dashed;
          border-left-color: var(--ref-palette-neutral-800);
        }
      }

      .auto-label {
        width: 16px;
        height: 16px;
        background: var(--sys-color-primary-main);
        border: 1px solid var(--ref-palette-neutral-500);
        font-size: 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--ref-palette-neutral-400);
      }

      .style-setting--input-unit {
        &:hover {
          input.jimu-numeric-input-input {
            background-color: var(--ref-palette-neutral-300);
          }
          .style-setting--unit-selector {
            background-color: var(--ref-palette-neutral-300);
          }
        }
        border-radius: 2px;
        width: 52px;
        height: 24px;

        input.jimu-numeric-input-input {
          height: 24px;
          font-size: 12px;
          padding: 0;
          text-align: center;
          border: none;
          background-color: var(--ref-palette-neutral-500);
          &:focus {
            background-color: var(--ref-palette-neutral-300);
          }
        }
        .style-setting--unit-selector {
          background-color: var(--ref-palette-neutral-500);
          color: var(--ref-palette-neutral-900);
          height: 24px;
          width: auto;
          min-width: 0;
          padding: 0;
          margin-left: 0;
          font-size: 12px;
          border: none;
        }
      }

      .origin-tip {
        margin-top: 8px;
        font-size: 12px;
        color: var(--ref-palette-neutral-900);
      }
    `}inputUnit(prop){const{layoutItem,formatMessage}=this.props,value=jimu_ui.utils.stringOfLinearUnit(layoutItem.bbox[prop]);return(0,jimu_core.Yac)("div",{className:"pos-label",role:"group","aria-label":formatMessage(prop)},(0,jimu_core.Yac)(style_setting_components.vn,{units:availableUnits,min:-1/0,max:1/0,value,onChange:value=>{this.updateBBox(prop,value)}}))}getSizeOfContainer(){const layoutElem=this.querySelector(`div.fixed-layout[data-layoutid="${this.props.layoutId}"]`);return null==layoutElem?void 0:layoutElem.getBoundingClientRect()}getSizeOfItem(){const{layoutId,layoutItem}=this.props,layoutElem=this.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItem.id}"]`);return null==layoutElem?void 0:layoutElem.getBoundingClientRect()}querySelector(selector){var _a;const appFrame=document.querySelector(`iframe[name="${jimu_core.mXW}"]`);if(null!=appFrame){return(null!==(_a=appFrame.contentDocument)&&void 0!==_a?_a:appFrame.contentWindow.document).querySelector(selector)}return null}switchAuto(side,otherSize,originValue){var _a,_b;const{layoutId,layoutItem}=this.props,setting=null!==(_a=layoutItem.setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({});let bbox=null!==(_b=layoutItem.bbox)&&void 0!==_b?_b:(0,jimu_core.J3Z)({});if(originValue&&null==bbox[side]){const containerRect=this.getSizeOfContainer(),rect=this.getSizeOfItem();switch(side){case"left":bbox=bbox.set(side,layout_runtime.utils.toRatio(rect.left,containerRect.width));break;case"right":bbox=bbox.set(side,layout_runtime.utils.toRatio(containerRect.width-rect.right,containerRect.width));break;case"top":bbox=bbox.set(side,layout_runtime.utils.toRatio(rect.top,containerRect.height));break;case"bottom":bbox=bbox.set(side,layout_runtime.utils.toRatio(containerRect.height-rect.bottom,containerRect.height))}this.props.onPosChange({layoutId,layoutItemId:layoutItem.id},bbox)}this.props.onSettingChange({layoutId,layoutItemId:layoutItem.id},setting.setIn(["autoProps",side],!originValue).setIn(["autoProps",otherSize],originValue))}checkAutoProps(itemSetting){const box=(0,fixed_layout_util.wK)(this.props.layoutItem.bbox,itemSetting);return{leftAuto:null==box.left||itemSetting.hCenter&&"50%"===box.left,rightAuto:null==box.right||itemSetting.hCenter&&"50%"===box.left,topAuto:null==box.top||itemSetting.vCenter&&"50%"===box.top,bottomAuto:null==box.bottom||itemSetting.vCenter&&"50%"===box.top}}checkOrigin(leftAuto,rightAuto,topAuto,bottomAuto){let left=leftAuto,right=rightAuto,top=topAuto,bottom=bottomAuto;return leftAuto===rightAuto&&(left=layout_runtime.utils.isRTL(),right=!left),topAuto===bottomAuto&&(top=!1,bottom=!0),{top,bottom,left,right}}allowChangeAutoProps(side){var _a;const itemSetting=this.props.layoutItem.setting,autoProps=null!==(_a=null==itemSetting?void 0:itemSetting.autoProps)&&void 0!==_a?_a:{};return!(layout_runtime.utils.getLayoutItemSizeMode(side,this.props.layoutItem.bbox,autoProps)===layout_runtime.LayoutItemSizeModes.Stretch||"width"===side&&(null==itemSetting?void 0:itemSetting.hCenter)||"height"===side&&(null==itemSetting?void 0:itemSetting.vCenter))}getOrigin(left,top,right,bottom){const{formatMessage}=this.props;return left||top?right||top?right||bottom?left||bottom?"":this.flipLeftRight?formatMessage("BR"):formatMessage("BL"):this.flipLeftRight?formatMessage("BL"):formatMessage("BR"):this.flipLeftRight?formatMessage("TL"):formatMessage("TR"):this.flipLeftRight?formatMessage("TR"):formatMessage("TL")}render(){const{layoutItem,widthMode,heightMode,formatMessage}=this.props;if(null==layoutItem)return null;const itemSetting=jimu_core.CM0.assign({},default_setting.E,layoutItem.setting),{leftAuto,rightAuto,topAuto,bottomAuto}=this.checkAutoProps(itemSetting),{top,bottom,left,right}=this.checkOrigin(leftAuto,rightAuto,topAuto,bottomAuto),canSwitchXAuto=this.allowChangeAutoProps("width"),canSwitchYAuto=this.allowChangeAutoProps("height");return(0,jimu_core.Yac)("div",{css:this.getStyle(),className:"w-100"},(0,jimu_core.Yac)("div",{className:"position-setting rounded-2"},(0,jimu_core.Yac)("div",{className:"content d-flex justify-content-center align-items-center"},(0,jimu_core.Yac)("div",{className:"d-flex w-half flex-column justify-content-center align-items-center"},(0,jimu_core.Yac)("div",{className:"d-flex w-100 justify-content-center align-items-center"},(0,jimu_core.Yac)(jimu_ui.Tooltip,{placement:"bottom",title:canSwitchXAuto?formatMessage(leftAuto?"changeToCustom":"changeToAuto"):""},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("from-left line-h flex-grow-1 flex-shrink-1",{"is-auto":leftAuto,"allow-change":canSwitchXAuto}),onClick:canSwitchXAuto?this.switchAuto.bind(this,"left","right",leftAuto):null})),leftAuto?null:this.inputUnit("left"))),(0,jimu_core.Yac)("div",{className:"d-flex h-100 flex-column justify-content-center align-items-center box-column"},(0,jimu_core.Yac)("div",{className:"d-flex h-half w-100 flex-column justify-content-center align-items-center"},(0,jimu_core.Yac)(jimu_ui.Tooltip,{placement:"bottom",title:canSwitchYAuto?formatMessage(topAuto?"changeToCustom":"changeToAuto"):""},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("from-top line-v flex-grow-1 flex-shrink-1",{"is-auto":topAuto,"allow-change":canSwitchYAuto}),onClick:canSwitchYAuto?this.switchAuto.bind(this,"top","bottom",topAuto):null})),topAuto?null:this.inputUnit("top")),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("box-item rounded-lg",{stretch:widthMode===layout_runtime.LayoutItemSizeModes.Stretch||heightMode===layout_runtime.LayoutItemSizeModes.Stretch,"stretch-w":widthMode===layout_runtime.LayoutItemSizeModes.Stretch,"stretch-h":heightMode===layout_runtime.LayoutItemSizeModes.Stretch})},(0,jimu_core.Yac)("div",{className:"h-arrow"},(0,jimu_core.Yac)(arrow_stretched.W,{className:"arrow-icon"})),(0,jimu_core.Yac)("div",{className:"v-arrow"},(0,jimu_core.Yac)(arrow_stretched.W,{className:"arrow-icon",rotate:90}))),(0,jimu_core.Yac)("div",{className:"d-flex h-half w-100 flex-column justify-content-center align-items-center"},(0,jimu_core.Yac)(jimu_ui.Tooltip,{placement:"bottom",title:canSwitchYAuto?formatMessage(bottomAuto?"changeToCustom":"changeToAuto"):""},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("from-bottom line-v flex-grow-1 flex-shrink-1",{"is-auto":bottomAuto,"allow-change":canSwitchYAuto}),onClick:canSwitchYAuto?this.switchAuto.bind(this,"bottom","top",bottomAuto):null})),bottomAuto?null:this.inputUnit("bottom"))),(0,jimu_core.Yac)("div",{className:"d-flex w-half flex-column justify-content-center align-items-center"},(0,jimu_core.Yac)("div",{className:"d-flex w-100 justify-content-center align-items-center"},(0,jimu_core.Yac)(jimu_ui.Tooltip,{placement:"bottom",title:canSwitchXAuto?formatMessage(rightAuto?"changeToCustom":"changeToAuto"):""},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("from-right line-h flex-grow-1 flex-shrink-1",{"is-auto":rightAuto,"allow-change":canSwitchXAuto}),onClick:canSwitchXAuto?this.switchAuto.bind(this,"right","left",rightAuto):null})),rightAuto?null:this.inputUnit("right"))),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("anchor top left",{selected:!left&&!top})}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("anchor top right",{selected:!right&&!top})}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("anchor bottom left",{selected:!left&&!bottom})}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("anchor bottom right",{selected:!bottom&&!right})}))),(0,jimu_core.Yac)("div",{className:"origin-tip d-flex justify-content-center align-item-center"},this.getOrigin(left,top,right,bottom)))}}try{ItemPositionSetting.displayName="ItemPositionSetting",ItemPositionSetting.__docgenInfo={description:"",displayName:"ItemPositionSetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}},heightMode:{defaultValue:null,description:"",name:"heightMode",required:!0,type:{name:"enum",value:[{value:'"AUTO"'},{value:'"STRETCH"'},{value:'"CUSTOM"'}]}},widthMode:{defaultValue:null,description:"",name:"widthMode",required:!0,type:{name:"enum",value:[{value:'"AUTO"'},{value:'"STRETCH"'},{value:'"CUSTOM"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/fixed-layout/builder/item-position-setting.tsx#ItemPositionSetting"]={docgenInfo:ItemPositionSetting.__docgenInfo,name:"ItemPositionSetting",path:"../jimu-layouts/lib/fixed-layout/builder/item-position-setting.tsx#ItemPositionSetting"})}catch(__react_docgen_typescript_loader_error){}const sizemodes=[layout_runtime.LayoutItemSizeModes.Auto,layout_runtime.LayoutItemSizeModes.Custom,layout_runtime.LayoutItemSizeModes.Stretch],sizemodesWithoutAuto=[layout_runtime.LayoutItemSizeModes.Custom,layout_runtime.LayoutItemSizeModes.Stretch],positionMenus=[...[fixedItemMenu[1][1],fixedItemMenu[1][2],fixedItemMenu[1][3],fixedItemMenu[1][4],{separator:!0},fixedItemMenu[0][1],fixedItemMenu[0][2],fixedItemMenu[0][3]].map((item=>Object.assign(Object.assign({},item),{title:item.title,label:null}))),[{icon:more_horizontal_default(),caret:!1},fixedItemMenu[0][4],fixedItemMenu[0][5],fixedItemMenu[0][6],{separator:!0},fixedItemMenu[0][7],fixedItemMenu[0][8],fixedItemMenu[0][9]]];class FixedItemSetting extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.updateBBox=(prop,value)=>{var _a;let bbox=this.props.layoutItem.bbox;const{distance,unit}=value,originalValue=bbox[prop],containerRect=this.getSizeOfContainer();let pixelValue,newValue=distance.toFixed(2);if(layout_runtime.utils.isPercentage(originalValue)&&unit===jimu_ui.DistanceUnits.PIXEL?containerRect&&(newValue="left"===prop||"right"===prop||"width"===prop?Math.round(parseFloat(originalValue)*containerRect.width/100):Math.round(parseFloat(originalValue)*containerRect.height/100),pixelValue=newValue):layout_runtime.utils.isPercentage(originalValue)||unit!==jimu_ui.DistanceUnits.PERCENTAGE||(containerRect&&(newValue="left"===prop||"right"===prop||"width"===prop?(100*parseFloat(originalValue)/containerRect.width).toFixed(4):(100*parseFloat(originalValue)/containerRect.height).toFixed(4)),pixelValue=parseFloat(originalValue)),pixelValue||unit!==jimu_ui.DistanceUnits.PERCENTAGE)pixelValue||unit!==jimu_ui.DistanceUnits.PIXEL||(pixelValue=distance);else{const total="width"===prop?containerRect.width:containerRect.height;pixelValue=Math.round(distance*total/100)}if(bbox=bbox.set(prop,unit===jimu_ui.DistanceUnits.PERCENTAGE?`${newValue}%`:`${newValue}px`),"ratio"===(null===(_a=this.props.layoutItem.setting)||void 0===_a?void 0:_a.heightMode)){const ratio=layout_runtime.utils.parseAspectRatio(this.props.layoutItem.setting.aspectRatio);if("width"===prop){const height=pixelValue*ratio;if(layout_runtime.utils.isPercentage(bbox.height)){const newValue=(100*height/containerRect.height).toFixed(4);bbox=bbox.set("height",`${newValue}%`)}else bbox=bbox.set("height",`${Math.round(height)}px`)}else{const width=pixelValue/ratio;if(layout_runtime.utils.isPercentage(bbox.width)){const newValue=(100*width/containerRect.width).toFixed(4);bbox=bbox.set("width",`${newValue}%`)}else bbox=bbox.set("width",`${Math.round(width)}px`)}}this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)},this.updateMode=(prop,value)=>{var _a;const setting=null!==(_a=this.props.layoutItem.setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({}),layoutInfo={layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id};if(value===layout_runtime.LayoutItemSizeModes.Custom){const containerRect=this.getSizeOfContainer(),itemRect=this.getSizeOfItem();if(containerRect&&itemRect){const newValue=(100*itemRect[prop]/containerRect[prop]).toFixed(4);return void(0,jimu_for_builder.getAppConfigAction)().editLayoutItemProperty(layoutInfo,"setting",setting.setIn(["autoProps",prop],value)).editLayoutItemProperty(layoutInfo,`bbox.${prop}`,`${newValue}%`).exec()}}this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.setIn(["autoProps",prop],value))},this.updateLockParent=e=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.set("lockParent",e.target.checked),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.toggleHeightMode=()=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});const mode="ratio"===setting.heightMode?"fixed":"ratio";if(setting=setting.set("heightMode",mode),"ratio"===mode){const itemRect=this.getSizeOfItem();itemRect&&(setting=setting.set("aspectRatio",Number((itemRect.height/itemRect.width).toFixed(2))).setIn(["autoProps","height","AUTO"]))}this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.updateAspectRatio=newRatio=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.set("aspectRatio",newRatio),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.flipLeftRight=layout_runtime.utils.isRTL(),this.state={enableToolbar:!1}}componentDidMount(){this.ref&&this.setState({enableToolbar:!0})}getSizeOfContainer(){const layoutElem=this.querySelector(`div.fixed-layout[data-layoutid="${this.props.layoutId}"]`);return layoutElem?layoutElem.getBoundingClientRect():null}getSizeOfItem(){const{layoutId,layoutItem}=this.props,layoutElem=this.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItem.id}"]`);return layoutElem?layoutElem.getBoundingClientRect():null}querySelector(selector){const appFrame=document.querySelector(`iframe[name="${jimu_core.mXW}"]`);if(appFrame){return(appFrame.contentDocument||appFrame.contentWindow.document).querySelector(selector)}return null}getStyle(){return jimu_core.AHW`
      .layout-item-toolbar {
        box-shadow: none;
        background: transparent;

        .toolbar-item, icon-container {
          width: 28px;
          min-height: 28px;
        }
        .toolbar-group {
          background: transparent;
          margin: 0 1px;
        }
        .toolbar-item {
          margin: 0 1px;
          background: transparent;
          &:hover {
            background: var(--ref-palette-neutral-500);
          }

          svg {
            width: 14px;
            height: 14px;
          }
        }
      }

      .ratio-value {
        font-size: 12px;
      }
    `}render(){const{layoutItem,layoutId,formatMessage,isLockLayout,supportAutoSize}=this.props;if(!layoutItem)return null;this.itemSetting=jimu_core.CM0.assign({},default_setting.E,layoutItem.setting);const isKeepAspect="ratio"===this.itemSetting.heightMode,widthMode=layout_runtime.utils.getLayoutItemSizeMode("width",layoutItem.bbox,this.itemSetting.autoProps),heightMode=layout_runtime.utils.getLayoutItemSizeMode("height",layoutItem.bbox,this.itemSetting.autoProps),bbox=layoutItem.bbox,theme=(0,jimu_theme.O4)(),inputStyle=jimu_core.AHW`width: 100px;`;return(0,jimu_core.Yac)("div",{className:"fixed-item-setting",css:this.getStyle(),ref:el=>{this.ref=el}},!isLockLayout&&this.state.enableToolbar&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(setting_components.SettingSection,{className:"p-0 d-flex justify-content-center"},(0,jimu_core.Yac)(Toolbar,{layoutId,layoutItem,parentRef:this.ref,theme,tools:positionMenus,formatMessage:this.props.formatMessage})),(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group","aria-label":`${formatMessage("size")} & ${formatMessage("position")}`,title:`${formatMessage("size")} & ${formatMessage("position")}`},(0,jimu_core.Yac)(setting_components.SettingRow,{role:"group","aria-label":formatMessage("width"),label:formatMessage("width")},(0,jimu_core.Yac)("div",{css:inputStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"W",mode:widthMode,sizeModes:supportAutoSize&&!isKeepAspect?sizemodes:sizemodesWithoutAuto,value:jimu_ui.utils.stringOfLinearUnit(bbox.width),onChange:value=>{this.updateBBox("width",value)},onModeChange:value=>{this.updateMode("width",value)}}))),widthMode!==layout_runtime.LayoutItemSizeModes.Auto&&(0,jimu_core.Yac)("div",null,(0,jimu_core.Yac)(jimu_ui.Tooltip,{title:formatMessage("keepAspectRatio"),placement:"bottom"},(0,jimu_core.Yac)(jimu_ui.Button,{size:"sm",type:"tertiary",className:"ml-1",icon:!0,onClick:this.toggleHeightMode,"aria-pressed":isKeepAspect},isKeepAspect?(0,jimu_core.Yac)(lock.s,{size:"s"}):(0,jimu_core.Yac)(editor_unlock.R,{size:"s"})))),(0,jimu_core.Yac)(setting_components.SettingRow,{role:"group","aria-label":formatMessage("height"),label:formatMessage("height"),className:(0,jimu_core.xWm)({"mt-0":widthMode!==layout_runtime.LayoutItemSizeModes.Auto})},(0,jimu_core.Yac)("div",{css:inputStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"H",mode:heightMode,sizeModes:supportAutoSize?sizemodes:sizemodesWithoutAuto,disabled:isKeepAspect,value:jimu_ui.utils.stringOfLinearUnit(bbox.height),onChange:value=>{this.updateBBox("height",value)},onModeChange:value=>{this.updateMode("height",value)}}))),isKeepAspect&&(0,jimu_core.Yac)(setting_components.SettingRow,{"aria-label":formatMessage("aspectRatio"),label:formatMessage("aspectRatio")},(0,jimu_core.Yac)(style_setting_components.Kr,{value:this.itemSetting.aspectRatio,style:{width:100},onChange:this.updateAspectRatio})),(0,jimu_core.Yac)(setting_components.SettingRow,null,(0,jimu_core.Yac)(ItemPositionSetting,Object.assign({},this.props,{widthMode,heightMode}))),(0,jimu_core.Yac)(common_transform_setting_CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,setting:layoutItem.setting,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage})),(0,jimu_core.Yac)(setting_components.SettingSection,null,(0,jimu_core.Yac)(setting_components.SettingRow,{tag:"label",label:formatMessage("lockParent")},(0,jimu_core.Yac)(jimu_ui.Switch,{checked:this.itemSetting.lockParent,onChange:this.updateLockParent})))),(layoutItem.type===jimu_core.K6q.Widget||layoutItem.sectionId)&&(0,jimu_core.Yac)(CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,style:this.props.style,isSection:layoutItem.type===jimu_core.K6q.Section,onStyleChange:this.props.onStyleChange,formatMessage:this.props.formatMessage,setting:layoutItem.setting||(0,jimu_core.J3Z)({}),onSettingChange:this.props.onSettingChange}))}}try{fixeditemsetting.displayName="fixeditemsetting",fixeditemsetting.__docgenInfo={description:"",displayName:"fixeditemsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/fixed-layout/builder/fixed-item-setting.tsx#fixeditemsetting"]={docgenInfo:fixeditemsetting.__docgenInfo,name:"fixeditemsetting",path:"../jimu-layouts/lib/fixed-layout/builder/fixed-item-setting.tsx#fixeditemsetting"})}catch(__react_docgen_typescript_loader_error){}var flow_layout_default_setting=__webpack_require__("../jimu-layouts/lib/flow-layout/default-setting.ts"),layout_utils=__webpack_require__("../jimu-layouts/lib/flow-layout/layout-utils.ts");const icons={[jimu_core.al_.Push]:__webpack_require__("../jimu-ui/advanced/lib/assets/icon_animation_transition_push.svg"),[jimu_core.al_.Fade]:__webpack_require__("../jimu-ui/advanced/lib/assets/icon_animation_transition_fade.svg"),[jimu_core.al_.Cover]:__webpack_require__("../jimu-ui/advanced/lib/assets/icon_animation_transition_push.svg")};class TransitionPopperContent extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.onTypeChanged=(e,type,isPanel)=>{isPanel?this.props.onPanelTransitionTypeChange(type):this.props.onTransitionTypeChange(type)},this.updateFirstPanel=e=>{}}getStyle(){return jimu_core.AHW`
      .animation-cards {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-row-gap: 12px;
        grid-column-gap: 12px;
      }

      .card-item {
        font-size: 13px;
        flex: 0 0 45%;

        user-select: none;
        cursor: pointer;
        position: relative;

        .card-content {
          width: 100%;
          height: 5rem;
          background-color: var(--ref-palette-neutral-300);
        }

        &.selected .card-content {
          outline: 2px solid var(--sys-color-primary-light);
        }

        .card-image {
          width: 100%;
          height: 100%;
          padding: 8px;
          &:after {
            display: none;
          }
        }

        .card-name {
          max-width: 90px;
          margin: 0 auto;
          color: var(--ref-palette-neutral-1100);
          .card-name-content {
            line-height: 1rem;
            max-height: 2rem;
            white-space: normal;
          }
        }
      }
    `}createAnimationCard(type,index,isPanel=!1){const{transitionType,panelTransitionType}=this.props;let effectType;return effectType=isPanel?null!=panelTransitionType?panelTransitionType:jimu_core.al_.Push:null!=transitionType?transitionType:jimu_core.al_.Fade,(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("d-flex flex-column align-items-center card-item",{selected:type===effectType}),key:index,onClick:e=>{this.onTypeChanged(e,type,isPanel)}},(0,jimu_core.Yac)("div",{className:"d-flex justify-content-center card-content"},(0,jimu_core.Yac)("div",{className:"card-image"},(0,jimu_core.Yac)(jimu_ui.Icon,{className:"w-100",currentColor:!1,icon:icons[type],size:72}))),(0,jimu_core.Yac)("div",{className:"card-name flex-grow-1 d-flex align-items-start mt-1"},(0,jimu_core.Yac)("span",{className:"text-center text-truncate card-name-content",title:this.props.formatMessage(type.toLowerCase())},this.props.formatMessage(type.toLowerCase()))))}render(){const{formatMessage}=this.props;return(0,jimu_core.Yac)("div",{className:"bg-default border-color-gray-400",css:this.getStyle()},(0,jimu_core.Yac)(setting_components.SettingSection,{title:formatMessage("mainStage")},(0,jimu_core.Yac)("div",{className:"animation-cards"},[jimu_core.al_.Fade,jimu_core.al_.Cover,jimu_core.al_.Push].map(((info,index)=>this.createAnimationCard(info,index))))),(0,jimu_core.Yac)(setting_components.SettingSection,{title:formatMessage("scrollingPanel")},(0,jimu_core.Yac)("div",{className:"animation-cards"},[jimu_core.al_.Push,jimu_core.al_.Fade].map(((info,index)=>this.createAnimationCard(info,index,!0))))),(0,jimu_core.Yac)(setting_components.SettingSection,null,(0,jimu_core.Yac)(setting_components.SettingRow,null,(0,jimu_core.Yac)(jimu_ui.Checkbox,{onChange:this.updateFirstPanel,className:"mr-2"}),formatMessage("applyToFirstPanel"))))}}try{TransitionPopperContent.displayName="TransitionPopperContent",TransitionPopperContent.__docgenInfo={description:"",displayName:"TransitionPopperContent",props:{transitionType:{defaultValue:null,description:"",name:"transitionType",required:!0,type:{name:"enum",value:[{value:'"FADE"'},{value:'"COVER"'},{value:'"PUSH"'}]}},panelTransitionType:{defaultValue:null,description:"",name:"panelTransitionType",required:!0,type:{name:"enum",value:[{value:'"FADE"'},{value:'"COVER"'},{value:'"PUSH"'}]}},onTransitionTypeChange:{defaultValue:null,description:"",name:"onTransitionTypeChange",required:!0,type:{name:"(type: ScreenTransitionType) => void"}},onPanelTransitionTypeChange:{defaultValue:null,description:"",name:"onPanelTransitionTypeChange",required:!0,type:{name:"(type: ScreenTransitionType) => void"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/screen-group-setting-popper.tsx#TransitionPopperContent"]={docgenInfo:TransitionPopperContent.__docgenInfo,name:"TransitionPopperContent",path:"../jimu-layouts/lib/flow-layout/builder/screen-group-setting-popper.tsx#TransitionPopperContent"})}catch(__react_docgen_typescript_loader_error){}const animationIcon=__webpack_require__("../jimu-ui/advanced/lib/assets/icon_animation_in_none.svg");class ScreenGroupSetting extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.sidePopperTrigger=jimu_core.q_G.createRef(),this.onTransitionTypeChange=type=>{const{screenGroupId}=this.props.layoutItem;(0,jimu_for_builder.getAppConfigAction)().editScreenGroupProperty(screenGroupId,"transitionType",type).exec()},this.onPanelTransitionTypeChange=type=>{const{screenGroupId}=this.props.layoutItem;(0,jimu_for_builder.getAppConfigAction)().editScreenGroupProperty(screenGroupId,"panelTransitionType",type).exec()},this.toggleSidePanel=()=>{this.setState({showSidePanel:!this.state.showSidePanel})},this.state={showSidePanel:!1}}getAnimBoxStyle(){return jimu_core.AHW`
      background-color: transparent;
      width: 100%;
      height: 72px;

      .img-tip {
        position: relative;
        min-width: 90px;
        height: 72px;
        cursor: pointer;
        background: var(--ref-palette-neutral-300);

        .has-sibling {
          position: absolute;
          &.first {
            left: 5px;
            top: 5px;
          }
          &.second {
            bottom: 5px;
            right: 5px;
          }
        }

        .diag-sep {
          position: absolute;
          height: 1px;
          width: 80px;
          top: 36px;
          transform: rotateZ(-45deg);
          background: var(--ref-palette-neutral-500);
        }
      }

      .anim-label {
        align-self: flex-start;
      }
    `}getSidePopperStyle(){return jimu_core.AHW`
      .header {
        height: 60px;
        padding: 0 0.5rem;
      }
      .side-popper-title {
        color: var(--ref-palette-neutral-1000);
        font-size: 13px;
      }
      .side-content {
        position: relative;
        width: 100%;
        height: calc(100% - 60px);
        overflow: auto;
      }
    `}render(){var _a,_b,_c,_d,_e;const{formatMessage}=this.props,transitionType=null!==(_a=this.props.transitionType)&&void 0!==_a?_a:jimu_core.al_.Fade,panelTransitionType=null!==(_b=this.props.panelTransitionType)&&void 0!==_b?_b:jimu_core.al_.Push;return(0,jimu_core.Yac)(setting_components.SettingSection,{title:formatMessage("transition")},(0,jimu_core.Yac)("div",{className:"anima-box d-flex justify-content-between align-items-center",css:this.getAnimBoxStyle()},(0,jimu_core.Yac)("div",{className:"img-tip d-flex justify-content-center align-items-center",onClick:this.toggleSidePanel},(0,jimu_core.Yac)("div",{className:"anim-icon first has-sibling"},(0,jimu_core.Yac)(jimu_ui.Icon,{icon:null!==(_c=icons[transitionType])&&void 0!==_c?_c:animationIcon,size:32})),(0,jimu_core.Yac)("div",{className:"diag-sep"}),(0,jimu_core.Yac)("div",{className:"anim-icon second has-sibling"},(0,jimu_core.Yac)(jimu_ui.Icon,{icon:null!==(_d=icons[panelTransitionType])&&void 0!==_d?_d:animationIcon,size:32}))),(0,jimu_core.Yac)("div",{className:"d-flex flex-column justify-content-between align-items-end h-100"},(0,jimu_core.Yac)("div",{className:"anim-label"},(0,jimu_core.Yac)("span",null,formatMessage(transitionType.toLowerCase())),(0,jimu_core.Yac)("span",{className:"mx-1"},"/"),(0,jimu_core.Yac)("span",null,formatMessage(panelTransitionType.toLowerCase()))),(0,jimu_core.Yac)("div",{className:"amin-icons w-100",ref:this.sidePopperTrigger},(0,jimu_core.Yac)(jimu_ui.Button,{size:"sm",onClick:this.toggleSidePanel,className:"text-truncate",title:formatMessage("change")},formatMessage("change"))))),this.state.showSidePanel&&(0,jimu_core.Yac)(setting_components.SidePopper,{isOpen:!0,title:formatMessage("transition"),css:this.getSidePopperStyle(),position:"right",toggle:this.toggleSidePanel,trigger:null===(_e=this.sidePopperTrigger)||void 0===_e?void 0:_e.current},(0,jimu_core.Yac)("div",{className:"side-content"},(0,jimu_core.Yac)(TransitionPopperContent,{transitionType,panelTransitionType,onTransitionTypeChange:this.onTransitionTypeChange,onPanelTransitionTypeChange:this.onPanelTransitionTypeChange,formatMessage}))))}}const screen_group_setting_mapStateToProps=(0,jimu_core.Mz0)([(state,props)=>{const{screenGroupId}=props.layoutItem,{appConfig}=state.appStateInBuilder;return appConfig.screenGroups[screenGroupId].transitionType},(state,props)=>{const{screenGroupId}=props.layoutItem,{appConfig}=state.appStateInBuilder;return appConfig.screenGroups[screenGroupId].panelTransitionType}],((transitionType,panelTransitionType)=>({transitionType,panelTransitionType}))),screen_group_setting=jimu_core.E_S.connect(screen_group_setting_mapStateToProps)(ScreenGroupSetting);try{screengroupsetting.displayName="screengroupsetting",screengroupsetting.__docgenInfo={description:"",displayName:"screengroupsetting",props:{style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/screen-group-setting.tsx#screengroupsetting"]={docgenInfo:screengroupsetting.__docgenInfo,name:"screengroupsetting",path:"../jimu-layouts/lib/flow-layout/builder/screen-group-setting.tsx#screengroupsetting"})}catch(__react_docgen_typescript_loader_error){}const inputStyle={width:110};class FloatingItemSetting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.updateWidth=value=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.set("width",jimu_ui.utils.stringOfLinearUnit(value)),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.updateBBoxWidth=value=>{let bbox=(0,jimu_core.J3Z)(this.props.layoutItem.bbox||{});bbox=bbox.set("width",jimu_ui.utils.stringOfLinearUnit(value)),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)},this.updateHeight=value=>{let bbox=(0,jimu_core.J3Z)(this.props.layoutItem.bbox||{});bbox=bbox.set("height",jimu_ui.utils.stringOfLinearUnit(value)),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)},this.updateOffsetX=value=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.set("offsetX",value))},this.updateOffsetY=value=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.set("offsetY",value))},this.updateHeightMode=mode=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.set("heightMode",mode===layout_runtime.LayoutItemSizeModes.Custom?"fixed":"auto"),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)}}updateFloatingArea(value){const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.set("floatingArea",value))}getStyle(){return jimu_core.AHW`
      .floating-position {
        margin-bottom: 1rem;
      }

      .floating-area-chooser {
        position: relative;

        .content {
          display: grid;
          grid-template-columns: 1fr 1fr 1fr;
          grid-row-gap: 0;
          grid-column-gap: 0;
          border: 1px solid var(--ref-palette-neutral-500);

          & > div {
            cursor: pointer;
            width: 30px;
            height: 30px;
            position: relative;
          }

          & > div:nth-of-type(3n+1) {
            border-right: 1px solid var(--ref-palette-neutral-500);
          }
          & > div:nth-of-type(3n) {
            border-left: 1px solid var(--ref-palette-neutral-500);
          }
          & > div:nth-of-type(1), & > div:nth-of-type(2), & > div:nth-of-type(3) {
            border-bottom: 1px solid var(--ref-palette-neutral-500);
          }
          & > div:nth-of-type(7), & > div:nth-of-type(8), & > div:nth-of-type(9) {
            border-top: 1px solid var(--ref-palette-neutral-500);
          }

          .selected:after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: var(--sys-color-primary-light);
            border: 1px solid var(--sys-color-primary-main);
          }
        }
      }
    `}render(){const{layoutId,layoutItem,formatMessage,isLockLayout}=this.props;if(!layoutItem)return null;if(layoutItem.type===jimu_core.K6q.ScreenGroup)return(0,jimu_core.Yac)(screen_group_setting,Object.assign({},this.props));this.itemSetting=jimu_core.CM0.assign({},flow_layout_default_setting.E,layoutItem.setting);const bbox=layoutItem.bbox;return(0,jimu_core.Yac)("div",{className:"flow-item-setting",css:this.getStyle()},!isLockLayout&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(setting_components.SettingSection,{title:`${formatMessage("position")} & ${formatMessage("size")}`},(0,jimu_core.Yac)("div",{className:"floating-position d-flex"},(0,jimu_core.Yac)("div",{className:"floating-area-chooser"},(0,jimu_core.Yac)("div",{className:"content"},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("top-left",{selected:1===this.itemSetting.floatingArea}),onClick:this.updateFloatingArea.bind(this,1)}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("top-center",{selected:2===this.itemSetting.floatingArea}),onClick:this.updateFloatingArea.bind(this,2)}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("top-right",{selected:3===this.itemSetting.floatingArea}),onClick:this.updateFloatingArea.bind(this,3)}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("middle-left",{selected:4===this.itemSetting.floatingArea}),onClick:this.updateFloatingArea.bind(this,4)}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("middle-center",{selected:5===this.itemSetting.floatingArea}),onClick:this.updateFloatingArea.bind(this,5)}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("middle-right",{selected:6===this.itemSetting.floatingArea}),onClick:this.updateFloatingArea.bind(this,6)}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("bottom-left",{selected:7===this.itemSetting.floatingArea}),onClick:this.updateFloatingArea.bind(this,7)}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("bottom-center",{selected:8===this.itemSetting.floatingArea}),onClick:this.updateFloatingArea.bind(this,8)}),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("bottom-right",{selected:9===this.itemSetting.floatingArea}),onClick:this.updateFloatingArea.bind(this,9)}))),(0,jimu_core.Yac)("div",{className:"d-flex flex-grow-1 flex-column justify-content-between align-items-end"},(0,jimu_core.Yac)("div",{className:"d-flex align-items-center",css:jimu_core.AHW`width: 110px`},(0,jimu_core.Yac)("span",{className:"mr-2"},"W"),(0,jimu_core.Yac)(style_setting_components.rL,{label:"W",mode:layout_runtime.LayoutItemSizeModes.Custom,disableModeSelect:!0,value:null==bbox?void 0:bbox.width,onChange:this.updateBBoxWidth})),(0,jimu_core.Yac)("div",{className:"d-flex align-items-center",css:jimu_core.AHW`width: 110px`},(0,jimu_core.Yac)("span",{className:"mr-2"},"H"),(0,jimu_core.Yac)(style_setting_components.rL,{label:"H",mode:layout_runtime.LayoutItemSizeModes.Custom,disableModeSelect:!0,value:null==bbox?void 0:bbox.height,onChange:this.updateHeight})))),(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("offsetX")},(0,jimu_core.Yac)(jimu_ui.NumericInput,{style:inputStyle,value:this.itemSetting.offsetX,precision:0,onChange:this.updateOffsetX,size:"sm"})),(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("offsetY")},(0,jimu_core.Yac)(jimu_ui.NumericInput,{style:inputStyle,precision:0,value:this.itemSetting.offsetY,onChange:this.updateOffsetY,size:"sm"})))),(layoutItem.type===jimu_core.K6q.Widget||layoutItem.sectionId)&&(0,jimu_core.Yac)(CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,isSection:!1,style:this.props.style,onStyleChange:this.props.onStyleChange,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))}}try{floatingitemsetting.displayName="floatingitemsetting",floatingitemsetting.__docgenInfo={description:"",displayName:"floatingitemsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/floating-item-setting.tsx#floatingitemsetting"]={docgenInfo:floatingitemsetting.__docgenInfo,name:"floatingitemsetting",path:"../jimu-layouts/lib/flow-layout/builder/floating-item-setting.tsx#floatingitemsetting"})}catch(__react_docgen_typescript_loader_error){}const flow_item_setting_inputStyle={width:110},heightModes=[layout_runtime.LayoutItemSizeModes.Auto,layout_runtime.LayoutItemSizeModes.Custom],heightUnits=[jimu_ui.DistanceUnits.PIXEL];class FlowItemSetting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.updateWidth=value=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.set("width",jimu_ui.utils.stringOfLinearUnit(value)),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.updateBBoxWidth=value=>{let bbox=(0,jimu_core.J3Z)(this.props.layoutItem.bbox||{});bbox=bbox.set("width",jimu_ui.utils.stringOfLinearUnit(value)),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)},this.updateHeight=value=>{let bbox=(0,jimu_core.J3Z)(this.props.layoutItem.bbox||{});bbox=bbox.set("height",jimu_ui.utils.stringOfLinearUnit(value)),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)},this.updateOffsetX=value=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.set("offsetX",value))},this.updateOffsetY=value=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.set("offsetY",value))},this.updateHeightMode=mode=>{var _a,_b,_c;const{layoutItem}=this.props;let setting=null!==(_a=layoutItem.setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({});if(setting=setting.set("heightMode",mode===layout_runtime.LayoutItemSizeModes.Custom?"fixed":"auto"),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting),!(null===(_b=layoutItem.bbox)||void 0===_b?void 0:_b.height)){const itemRect=this.getSizeOfItem();if(itemRect){let bbox=(0,jimu_core.J3Z)(null!==(_c=layoutItem.bbox)&&void 0!==_c?_c:{});bbox=bbox.set("height",`${Math.round(itemRect.height)}px`),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)}}}}getSizeOfItem(){const{layoutId,layoutItem}=this.props,layoutElem=this.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItem.id}"]`);return layoutElem?layoutElem.getBoundingClientRect():null}querySelector(selector){const appFrame=document.querySelector(`iframe[name="${jimu_core.mXW}"]`);if(appFrame){return(appFrame.contentDocument||appFrame.contentWindow.document).querySelector(selector)}return null}updateFloatingArea(value){const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.set("floatingArea",value))}render(){var _a,_b;const{layoutId,layoutItem,formatMessage,isLockLayout}=this.props;if(!layoutItem)return null;if(layoutItem.type===jimu_core.K6q.ScreenGroup)return(0,jimu_core.Yac)(screen_group_setting,Object.assign({},this.props));if(this.itemSetting=jimu_core.CM0.assign({},flow_layout_default_setting.E,layoutItem.setting),this.itemSetting.isFloating)return(0,jimu_core.Yac)(FloatingItemSetting,Object.assign({},this.props));const bbox=layoutItem.bbox,width=jimu_ui.utils.stringOfLinearUnit((0,layout_utils.p5)(this.itemSetting)),height=jimu_ui.utils.stringOfLinearUnit(parseFloat(null===(_a=layoutItem.bbox)||void 0===_a?void 0:_a.height)>0?null===(_b=layoutItem.bbox)||void 0===_b?void 0:_b.height:100),isAuto="auto"===this.itemSetting.heightMode||layout_runtime.utils.isPercentage(null==bbox?void 0:bbox.height);return(0,jimu_core.Yac)("div",{className:"flow-item-setting"},!isLockLayout&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(setting_components.SettingSection,{title:formatMessage("size")},(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("width")},(0,jimu_core.Yac)("div",{style:flow_item_setting_inputStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"W",mode:layout_runtime.LayoutItemSizeModes.Custom,disableModeSelect:!0,value:width,onChange:this.updateWidth}))),(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("height")},(0,jimu_core.Yac)("div",{style:flow_item_setting_inputStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"H",mode:isAuto?layout_runtime.LayoutItemSizeModes.Auto:layout_runtime.LayoutItemSizeModes.Custom,sizeModes:heightModes,availableUnits:heightUnits,disableModeSelect:!1,value:height,onChange:this.updateHeight,onModeChange:this.updateHeightMode})))),(0,jimu_core.Yac)(setting_components.SettingSection,{title:formatMessage("position")},(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("offsetX")},(0,jimu_core.Yac)(jimu_ui.NumericInput,{style:flow_item_setting_inputStyle,value:this.itemSetting.offsetX,onChange:this.updateOffsetX,precision:0,size:"sm"})),(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("offsetY")},(0,jimu_core.Yac)(jimu_ui.NumericInput,{style:flow_item_setting_inputStyle,value:this.itemSetting.offsetY,onChange:this.updateOffsetY,precision:0,size:"sm"})))),(layoutItem.type===jimu_core.K6q.Widget||layoutItem.sectionId)&&(0,jimu_core.Yac)(CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,isSection:!1,style:this.props.style,onStyleChange:this.props.onStyleChange,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))}}try{flowitemsetting.displayName="flowitemsetting",flowitemsetting.__docgenInfo={description:"",displayName:"flowitemsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/flow-item-setting.tsx#flowitemsetting"]={docgenInfo:flowitemsetting.__docgenInfo,name:"flowitemsetting",path:"../jimu-layouts/lib/flow-layout/builder/flow-item-setting.tsx#flowitemsetting"})}catch(__react_docgen_typescript_loader_error){}const column_item_setting_inputStyle=jimu_core.AHW`width: 100px;`,widthModes=[layout_runtime.LayoutItemSizeModes.Stretch,layout_runtime.LayoutItemSizeModes.Custom],column_item_setting_heightModes=[layout_runtime.LayoutItemSizeModes.Auto,layout_runtime.LayoutItemSizeModes.Stretch,layout_runtime.LayoutItemSizeModes.Custom],heightModesWithoutAuto=[layout_runtime.LayoutItemSizeModes.Stretch,layout_runtime.LayoutItemSizeModes.Custom],availableWidthUnits=[jimu_ui.DistanceUnits.PIXEL,jimu_ui.DistanceUnits.PERCENTAGE],availableHeightUnits=[jimu_ui.DistanceUnits.PIXEL];class ColumnItemSetting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.updateBBox=(prop,value)=>{var _a;let bbox=this.props.layoutItem.bbox;const{distance,unit}=value,originalValue=bbox[prop],containerRect=this.getSizeOfContainer();let pixelValue,newValue=distance.toFixed(2);if(layout_runtime.utils.isPercentage(originalValue)&&unit===jimu_ui.DistanceUnits.PIXEL?containerRect&&(newValue="left"===prop||"right"===prop||"width"===prop?Math.round(parseFloat(originalValue)*containerRect.width/100):Math.round(parseFloat(originalValue)*containerRect.height/100),pixelValue=newValue):layout_runtime.utils.isPercentage(originalValue)||unit!==jimu_ui.DistanceUnits.PERCENTAGE||(containerRect&&(newValue="left"===prop||"right"===prop||"width"===prop?(100*parseFloat(originalValue)/containerRect.width).toFixed(4):(100*parseFloat(originalValue)/containerRect.height).toFixed(4)),pixelValue=parseFloat(originalValue)),pixelValue||unit!==jimu_ui.DistanceUnits.PERCENTAGE)pixelValue||unit!==jimu_ui.DistanceUnits.PIXEL||(pixelValue=distance);else{const total="width"===prop?containerRect.width:containerRect.height;pixelValue=Math.round(distance*total/100)}if(bbox=bbox.set(prop,unit===jimu_ui.DistanceUnits.PERCENTAGE?`${newValue}%`:`${newValue}px`),"ratio"===(null===(_a=this.props.layoutItem.setting)||void 0===_a?void 0:_a.heightMode)){const ratio=this.props.layoutItem.setting.aspectRatio;if("width"===prop){const height=pixelValue*ratio;if(layout_runtime.utils.isPercentage(bbox.height)){const newValue=(100*height/containerRect.height).toFixed(4);bbox=bbox.set("height",`${newValue}%`)}else bbox=bbox.set("height",`${Math.round(height)}px`)}else{const width=pixelValue/ratio;if(layout_runtime.utils.isPercentage(bbox.width)){const newValue=(100*width/containerRect.width).toFixed(4);bbox=bbox.set("width",`${newValue}%`)}else bbox=bbox.set("width",`${Math.round(width)}px`)}}this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)},this.toggleHeightMode=()=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});const heightMode="ratio"===setting.heightMode?"fixed":"ratio";if(setting=setting.set("heightMode",heightMode),"ratio"===heightMode){const itemRect=this.getSizeOfItem();itemRect&&(setting=setting.set("aspectRatio",Number((itemRect.height/itemRect.width).toFixed(2))))}else{let bbox=this.props.layoutItem.bbox;const rect=this.getSizeOfItem();if(layout_runtime.utils.isPercentage(bbox.width)){const containerRect=this.getSizeOfContainer();bbox=bbox.set("width",`${(100*rect.width/containerRect.width).toFixed(4)}%`)}else bbox=bbox.set("width",`${Math.round(rect.width)}px`);bbox=bbox.set("height",`${Math.round(rect.height)}px`),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)}this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.updateAlignSelf=e=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.setIn(["style","alignSelf"],e.target.value),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.updateHeightMode=mode=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});let bbox=(0,jimu_core.J3Z)(this.props.layoutItem.bbox);if(mode===layout_runtime.LayoutItemSizeModes.Custom&&isNaN(parseFloat(bbox.height))){const rect=this.getSizeOfItem();bbox=bbox.set("height",`${Math.round(rect.height)}px`),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)}this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.setIn(["autoProps","height"],mode))},this.updateWidthMode=mode=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});let bbox=(0,jimu_core.J3Z)(this.props.layoutItem.bbox);if(mode===layout_runtime.LayoutItemSizeModes.Custom&&isNaN(parseFloat(bbox.width))){const rect=this.getSizeOfItem();bbox=bbox.set("width",`${Math.round(rect.width)}px`),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)}this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.setIn(["autoProps","width"],mode))},this.updateAspectRatio=newRatio=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.set("aspectRatio",newRatio),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.formatMessage=id=>this.props.formatMessage(id)}getSizeOfContainer(){const layoutElem=this.querySelector(`div.column-layout[data-layoutid="${this.props.layoutId}"]`);return layoutElem?layoutElem.getBoundingClientRect():null}getSizeOfItem(){const{layoutId,layoutItem}=this.props,layoutElem=this.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItem.id}"]`);return layoutElem?layoutElem.getBoundingClientRect():null}querySelector(selector){const appFrame=document.querySelector(`iframe[name="${jimu_core.mXW}"]`);if(appFrame){return(appFrame.contentDocument||appFrame.contentWindow.document).querySelector(selector)}return null}getStyle(){return jimu_core.AHW`
      .rotation-setting, .rotation-setting input {
        height: 26px;
      }

      .ratio-value {
        font-size: 12px;
      }

      .align-select {
        .dropdown-button, .dropdown-button:hover {
          height: 26px;
        }
      }
    `}render(){var _a,_b,_c,_d;const{layoutId,layoutItem,isLockLayout,supportAutoSize}=this.props;if(!layoutItem)return null;const setting=layoutItem.setting||{},style=setting.style||{},bbox=layoutItem.bbox||{},isAutoWidth=(null===(_a=setting.autoProps)||void 0===_a?void 0:_a.width)!==layout_runtime.LayoutItemSizeModes.Custom,heightMode=null!==(_c=null===(_b=setting.autoProps)||void 0===_b?void 0:_b.height)&&void 0!==_c?_c:layout_runtime.LayoutItemSizeModes.Custom,keepAspectRatio="ratio"===setting.heightMode;return(0,jimu_core.Yac)("div",{className:"column-item-setting",css:this.getStyle()},!isLockLayout&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group",title:this.formatMessage("size"),"aria-label":this.formatMessage("size")},(0,jimu_core.Yac)(setting_components.SettingRow,{role:"group",label:this.formatMessage("width"),"aria-label":this.formatMessage("width")},(0,jimu_core.Yac)("div",{css:column_item_setting_inputStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"W",mode:isAutoWidth?layout_runtime.LayoutItemSizeModes.Stretch:layout_runtime.LayoutItemSizeModes.Custom,sizeModes:widthModes,value:null==bbox?void 0:bbox.width,availableUnits:availableWidthUnits,onChange:value=>{this.updateBBox("width",value)},onModeChange:this.updateWidthMode}))),(0,jimu_core.Yac)(setting_components.SettingRow,{className:"mt-0",label:(0,jimu_core.Yac)(jimu_ui.Tooltip,{title:this.formatMessage("keepAspectRatio"),placement:"bottom"},(0,jimu_core.Yac)(jimu_ui.Button,{size:"sm",type:"tertiary",className:"ml-1",icon:!0,onClick:this.toggleHeightMode,"aria-pressed":keepAspectRatio},keepAspectRatio?(0,jimu_core.Yac)(lock.s,{size:"s"}):(0,jimu_core.Yac)(editor_unlock.R,{size:"s"})))}),(0,jimu_core.Yac)(setting_components.SettingRow,{role:"group",className:"mt-0",label:this.formatMessage("height"),"aria-label":this.formatMessage("height")},(0,jimu_core.Yac)("div",{css:column_item_setting_inputStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"H",mode:heightMode||layout_runtime.LayoutItemSizeModes.Custom,sizeModes:supportAutoSize?column_item_setting_heightModes:heightModesWithoutAuto,value:bbox.height,availableUnits:availableHeightUnits,onChange:value=>{this.updateBBox("height",value)},onModeChange:this.updateHeightMode,disabled:keepAspectRatio}))),keepAspectRatio&&(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("aspectRatio"),"aria-label":this.formatMessage("aspectRatio")},(0,jimu_core.Yac)(style_setting_components.Kr,{value:setting.aspectRatio,style:{width:100},onChange:this.updateAspectRatio})),!isAutoWidth&&(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("align")},(0,jimu_core.Yac)(jimu_ui.Select,{"aria-label":this.formatMessage("align"),className:"align-select",value:null!==(_d=style.alignSelf)&&void 0!==_d?_d:"flex-start",onChange:this.updateAlignSelf,css:column_item_setting_inputStyle},(0,jimu_core.Yac)("option",{value:"flex-start"},this.formatMessage("start")),(0,jimu_core.Yac)("option",{value:"flex-end"},this.formatMessage("end")),(0,jimu_core.Yac)("option",{value:"center"},this.formatMessage("center")))),(0,jimu_core.Yac)(common_transform_setting_CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,setting,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))),(layoutItem.type===jimu_core.K6q.Widget||layoutItem.sectionId)&&(0,jimu_core.Yac)(CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,isSection:layoutItem.type===jimu_core.K6q.Section,style:this.props.style,onStyleChange:this.props.onStyleChange,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))}}try{columnitemsetting.displayName="columnitemsetting",columnitemsetting.__docgenInfo={description:"",displayName:"columnitemsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/column-layout/builder/column-item-setting.tsx#columnitemsetting"]={docgenInfo:columnitemsetting.__docgenInfo,name:"columnitemsetting",path:"../jimu-layouts/lib/column-layout/builder/column-item-setting.tsx#columnitemsetting"})}catch(__react_docgen_typescript_loader_error){}const flex_row_item_setting_inputStyle=jimu_core.AHW`width: 100px;`,flex_row_item_setting_heightModes=[layout_runtime.LayoutItemSizeModes.Auto,layout_runtime.LayoutItemSizeModes.Stretch,layout_runtime.LayoutItemSizeModes.Custom],flex_row_item_setting_widthModes=[layout_runtime.LayoutItemSizeModes.Auto,layout_runtime.LayoutItemSizeModes.Stretch,layout_runtime.LayoutItemSizeModes.Custom],flex_row_item_setting_heightModesWithoutAuto=[layout_runtime.LayoutItemSizeModes.Stretch,layout_runtime.LayoutItemSizeModes.Custom],flex_row_item_setting_availableHeightUnits=[jimu_ui.DistanceUnits.PIXEL,jimu_ui.DistanceUnits.PERCENTAGE],flex_row_item_setting_availableWidthUnits=[jimu_ui.DistanceUnits.PIXEL];class FlexRowItemSetting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.updateBBox=(prop,value)=>{var _a;let bbox=this.props.layoutItem.bbox;const{distance,unit}=value,originalValue=bbox[prop],containerRect=this.getSizeOfContainer();let pixelValue,newValue=distance.toFixed(2);if(layout_runtime.utils.isPercentage(originalValue)&&unit===jimu_ui.DistanceUnits.PIXEL?containerRect&&(newValue="left"===prop||"right"===prop||"width"===prop?Math.round(parseFloat(originalValue)*containerRect.width/100):Math.round(parseFloat(originalValue)*containerRect.height/100),pixelValue=newValue):layout_runtime.utils.isPercentage(originalValue)||unit!==jimu_ui.DistanceUnits.PERCENTAGE||(containerRect&&(newValue="left"===prop||"right"===prop||"width"===prop?(100*parseFloat(originalValue)/containerRect.width).toFixed(4):(100*parseFloat(originalValue)/containerRect.height).toFixed(4)),pixelValue=parseFloat(originalValue)),pixelValue||unit!==jimu_ui.DistanceUnits.PERCENTAGE)pixelValue||unit!==jimu_ui.DistanceUnits.PIXEL||(pixelValue=distance);else{const total="width"===prop?containerRect.width:containerRect.height;pixelValue=Math.round(distance*total/100)}if(bbox=bbox.set(prop,unit===jimu_ui.DistanceUnits.PERCENTAGE?`${newValue}%`:`${newValue}px`),"ratio"===(null===(_a=this.props.layoutItem.setting)||void 0===_a?void 0:_a.heightMode)){const ratio=this.props.layoutItem.setting.aspectRatio;if("width"===prop){const height=pixelValue*ratio;if(layout_runtime.utils.isPercentage(bbox.height)){const newValue=(100*height/containerRect.height).toFixed(4);bbox=bbox.set("height",`${newValue}%`)}else bbox=bbox.set("height",`${Math.round(height)}px`)}else{const width=pixelValue/ratio;if(layout_runtime.utils.isPercentage(bbox.width)){const newValue=(100*width/containerRect.width).toFixed(4);bbox=bbox.set("width",`${newValue}%`)}else bbox=bbox.set("width",`${Math.round(width)}px`)}}this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)},this.toggleHeightMode=()=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});const heightMode="ratio"===setting.heightMode?"fixed":"ratio";setting=setting.set("heightMode",heightMode);const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();if("ratio"===heightMode){const itemRect=this.getSizeOfItem();itemRect&&(setting=setting.set("aspectRatio",Number((itemRect.height/itemRect.width).toFixed(2))))}else{let bbox=this.props.layoutItem.bbox;const rect=this.getSizeOfItem();if(layout_runtime.utils.isPercentage(bbox.width)){const containerRect=this.getSizeOfContainer();bbox=bbox.set("width",`${(100*rect.width/containerRect.width).toFixed(4)}%`)}else bbox=bbox.set("width",`${Math.round(rect.width)}px`);bbox=bbox.set("height",`${Math.round(rect.height)}px`),appConfigAction.editLayoutItemProperty({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},"bbox",bbox)}appConfigAction.editLayoutItemProperty({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},"setting",setting).exec()},this.updateAlignSelf=e=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.setIn(["style","alignSelf"],e.target.value),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.updateHeightMode=mode=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});let bbox=(0,jimu_core.J3Z)(this.props.layoutItem.bbox);if(mode===layout_runtime.LayoutItemSizeModes.Custom&&isNaN(parseFloat(bbox.height))){const rect=this.getSizeOfItem();bbox=bbox.set("height",`${Math.round(rect.height)}px`),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)}this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.setIn(["autoProps","height"],mode))},this.updateWidthMode=mode=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});let bbox=(0,jimu_core.J3Z)(this.props.layoutItem.bbox);if(mode===layout_runtime.LayoutItemSizeModes.Custom&&isNaN(parseFloat(bbox.width))){const rect=this.getSizeOfItem();bbox=bbox.set("width",`${Math.round(rect.width)}px`),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)}this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.setIn(["autoProps","width"],mode))},this.updateAspectRatio=newRatio=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.set("aspectRatio",newRatio),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.formatMessage=id=>this.props.formatMessage(id)}getSizeOfContainer(){const layoutElem=this.querySelector(`div.column-layout[data-layoutid="${this.props.layoutId}"]`);return layoutElem?layoutElem.getBoundingClientRect():null}getSizeOfItem(){const{layoutId,layoutItem}=this.props,layoutElem=this.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItem.id}"]`);return layoutElem?layoutElem.getBoundingClientRect():null}querySelector(selector){const appFrame=document.querySelector(`iframe[name="${jimu_core.mXW}"]`);if(appFrame){return(appFrame.contentDocument||appFrame.contentWindow.document).querySelector(selector)}return null}getStyle(){return jimu_core.AHW`
      .rotation-setting, .rotation-setting input {
        height: 26px;
      }

      .ratio-value {
        font-size: 12px;
      }

      .align-select {
        .dropdown-button, .dropdown-button:hover {
          height: 26px;
        }
      }
    `}render(){var _a,_b,_c,_d,_e;const{layoutId,layoutItem,isLockLayout,supportAutoSize}=this.props;if(!layoutItem)return null;const setting=layoutItem.setting||{},style=setting.style||{},bbox=layoutItem.bbox||{},heightMode=null!==(_b=null===(_a=setting.autoProps)||void 0===_a?void 0:_a.height)&&void 0!==_b?_b:layout_runtime.LayoutItemSizeModes.Stretch,isStretch=heightMode===layout_runtime.LayoutItemSizeModes.Stretch,widthMode=null!==(_d=null===(_c=setting.autoProps)||void 0===_c?void 0:_c.width)&&void 0!==_d?_d:layout_runtime.LayoutItemSizeModes.Custom,keepAspectRatio="ratio"===setting.heightMode;return(0,jimu_core.Yac)("div",{className:"flex-row-item-setting",css:this.getStyle()},!isLockLayout&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group",title:this.formatMessage("size"),"aria-label":this.formatMessage("size")},(0,jimu_core.Yac)(setting_components.SettingRow,{role:"group",label:this.formatMessage("width"),"aria-label":this.formatMessage("width")},(0,jimu_core.Yac)("div",{css:flex_row_item_setting_inputStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"W",mode:widthMode,sizeModes:flex_row_item_setting_widthModes,value:null==bbox?void 0:bbox.width,availableUnits:flex_row_item_setting_availableWidthUnits,onChange:value=>{this.updateBBox("width",value)},onModeChange:this.updateWidthMode}))),(0,jimu_core.Yac)("div",null,(0,jimu_core.Yac)(jimu_ui.Tooltip,{title:this.formatMessage("keepAspectRatio"),placement:"bottom"},(0,jimu_core.Yac)(jimu_ui.Button,{size:"sm",type:"tertiary",className:"ml-1",icon:!0,onClick:this.toggleHeightMode,"aria-pressed":keepAspectRatio},keepAspectRatio?(0,jimu_core.Yac)(lock.s,{size:"s"}):(0,jimu_core.Yac)(editor_unlock.R,{size:"s"})))),(0,jimu_core.Yac)(setting_components.SettingRow,{role:"group",className:"mt-0",label:this.formatMessage("height"),"aria-label":this.formatMessage("height")},(0,jimu_core.Yac)("div",{css:flex_row_item_setting_inputStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"H",mode:heightMode,sizeModes:supportAutoSize?flex_row_item_setting_heightModes:flex_row_item_setting_heightModesWithoutAuto,value:bbox.height,availableUnits:flex_row_item_setting_availableHeightUnits,onChange:value=>{this.updateBBox("height",value)},onModeChange:this.updateHeightMode,disabled:keepAspectRatio}))),keepAspectRatio&&(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("aspectRatio"),"aria-label":this.formatMessage("aspectRatio")},(0,jimu_core.Yac)(style_setting_components.Kr,{value:setting.aspectRatio,style:{width:100},onChange:this.updateAspectRatio})),!isStretch&&(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("align")},(0,jimu_core.Yac)(jimu_ui.Select,{"aria-label":this.formatMessage("align"),className:"align-select",value:null!==(_e=style.alignSelf)&&void 0!==_e?_e:"flex-start",onChange:this.updateAlignSelf,css:flex_row_item_setting_inputStyle},(0,jimu_core.Yac)("option",{value:"flex-start"},this.formatMessage("start")),(0,jimu_core.Yac)("option",{value:"flex-end"},this.formatMessage("end")),(0,jimu_core.Yac)("option",{value:"center"},this.formatMessage("center")))),(0,jimu_core.Yac)(common_transform_setting_CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,setting,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))),(layoutItem.type===jimu_core.K6q.Widget||layoutItem.sectionId)&&(0,jimu_core.Yac)(CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,isSection:layoutItem.type===jimu_core.K6q.Section,style:this.props.style,onStyleChange:this.props.onStyleChange,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))}}try{flexrowitemsetting.displayName="flexrowitemsetting",flexrowitemsetting.__docgenInfo={description:"",displayName:"flexrowitemsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flex-row-layout/builder/flex-row-item-setting.tsx#flexrowitemsetting"]={docgenInfo:flexrowitemsetting.__docgenInfo,name:"flexrowitemsetting",path:"../jimu-layouts/lib/flex-row-layout/builder/flex-row-item-setting.tsx#flexrowitemsetting"})}catch(__react_docgen_typescript_loader_error){}const row_item_setting_inputStyle=jimu_core.AHW`width: 72px`,sizeEditorStyle=jimu_core.AHW`width: 100px;`,row_item_setting_heightModes=[layout_runtime.LayoutItemSizeModes.Auto,layout_runtime.LayoutItemSizeModes.Stretch,layout_runtime.LayoutItemSizeModes.Custom],row_item_setting_heightModesWithoutAuto=[layout_runtime.LayoutItemSizeModes.Stretch,layout_runtime.LayoutItemSizeModes.Custom];class RowItemSetting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.handleAlignChange=e=>{this.updateStyle("alignSelf",e.target.value)},this.handleHeightChange=value=>{let bbox=this.props.layoutItem.bbox;const{distance,unit}=value,originalValue=bbox.height,containerRect=this.getSizeOfContainer();let newValue=distance.toFixed(2);layout_runtime.utils.isPercentage(originalValue)&&unit===jimu_ui.DistanceUnits.PIXEL?null!=containerRect&&(newValue=Math.round(parseFloat(originalValue)*containerRect.height/100)):layout_runtime.utils.isPercentage(originalValue)||unit!==jimu_ui.DistanceUnits.PERCENTAGE||null!=containerRect&&(newValue=(100*parseFloat(originalValue)/containerRect.height).toFixed(4)),bbox=bbox.set("height",unit===jimu_ui.DistanceUnits.PERCENTAGE?`${newValue}%`:`${newValue}px`),this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox)},this.handleHeightModeChange=mode=>{var _a;const setting=null!==(_a=this.props.layoutItem.setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.setIn(["autoProps","height"],mode))},this.updateAspectSetting=heightMode=>{var _a;let setting=null!==(_a=this.props.layoutItem.setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({});if("fit"===setting.heightMode&&(setting=setting.setIn(["autoProps","height"],layout_runtime.LayoutItemSizeModes.Stretch)),setting=setting.set("heightMode",heightMode),"ratio"===heightMode){const itemRect=this.getSizeOfItem();null!=itemRect&&(setting=setting.set("aspectRatio",Number((itemRect.height/itemRect.width).toFixed(2))))}else{const bbox=this.props.layoutItem.bbox,rect=this.getSizeOfItem();if(layout_runtime.utils.isPercentage(bbox.height)){const containerRect=this.getSizeOfContainer();this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox.set("height",`${(100*rect.height/containerRect.height).toFixed(4)}%`))}else this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox.set("height",`${Math.round(rect.height)}px`))}this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.handleAspectRatioChange=newRatio=>{var _a;let setting=null!==(_a=this.props.layoutItem.setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({});setting=setting.set("aspectRatio",newRatio),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.handleOffsetXChange=value=>{var _a;const setting=null!==(_a=this.props.layoutItem.setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.set("offsetX",value))},this.handleOffsetYChange=value=>{var _a;const setting=null!==(_a=this.props.layoutItem.setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.set("offsetY",value))},this.formatMessage=id=>this.props.formatMessage(id)}updateStyle(key,value){var _a;const{layoutItem}=this.props,setting=(0,jimu_core.J3Z)(null!==(_a=null==layoutItem?void 0:layoutItem.setting)&&void 0!==_a?_a:{});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.setIn(["style",key],value))}getSizeOfContainer(){const layoutElem=this.querySelector(`div.row-layout[data-layoutid="${this.props.layoutId}"]`);return null!=layoutElem?layoutElem.getBoundingClientRect():null}getSizeOfItem(){const{layoutId,layoutItem}=this.props,layoutElem=this.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItem.id}"] > div.layout-item-content`);return null!=layoutElem?layoutElem.getBoundingClientRect():null}querySelector(selector){var _a;const appFrame=document.querySelector(`iframe[name="${jimu_core.mXW}"]`);if(null!=appFrame){return(null!==(_a=appFrame.contentDocument)&&void 0!==_a?_a:appFrame.contentWindow.document).querySelector(selector)}return null}getStyle(){return jimu_core.AHW`
      .align-select {
        .dropdown-button,
        .dropdown-button:hover {
          height: 26px;
        }
      }
    `}render(){var _a,_b,_c,_d;const{layoutId,layoutItem,isLockLayout,supportAutoSize}=this.props;if(null==layoutItem)return null;const itemSetting=jimu_core.CM0.assign({},row_layout_default_setting.i,layoutItem.setting),bbox=layoutItem.bbox,style=null!==(_a=itemSetting.style)&&void 0!==_a?_a:{},heightMode=null!==(_c=null===(_b=itemSetting.autoProps)||void 0===_b?void 0:_b.height)&&void 0!==_c?_c:layout_runtime.LayoutItemSizeModes.Stretch,keepAspectRatio="ratio"===itemSetting.heightMode;return(0,jimu_core.Yac)("div",{className:"row-item-setting",css:this.getStyle()},!isLockLayout&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group",title:this.formatMessage("size"),"aria-label":this.formatMessage("size")},(0,jimu_core.Yac)(setting_components.SettingRow,{role:"group",label:this.formatMessage("height"),"aria-label":this.formatMessage("height")},(0,jimu_core.Yac)("div",{css:sizeEditorStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"H",mode:heightMode,sizeModes:supportAutoSize?row_item_setting_heightModes:row_item_setting_heightModesWithoutAuto,value:jimu_ui.utils.stringOfLinearUnit(bbox.height),onChange:this.handleHeightChange,onModeChange:this.handleHeightModeChange,disabled:keepAspectRatio}))),(0,jimu_core.Yac)(setting_components.SettingRow,null,(0,jimu_core.Yac)(jimu_ui.Checkbox,{"aria-label":this.formatMessage("keepAspectRatio"),checked:keepAspectRatio,onChange:e=>{this.updateAspectSetting(e.target.checked?"ratio":"fixed")},className:"mr-2"}),this.formatMessage("keepAspectRatio")),keepAspectRatio&&(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("aspectRatio"),"aria-label":this.formatMessage("aspectRatio")},(0,jimu_core.Yac)(style_setting_components.Kr,{value:itemSetting.aspectRatio,style:{width:100},onChange:this.handleAspectRatioChange})),heightMode!==layout_runtime.LayoutItemSizeModes.Stretch&&(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("align")},(0,jimu_core.Yac)(jimu_ui.Select,{"aria-label":this.formatMessage("align"),className:"align-select",css:sizeEditorStyle,value:null!==(_d=style.alignSelf)&&void 0!==_d?_d:"flex-start",onChange:this.handleAlignChange},(0,jimu_core.Yac)("option",{value:"flex-start"},this.formatMessage("T")),(0,jimu_core.Yac)("option",{value:"flex-end"},this.formatMessage("B")),(0,jimu_core.Yac)("option",{value:"center"},this.formatMessage("center"))))),(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group",title:this.formatMessage("position"),"aria-label":this.formatMessage("position")},(0,jimu_core.Yac)(common_transform_setting_CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,setting:layoutItem.setting,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}),(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("offsetX"),"aria-label":this.formatMessage("offsetX")},(0,jimu_core.Yac)(jimu_ui.NumericInput,{css:row_item_setting_inputStyle,value:itemSetting.offsetX,onChange:this.handleOffsetXChange,precision:0,size:"sm"})),(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("offsetY"),"aria-label":this.formatMessage("offsetY")},(0,jimu_core.Yac)(jimu_ui.NumericInput,{css:row_item_setting_inputStyle,value:itemSetting.offsetY,onChange:this.handleOffsetYChange,precision:0,size:"sm"})))),(layoutItem.type===jimu_core.K6q.Widget||null!=layoutItem.sectionId)&&(0,jimu_core.Yac)(CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,isSection:layoutItem.type===jimu_core.K6q.Section,style:this.props.style,onStyleChange:this.props.onStyleChange,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))}}try{rowitemsetting.displayName="rowitemsetting",rowitemsetting.__docgenInfo={description:"",displayName:"rowitemsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/row-layout/builder/row-item-setting.tsx#rowitemsetting"]={docgenInfo:rowitemsetting.__docgenInfo,name:"rowitemsetting",path:"../jimu-layouts/lib/row-layout/builder/row-item-setting.tsx#rowitemsetting"})}catch(__react_docgen_typescript_loader_error){}var info=__webpack_require__("../jimu-icons/outlined/suggested/info.tsx");function GridItemSetting(props){var _a,_b;const{layoutItem,layoutId}=props,translate=jimu_core.JLE.useTranslation(jimu_ui.defaultMessages),[label,setLabel]=jimu_core.q_G.useState(null!==(_a=layoutItem.label)&&void 0!==_a?_a:""),isInTab=jimu_core.E_S.useSelector((state=>{const layout=state.appStateInBuilder.appConfig.layouts[layoutId];if(layoutItem.parent){return layout.content[layoutItem.parent].gridType===jimu_core.Qwn.Tab}return!1})),innerLabel=jimu_core.E_S.useSelector((state=>{const gridItem=state.appStateInBuilder.appConfig.layouts[layoutId].content[layoutItem.id];return!isInTab||gridItem.gridType!==jimu_core.Qwn.Row&&gridItem.gridType!==jimu_core.Qwn.Column?"":gridItem.label}));jimu_core.q_G.useEffect((()=>{setLabel(innerLabel)}),[innerLabel]);const handleLabelChange=jimu_core.q_G.useCallback((value=>{(0,jimu_for_builder.getAppConfigAction)().editLayoutItemProperty({layoutId,layoutItemId:layoutItem.id},"label",""!==value?value:void 0,!0).exec()}),[layoutId,layoutItem.id]),handleExpandableChange=jimu_core.q_G.useCallback((value=>{(0,jimu_for_builder.getAppConfigAction)().editLayoutItemProperty({layoutId,layoutItemId:layoutItem.id},"expandable",value,!0).exec()}),[layoutId,layoutItem.id]),updateLabel=jimu_core.q_G.useCallback((e=>{setLabel(e.target.value)}),[]);if(!layoutItem)return null;const gridItem=layoutItem;return!isInTab||gridItem.gridType!==jimu_core.Qwn.Row&&gridItem.gridType!==jimu_core.Qwn.Column?gridItem.gridType===jimu_core.Qwn.Plain?(0,jimu_core.Yac)("div",{className:"grid-item-setting h-100"},(0,jimu_core.Yac)(setting_components.SettingSection,{title:translate("gridItem")},(0,jimu_core.Yac)(setting_components.SettingRow,null,(0,jimu_core.Yac)(jimu_ui.Label,{centric:!0},(0,jimu_core.Yac)(jimu_ui.Checkbox,{"aria-label":translate("allowExpansion"),checked:null===(_b=layoutItem.expandable)||void 0===_b||_b,onChange:(e,checked)=>{handleExpandableChange(e.target.checked)}}),(0,jimu_core.Yac)("span",{className:"ml-2 text-truncate"},translate("allowExpansion"))))),(0,jimu_core.Yac)(CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,style:props.style,isSection:layoutItem.type===jimu_core.K6q.Section,onStyleChange:props.onStyleChange,formatMessage:props.formatMessage,setting:layoutItem.setting||(0,jimu_core.J3Z)({}),onSettingChange:props.onSettingChange})):(0,jimu_core.Yac)("div",{className:"grid-item-setting h-100"},(0,jimu_core.Yac)("div",{className:"h-100 align-items-center justify-content-center d-flex flex-column",css:jimu_core.AHW`color: var(--ref-palette-neutral-1000)`},(0,jimu_core.Yac)("div",null,(0,jimu_core.Yac)(info.J,{size:48})),(0,jimu_core.Yac)("div",{className:"mt-4"},translate("noConfigNeeded")))):(0,jimu_core.Yac)("div",{className:"grid-item-setting h-100"},(0,jimu_core.Yac)(setting_components.SettingSection,null,(0,jimu_core.Yac)(setting_components.SettingRow,{label:translate("label"),flow:"wrap"},(0,jimu_core.Yac)(jimu_ui.TextInput,{size:"sm",value:label,onChange:updateLabel,onAcceptValue:handleLabelChange,className:"w-100"}))))}try{griditemsetting.displayName="griditemsetting",griditemsetting.__docgenInfo={description:"",displayName:"griditemsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/grid-layout/builder/grid-item-setting.tsx#griditemsetting"]={docgenInfo:griditemsetting.__docgenInfo,name:"griditemsetting",path:"../jimu-layouts/lib/grid-layout/builder/grid-item-setting.tsx#griditemsetting"})}catch(__react_docgen_typescript_loader_error){}const accordion_item_setting_inputStyle=jimu_core.AHW`width: 100px;`,accordion_item_setting_heightModes=[layout_runtime.LayoutItemSizeModes.Auto,layout_runtime.LayoutItemSizeModes.Custom],accordion_item_setting_heightModesWithoutAuto=[layout_runtime.LayoutItemSizeModes.Auto,layout_runtime.LayoutItemSizeModes.Custom],accordion_item_setting_availableHeightUnits=[jimu_ui.DistanceUnits.PIXEL];class AccordionItemSetting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.updateHeight=value=>{const bbox=this.props.layoutItem.bbox;this.props.onPosChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},bbox.set("height",`${value.distance}px`))},this.toggleAspectRatio=(e,checked)=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({}),heightMode=checked?"ratio":"fixed";this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.set("heightMode",heightMode))},this.updateHeightMode=mode=>{const setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting.setIn(["autoProps","height"],mode))},this.updateAspectRatio=newRatio=>{let setting=this.props.layoutItem.setting||(0,jimu_core.J3Z)({});setting=setting.set("aspectRatio",newRatio),this.props.onSettingChange({layoutId:this.props.layoutId,layoutItemId:this.props.layoutItem.id},setting)},this.formatMessage=id=>this.props.formatMessage(id)}getStyle(){return jimu_core.AHW`
      .rotation-setting, .rotation-setting input {
        height: 26px;
      }

      .ratio-value {
        font-size: 12px;
      }

      .align-select {
        .dropdown-button, .dropdown-button:hover {
          height: 26px;
        }
      }
    `}render(){var _a,_b;const{layoutId,layoutItem,isLockLayout,supportAutoSize}=this.props;if(!layoutItem)return null;const setting=layoutItem.setting||{},bbox=layoutItem.bbox||{},heightMode=null!==(_b=null===(_a=setting.autoProps)||void 0===_a?void 0:_a.height)&&void 0!==_b?_b:layout_runtime.LayoutItemSizeModes.Custom,keepAspectRatio="ratio"===setting.heightMode;return(0,jimu_core.Yac)("div",{className:"accordion-item-setting",css:this.getStyle()},!isLockLayout&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group",title:this.formatMessage("size"),"aria-label":this.formatMessage("size")},(0,jimu_core.Yac)(setting_components.SettingRow,{role:"group",label:this.formatMessage("height"),"aria-label":this.formatMessage("height")},(0,jimu_core.Yac)("div",{css:accordion_item_setting_inputStyle},(0,jimu_core.Yac)(style_setting_components.rL,{label:"H",mode:heightMode||layout_runtime.LayoutItemSizeModes.Custom,sizeModes:supportAutoSize?accordion_item_setting_heightModes:accordion_item_setting_heightModesWithoutAuto,value:bbox.height,availableUnits:accordion_item_setting_availableHeightUnits,onChange:this.updateHeight,onModeChange:this.updateHeightMode,disabled:keepAspectRatio}))),(0,jimu_core.Yac)(setting_components.SettingRow,null,(0,jimu_core.Yac)(jimu_ui.Label,null,(0,jimu_core.Yac)(jimu_ui.Checkbox,{className:"mr-2",checked:keepAspectRatio,onChange:this.toggleAspectRatio}),(0,jimu_core.Yac)("span",{className:"checkbox-label"},this.formatMessage("keepAspectRatio")))),keepAspectRatio&&(0,jimu_core.Yac)(setting_components.SettingRow,{label:this.formatMessage("aspectRatio"),"aria-label":this.formatMessage("aspectRatio")},(0,jimu_core.Yac)(style_setting_components.Kr,{value:setting.aspectRatio||"1:1",style:{width:100},onChange:this.updateAspectRatio})))),(layoutItem.type===jimu_core.K6q.Widget||layoutItem.sectionId)&&(0,jimu_core.Yac)(CommonLayoutItemSetting,{layoutId,layoutItemId:layoutItem.id,isSection:layoutItem.type===jimu_core.K6q.Section,style:this.props.style,onStyleChange:this.props.onStyleChange,onSettingChange:this.props.onSettingChange,formatMessage:this.props.formatMessage}))}}try{accordionitemsetting.displayName="accordionitemsetting",accordionitemsetting.__docgenInfo={description:"",displayName:"accordionitemsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"LayoutItemJson"}},additionalInfo:{defaultValue:null,description:"",name:"additionalInfo",required:!1,type:{name:"any"}},style:{defaultValue:null,description:"",name:"style",required:!0,type:{name:"any"}},isLockLayout:{defaultValue:null,description:"",name:"isLockLayout",required:!0,type:{name:"boolean"}},supportAutoSize:{defaultValue:null,description:"",name:"supportAutoSize",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},onSettingChange:{defaultValue:null,description:"",name:"onSettingChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, setting: any) => void"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, style: any) => void"}},onPosChange:{defaultValue:null,description:"",name:"onPosChange",required:!0,type:{name:"(layoutInfo: LayoutInfo, bbox: BoundingBox) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/accordion-layout/builder/accordion-item-setting.tsx#accordionitemsetting"]={docgenInfo:accordionitemsetting.__docgenInfo,name:"accordionitemsetting",path:"../jimu-layouts/lib/accordion-layout/builder/accordion-item-setting.tsx#accordionitemsetting"})}catch(__react_docgen_typescript_loader_error){}const layout_setting_inputStyle={width:110};class FlowLayoutSetting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.updateSpace=value=>{const{layoutId}=this.props;if(!isNaN(value.distance)){(0,jimu_for_builder.getAppConfigAction)().editLayoutProperty(layoutId,"setting.gutter",value.distance).exec()}},this.updatePadding=value=>{const{layoutId}=this.props;(0,jimu_for_builder.getAppConfigAction)().editLayoutProperty(layoutId,"setting.style.padding",value).exec()}}render(){const{formatMessage}=this.props,setting=this.props.setting||{},style=setting.style||{},gutter=setting.gutter>=0?setting.gutter:flow_layout_default_setting.e.gutter;return(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group",className:"flow-layout-setting",title:formatMessage("layout"),"aria-label":formatMessage("layout")},(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("gap")},(0,jimu_core.Yac)(style_setting_components.vn,{style:layout_setting_inputStyle,"aria-label":formatMessage("gap"),min:0,value:{distance:gutter,unit:void 0},onChange:this.updateSpace})),(0,jimu_core.Yac)(setting_components.SettingRow,{flow:"wrap",role:"group",label:formatMessage("padding"),"aria-label":formatMessage("padding")},(0,jimu_core.Yac)(style_setting_components.Yq,{value:style.padding,onChange:this.updatePadding})))}}const layout_setting_mapStateToProps=(0,jimu_core.Mz0)(((state,ownProps)=>{var _a,_b,_c,_d;return null===(_d=null===(_c=null===(_b=null===(_a=state.appStateInBuilder)||void 0===_a?void 0:_a.appConfig)||void 0===_b?void 0:_b.layouts)||void 0===_c?void 0:_c[ownProps.layoutId])||void 0===_d?void 0:_d.setting}),(setting=>({setting}))),layout_setting=jimu_core.E_S.connect(layout_setting_mapStateToProps)(FlowLayoutSetting);try{layoutsetting.displayName="layoutsetting",layoutsetting.__docgenInfo={description:"",displayName:"layoutsetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/layout-setting.tsx#layoutsetting"]={docgenInfo:layoutsetting.__docgenInfo,name:"layoutsetting",path:"../jimu-layouts/lib/flow-layout/layout-setting.tsx#layoutsetting"})}catch(__react_docgen_typescript_loader_error){}var color_picker=__webpack_require__("../jimu-ui/basic/color-picker.tsx");function MainItemSetting(props){const{layoutId}=props,translate=jimu_core.JLE.useTranslation(),contentIds=jimu_core.E_S.useSelector((state=>{const layoutJson=state.appStateInBuilder.appConfig.layouts[layoutId],list=Object.keys((null==layoutJson?void 0:layoutJson.content)||{}).map((itemId=>{const layoutItem=layoutJson.content[itemId];return layoutItem.isPending?"":layoutItem.type===jimu_core.K6q.Widget&&layoutItem.widgetId?`widget:${layoutItem.widgetId}`:layoutItem.type===jimu_core.K6q.Section?`section:${layoutItem.sectionId}`:""})).filter((id=>""!==id));return list.sort(),list.join(",")})),mainItemId=jimu_core.E_S.useSelector((state=>{var _a,_b;const layoutJson=state.appStateInBuilder.appConfig.layouts[layoutId];return null!==(_b=null===(_a=null==layoutJson?void 0:layoutJson.setting)||void 0===_a?void 0:_a.mainItemId)&&void 0!==_b?_b:""})),allOptions=jimu_core.q_G.useMemo((()=>{if(contentIds.length>0){const appState=(0,jimu_core.Vp3)().getState().appStateInBuilder;return contentIds.split(",").map((item=>{const[type,id]=item.split(":");return"widget"===type?{value:id,label:appState.appConfig.widgets[id].label}:{value:id,label:appState.appConfig.sections[id].label}}))}return[]}),[contentIds]),handleValueChange=jimu_core.q_G.useCallback((e=>{var _a;const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();if(""===e.target.value){const layoutSetting=null!==(_a=appConfigAction.appConfig.layouts[layoutId].setting)&&void 0!==_a?_a:(0,jimu_core.J3Z)({});appConfigAction.editLayoutProperty(layoutId,"setting",layoutSetting.without("mainItemId")).exec()}else appConfigAction.editLayoutProperty(layoutId,"setting.mainItemId",e.target.value).exec()}),[layoutId]);return(0,jimu_core.Yac)(jimu_ui.Select,{css:jimu_core.AHW`.jimu-dropdown { width: 100%; }`,value:mainItemId,onChange:handleValueChange},(0,jimu_core.Yac)("option",{key:"none",value:""},translate("none")),allOptions.map((item=>(0,jimu_core.Yac)("option",{key:item.value,value:item.value},item.label))))}try{MainItemSetting.displayName="MainItemSetting",MainItemSetting.__docgenInfo={description:"",displayName:"MainItemSetting",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/grid-layout/main-item-setting.tsx#MainItemSetting"]={docgenInfo:MainItemSetting.__docgenInfo,name:"MainItemSetting",path:"../jimu-layouts/lib/grid-layout/main-item-setting.tsx#MainItemSetting"})}catch(__react_docgen_typescript_loader_error){}const layout_setting_availableUnits=[jimu_ui.DistanceUnits.PIXEL];class _Setting extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.handlePaddingChange=value=>{const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();this.getLayoutIds().forEach((layoutId=>{appConfigAction.editLayoutProperty(layoutId,"setting.style.padding",value)})),appConfigAction.exec()},this.handleSettingChange=(prop,value)=>{const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();this.getLayoutIds().forEach((layoutId=>{appConfigAction.editLayoutProperty(layoutId,`setting.${prop}`,value)})),appConfigAction.exec()},this.toggleExpandable=()=>{var _a;const{layoutId,allItemsExpandable}=this.props,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),layout=appConfigAction.appConfig.layouts[layoutId];Object.keys(null!==(_a=layout.content)&&void 0!==_a?_a:{}).forEach((itemId=>{layout.content[itemId].gridType===jimu_core.Qwn.Plain&&appConfigAction.editLayoutItemProperty({layoutId,layoutItemId:itemId},"expandable",!allItemsExpandable,!0)})),appConfigAction.exec()}}getLayoutIds(){const result=[],{layouts}=this.props;return null!=layouts&&Object.keys(layouts).forEach((sizemode=>{result.push(layouts[sizemode])})),result}render(){var _a,_b,_c,_d;const{layoutSetting,allItemsExpandable,allItemsNotExpandable,useCustomLayoutInSmallSizeMode,formatMessage,appTheme}=this.props;return(0,jimu_core.Yac)("div",{className:"flexbox-layout-setting"},(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group",title:formatMessage("layout"),"aria-label":formatMessage("layout")},(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("padding"),role:"group","aria-label":formatMessage("padding"),flow:"wrap"},(0,jimu_core.Yac)(style_setting_components.Yq,{value:null===(_a=layoutSetting.style)||void 0===_a?void 0:_a.padding,onChange:this.handlePaddingChange})),(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("paddingColor")},(0,jimu_core.Yac)(color_picker.tN,{"aria-label":formatMessage("paddingColor"),specificTheme:appTheme,value:layoutSetting.paddingColor,onChange:value=>{this.handleSettingChange("paddingColor",value)}})),(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("gap"),truncateLabel:!0},(0,jimu_core.Yac)(color_picker.tN,{"aria-label":formatMessage("gap"),specificTheme:appTheme,value:null!==(_b=layoutSetting.splitColor)&&void 0!==_b?_b:"var(--ref-palette-neutral-500)",onChange:value=>{this.handleSettingChange("splitColor",value)}}),(0,jimu_core.Yac)(style_setting_components.vn,{css:jimu_core.AHW`width: 74px !important;`,className:"ml-2",units:layout_setting_availableUnits,min:1,max:100,precision:0,value:{distance:null!==(_c=layoutSetting.splitSize)&&void 0!==_c?_c:8,unit:jimu_ui.DistanceUnits.PIXEL},onChange:value=>{this.handleSettingChange("splitSize",value.distance)}}))),(0,jimu_core.Yac)(setting_components.SettingSection,{role:"group",title:formatMessage("gridItems"),"aria-label":formatMessage("gridItems")},(0,jimu_core.Yac)(setting_components.SettingRow,null,(0,jimu_core.Yac)(jimu_ui.Label,{centric:!0},(0,jimu_core.Yac)(jimu_ui.Checkbox,{"aria-label":formatMessage("allowResize"),checked:null===(_d=layoutSetting.resizable)||void 0===_d||_d,onChange:(_,checked)=>{this.handleSettingChange("resizable",checked)}}),(0,jimu_core.Yac)("span",{className:"ml-2"},formatMessage("allowResize")))),(0,jimu_core.Yac)(setting_components.SettingRow,null,(0,jimu_core.Yac)("div",{className:"d-flex w-100 align-items-center"},(0,jimu_core.Yac)(jimu_ui.Label,{css:jimu_core.AHW`width: 80%;`,className:"justify-content-start"},(0,jimu_core.Yac)(jimu_ui.Checkbox,{"aria-label":formatMessage("allowExpansion"),checked:allItemsExpandable,indeterminate:!allItemsExpandable&&!allItemsNotExpandable,onClick:this.toggleExpandable}),(0,jimu_core.Yac)("span",{className:"ml-2 text-truncate"},formatMessage("allowExpansion"))),(0,jimu_core.Yac)(jimu_ui.Tooltip,{title:formatMessage("gridSettingOverrideTip"),placement:"bottom"},(0,jimu_core.Yac)(jimu_ui.Button,{className:"ml-auto",type:"tertiary",icon:!0},(0,jimu_core.Yac)(info.J,null))))),!useCustomLayoutInSmallSizeMode&&(0,jimu_core.Yac)(setting_components.SettingRow,{label:formatMessage("setMainGridItem"),flow:"wrap"},(0,jimu_core.Yac)(MainItemSetting,{layoutId:this.props.layoutId}))))}}const mapStateToSettingProps=(0,jimu_core.Mz0)(((state,ownProps)=>{const appState=state.appStateInBuilder;return appState?ownProps.layouts[appState.browserSizeMode]||ownProps.layouts[appState.appConfig.mainSizeMode]:null}),((state,ownProps)=>{var _a,_b;const appState=state.appStateInBuilder;if(!appState)return{};const layoutId=ownProps.layouts[appState.browserSizeMode]||ownProps.layouts[appState.appConfig.mainSizeMode],{layouts}=appState.appConfig;return null!==(_b=null===(_a=layouts[layoutId])||void 0===_a?void 0:_a.setting)&&void 0!==_b?_b:{}}),((state,ownProps)=>{var _a;const appState=state.appStateInBuilder;if(!appState)return!1;const layoutId=ownProps.layouts[appState.browserSizeMode]||ownProps.layouts[appState.appConfig.mainSizeMode],{layouts}=appState.appConfig,layout=layouts[layoutId],idList=Object.keys(null!==(_a=layout.content)&&void 0!==_a?_a:{});return!(idList.length>0)||idList.every((itemId=>{var _a;const layoutItem=layout.content[itemId];return layoutItem.gridType!==jimu_core.Qwn.Plain||(null===(_a=layoutItem.expandable)||void 0===_a||_a)}))}),((state,ownProps)=>{var _a;const appState=state.appStateInBuilder;if(!appState)return!1;const layoutId=ownProps.layouts[appState.browserSizeMode]||ownProps.layouts[appState.appConfig.mainSizeMode],{layouts}=appState.appConfig,layout=layouts[layoutId],idList=Object.keys(null!==(_a=layout.content)&&void 0!==_a?_a:{});return!(idList.length>0)||idList.every((itemId=>{const layoutItem=layout.content[itemId];return layoutItem.gridType!==jimu_core.Qwn.Plain||null!=layoutItem.expandable&&!layoutItem.expandable}))}),((state,ownProps)=>{const appState=state.appStateInBuilder;if(!appState)return{};const layoutId=ownProps.layouts[appState.browserSizeMode]||ownProps.layouts[appState.appConfig.mainSizeMode],rootContainerInfo=layout_runtime.searchUtils.getRootContainerInfoOfLayout(appState.appConfig,layoutId,appState.browserSizeMode);switch(null==rootContainerInfo?void 0:rootContainerInfo.type){case jimu_core.Kk5.Page:return null!=appState.appConfig.pages[rootContainerInfo.id].layout[jimu_core.rHp.Small];case jimu_core.Kk5.Dialog:return null!=appState.appConfig.dialogs[rootContainerInfo.id].layout[jimu_core.rHp.Small];case jimu_core.Kk5.Header:return null!=appState.appConfig.header.layout[jimu_core.rHp.Small];case jimu_core.Kk5.Footer:return null!=appState.appConfig.footer.layout[jimu_core.rHp.Small];default:return!1}}),((layoutId,layoutSetting,allItemsExpandable,allItemsNotExpandable,useCustomLayoutInSmallSizeMode)=>({layoutId,layoutSetting,allItemsExpandable,allItemsNotExpandable,useCustomLayoutInSmallSizeMode}))),grid_layout_layout_setting=jimu_core.E_S.connect(mapStateToSettingProps)(_Setting);try{layoutsetting.displayName="layoutsetting",layoutsetting.__docgenInfo={description:"",displayName:"layoutsetting",props:{layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"ImmutableObjectMixin<SizeModeLayoutJson> & { readonly [x: string]: string; }"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},appTheme:{defaultValue:null,description:"",name:"appTheme",required:!0,type:{name:"ImmutableObjectMixin<ThemeVariable> & { readonly uri?: string; readonly darkTheme?: boolean; readonly coloration?: ThemeColorationType; ... 19 more ...; readonly comp?: ImmutableObject<...>; }"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/grid-layout/layout-setting.tsx#layoutsetting"]={docgenInfo:layoutsetting.__docgenInfo,name:"layoutsetting",path:"../jimu-layouts/lib/grid-layout/layout-setting.tsx#layoutsetting"})}catch(__react_docgen_typescript_loader_error){}var layout_transform=__webpack_require__("../jimu-layouts/lib/flow-layout/layout-transform.ts"),row_layout_layout_transform=__webpack_require__("../jimu-layouts/lib/row-layout/layout-transform.ts"),grid_layout_layout_transform=__webpack_require__("../jimu-layouts/lib/grid-layout/layout-transform.ts");var flow_context_menu_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};function FlowContextMenu(props){const{isFirst,isLast,menuItems}=props,otherProps=flow_context_menu_rest(props,["isFirst","isLast","menuItems"]),[menus,setMenus]=jimu_core.q_G.useState(menuItems),lockLayout=jimu_core.E_S.useSelector((state=>{var _a,_b,_c;return null!==(_c=null===(_b=null===(_a=state.appConfig)||void 0===_a?void 0:_a.forBuilderAttributes)||void 0===_b?void 0:_b.lockLayout)&&void 0!==_c&&_c}));return jimu_core.q_G.useEffect((()=>{const filterMenu=menuItems.filter((item=>{var _a;return"function"==typeof item.visible?item.visible({layoutId:props.layoutId,layoutItem:props.layoutItem,clientRect:null}):null===(_a=item.visible)||void 0===_a||_a}));setMenus(filterMenu)}),[isFirst,isLast,menuItems,props.layoutId,props.layoutItem,lockLayout]),jimu_core.q_G.createElement(context_menu,Object.assign({menuItems:menus},otherProps))}try{FlowContextMenu.displayName="FlowContextMenu",FlowContextMenu.__docgenInfo={description:"",displayName:"FlowContextMenu",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"IMThemeVariables"}},positionType:{defaultValue:null,description:"",name:"positionType",required:!0,type:{name:"enum",value:[{value:'"center"'},{value:'"left"'},{value:'"right"'}]}},size:{defaultValue:null,description:"",name:"size",required:!0,type:{name:"number"}},iconSize:{defaultValue:null,description:"",name:"iconSize",required:!0,type:{name:"number"}},className:{defaultValue:null,description:"",name:"className",required:!0,type:{name:"string"}},menuItems:{defaultValue:null,description:"",name:"menuItems",required:!0,type:{name:"ToolbarConfig"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}},onMouseEnter:{defaultValue:null,description:"",name:"onMouseEnter",required:!1,type:{name:"() => void"}},onMouseLeave:{defaultValue:null,description:"",name:"onMouseLeave",required:!1,type:{name:"() => void"}},isFirst:{defaultValue:null,description:"",name:"isFirst",required:!0,type:{name:"boolean"}},isLast:{defaultValue:null,description:"",name:"isLast",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/flow-context-menu.tsx#FlowContextMenu"]={docgenInfo:FlowContextMenu.__docgenInfo,name:"FlowContextMenu",path:"../jimu-layouts/lib/flow-layout/builder/flow-context-menu.tsx#FlowContextMenu"})}catch(__react_docgen_typescript_loader_error){}var builder_utils_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};function addTemplateRow(layoutId,layoutItemId,layoutTemplate){return builder_utils_awaiter(this,void 0,void 0,(function*(){const context={},result=yield jimu_for_builder.widgetService.createFromTemplate((0,jimu_for_builder.getAppConfigAction)().appConfig,layoutTemplate,null,[layout_runtime.utils.getCurrentSizeMode()],context,{isBlock:!0});let appConfig=result[0];const newWidgetId=result[1];appConfig=jimu_for_builder.widgetService.afterBatchCopied(appConfig,(0,jimu_core.J3Z)(layoutTemplate.config),context);const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),layoutInfo=appConfigAction.addTemplateContentToLayout(layoutId,jimu_core.K6q.Widget,newWidgetId),insertIndex=(appConfigAction.appConfig.layouts[layoutId].order||[]).indexOf(layoutItemId);return appConfigAction.adjustOrderOfItem(layoutInfo,insertIndex>=0?insertIndex+1:NaN),layout_runtime.utils.changeLayout(appConfigAction.appConfig,Object.assign(Object.assign({},layoutInfo),{autoScroll:!0})),layoutInfo}))}function addTemplateScreenGroup(layoutId,layoutItemId,screenGroupTemplate){return builder_utils_awaiter(this,void 0,void 0,(function*(){const context={},result=yield jimu_for_builder.screenGroupService.createFromTemplate((0,jimu_for_builder.getAppConfigAction)().appConfig,screenGroupTemplate,null,[layout_runtime.utils.getCurrentSizeMode()],context);let appConfig=result[0];const newScreenGroupId=result[1];appConfig=jimu_for_builder.widgetService.afterBatchCopied(appConfig,(0,jimu_core.J3Z)(screenGroupTemplate.config),context);const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),layoutInfo=appConfigAction.addTemplateContentToLayout(layoutId,jimu_core.K6q.ScreenGroup,newScreenGroupId),insertIndex=(appConfigAction.appConfig.layouts[layoutId].order||[]).indexOf(layoutItemId);return appConfigAction.adjustOrderOfItem(layoutInfo,insertIndex>=0?insertIndex+1:NaN),layout_runtime.utils.changeLayout(appConfigAction.appConfig,Object.assign(Object.assign({},layoutInfo),{autoScroll:!0})),layoutInfo}))}function moveDown(appConfig,layoutInfo){var _a;const{layoutId,layoutItemId}=layoutInfo,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),layout=appConfigAction.appConfig.layouts[layoutId],order=layout.order,result=[].concat(order),index=order.indexOf(layoutItemId);let target=order.length-1;for(let i=index+1;i<order.length;i++){const id=order[i];if(!(null===(_a=layout.content[id].setting)||void 0===_a?void 0:_a.isFloating)){target=i;break}}return result.splice(target+1,0,layoutItemId),result.splice(index,1),appConfigAction.editLayoutProperty(layoutId,"order",result),appConfigAction.appConfig}function moveUp(appConfig,layoutInfo){var _a;const{layoutId,layoutItemId}=layoutInfo,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),layout=appConfigAction.appConfig.layouts[layoutId],order=layout.order,result=[].concat(order),index=order.indexOf(layoutItemId);let target=0;for(let i=index-1;i>=0;i--){const id=order[i];if(!(null===(_a=layout.content[id].setting)||void 0===_a?void 0:_a.isFloating)){target=i;break}}return result.splice(index,1),result.splice(target,0,layoutItemId),appConfigAction.editLayoutProperty(layoutId,"order",result),appConfigAction.appConfig}var block=__webpack_require__("../jimu-icons/svg/outlined/brand/block.svg"),block_default=__webpack_require__.n(block),screen_group=__webpack_require__("../jimu-icons/svg/outlined/brand/screen-group.svg"),screen_group_default=__webpack_require__.n(screen_group),flow_layout_common_util=__webpack_require__("../jimu-layouts/lib/flow-layout/common/util.ts");class FlowLayoutItem extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.state={isResizing:!1,dh:0,showBlockTemplatePopup:!1,showScreenTemplatePopup:!1,referenceElem:null},this.onResizeStart=(id,initWidth,initHeight)=>{const{padding}=this.props;this.minHeight=types.o7+padding,this.initHeight=initHeight,this.setState({dh:0,isResizing:!0})},this.onResizing=(id,x,y,dw,dh)=>{let delta=dh;dh<0&&this.initHeight+dh<this.minHeight&&(delta=this.minHeight-this.initHeight),this.setState({dh:delta,isResizing:!0})},this.onResizeEnd=(id,x,y,dw,dh,shiftKey)=>{const{layoutId,layoutItem}=this.props;let delta=dh;dh<0&&this.initHeight+dh<this.minHeight&&(delta=this.minHeight-this.initHeight);const bbox=(0,jimu_core.J3Z)(layoutItem.bbox||{}).set("height",Math.round(this.initHeight+delta));(0,jimu_for_builder.getAppConfigAction)().editLayoutItemProperty({layoutId,layoutItemId:layoutItem.id},"bbox",bbox).exec(),this.setState({isResizing:!1,dh:0})},this.toggleBlockTemplatePopup=()=>{(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small?this.setState({showBlockTemplatePopup:!this.state.showBlockTemplatePopup}):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"templateBlock",templateMethod:"getBlockTemplates",onSelect:this.onTemplateBlockSelected})},this.toggleScreenTemplatePopup=()=>{(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small?this.setState({showScreenTemplatePopup:!this.state.showScreenTemplatePopup}):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"template",templateMethod:"getScreenGroupTemplates",onSelect:this.onTemplateScreenGroupSelected})},this.removeLayoutItem=()=>{const{layoutId,layoutItemId}=this.props;(0,jimu_for_builder.getAppConfigAction)().removeLayoutItem({layoutId,layoutItemId},!0).exec()},this.moveLayoutItemUp=()=>{const{layoutId,layoutItemId}=this.props,appConfig=moveUp((0,jimu_for_builder.getAppConfigAction)().appConfig,{layoutId,layoutItemId});(0,jimu_for_builder.getAppConfigAction)(appConfig).exec()},this.moveLayoutItemDown=()=>{const{layoutId,layoutItemId}=this.props,appConfig=moveDown((0,jimu_for_builder.getAppConfigAction)().appConfig,{layoutId,layoutItemId});(0,jimu_for_builder.getAppConfigAction)(appConfig).exec()},this.switchSetting=()=>{const{layoutId,layoutItemId,selected}=this.props;selected||(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged({layoutId,layoutItemId}))},this.onTemplateBlockSelected=template=>{addTemplateRow(this.props.layoutId,this.props.layoutItemId,template),this.setState({showBlockTemplatePopup:!1})},this.onTemplateScreenGroupSelected=template=>{addTemplateScreenGroup(this.props.layoutId,this.props.layoutItemId,template),this.setState({showScreenTemplatePopup:!1})},this.fakeTopLayouts=(0,jimu_core.J3Z)({[jimu_core.rHp.Large]:`${this.props.layoutId}_${this.props.layoutItemId}_tlarge`,[jimu_core.rHp.Medium]:`${this.props.layoutId}_${this.props.layoutItemId}_tmedium`,[jimu_core.rHp.Small]:`${this.props.layoutId}_${this.props.layoutItemId}_tsmall`}),this.fakeBottomLayouts=(0,jimu_core.J3Z)({[jimu_core.rHp.Large]:`${this.props.layoutId}_${this.props.layoutItemId}_blarge`,[jimu_core.rHp.Medium]:`${this.props.layoutId}_${this.props.layoutItemId}_bmedium`,[jimu_core.rHp.Small]:`${this.props.layoutId}_${this.props.layoutItemId}_bsmall`}),this.minHeight=0,this.contextMenus=[{icon:block_default(),title:this.props.formatMessage("insertABlock"),onClick:this.toggleBlockTemplatePopup,visible:()=>!isLockLayout()},{icon:screen_group_default(),title:this.props.formatMessage("insertAScreenGroup"),onClick:this.toggleScreenTemplatePopup,visible:()=>!isLockLayout()&&(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small},duplicateMenuItem,{icon:setting_default(),title:this.props.formatMessage("setting"),onClick:this.switchSetting},{icon:move_default(),title:this.props.formatMessage("dragToMove",{label:getLabelOfLayoutItem(this.props.layoutItem)}),className:"tool-drag-handler",onClick:()=>null,visible:()=>!isLockLayout()},{icon:up_default(),onClick:this.moveLayoutItemUp,title:this.props.formatMessage("moveup"),visible:()=>!this.props.isFirst&&!isLockLayout()},{icon:up_default(),rotate:180,onClick:this.moveLayoutItemDown,title:this.props.formatMessage("movedown"),visible:()=>!this.props.isLast&&!isLockLayout()},{icon:trash_default(),title:this.props.formatMessage("delete"),onClick:this.removeLayoutItem,visible:()=>!isLockLayout()}]}calHeight(itemSetting){if(this.state.isResizing)return`${this.initHeight+this.state.dh}px`;const height=flow_layout_common_util.W(this.props.layoutItem,itemSetting);return this.autoHeight="auto"===height,height}createContextMenu(){const{builderTheme}=this.pageContext,{layoutId,layoutItem,isFirst,isLast}=this.props;return(0,jimu_core.Yac)(FlowContextMenu,{layoutId,layoutItem,builderTheme,positionType:"center",size:types.mE,iconSize:types.cm,className:"widget-context-menu",menuItems:this.contextMenus,isFirst,isLast},(0,jimu_core.Yac)("div",{ref:ref=>{this.reference=ref},css:jimu_core.AHW`position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;`}),this.state.showBlockTemplatePopup&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getBlockTemplates)(),referenceElement:this.reference,onItemSelect:this.onTemplateBlockSelected,onClose:this.toggleBlockTemplatePopup}),this.state.showScreenTemplatePopup&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getScreenGroupTemplates)(),referenceElement:this.reference,onItemSelect:this.onTemplateScreenGroupSelected,onClose:this.toggleScreenTemplatePopup}))}getStyle(itemSetting){const{builderTheme}=this.pageContext,{index,gutter}=this.props,sign=layout_runtime.utils.isRTL()?-1:1;return[jimu_core.AHW`
        margin-top: ${index>0?`${gutter}px`:"unset"};
        width: ${(0,layout_utils.p5)(itemSetting)};
        height: ${this.calHeight(itemSetting)};
        flex-shrink: 0;
        position: relative;
        cursor: default;
        & > div.widget-context-menu {
          display: none;
        }

        &:hover > div.widget-context-menu {
          display: flex;
        }

        .template-popup {
          background-color: ${builderTheme.ref.palette.black};
        }

        .tool-drag-handler {
          cursor: move;
        }
      `,itemSetting.offsetX||itemSetting.offsetY?`translate(${(itemSetting.offsetX||0)*sign}px, ${itemSetting.offsetY||0}px)`:null]}render(){const{layoutId,layoutItem,draggable,selectable,isEmpty,selected}=this.props;if(!layoutItem||isEmpty)return null;const itemSetting=jimu_core.CM0.assign({},flow_layout_default_setting.E,layoutItem.setting),mergedClass=(0,jimu_core.xWm)("flow-layout-item d-flex",{selected}),oneByOneAnimationProps=layout_runtime.utils.handleOnebyOneAnimation(this.props);return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(pageContext=>{this.pageContext=pageContext;const[cssStyle,transform]=this.getStyle(itemSetting);return(0,jimu_core.Yac)(LayoutItemInBuilder,Object.assign({id:`${layoutId}_block_${layoutItem.id}`,css:cssStyle,style:{transform},layoutId,layoutItemId:layoutItem.id,onResizeStart:this.onResizeStart,onResizing:this.onResizing,onResizeEnd:this.onResizeEnd,left:!1,right:!1,top:!1,bottom:"fixed"===itemSetting.heightMode,restrict:!0,useDragHandler:!0,draggable,selectable,forbidContextMenu:!0,forbidToolbar:!0,isBlock:!0,className:mergedClass,autoHeight:this.autoHeight},oneByOneAnimationProps),!pageContext.viewOnly&&this.createContextMenu())}))}}const builder_layout_item=jimu_core.E_S.connect(layout_utils.aT)(FlowLayoutItem);try{layoutitem.displayName="layoutitem",layoutitem.__docgenInfo={description:"",displayName:"layoutitem",props:{index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"ImmutableObjectMixin<SizeModeLayoutJson> & { readonly [x: string]: string; }"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"ImmutableObjectMixin<LayoutItemJson> & { readonly id?: string; readonly bbox?: ImmutableObject<BoundingBox>; ... 8 more ...; readonly children?: ImmutableArray<...>; }"}},gutter:{defaultValue:null,description:"",name:"gutter",required:!0,type:{name:"number"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string, values?: any) => string"}},isLast:{defaultValue:null,description:"",name:"isLast",required:!0,type:{name:"boolean"}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"ImmutableObjectMixin<ThemeVariable> & { readonly uri?: string; readonly darkTheme?: boolean; readonly coloration?: ThemeColorationType; ... 19 more ...; readonly comp?: ImmutableObject<...>; }"}},onDropAtBoundary:{defaultValue:null,description:"",name:"onDropAtBoundary",required:!0,type:{name:"(draggingItem: LayoutItemConstructorProps, itemRect: DOMRect, insertIndex: number) => void"}},isFirst:{defaultValue:null,description:"",name:"isFirst",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/layout-item.tsx#layoutitem"]={docgenInfo:layoutitem.__docgenInfo,name:"layoutitem",path:"../jimu-layouts/lib/flow-layout/builder/layout-item.tsx#layoutitem"})}catch(__react_docgen_typescript_loader_error){}class FloatingLayoutItem extends jimu_core.q_G.PureComponent{constructor(){super(...arguments),this.state={isResizing:!1,dx:0,dy:0,dw:0,dh:0},this.onResizeStart=(id,initWidth,initHeight)=>{this.setState({isResizing:!0}),this.initHeight=initHeight,this.initWidth=initWidth},this.onResizing=(id,x,y,dw,dh)=>{this.setState({dx:x,dy:y,dw,dh})},this.onResizeEnd=(id,x,y,dw,dh,shiftKey)=>{const{layoutId,layoutItem}=this.props;let bbox=layoutItem.bbox;bbox=bbox.set("height",Math.round(parseInt(bbox.height,10)+dh)).set("width",Math.round(parseInt(bbox.width,10)+dw)).set("left",Math.round(parseInt(bbox.left,10)+x)).set("top",Math.round(parseInt(bbox.top,10)+y)).set("bottom",Math.round(parseInt(bbox.top,10)-dh+y));(0,jimu_for_builder.getAppConfigAction)().editLayoutItemProperty({layoutId,layoutItemId:layoutItem.id},"bbox",bbox).exec(),this.setState({isResizing:!1,dx:0,dy:0,dw:0,dh:0})}}calculatePosition(){const{layoutItem}=this.props,{dh,dw,isResizing}=this.state;return(0,layout_utils.ES)(layoutItem,{dh,dw,isResizing,initWidth:this.initWidth,initHeight:this.initHeight})}render(){const{layoutId,layoutItem,selectable,selected}=this.props;if(!layoutItem)return null;const mergedClass=(0,jimu_core.xWm)("flexbox-layout-item floating d-flex",{selected});return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(pageContext=>(this.pageContext=pageContext,(0,jimu_core.Yac)(LayoutItemInBuilder,{css:this.calculatePosition(),layoutId,layoutItemId:layoutItem.id,onResizeStart:this.onResizeStart,onResizing:this.onResizing,onResizeEnd:this.onResizeEnd,restrict:!0,draggable:!1,selectable,className:mergedClass}))))}}const floating_layout_item=jimu_core.E_S.connect(layout_runtime.utils.mapStateToLayoutItemProps)(FloatingLayoutItem);try{floatinglayoutitem.displayName="floatinglayoutitem",floatinglayoutitem.__docgenInfo={description:"",displayName:"floatinglayoutitem",props:{index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"ImmutableObjectMixin<SizeModeLayoutJson> & { readonly [x: string]: string; }"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},gutter:{defaultValue:null,description:"",name:"gutter",required:!0,type:{name:"number"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"ImmutableObjectMixin<ThemeVariable> & { readonly uri?: string; readonly darkTheme?: boolean; readonly coloration?: ThemeColorationType; ... 19 more ...; readonly comp?: ImmutableObject<...>; }"}},total:{defaultValue:null,description:"",name:"total",required:!0,type:{name:"number"}},onDropAtBoundary:{defaultValue:null,description:"",name:"onDropAtBoundary",required:!0,type:{name:"(draggingItem: LayoutItemConstructorProps, itemRect: DOMRect, insertIndex: number) => void"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/floating-layout-item.tsx#floatinglayoutitem"]={docgenInfo:floatinglayoutitem.__docgenInfo,name:"floatinglayoutitem",path:"../jimu-layouts/lib/flow-layout/builder/floating-layout-item.tsx#floatinglayoutitem"})}catch(__react_docgen_typescript_loader_error){}function ScreenGroupMenu(props){const{formatMessage,activeScreenIndex,total,layoutId,layoutItemId,screenGroupId,browserSizeMode,hasPanel}=props,readonly=!jimu_core.E_S.useSelector((state=>{var _a,_b,_c;const lockLayout=null!==(_b=null===(_a=state.appConfig.forBuilderAttributes)||void 0===_a?void 0:_a.lockLayout)&&void 0!==_b&&_b;return(null===(_c=state.appRuntimeInfo)||void 0===_c?void 0:_c.appMode)===jimu_core.$0N.Design&&!lockLayout}))||browserSizeMode!==jimu_core.rHp.Large,[showPopper,setShowPopper]=jimu_core.q_G.useState(!1),popperRef=jimu_core.q_G.useRef(),closeScreenPopper=jimu_core.q_G.useCallback((()=>{setShowPopper(!1)}),[]),tooltipStyle=jimu_core.q_G.useCallback((()=>{const theme=(0,jimu_theme.wE)();return jimu_core.AHW`
      border: none;

      .tooltip {
        color: ${theme.ref.palette.black};
        background-color: ${theme.ref.palette.neutral[600]};
        border-color: ${theme.ref.palette.neutral[400]};
      }
    `}),[]),addScreen=jimu_core.q_G.useCallback((templateJson=>{const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),screenGroupId=appConfigAction.appConfig.layouts[layoutId].content[layoutItemId].screenGroupId;appConfigAction.createScreenFromTemplate(null,templateJson).then((newScreenId=>{let appConfig=appConfigAction.appConfig;appConfig=appConfig.setIn(["screenGroups",screenGroupId,"screens"],[].concat(appConfig.screenGroups[screenGroupId].screens,newScreenId)).setIn(["screens",newScreenId,"parent"],screenGroupId),jimu_core.WpD.changeAppConfig(appConfig),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(screenGroupId,appConfig.screenGroups[screenGroupId].screens.length-1))})),closeScreenPopper()}),[closeScreenPopper,layoutId,layoutItemId]),toggleScreenPopper=jimu_core.q_G.useCallback((()=>{if(hasPanel)setShowPopper(!showPopper);else{const templateJson=(0,jimu_for_builder_templates.getScreenTemplates)().find((item=>"nopanel"===item.name));templateJson&&addScreen(templateJson)}}),[showPopper,hasPanel,addScreen]),moveup=jimu_core.q_G.useCallback((()=>{(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(screenGroupId,activeScreenIndex-1))}),[screenGroupId,activeScreenIndex]),movedown=jimu_core.q_G.useCallback((()=>{(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(screenGroupId,activeScreenIndex+1))}),[screenGroupId,activeScreenIndex]),removeScreen=jimu_core.q_G.useCallback((()=>{(0,jimu_for_builder.getAppConfigAction)().removeScreenByIndex(activeScreenIndex,screenGroupId).exec(),activeScreenIndex===total-1&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(screenGroupId,activeScreenIndex-1))}),[activeScreenIndex,total,screenGroupId]),duplicateScreen=jimu_core.q_G.useCallback((()=>{const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();appConfigAction.duplicateScreenByIndex(activeScreenIndex,screenGroupId),appConfigAction.exec(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(screenGroupId,activeScreenIndex+1))}),[activeScreenIndex,screenGroupId]);return(0,jimu_core.Yac)("div",{className:"menu-bar d-flex justify-content-between align-items-center"},(0,jimu_core.Yac)("div",{className:"d-flex justify-content-start align-items-center"},(0,jimu_core.Yac)("div",{className:"info ml-2"},formatMessage("screen"),": ",activeScreenIndex+1," / ",total),(0,jimu_core.Yac)(theme_tooltip.v,{title:0===activeScreenIndex?"":formatMessage("previous"),placement:"bottom",css:tooltipStyle()},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,className:"rounded-circle",disabled:0===activeScreenIndex,type:"tertiary",onClick:moveup},(0,jimu_core.Yac)(jimu_ui.Icon,{icon:up_default(),size:16}))),(0,jimu_core.Yac)(theme_tooltip.v,{title:activeScreenIndex===total-1?"":formatMessage("next"),placement:"bottom",css:tooltipStyle()},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,className:"rounded-circle",disabled:activeScreenIndex===total-1,type:"tertiary",onClick:movedown},(0,jimu_core.Yac)(jimu_ui.Icon,{icon:up_default(),rotate:180,size:16}))),!readonly&&(0,jimu_core.Yac)("div",{ref:popperRef},(0,jimu_core.Yac)(theme_tooltip.v,{title:formatMessage("newScreen"),placement:"bottom",css:tooltipStyle()},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,onClick:toggleScreenPopper,className:"rounded-circle",type:"tertiary","data-testid":"addBtn"},(0,jimu_core.Yac)(jimu_ui.Icon,{icon:plus_default(),size:16})))),!readonly&&showPopper&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getScreenTemplates)(),referenceElement:popperRef.current,onItemSelect:addScreen,onClose:closeScreenPopper}),!readonly&&(0,jimu_core.Yac)(theme_tooltip.v,{title:formatMessage("duplicateScreen"),placement:"bottom",css:tooltipStyle()},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,className:"rounded-circle",type:"tertiary",onClick:duplicateScreen,"data-testid":"duplicateBtn"},(0,jimu_core.Yac)(jimu_ui.Icon,{icon:duplicate_page_default(),size:16}))),!readonly&&total>1&&(0,jimu_core.Yac)(theme_tooltip.v,{title:formatMessage("deleteScreen"),placement:"bottom",css:tooltipStyle()},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,className:"rounded-circle",type:"tertiary",onClick:removeScreen,"data-testid":"removeBtn"},(0,jimu_core.Yac)(jimu_ui.Icon,{icon:trash_default(),size:16})))))}try{ScreenGroupMenu.displayName="ScreenGroupMenu",ScreenGroupMenu.__docgenInfo={description:"",displayName:"ScreenGroupMenu",props:{itemIndex:{defaultValue:null,description:"",name:"itemIndex",required:!0,type:{name:"number"}},activeScreenIndex:{defaultValue:null,description:"",name:"activeScreenIndex",required:!0,type:{name:"number"}},total:{defaultValue:null,description:"",name:"total",required:!0,type:{name:"number"}},screenGroupId:{defaultValue:null,description:"",name:"screenGroupId",required:!0,type:{name:"string"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},hasPanel:{defaultValue:null,description:"",name:"hasPanel",required:!0,type:{name:"boolean"}},browserSizeMode:{defaultValue:null,description:"",name:"browserSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/screen-menu.tsx#ScreenGroupMenu"]={docgenInfo:ScreenGroupMenu.__docgenInfo,name:"ScreenGroupMenu",path:"../jimu-layouts/lib/flow-layout/builder/screen-menu.tsx#ScreenGroupMenu"})}catch(__react_docgen_typescript_loader_error){}var common=__webpack_require__("../jimu-layouts/lib/flow-layout/common/index.tsx"),screen_side_panel=__webpack_require__("../jimu-layouts/lib/flow-layout/common/screen-side-panel.tsx"),use_intersection=__webpack_require__("../jimu-layouts/lib/flow-layout/use-intersection.tsx");const screen_side_action_block_ThemeWidgetListPopper=(0,jimu_theme.ZS)(setting_components.WidgetListPopper),screen_side_action_block_buttonStyle=jimu_core.AHW`
  width: 36px;
  height: 36px;
  padding: 0.5rem;
`,screen_side_action_block_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  bottom: 0;
  top: 0;
  right: 0;
  background: transparent;
`;function screen_side_action_block_getStyle(builderTheme){return jimu_core.AHW`
    display: flex;
    height: 200px;
    position: relative;
    z-index: 1;
    border: 1px dashed ${jimu_core.PLL.rgba(builderTheme.ref.palette.neutral[1e3],.6)};

    body.lock-layout &,
    body:not(.design-mode) & {
      display: none !important;
    }

    .action-item {
      z-index: 1;
    }
  `}function Placeholder(props){const{layouts,builderTheme}=props,layoutId=jimu_core.E_S.useSelector((state=>layouts[state.browserSizeMode]||layouts[state.appConfig.mainSizeMode])),[showPopper,setShowPopper]=jimu_core.q_G.useState(!1),templateRef=jimu_core.q_G.useRef(null),addWidget=jimu_core.q_G.useCallback((item=>{common_layout_actions_addItemToLayout((0,jimu_for_builder.getAppConfigAction)().appConfig,item,layoutId).then((({layoutInfo,updatedAppConfig})=>{const outAppConfig=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.ColumnLayout).processAfterItemAdded(updatedAppConfig,item,layoutInfo,{currentSizeMode:null,containerRect:{width:100,height:100},itemRect:{left:0,top:0},insertIndex:null});layout_runtime.utils.changeLayout(outAppConfig,layoutInfo)})),setShowPopper(!1)}),[layoutId]),onDrop=jimu_core.q_G.useCallback(((draggingItem,containerRect,itemRect)=>{common_layout_actions_addItemToLayout((0,jimu_for_builder.getAppConfigAction)().appConfig,draggingItem,layoutId).then((({layoutInfo,updatedAppConfig})=>{const outAppConfig=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.ColumnLayout).processAfterItemAdded(updatedAppConfig,draggingItem,layoutInfo,{currentSizeMode:null,containerRect,itemRect,insertIndex:null});layout_runtime.utils.changeLayout(outAppConfig,layoutInfo)}))}),[layoutId]),isItemAccepted=jimu_core.q_G.useCallback((item=>!item.layoutInfo||item.layoutInfo.layoutId!==layoutId),[layoutId]);return(0,jimu_core.Yac)(layout_runtime.LayoutContext.Provider,{value:{isItemAccepted}},(0,jimu_core.Yac)("div",{className:"placeholder-btn w-100 justify-content-center align-items-center",css:screen_side_action_block_getStyle(builderTheme)},(0,jimu_core.Yac)(droparea_hook_DropArea,{css:screen_side_action_block_dropareaStyle,layouts,onDrop}),(0,jimu_core.Yac)("div",{className:"action-item",ref:templateRef},(0,jimu_core.Yac)(jimu_ui.Button,{icon:!0,css:screen_side_action_block_buttonStyle,onClick:e=>{e.stopPropagation(),(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small?setShowPopper(!showPopper):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"widget",isPlaceholder:!0,isItemAccepted,onSelect:addWidget})}},(0,jimu_core.Yac)(editor_plus.b,{size:"m"}))),showPopper&&(0,jimu_core.Yac)(screen_side_action_block_ThemeWidgetListPopper,{referenceElement:templateRef.current,isAccepted:isItemAccepted,onSelect:addWidget,onClose:()=>{setShowPopper(!1)}})))}try{Placeholder.displayName="Placeholder",Placeholder.__docgenInfo={description:"",displayName:"Placeholder",props:{layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"SizeModeLayoutJson"}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"IMThemeVariables"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/screen-side-action-block.tsx#Placeholder"]={docgenInfo:Placeholder.__docgenInfo,name:"Placeholder",path:"../jimu-layouts/lib/flow-layout/builder/screen-side-action-block.tsx#Placeholder"})}catch(__react_docgen_typescript_loader_error){}var invisible=__webpack_require__("../jimu-icons/outlined/application/invisible.tsx");const animated=jimu_core.ozl.animated;function screen_side_panel_getStyle(options){const{props,viewHeight,headerHeight,isActive,verticalSpace,stretched,transitionType,screenTransitionType,isSmallSize,builderTheme,isResizing,width}=options,{side,size}=props.panel||{},visibleButtonStyle=jimu_core.AHW`
    color: ${builderTheme.ref.palette.neutral[1200]};
    background-color: ${builderTheme.ref.palette.neutral[500]};
    border-color: ${builderTheme.ref.palette.neutral[600]};
    &:hover {
      color: ${builderTheme.ref.palette.black};
      background-color: ${builderTheme.ref.palette.neutral[600]};
    }
  `;return isSmallSize?jimu_core.AHW`
      ${(0,screen_side_panel.f)({props,viewHeight,headerHeight,isActive,verticalSpace,stretched,transitionType,screenTransitionType,isSmallSize})};

      .panel-content {
        transform: none !important;

        &:not(.visible) {
          pointer-events: none;
          > .layout-wrapper > .layout,
          > .layout-wrapper > .placeholder-btn {
            pointer-events: none;
          }
        }
      }

      &.minimized .exb-drop-area, &.minimized .toggle-visible-btn {
        pointer-events: none !important;
      }

      .resize-handle {
        display: none;
      }

      .layout-wrapper {
        transform-origin: right bottom;
      }

      .toggle-visible-btn {
        display: flex;
        justify-content: flex-end;
        pointer-events: auto;

        > button {
          ${visibleButtonStyle};
        }
      }
      body:not(.design-mode) & .toggle-visible-btn {
        display: none !important;
      }
    `:jimu_core.AHW`
    ${(0,screen_side_panel.f)({props,viewHeight,headerHeight,isActive,verticalSpace,stretched,transitionType,screenTransitionType,isSmallSize})};

    .panel-content {
      position: relative;
      touch-action: none;
      width: ${isResizing?`${width}px`:size};

      &:not(.visible) {
        pointer-events: none;
        > .layout-wrapper > .layout,
        > .layout-wrapper > .placeholder-btn {
          pointer-events: none;
        }
      }

      &.simple-mode {
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        width: 100% !important;
      }

      .layout-wrapper {
        position: relative;
        transform-origin: right bottom;
      }
    }

    .toggle-visible-btn {
      display: flex;
      justify-content: flex-end;
      pointer-events: auto;
      > button {
        ${visibleButtonStyle};
        svg {
          margin-right: 0;
          margin-left: 0;
        }
      }
    }

    &.minimized .exb-drop-area, &.minimized .toggle-visible-btn {
        pointer-events: none !important;
      }

    .panel-content:hover {
      .resize-handle {
        display: block;
      }
    }
    body:not(.design-mode) & .resize-handle,
    body:not(.design-mode) & .toggle-visible-btn,
    body.lock-layout & .resize-handle {
      display: none !important;
    }
    .resize-handle {
      position: absolute;
      cursor: ew-resize;
      top: 0;
      bottom: 0;
      display: ${isResizing?"block":"none"};
      touch-action: none;
      outline: 1px solid var(--ref-palette-neutral-500);
      width: 5px;
      pointer-events: auto;
      &:after {
        content: '';
        position: absolute;
        z-index: -1;
        top: 0;
        bottom: 0;
        left: 50%;
        border-left: 1px dotted var(--ref-palette-neutral-500);
        transform: translate(-50%);
      }

      &.left {
        left: -5px;
        display: ${"left"!==side?"none":"none !important"};
      }
      &.right {
        right: -5px;
        display: ${"right"!==side?"none":"none !important"};
      }
    }
  `}function ScreenSidePanel(props){const{index,screenId,onInteractionChange,onHeightChange,builderTheme,viewHeight,headerHeight,layoutEntry:LayoutEntry,isActive,isSmallSize,isDesignMode,transitionType,screenTransitionType,triggerType,stretched,viewOnly,verticalSpace="0",useAnimation=!0,formatMessage}=props,screenJson=jimu_core.E_S.useSelector((state=>state.appConfig.screens[screenId])),panelVisible=jimu_core.E_S.useSelector((state=>{var _a,_b,_c;return null===(_c=null===(_b=null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.screenPanelStates)||void 0===_b?void 0:_b[screenId])||void 0===_c||_c})),{panel}=screenJson,domRef=jimu_core.q_G.useRef(),elementRef=jimu_core.q_G.useRef(),interactableRef=jimu_core.q_G.useRef(),[isResizing,setIsResizing]=jimu_core.q_G.useState(!1),[deltaWidth,setDeltaWidth]=jimu_core.q_G.useState(0),panelVisibleRef=jimu_core.q_G.useRef(panelVisible),designModeRef=jimu_core.q_G.useRef(isDesignMode),initWidth=jimu_core.q_G.useRef(),initialOffset=jimu_core.q_G.useMemo((()=>{if(panel&&panel.overlay&&Math.abs(parseFloat(panel.offset))>0){const factor=(0,jimu_core.Vp3)().getState().appContext.isRTL?"left"===panel.side?-1:1:"right"===panel.side?-1:1;return parseFloat(panel.offset)*factor}return 0}),[panel]),[animationProps,api]=jimu_core.ozl.useSpring((()=>({opacity:1,size:1,x:0,y:0}))),onResizeStart=jimu_core.q_G.useCallback(((id,width)=>{initWidth.current=width,setIsResizing(!0),setDeltaWidth(0)}),[]),onResizing=jimu_core.q_G.useCallback(((id,dx,dy,dw,dh)=>{setDeltaWidth(dw)}),[]),onResizeEnd=jimu_core.q_G.useCallback(((id,dx,dy,dw,dh)=>{!function updateScreenSize(screenId,size){var _a;const appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),screenJson=appConfigAction.appConfig.screens[screenId];let newSize;newSize=layout_runtime.utils.isPercentage(null===(_a=screenJson.panel)||void 0===_a?void 0:_a.size)?layout_runtime.utils.toRatio(size,document.body.clientWidth):`${Math.round(size)}px`,appConfigAction.editScreenProperty(screenId,"panel.size",newSize).exec()}(screenId,initWidth.current+dw),setIsResizing(!1)}),[screenId]);jimu_core.q_G.useEffect((()=>{designModeRef.current!==isDesignMode&&(designModeRef.current=isDesignMode,isDesignMode?panelVisibleRef.current?api.start({opacity:1,x:0,y:0,immediate:!0,onRest:null}):api.start({opacity:0,immediate:!0,onRest:null}):api.start({opacity:1,x:0,y:0,immediate:!0,onRest:null}))}),[isDesignMode,api]),jimu_core.q_G.useEffect((()=>{if(!interactableRef.current&&elementRef.current)return interactableRef.current=interact_min_default()(elementRef.current),bindResizeHandler(interactableRef.current,{layoutItemId:screenId,onResizeStart,onResizing,onResizeEnd}),()=>{interactableRef.current&&(interactableRef.current.unset(),interactableRef.current=null)}}),[screenId,onResizeStart,onResizing,onResizeEnd]);const intersectionChange=jimu_core.q_G.useCallback((isIntersecting=>{onInteractionChange(index,isIntersecting)}),[index,onInteractionChange]),onSizeChange=jimu_core.q_G.useCallback((({width,height})=>{onHeightChange(index,height)}),[index,onHeightChange]),hidePanel=jimu_core.q_G.useCallback((e=>{const buttonRect=e.target.getBoundingClientRect(),parentRect=domRef.current.getBoundingClientRect(),isRTL=(0,jimu_core.Vp3)().getState().appContext.isRTL;domRef.current.classList.add("minimized"),api.start({opacity:0,size:0,x:isRTL?parentRect.left-buttonRect.left:parentRect.right-buttonRect.right,y:parentRect.bottom-buttonRect.bottom,immediate:!useAnimation,onRest:()=>{panelVisibleRef.current=!1,(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenPanelVisibleChanged(screenId,!1))}})}),[api,screenId,useAnimation]),showPanel=jimu_core.q_G.useCallback((()=>{domRef.current.classList.remove("minimized"),api.start({opacity:1,size:1,x:0,y:0,immediate:!useAnimation,onRest:null})}),[api,useAnimation]);jimu_core.q_G.useEffect((()=>{panelVisibleRef.current!==panelVisible&&panelVisible&&(showPanel(),panelVisibleRef.current=panelVisible)}),[panelVisible,showPanel]),(0,use_intersection.v)(domRef.current,props.refElement,isSmallSize?jimu_core.Lm.Lower:null!=triggerType?triggerType:jimu_core.Lm.Bottom,intersectionChange);const animationStyle={opacity:animationProps.opacity,translateX:initialOffset,x:animationProps.x,y:animationProps.y},togglable=jimu_core.q_G.useCallback((()=>!viewOnly&&isActive&&(null==panel?void 0:panel.overlay)),[panel,isActive,viewOnly]);return(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("screen-side-panel",{"top-spacing":0===index&&((null==panel?void 0:panel.overlay)||isSmallSize)}),"data-screenid":screenId,"data-index":index,ref:domRef,css:screen_side_panel_getStyle({props:screenJson,viewHeight,headerHeight,isActive,verticalSpace,stretched:stretched||null==panel,transitionType,screenTransitionType,isSmallSize,panelVisible,builderTheme,isResizing,width:initWidth.current+deltaWidth})},panel&&(0,jimu_core.Yac)(animated.div,{className:(0,jimu_core.xWm)("panel-content",{visible:panelVisible}),ref:elementRef,style:animationStyle},(0,jimu_core.Yac)("div",{className:"layout-wrapper"},(0,jimu_core.Yac)(LayoutEntry,{layouts:panel.layout}),!viewOnly&&(0,jimu_core.Yac)(Placeholder,{layouts:panel.layout,builderTheme}),(0,jimu_core.Yac)("span",{className:"resize-handle left rnd-resize-left"}),(0,jimu_core.Yac)("span",{className:"resize-handle right rnd-resize-right"})),togglable()&&(0,jimu_core.Yac)("div",{className:"toggle-visible-btn",onClick:hidePanel,"data-testid":`toggleBtn-${panelVisible}`},(0,jimu_core.Yac)(theme_tooltip.v,{placement:"auto",title:formatMessage("hideInDesignView")},(0,jimu_core.Yac)(jimu_ui.Button,{type:"default",size:"sm",className:"rounded-1"},(0,jimu_core.Yac)(invisible.u,{size:"m"})))),(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("panel-spacing",{"last-item":props.isLast})})),!panel&&panelVisible&&(0,jimu_core.Yac)("div",{className:"panel-content-placeholder"}),(0,jimu_core.Yac)(jimu_core.cQZ,{targetRef:domRef,handleHeight:!0,onResize:onSizeChange}))}try{ScreenSidePanel.displayName="ScreenSidePanel",ScreenSidePanel.__docgenInfo={description:"",displayName:"ScreenSidePanel",props:{index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},isLast:{defaultValue:null,description:"",name:"isLast",required:!0,type:{name:"boolean"}},viewHeight:{defaultValue:null,description:"",name:"viewHeight",required:!1,type:{name:"number"}},headerHeight:{defaultValue:null,description:"",name:"headerHeight",required:!0,type:{name:"number"}},screenId:{defaultValue:null,description:"",name:"screenId",required:!0,type:{name:"string"}},refElement:{defaultValue:null,description:"",name:"refElement",required:!0,type:{name:"HTMLDivElement"}},layoutEntry:{defaultValue:null,description:"",name:"layoutEntry",required:!0,type:{name:"ComponentType<LayoutProps>"}},isActive:{defaultValue:null,description:"",name:"isActive",required:!0,type:{name:"boolean"}},transitionType:{defaultValue:null,description:"",name:"transitionType",required:!0,type:{name:"enum",value:[{value:'"FADE"'},{value:'"COVER"'},{value:'"PUSH"'}]}},screenTransitionType:{defaultValue:null,description:"",name:"screenTransitionType",required:!0,type:{name:"enum",value:[{value:'"FADE"'},{value:'"COVER"'},{value:'"PUSH"'}]}},triggerType:{defaultValue:null,description:"",name:"triggerType",required:!0,type:{name:"enum",value:[{value:'"TOP"'},{value:'"UPPER"'},{value:'"LOWER"'},{value:'"BOTTOM"'}]}},stretched:{defaultValue:null,description:"",name:"stretched",required:!0,type:{name:"boolean"}},verticalSpace:{defaultValue:null,description:"",name:"verticalSpace",required:!0,type:{name:"string"}},isSmallSize:{defaultValue:null,description:"",name:"isSmallSize",required:!0,type:{name:"boolean"}},onHeightChange:{defaultValue:null,description:"",name:"onHeightChange",required:!0,type:{name:"(index: number, height: number) => void"}},onInteractionChange:{defaultValue:null,description:"",name:"onInteractionChange",required:!0,type:{name:"(index: number, isIntersecting: boolean) => void"}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"IMThemeVariables"}},viewOnly:{defaultValue:null,description:"",name:"viewOnly",required:!0,type:{name:"boolean"}},isDesignMode:{defaultValue:null,description:"",name:"isDesignMode",required:!0,type:{name:"boolean"}},useAnimation:{defaultValue:null,description:"",name:"useAnimation",required:!1,type:{name:"boolean"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/screen-side-panel.tsx#ScreenSidePanel"]={docgenInfo:ScreenSidePanel.__docgenInfo,name:"ScreenSidePanel",path:"../jimu-layouts/lib/flow-layout/builder/screen-side-panel.tsx#ScreenSidePanel"})}catch(__react_docgen_typescript_loader_error){}function ScreenContextMenu(props){const{layoutId,layoutItemId,builderTheme,layoutItem,formatMessage,isFirst,isLast}=props,[showBlockPopper,setShowBlockPopper]=jimu_core.q_G.useState(!1),[showScreenGroupPopper,setShowScreenGroupPopper]=jimu_core.q_G.useState(!1),contextMenuRef=jimu_core.q_G.useRef(),onTemplateBlockSelected=jimu_core.q_G.useCallback((template=>{addTemplateRow(layoutId,layoutItemId,template),setShowBlockPopper(!1)}),[layoutId,layoutItemId]),toggleBlockPopper=jimu_core.q_G.useCallback((()=>{(0,jimu_core.Vp3)().getState().browserSizeMode!==jimu_core.rHp.Small?setShowBlockPopper(!showBlockPopper):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"templateBlock",templateMethod:"getBlockTemplates",onSelect:onTemplateBlockSelected})}),[showBlockPopper,onTemplateBlockSelected]),toggleScreenGroupPopper=jimu_core.q_G.useCallback((()=>{setShowScreenGroupPopper(!showScreenGroupPopper)}),[showScreenGroupPopper]),onTemplateScreenGroupSelected=jimu_core.q_G.useCallback((template=>{addTemplateScreenGroup(layoutId,layoutItemId,template),setShowScreenGroupPopper(!1)}),[layoutId,layoutItemId]),moveLayoutItemUp=jimu_core.q_G.useCallback((()=>{const appConfig=moveUp((0,jimu_for_builder.getAppConfigAction)().appConfig,{layoutId,layoutItemId});(0,jimu_for_builder.getAppConfigAction)(appConfig).exec()}),[layoutId,layoutItemId]),moveLayoutItemDown=jimu_core.q_G.useCallback((()=>{const appConfig=moveDown((0,jimu_for_builder.getAppConfigAction)().appConfig,{layoutId,layoutItemId});(0,jimu_for_builder.getAppConfigAction)(appConfig).exec()}),[layoutId,layoutItemId]),removeLayoutItem=jimu_core.q_G.useCallback((()=>{jimu_for_builder.appBuilderSync.publishConfirmDeleteToApp({layoutId,layoutItemId})}),[layoutId,layoutItemId]),sizemodeSupported=jimu_core.q_G.useCallback((()=>(0,jimu_core.Vp3)().getState().browserSizeMode===jimu_core.rHp.Large),[]),contextMenus=[{icon:block_default(),title:formatMessage("insertABlock"),onClick:toggleBlockPopper,visible:()=>!isLockLayout()},{icon:screen_group_default(),title:formatMessage("insertAScreenGroup"),onClick:toggleScreenGroupPopper,visible:()=>sizemodeSupported()&&!isLockLayout()},pendingMenuItem,Object.assign(Object.assign({},duplicateMenuItem),{visible:()=>sizemodeSupported()&&!isLockLayout()}),{icon:setting_default(),title:formatMessage("setting"),onClick:()=>{(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged({layoutId,layoutItemId}))}},{icon:move_default(),title:formatMessage("dragToMove",{label:getLabelOfLayoutItem(layoutItem)}),className:"tool-drag-handler",onClick:()=>null,visible:()=>!isLockLayout()},{icon:up_default(),onClick:moveLayoutItemUp,title:formatMessage("moveup"),visible:()=>!isFirst&&!isLockLayout()},{icon:up_default(),rotate:180,onClick:moveLayoutItemDown,title:formatMessage("movedown"),visible:()=>!isLast&&!isLockLayout()},{icon:trash_default(),title:formatMessage("delete"),onClick:removeLayoutItem,visible:()=>!isLockLayout()}];return(0,jimu_core.Yac)(FlowContextMenu,{layoutId,layoutItem,builderTheme,positionType:"center",size:layout_runtime.CONTEXT_MENU_ITEM_SIZE,iconSize:layout_runtime.CONTEXT_MENU_ICON_SIZE,className:"widget-context-menu",menuItems:contextMenus,isFirst,isLast},(0,jimu_core.Yac)("div",{ref:contextMenuRef,css:jimu_core.AHW`position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;`}),showBlockPopper&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getBlockTemplates)(),referenceElement:contextMenuRef.current,onItemSelect:onTemplateBlockSelected,onClose:toggleBlockPopper}),showScreenGroupPopper&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getScreenGroupTemplates)(),referenceElement:contextMenuRef.current,onItemSelect:onTemplateScreenGroupSelected,onClose:toggleScreenGroupPopper}))}try{ScreenContextMenu.displayName="ScreenContextMenu",ScreenContextMenu.__docgenInfo={description:"",displayName:"ScreenContextMenu",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},isFirst:{defaultValue:null,description:"",name:"isFirst",required:!0,type:{name:"boolean"}},isLast:{defaultValue:null,description:"",name:"isLast",required:!0,type:{name:"boolean"}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"IMThemeVariables"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(string: any, values?: any) => string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/screen-context-menu.tsx#ScreenContextMenu"]={docgenInfo:ScreenContextMenu.__docgenInfo,name:"ScreenContextMenu",path:"../jimu-layouts/lib/flow-layout/builder/screen-context-menu.tsx#ScreenContextMenu"})}catch(__react_docgen_typescript_loader_error){}var type=__webpack_require__("../jimu-layouts/lib/flow-layout/common/type.ts");function screen_group_getStyle(viewHeight,builderTheme,isFirst,isLast,selected,isOverlay){return jimu_core.AHW`
    position: relative;
    width: 100%;

    & > div.widget-context-menu {
      display: none;
    }

    &:hover > div.widget-context-menu {
      display: flex;
    }

    body.lock-layout & {
      .screen-menu {
        bottom: ${isFirst?isLast?"-10px":"-32px":"auto"};
        z-index: ${isFirst&&isLast?10:null};
      }
    }

    .screen-menu {
      display: ${selected?"block":"none"};
      position: absolute;
      opacity: ${selected?.8:.5};
      left: 0;
      top: ${isFirst?"auto":"-32px"};
      bottom: ${isFirst?"-32px":"auto"};
      height: 32px;
      width: 100%;
      background-color: ${builderTheme.ref.palette.neutral[300]};
      overflow: visible;

      .info {
        color: ${builderTheme.ref.palette.black};
      }

      .jimu-btn svg {
        color: ${builderTheme.ref.palette.neutral[1e3]};
      }
    }

    .screen-group {
      position: relative;
      height: ${viewHeight}px;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .main-panels {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      pointer-events: none;
      z-index: 0;
    }

    &.small-size .main-panels {
      z-index: ${isOverlay?0:1};
    }

    &.small-size .side-panels {
      z-index: ${isOverlay?1:0};
    }

    .side-panels {
      position: relative;
      z-index: 1;
      pointer-events: none;

      > div:first-of-type > div.panel-content {
        padding-top: ${Math.round(viewHeight*type.v)}px;
      }

      /* > div:nth-last-of-type(2) {
        min-height: ${viewHeight}px;
      } */
    }

    body:not(.design-mode) & {
      .screen-group {
        position: static;
        height: auto;
        overflow-y: unset;
        overflow-x: unset;
      }
      .side-panels {
        > div:first-of-type > div.panel-content {
          padding-top: ${100*type.v}vh;
          padding-top: calc(var(--vh) * ${100*type.v});
        }
        /* > div:nth-last-of-type(2) {
          min-height: 100vh;
        } */
      }
      .screen-menu {
        display: none !important;
      }
    }

    .group-tip {
      display: none;
      padding: inherit;
      position: absolute;
      left: 0;
      bottom: 0;
      top: 0;
      right: 0;
      pointer-events: none;
      .tip-content {
        height: 100%;
        padding: 2px;
        &:after {
          content: '';
          width: 100%;
          height: 100%;
          outline: 2px solid ${builderTheme.sys.color.primary.dark};
          display: block;
        }
      }
    }

    &:hover .group-tip {
      display: block;
    }
  `}function ScreenGroup(props){var _a;const{layoutId,layoutItemId,layoutItem,formatMessage,itemIndex,isFirst,isLast}=props,{screenGroupId}=layoutItem,selected=jimu_core.E_S.useSelector((state=>{var _a;const selection=null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.selection;return!!selection&&(selection.layoutId===layoutId&&selection.layoutItemId===layoutItemId)})),screenGroup=jimu_core.E_S.useSelector((state=>state.appConfig.screenGroups[layoutItem.screenGroupId])),hasPanel=jimu_core.E_S.useSelector((state=>state.appConfig.screenGroups[layoutItem.screenGroupId].screens.some((screenId=>null!=state.appConfig.screens[screenId].panel)))),browserSizeMode=jimu_core.E_S.useSelector((state=>state.browserSizeMode)),{screens,stretchPanel=!0,triggerType=jimu_core.Lm.Bottom,verticalSpace="0",panelTransitionType=jimu_core.al_.Push}=screenGroup;let transitionType=null!==(_a=screenGroup.transitionType)&&void 0!==_a?_a:jimu_core.al_.Fade;browserSizeMode!==jimu_core.rHp.Small||hasPanel||(transitionType=jimu_core.al_.Cover);const navInfo=jimu_core.E_S.useSelector((state=>{var _a;return null===(_a=state.appRuntimeInfo.screenGroupNavInfos)||void 0===_a?void 0:_a[screenGroupId]})),viewportSize=jimu_core.E_S.useSelector((state=>jimu_core.WpD.findViewportSize(state.appConfig,state.browserSizeMode||jimu_core.rHp.Large))),isDesignMode=jimu_core.E_S.useSelector((state=>{var _a;return(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design})),{viewOnly,builderTheme,pageId}=jimu_core.q_G.useContext(layout_runtime.PageContext),headerHeight=jimu_core.E_S.useSelector((state=>{const pageJson=state.appConfig.pages[pageId];if(null==pageJson?void 0:pageJson.header){const headerJson=state.appConfig.header;if(null==headerJson?void 0:headerJson.sticky){const browserSizeMode=state.browserSizeMode,mainSizeMode=state.appConfig.mainSizeMode,height=headerJson.height[browserSizeMode]||headerJson.height[mainSizeMode]||type.q;return parseInt(height,10)}}return 0})),domRef=jimu_core.q_G.useRef(),screenGroupRef=jimu_core.q_G.useRef(),mainPanelRef=jimu_core.q_G.useRef(),sidePanelsRef=jimu_core.q_G.useRef(),monitorScrollRef=jimu_core.q_G.useRef(!0),scrollListenerRef=jimu_core.q_G.useRef(),interactableRef=jimu_core.q_G.useRef(),[activeIndex,setActiveIndex]=jimu_core.q_G.useState(0);jimu_core.q_G.useEffect((()=>{if(selected){const element=document.querySelector(`div.exb-rnd[data-layoutid="${layoutId}"][data-layoutitemid="${layoutItemId}"]`);null!=element&&element.scrollIntoView({behavior:"auto",block:"center"})}}),[selected,layoutId,layoutItemId]);const isOverlay=jimu_core.q_G.useMemo((()=>{var _a,_b,_c;if(browserSizeMode!==jimu_core.rHp.Small)return!1;const appConfig=(0,jimu_core.Vp3)().getState().appConfig,screens=null===(_b=null===(_a=appConfig.screenGroups)||void 0===_a?void 0:_a[screenGroupId])||void 0===_b?void 0:_b.screens;if(null==screens?void 0:screens[activeIndex]){return null===(_c=appConfig.screens[screens[activeIndex]].panel)||void 0===_c?void 0:_c.overlay}return!1}),[screenGroupId,activeIndex,browserSizeMode]),scrollIntoView=jimu_core.q_G.useCallback((index=>{var _a;const sideElements=screenGroupRef.current.querySelectorAll("div.screen-side-panel");let previousItemsHeight=0;if(sideElements.forEach((element=>{+element.getAttribute("data-index")<index&&(previousItemsHeight+=element.clientHeight)})),screenGroupRef.current.scrollTop=previousItemsHeight,transitionType!==jimu_core.al_.Fade){const screenContainerElem=null===(_a=mainPanelRef.current)||void 0===_a?void 0:_a.children[0];screenContainerElem&&(screenContainerElem.scrollTop=screenGroupRef.current.scrollTop)}}),[transitionType]),onItemDragStart=jimu_core.q_G.useCallback((()=>{setIsDragging(!0)}),[]),onItemDragEnd=jimu_core.q_G.useCallback((()=>{setIsDragging(!1)}),[]);jimu_core.q_G.useEffect((()=>{if(domRef.current&&!interactableRef.current){const{layoutId,layoutItemId,layoutItem}=props;interactableRef.current=interact_min_default()(domRef.current).origin("parent"),interactableRef.current=bindDragHandler(interactableRef.current,{layoutId,layoutItemId,onDragStart:onItemDragStart,onDragEnd:onItemDragEnd,useDragHandler:!0,itemType:layoutItem.type,rootLayoutId:()=>layoutId,restrict:()=>!0}),interactableRef.current.draggable({modifiers:[interact_min_default().modifiers.restrictRect({restriction:"parent"})]})}return()=>{interactableRef.current&&(interactableRef.current.unset(),interactableRef.current=null)}}),[]),jimu_core.q_G.useEffect((()=>{null!=(null==navInfo?void 0:navInfo.activeIndex)&&navInfo.activeIndex!==activeIndex&&(!function clearSelectionInScreen(screenGroupId,screenIndex){var _a;const appConfig=(0,jimu_core.Vp3)().getState().appConfig,sizeMode=(0,jimu_core.Vp3)().getState().browserSizeMode,selection=null===(_a=(0,jimu_core.Vp3)().getState().appRuntimeInfo)||void 0===_a?void 0:_a.selection;if(null!=selection){const screenId=appConfig.screenGroups[screenGroupId].screens[screenIndex],screenJson=appConfig.screens[screenId];if(screenJson){const screenLayoutId=screenJson.main.layout[sizeMode];selection.layoutId===screenLayoutId&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged(null)),null!=document.querySelector(`div[data-layoutid="${screenLayoutId}"] div[data-layoutid="${selection.layoutId}"][data-layoutitemid="${selection.layoutItemId}"]`)&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged(null))}}}(screenGroupId,activeIndex),setActiveIndex(navInfo.activeIndex),navInfo.scrollIntoView&&(monitorScrollRef.current=!1,scrollIntoView(navInfo.activeIndex),setTimeout((()=>{monitorScrollRef.current=!0}),200)))}),[navInfo,activeIndex,scrollIntoView,screenGroupId]),jimu_core.q_G.useEffect((()=>{scrollListenerRef.current&&(screenGroupRef.current.removeEventListener("scroll",scrollListenerRef.current),scrollListenerRef.current=null),scrollListenerRef.current=()=>{var _a;const screenContainerElem=null===(_a=mainPanelRef.current)||void 0===_a?void 0:_a.children[0];screenContainerElem&&transitionType!==jimu_core.al_.Fade&&(screenContainerElem.scrollTop=screenGroupRef.current.scrollTop)},screenGroupRef.current.addEventListener("scroll",scrollListenerRef.current)}),[transitionType]),jimu_core.q_G.useEffect((()=>{(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(screenGroupId,0))}),[isDesignMode,screenGroupId]);const onInteractionChange=jimu_core.q_G.useCallback(((index,isIntersecting)=>{monitorScrollRef.current&&(isIntersecting&&index!==activeIndex?(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(screenGroupId,index,!1)):!isIntersecting&&index>0&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(screenGroupId,index-1,!1)))}),[activeIndex,screenGroupId]),selectItem=jimu_core.q_G.useCallback((e=>{e.stopPropagation(),isLockLayout()||viewOnly||browserSizeMode===jimu_core.rHp.Small||(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged({layoutId,layoutItemId}))}),[viewOnly,browserSizeMode,layoutId,layoutItemId]),sidepanelResizeHandler=jimu_core.q_G.useCallback((()=>{if(!screenGroupRef.current)return;const mainPanelContainer=screenGroupRef.current.children[0],sidePanelContainer=screenGroupRef.current.children[1];mainPanelContainer.style.height=`${sidePanelContainer.clientHeight}px`}),[]),debounceResizeHandler=jimu_core.q_G.useMemo((()=>jimu_core.CM0.debounce(sidepanelResizeHandler,200)),[sidepanelResizeHandler]),onSidePanelHeightChange=jimu_core.q_G.useCallback(((index,height)=>{if(!screenGroupRef.current)return;const mainPanelContainer=screenGroupRef.current.children[0],sidePanelContainer=screenGroupRef.current.children[1];if(transitionType!==jimu_core.al_.Fade)if(transitionType!==jimu_core.al_.Cover){if(transitionType===jimu_core.al_.Push){const relatedElement=mainPanelContainer.querySelector(`div.screen-main-panel[data-index="${index}"]`),panelElement=sidePanelContainer.querySelector(`div.screen-side-panel[data-index="${index}"]`);relatedElement.style.height=`${panelElement.clientHeight}px`,mainPanelContainer.style.height=`${sidePanelContainer.clientHeight}px`}}else(0,flow_layout_common_util.Z)(mainPanelContainer,sidePanelContainer,browserSizeMode);else mainPanelContainer.style.height=`${sidePanelContainer.clientHeight}px`}),[browserSizeMode,transitionType]),deleteSelectedItem=jimu_core.q_G.useCallback((()=>{(0,jimu_core.Vp3)().dispatch(jimu_for_builder.builderActions.confirmDeleteContentChanged({layoutId,layoutItemId}))}),[layoutId,layoutItemId]),keyBindings=jimu_core.q_G.useMemo((()=>({delete:deleteSelectedItem,backspace:deleteSelectedItem})),[deleteSelectedItem]);return screens.length>0?(0,jimu_core.Yac)(page_context.VZ.Provider,{value:`${layoutId}:${layoutItemId}`},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("builder-layout-item exb-rnd",{selected,"small-size":browserSizeMode===jimu_core.rHp.Small}),css:screen_group_getStyle(viewportSize.height,builderTheme,isFirst,isLast,selected,isOverlay),"data-layoutitemid":layoutItemId,"data-layoutid":layoutId,onClick:selectItem,ref:domRef},(0,jimu_core.Yac)("div",{className:"screen-menu"},(0,jimu_core.Yac)(ScreenGroupMenu,{activeScreenIndex:activeIndex,itemIndex,total:screens.length,screenGroupId,layoutId,layoutItemId,browserSizeMode,hasPanel,formatMessage})),(0,jimu_core.Yac)("div",{className:"screen-group",ref:screenGroupRef},(0,jimu_core.Yac)("div",{className:"main-panels",ref:mainPanelRef},(0,jimu_core.Yac)(common.yl,{rootLayoutId:layoutId,activeIndex,viewHeight:viewportSize.height,headerHeight,screens,transitionType,layoutEntry:layout_entry,isSmallSize:browserSizeMode===jimu_core.rHp.Small,isDesignMode,builderTheme,formatMessage})),(0,jimu_core.Yac)("div",{className:"side-panels",ref:sidePanelsRef},screens.map(((screenId,idx)=>(0,jimu_core.Yac)(ScreenSidePanel,{key:screenId,index:idx,isLast:idx===screens.length-1,screenId,viewHeight:viewportSize.height,headerHeight,refElement:isDesignMode?domRef.current:null,layoutEntry:layout_entry,viewOnly,builderTheme,isActive:idx===activeIndex,isSmallSize:browserSizeMode===jimu_core.rHp.Small,isDesignMode,stretched:stretchPanel,triggerType,verticalSpace,transitionType:panelTransitionType,screenTransitionType:transitionType,onHeightChange:onSidePanelHeightChange,onInteractionChange,formatMessage}))),(0,jimu_core.Yac)(jimu_core.cQZ,{targetRef:sidePanelsRef,handleHeight:!0,onResize:debounceResizeHandler}))),!viewOnly&&(0,jimu_core.Yac)(ScreenContextMenu,{layoutId,layoutItemId,layoutItem,isFirst,isLast,builderTheme,formatMessage}),isDesignMode&&(0,jimu_core.Yac)("div",{className:"group-tip"},(0,jimu_core.Yac)("div",{className:"tip-content"})),isDesignMode&&selected&&(0,jimu_core.Yac)(jimu_core.s3S,{bindings:keyBindings}))):null}try{ScreenGroup.displayName="ScreenGroup",ScreenGroup.__docgenInfo={description:"",displayName:"ScreenGroup",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},itemIndex:{defaultValue:null,description:"",name:"itemIndex",required:!0,type:{name:"number"}},isFirst:{defaultValue:null,description:"",name:"isFirst",required:!0,type:{name:"boolean"}},isLast:{defaultValue:null,description:"",name:"isLast",required:!0,type:{name:"boolean"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},theme:{defaultValue:null,description:"",name:"theme",required:!0,type:{name:"IMThemeVariables"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(id: string) => string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/screen-group.tsx#ScreenGroup"]={docgenInfo:ScreenGroup.__docgenInfo,name:"ScreenGroup",path:"../jimu-layouts/lib/flow-layout/builder/screen-group.tsx#ScreenGroup"})}catch(__react_docgen_typescript_loader_error){}var brand_block=__webpack_require__("../jimu-icons/outlined/brand/block.tsx"),brand_screen_group=__webpack_require__("../jimu-icons/outlined/brand/screen-group.tsx");const builder_action_block_buttonStyle=jimu_core.AHW`
  pointer-events: auto;
`;function builder_action_block_getStyle(builderTheme){return jimu_core.AHW`
    body.lock-layout &,
    body:not(.design-mode) & {
      display: none !important;
    }

    display: flex;
    height: 200px;
    padding: 1rem;
    pointer-events: none;
    position: relative;
    z-index: 1;
    .btn-text {
      line-height: 32px;
    }
    .btn {
      margin-right: 2rem;
      background: ${builderTheme.ref.palette.neutral[600]};
      &:hover {
        background: ${builderTheme.ref.palette.neutral[700]};
      }
    }
    .action-item {
      width: 32px;
    }

    .action-separator {
      width: 300px;
      height: 1px;
      background-color: ${builderTheme.ref.palette.neutral[1100]};
    }
  `}function sizemodeSupported(browserSizeMode){return browserSizeMode===jimu_core.rHp.Large}function builder_action_block_ActionBlock(props){const{pageContext,browserSizeMode,onPageTemplateSelected,onBlockTemplateSelected,onScreenTemplateSelected,blockOnly}=props,{builderTheme,formatMessage,isHeader,isFooter}=pageContext,[showTemplatePopper,setShowTemplatePopper]=jimu_core.q_G.useState(!1),[showBlockPopper,setShowBlockPopper]=jimu_core.q_G.useState(!1),[showScreenPopper,setShowScreenPopper]=jimu_core.q_G.useState(!1),blockRef=jimu_core.q_G.useRef(null),screenRef=jimu_core.q_G.useRef(null),templateRef=jimu_core.q_G.useRef(null),show=jimu_core.E_S.useSelector((state=>{var _a,_b,_c;const lockLayout=null!==(_c=null===(_b=null===(_a=state.appConfig)||void 0===_a?void 0:_a.forBuilderAttributes)||void 0===_b?void 0:_b.lockLayout)&&void 0!==_c&&_c;return state.appRuntimeInfo.appMode===jimu_core.$0N.Design&&!lockLayout})),isPageBody=!isHeader&&!isFooter;let templateTooltip;templateTooltip=isHeader?formatMessage("chooseHeaderTemplate"):isFooter?formatMessage("chooseFooterTemplate"):formatMessage("chooseTemplate",{type:pageContext.isDialog?formatMessage("dialog").toLocaleLowerCase():formatMessage("page").toLocaleLowerCase()});return show?(0,jimu_core.Yac)("div",{className:"w-100 flex-column justify-content-center align-items-center",css:builder_action_block_getStyle(builderTheme)},(0,jimu_core.Yac)("div",{className:"d-flex"},isPageBody&&(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,(0,jimu_core.Yac)(theme_tooltip.v,{placement:"bottom",title:formatMessage("insertABlock")},(0,jimu_core.Yac)("div",{className:"action-item"},(0,jimu_core.Yac)(jimu_ui.Button,{ref:blockRef,icon:!0,onClick:e=>{e.stopPropagation(),browserSizeMode!==jimu_core.rHp.Small?setShowBlockPopper(!showBlockPopper):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"templateBlock",templateMethod:"getBlockTemplates",onSelect:onBlockTemplateSelected})},css:builder_action_block_buttonStyle,className:"rounded-circle"},(0,jimu_core.Yac)(brand_block.g,{size:"m",color:builderTheme.ref.palette.neutral[1100]})))),sizemodeSupported(browserSizeMode)&&(0,jimu_core.Yac)(theme_tooltip.v,{placement:"bottom",title:formatMessage("insertAScreenGroup")},(0,jimu_core.Yac)("div",{className:"action-item ml-5"},(0,jimu_core.Yac)(jimu_ui.Button,{ref:screenRef,icon:!0,onClick:e=>{e.stopPropagation(),setShowScreenPopper(!showScreenPopper)},css:builder_action_block_buttonStyle,className:"rounded-circle"},(0,jimu_core.Yac)(brand_screen_group.U,{size:16,color:builderTheme.ref.palette.neutral[1100]}))))),!blockOnly&&(0,jimu_core.Yac)(theme_tooltip.v,{placement:"bottom",title:templateTooltip},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("action-item",{"ml-5":isPageBody})},(0,jimu_core.Yac)(jimu_ui.Button,{ref:templateRef,icon:!0,onClick:e=>{e.stopPropagation(),browserSizeMode!==jimu_core.rHp.Small?setShowTemplatePopper(!showTemplatePopper):jimu_for_builder.appBuilderSync.publishSidePanelToApp({type:"template",templateMethod:"getScrollingPageTemplates",onSelect:onPageTemplateSelected})},css:builder_action_block_buttonStyle,className:"rounded-circle"},(0,jimu_core.Yac)(template.v,{autoFlip:!0,size:16,color:builderTheme.ref.palette.neutral[1100]}))))),(0,jimu_core.Yac)("div",{className:"action-separator mt-4"}),(0,jimu_core.Yac)("div",null,(0,jimu_core.Yac)("h5",{className:"btn-text mt-2"},formatMessage("dropWidgetToAdd"))),isPageBody&&showBlockPopper&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getBlockTemplates)(),referenceElement:blockRef.current,onItemSelect:template=>{setShowBlockPopper(!1),onBlockTemplateSelected(template)},onClose:()=>{setShowBlockPopper(!1)}}),isPageBody&&showScreenPopper&&sizemodeSupported(browserSizeMode)&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getScreenGroupTemplates)(),referenceElement:screenRef.current,onItemSelect:template=>{setShowScreenPopper(!1),onScreenTemplateSelected(template)},onClose:()=>{setShowScreenPopper(!1)}}),!blockOnly&&showTemplatePopper&&(0,jimu_core.Yac)(setting_components.TemplateSelector,{templates:(0,jimu_for_builder_templates.getScrollingPageTemplates)(!1),referenceElement:templateRef.current,onItemSelect:template=>{setShowTemplatePopper(!1),onPageTemplateSelected(template)},onClose:()=>{setShowTemplatePopper(!1)}})):null}try{builder_action_block_ActionBlock.displayName="ActionBlock",builder_action_block_ActionBlock.__docgenInfo={description:"",displayName:"ActionBlock",props:{pageContext:{defaultValue:null,description:"",name:"pageContext",required:!0,type:{name:"PageContextProps"}},browserSizeMode:{defaultValue:null,description:"",name:"browserSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},blockOnly:{defaultValue:null,description:"",name:"blockOnly",required:!1,type:{name:"boolean"}},onPageTemplateSelected:{defaultValue:null,description:"",name:"onPageTemplateSelected",required:!0,type:{name:"(templatePageJson: any) => void"}},onBlockTemplateSelected:{defaultValue:null,description:"",name:"onBlockTemplateSelected",required:!0,type:{name:"(templateBlockJson: any) => void"}},onScreenTemplateSelected:{defaultValue:null,description:"",name:"onScreenTemplateSelected",required:!0,type:{name:"(templateScreenJson: any) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/action-block.tsx#ActionBlock"]={docgenInfo:builder_action_block_ActionBlock.__docgenInfo,name:"ActionBlock",path:"../jimu-layouts/lib/flow-layout/builder/action-block.tsx#ActionBlock"})}catch(__react_docgen_typescript_loader_error){}const flow_layout_builder_layout_dropareaStyle=jimu_core.AHW`
  position: absolute;
  left: 0;
  bottom: 0;
  top: 0;
  right: 0;
  background: transparent;
`,flow_layout_builder_layout_guideOverlay=jimu_core.AHW`
  ${flow_layout_builder_layout_dropareaStyle};
  z-index: ${layout_runtime.LayoutZIndex.DragMoveTip};
  pointer-events: none;
`;class flow_layout_builder_layout_Layout extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.state={isDragover:!1,isLoadingTemplate:!1},this.handleActivate=e=>{if(!isDesignMode()&&!isExpressMode())return;if(Math.abs(e.screenX-this.mousedownX)>layout_runtime.CLICK_TOLERANCE||Math.abs(e.screenY-this.mousedownY)>layout_runtime.CLICK_TOLERANCE)return void e.stopPropagation();const{isInSection,isInWidget}=this.props;this.pageContext.viewOnly||isInSection||isInWidget||isResizing()||isDragging()||(e.stopPropagation(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged(null)))},this.handleMouseDown=e=>{this.mousedownX=e.screenX,this.mousedownY=e.screenY},this.handleDragOver=(draggingItem,draggingElement,containerRect,itemRect,clientX,clientY)=>{var _a,_b,_c;const{layout}=this.props,layoutInfo=null!==(_a=draggingItem.layoutInfo)&&void 0!==_a?_a:{layoutId:null};let rect=itemRect;if(this.canvasPane.clear(),(null===(_b=this.childRects)||void 0===_b?void 0:_b.length)>0){const{insertY,refId}=function dnd_helper_calInsertPositionForColumn(boundingRect,centerY,childRects,indicatorSize){let result,refId,found=!1;if(childRects.some(((rect,i)=>{if(rect.top+rect.height/2>centerY){if(0===i)result=Math.max(rect.top/2,rect.top-5);else{const previousItem=childRects[i-1];result=(rect.top+previousItem.top+previousItem.height)/2}found=!0,refId=rect.id}return found})),!found){const lastItem=childRects[childRects.length-1];result=Math.min(lastItem.top+lastItem.height+5,(lastItem.top+lastItem.height+boundingRect.height)/2)}return{refId,insertY:result}}(containerRect,clientY,this.childRects);if(this.referenceId=refId,layoutInfo.layoutId===this.props.layout.id){const content=layout.order,draggingIndex=content.indexOf(layoutInfo.layoutItemId),refIndex=content.indexOf(refId);if((null===(_c=layout.content[layoutInfo.layoutItemId].setting)||void 0===_c?void 0:_c.isFloating)||draggingIndex===refIndex-1||null==refId&&draggingIndex===content.length-1)return}rect={top:insertY-5+this.ref.scrollTop,width:containerRect.width-10,left:5,height:10}}else this.referenceId=null,rect={top:containerRect.height/2-5,width:containerRect.width-10,left:5,height:10};this.canvasPane.setColor(jimu_core.PLL.rgba(this.builderTheme.sys.color.primary.light,.5)),this.canvasPane.drawRect(rect)},this.handleToggleDragoverEffect=(value,draggingItem)=>{var _a;value&&(this.referenceId=null,this.collectBounds(null!==(_a=draggingItem.layoutInfo)&&void 0!==_a?_a:{layoutId:null})),this.canvasPane.clear(),this.setState({isDragover:value})},this.handleDrop=(draggingItem,containerRect,itemRect)=>{var _a,_b;this.canvasPane.clear();const{layout}=this.props,draggingLayoutInfo=null!==(_a=draggingItem.layoutInfo)&&void 0!==_a?_a:{layoutId:null},appConfigAction=(0,jimu_for_builder.getAppConfigAction)();let insertIndex=0;if(null!=this.referenceId?insertIndex=layout.order.indexOf(this.referenceId):null!=layout.order&&(insertIndex=layout.order.length),this.referenceId=null,this.childRects=[],draggingLayoutInfo.layoutId===layout.id){if(null===(_b=layout.content[draggingLayoutInfo.layoutItemId].setting)||void 0===_b?void 0:_b.isFloating){const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();return appConfigAction.setLayoutItemToPending(draggingLayoutInfo,!1),void layout_runtime.utils.changeLayout(appConfigAction.appConfig,Object.assign(Object.assign({},draggingLayoutInfo),{autoScroll:!1}))}return void common_layout_actions_addItemToLayout(appConfigAction.appConfig,draggingItem,layout.id).then((result=>{const{layoutInfo,updatedAppConfig}=result,outAppConfig=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.FlowLayout).processAfterItemAdded(updatedAppConfig,draggingItem,layoutInfo,{currentSizeMode:null,containerRect,itemRect,insertIndex});layout_runtime.utils.changeLayout(outAppConfig,Object.assign(Object.assign({},layoutInfo),{autoScroll:!0}))})).finally(null)}const colWidth=(this.maxPageWidth>0?Math.min(this.maxPageWidth,containerRect.width):containerRect.width)/12,span=Math.min(Math.ceil(itemRect.width/colWidth),12);draggingItem.itemType===jimu_core.K6q.ScreenGroup?common_layout_actions_addItemToLayout(appConfigAction.appConfig,draggingItem,layout.id).then((result=>{const{layoutInfo,updatedAppConfig}=result,outAppConfig=jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(jimu_core.p5K.FlowLayout).processAfterItemAdded(updatedAppConfig,draggingItem,layoutInfo,{currentSizeMode:null,containerRect,itemRect,insertIndex});layout_runtime.utils.changeLayout(outAppConfig,Object.assign(Object.assign({},layoutInfo),{autoScroll:!0}))})).finally(null):this.addWidgetToLayout(draggingItem,containerRect,itemRect,span,insertIndex)},this.handleDropAtBoundary=(draggingItem,itemRect,insertIndex)=>{insertIndex<this.props.layout.order.length?this.referenceId=this.props.layout.order[insertIndex]:this.referenceId=null,null==this.domRect&&(this.domRect=this.ref.getBoundingClientRect()),this.handleDrop(draggingItem,this.domRect,itemRect)},this.onWidgetItemSelected=item=>{var _a,_b,_c;const rect=this.ref.getBoundingClientRect(),itemRect={height:null!==(_c=null===(_b=null===(_a=item.manifest)||void 0===_a?void 0:_a.defaultSize)||void 0===_b?void 0:_b.height)&&void 0!==_c?_c:300};this.addWidgetToLayout(item,rect,itemRect,4,0)},this.handleBlockTemplateSelected=template=>{this.setState({isLoadingTemplate:!0}),addTemplateRow(this.props.layout.id,"",template).finally((()=>{this.setState({isLoadingTemplate:!1})}))},this.handleScreenTemplateSelected=template=>{this.setState({isLoadingTemplate:!0}),addTemplateScreenGroup(this.props.layout.id,"",template).finally((()=>{this.setState({isLoadingTemplate:!1})}))},this.handlePageTemplateSelected=templatePageJson=>{const appConfigAction=(0,jimu_for_builder.getAppConfigAction)();this.setState({isLoadingTemplate:!0}),this.pageContext.isHeader?appConfigAction.applyHeaderTemplate(templatePageJson).then((()=>{appConfigAction.exec(),jimu_core.CM0.defer((()=>{this.setState({isLoadingTemplate:!1})}))})).finally(null):this.pageContext.isFooter?appConfigAction.applyFooterTemplate(templatePageJson).then((()=>{appConfigAction.exec(),jimu_core.CM0.defer((()=>{this.setState({isLoadingTemplate:!1})}))})).finally(null):appConfigAction.applyPageBodyTemplate(this.pageContext.pageId,templatePageJson).then((()=>{appConfigAction.exec(),jimu_core.CM0.defer((()=>{this.setState({isLoadingTemplate:!1})}))})).finally(null)};const exts=jimu_core.nH3.getInstance().getExtensions(`${jimu_core.vZE.R6.LayoutTransformer}`);if((null==exts?void 0:exts.length)>0){const ext=exts.find((item=>item.layoutType===this.props.layout.type));this.layoutTransform=null==ext?void 0:ext.transformLayout}}componentDidMount(){this.canvasPane=new canvas_pane_CanvasPane(this.canvasRef),this.canvasPane.setSize(this.ref.clientWidth,this.ref.clientHeight)}componentDidUpdate(){this.canvasPane.setSize(this.ref.clientWidth,this.ref.clientHeight)}addWidgetToLayout(draggingItem,containerRect,itemRect,width,insertIndex,appConfig){addBlockToFlowLayout(draggingItem,{targetLayoutId:this.props.layout.id,containerRect,itemRect,width,insertIndex,appConfig}).finally(null)}collectBounds(layoutInfo){const{layout}=this.props;this.childRects=[],this.domRect=this.ref.getBoundingClientRect();const draggableChildren=this.ref.parentNode.querySelectorAll(`div[data-layoutid="${layout.id}"] > div.exb-rnd`);return(null==draggableChildren?void 0:draggableChildren.length)>0&&draggableChildren.forEach((node=>{var _a,_b;const itemId=node.getAttribute("data-layoutitemid");if((layoutInfo.layoutId!==layout.id||layoutInfo.layoutItemId!==itemId)&&(null===(_a=layout.order)||void 0===_a?void 0:_a.includes(itemId))){if(!(null===(_b=layout.content[itemId].setting)||void 0===_b?void 0:_b.isFloating)){const rect=layout_runtime.utils.relativeClientRect(node.getBoundingClientRect(),this.domRect);rect.id=itemId,this.childRects.push(rect)}}})),this.childRects.sort(((a,b)=>a.top-b.top))}createItem(item,total,index,layoutSetting){if(null==item?void 0:item.isPending)return null;const{layouts,layout,itemDraggable,itemSelectable}=this.props,isFirst=function isFirstNonFloatingItem(layoutInfo){const{layoutId,layoutItemId}=layoutInfo,layout=(0,jimu_for_builder.getAppConfigAction)().appConfig.layouts[layoutId];let result=!1;return layout.order.some((id=>{var _a;const item=layout.content[id];return!(null===(_a=item.setting)||void 0===_a?void 0:_a.isFloating)&&!item.isPending&&(result=id===layoutItemId,!0)})),result}({layoutId:layout.id,layoutItemId:item.id}),isLast=function isLastNonFloatingItem(layoutInfo){var _a;const{layoutId,layoutItemId}=layoutInfo,layout=(0,jimu_for_builder.getAppConfigAction)().appConfig.layouts[layoutId];let result=!1;for(let i=layout.order.length-1;i>=0;i--){const id=layout.order[i],item=layout.content[id];if(!(null===(_a=item.setting)||void 0===_a?void 0:_a.isFloating)&&!item.isPending){result=id===layoutItemId;break}}return result}({layoutId:layout.id,layoutItemId:item.id}),itemSetting=item.setting;return item.type===jimu_core.K6q.ScreenGroup?(0,jimu_core.Yac)(ScreenGroup,{key:`${layout.id}_${item.id}`,itemIndex:index,isFirst,isLast,layoutId:layout.id,layoutItemId:item.id,layoutItem:item,theme:this.pageContext.builderTheme,formatMessage:this.pageContext.formatMessage}):(null==itemSetting?void 0:itemSetting.isFloating)?(0,jimu_core.Yac)(floating_layout_item,{key:`${layout.id}_${item.id}`,index,total,builderTheme:this.builderTheme,layouts,layoutId:layout.id,layoutItemId:item.id,layoutItem:item,gutter:layoutSetting.gutter,draggable:itemDraggable,selectable:itemSelectable,onDropAtBoundary:this.handleDropAtBoundary,formatMessage:this.pageContext.formatMessage}):(0,jimu_core.Yac)(builder_layout_item,{key:`${layout.id}_${item.id}`,index,isFirst,isLast,builderTheme:this.builderTheme,layouts,layoutId:layout.id,layoutItemId:item.id,layoutItem:item,gutter:layoutSetting.gutter,draggable:itemDraggable,selectable:itemSelectable,onDropAtBoundary:this.handleDropAtBoundary,formatMessage:this.pageContext.formatMessage})}getActionStyle(){return jimu_core.AHW`
      height: 200px;
      padding: 1rem;
      pointer-events: none;
      z-index: 1;
      .btn-text {
        line-height: 32px;
      }
      .btn {
        margin-right: 2rem;
        background: ${this.builderTheme.ref.palette.neutral[600]};
        &:hover {
          background: ${this.builderTheme.ref.palette.neutral[700]};
        }
      }
      .action-item {
        width: 32px;
      }

      .action-separator {
        .sep {
          width: 65px;
          height: 1px;
          background-color: ${this.builderTheme.ref.palette.neutral[1100]};
        }
        .btn-text {
          margin: 0 13px;
        }
      }
    `}getStyle(){const{builderTheme}=this.pageContext;return jimu_core.AHW`
      & > .trail-container > .builder-layout-item {
        margin-bottom: 10px;
        border-top: 1px dashed ${jimu_core.PLL.rgba(builderTheme.ref.palette.neutral[1e3],.6)};
        border-bottom: 1px dashed ${jimu_core.PLL.rgba(builderTheme.ref.palette.neutral[1e3],.6)};
        z-index: 0;

        .widget-context-menu {
          width: 100%;
          height: auto;
          top: 0;
        }

        &.selected, &.floating {
          z-index: 1;
        }
      }

      body:not(.design-mode) & {
        & > .trail-container > .builder-layout-item {
          margin-bottom: 0;
          border-top: none;
          border-bottom: none;
        }
      }
    `}createActions(blockOnly){const{viewOnly,rootLayoutId}=this.pageContext,{layout}=this.props,isPageBody=!this.pageContext.isHeader&&!this.pageContext.isFooter;return this.state.isLoadingTemplate||!isPageBody||viewOnly||layout.id!==rootLayoutId?null:(0,jimu_core.Yac)(builder_action_block_ActionBlock,{pageContext:this.pageContext,browserSizeMode:this.props.browserSizeMode,blockOnly,onPageTemplateSelected:this.handlePageTemplateSelected,onBlockTemplateSelected:this.handleBlockTemplateSelected,onScreenTemplateSelected:this.handleScreenTemplateSelected})}render(){const{layout,className,isPageItem,layouts,mainSizeMode,browserSizeMode}=this.props;if(null==layout)return null;const outClass=(0,jimu_core.xWm)("layout flow-layout w-100",className),guideVisibleStyle={display:this.state.isDragover?"block":"none"};return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(props=>{var _a;this.builderTheme=props.builderTheme,this.maxPageWidth=props.maxWidth,this.pageContext=props;let targetLayout=layout;layouts[browserSizeMode]!==layout.id&&null!=this.layoutTransform&&(targetLayout=this.layoutTransform(layout,mainSizeMode,browserSizeMode));const content=null!==(_a=targetLayout.order)&&void 0!==_a?_a:[],layoutSetting=jimu_core.CM0.assign({},flow_layout_default_setting.e,targetLayout.setting),mergedStyle=Object.assign({position:"relative"},jimu_ui.styleUtils.toCSSStyle(layoutSetting.style));return(0,jimu_core.Yac)("div",{className:outClass,ref:el=>{this.ref=el},css:this.getStyle(),style:mergedStyle,"data-layoutid":layout.id,onClick:this.handleActivate,onMouseDown:this.handleMouseDown},(0,jimu_core.Yac)(jimu_core.zKZ.Provider,{value:{monitor:!0}},(0,jimu_core.Yac)(jimu_core._kc,{oid:targetLayout.id,"data-layoutid":targetLayout.id,className:"trail-container d-flex flex-column align-items-center",css:jimu_core.AHW`
                    width: 100%;
                  `},!props.viewOnly&&(0,jimu_core.Yac)(droparea_hook_DropArea,{css:flow_layout_builder_layout_dropareaStyle,layouts:this.props.layouts,isRepeat:this.props.isRepeat,highlightDragover:!isPageItem,onDragOver:this.handleDragOver,onDrop:this.handleDrop,onToggleDragoverEffect:this.handleToggleDragoverEffect}),content.length>0&&content.map(((layoutItemId,index)=>this.createItem(targetLayout.content[layoutItemId],content.length,index,layoutSetting))))),!this.state.isLoadingTemplate&&!props.viewOnly&&layout_runtime.utils.isEmptyLayout(targetLayout)&&layout.id===props.rootLayoutId&&this.createActions(!1),content.length>0&&this.createActions(!0),this.state.isLoadingTemplate&&(0,jimu_core.Yac)(jimu_ui.Loading,{type:jimu_ui.LoadingType.Primary}),(0,jimu_core.Yac)("canvas",{css:flow_layout_builder_layout_guideOverlay,style:guideVisibleStyle,ref:el=>{this.canvasRef=el}}))}))}}const flow_layout_builder_layout=jimu_core.E_S.connect(layout_runtime.utils.mapStateToLayoutProps)(flow_layout_builder_layout_Layout);try{layout.displayName="layout",layout.__docgenInfo={description:"",displayName:"layout",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!1,type:{name:"boolean"}},layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"ImmutableObjectMixin<SizeModeLayoutJson> & { readonly [x: string]: string; }"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},isInWidget:{defaultValue:null,description:"",name:"isInWidget",required:!1,type:{name:"boolean"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},isPageItem:{defaultValue:null,description:"",name:"isPageItem",required:!1,type:{name:"boolean"}},itemDraggable:{defaultValue:null,description:"",name:"itemDraggable",required:!1,type:{name:"boolean"}},itemResizable:{defaultValue:null,description:"",name:"itemResizable",required:!1,type:{name:"boolean"}},itemSelectable:{defaultValue:null,description:"",name:"itemSelectable",required:!1,type:{name:"boolean"}},droppable:{defaultValue:null,description:"",name:"droppable",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isItemAccepted:{defaultValue:null,description:"",name:"isItemAccepted",required:!1,type:{name:"(item: LayoutItemConstructorProps, isReplacePlaceholder: boolean) => boolean"}},onItemClick:{defaultValue:null,description:"",name:"onItemClick",required:!1,type:{name:"(e: any, widgetId: string) => void"}},ignoreMinHeight:{defaultValue:null,description:"",name:"ignoreMinHeight",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/flow-layout/builder/layout.tsx#layout"]={docgenInfo:layout.__docgenInfo,name:"layout",path:"../jimu-layouts/lib/flow-layout/builder/layout.tsx#layout"})}catch(__react_docgen_typescript_loader_error){}var edit=__webpack_require__("../jimu-icons/outlined/editor/edit.tsx");const resizeHandlerStyle=jimu_core.AHW`
  .resize-handler {
    height: ${16}px;
    width: 100%;
    cursor: ns-resize;
    position: absolute;
  }
`,maskStyle=jimu_core.AHW`
  position: absolute;
  right: 0;
  top: 0;
  left: 0;
  bottom: 0;
`;function editBtnStyle(theme){return jimu_core.AHW`
    .edit-btn {
      background: ${theme.sys.color.primary.main};
      color: ${theme.ref.palette.neutral[1100]};
      border-radius: 2px;
      &:hover {
        background: ${theme.sys.color.primary.main};
        color: ${theme.ref.palette.black};
      }
    }
  `}function editHeader(){(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.activePagePartChanged(jimu_core.xH7.Header))}function editFooter(){(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.activePagePartChanged(jimu_core.xH7.Footer))}function editBody(){(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.activePagePartChanged(jimu_core.xH7.Body))}function getHeaderLayoutId(){const state=(0,jimu_core.Vp3)().getState(),sizeModeLayout=state.appConfig.header.layout;return layout_runtime.searchUtils.findLayoutId(sizeModeLayout,state.browserSizeMode,state.appConfig.mainSizeMode)}function getFooterLayoutId(){const state=(0,jimu_core.Vp3)().getState(),sizeModeLayout=state.appConfig.footer.layout;return layout_runtime.searchUtils.findLayoutId(sizeModeLayout,state.browserSizeMode,state.appConfig.mainSizeMode)}function getDialogLayoutId(dialogId){var _a;const state=(0,jimu_core.Vp3)().getState(),sizeModeLayout=null===(_a=state.appConfig.dialogs[dialogId])||void 0===_a?void 0:_a.layout;return layout_runtime.searchUtils.findLayoutId(sizeModeLayout,state.browserSizeMode,state.appConfig.mainSizeMode)}function getVisiblePageId(pageStatus){return Object.keys(pageStatus).find((pid=>pageStatus[pid]))}var page_util=__webpack_require__("../jimu-layouts/lib/common/page-util.ts");function page_header_getStyle(header,height,builderTheme,theme){var _a,_b;return jimu_core.AHW`
    ${resizeHandlerStyle};
    ${editBtnStyle(builderTheme)};
    position: relative;
    z-index: 0;
    top: 0;
    display: flex;
    width: 100%;
    height: auto;
    min-height: ${parseFloat(height)}px;
    overflow: hidden;
    background-color: ${header.backgroundColor||(null===(_a=theme.comp)||void 0===_a?void 0:_a.Header.root.vars.bg)||"transparent"};
    background-image: ${header.backgroundIMage};
    background-position: ${header.backgroundPosition};
    color: ${null===(_b=theme.comp)||void 0===_b?void 0:_b.Header.root.vars.color};
    border-bottom: 1px dashed ${jimu_core.PLL.rgba(builderTheme.ref.palette.white,.12)};
    flex: 0 0 auto;

    &:hover {
      .edit-mask {
        display: flex;
      }
    }

    .resize-handler {
      bottom: ${-8}px;
      z-index: 1;
      .handler {
        width: 36px;
        height: 4px;
        background: var(--ref-palette-black);
        border: 1px solid var(--ref-palette-white);
        position: absolute;
        left: 50%;
        bottom: 9px;
        transform: translateX(-50%);
      }
    }

    body.lock-layout &,
    body:not(.design-mode) & {
      border-bottom: none;
      > .resize-handler {
        display: none !important;
      }
    }
    body:not(.design-mode) & {
      position: ${header.sticky?"sticky":"relative"};
      z-index: ${header.sticky?2:"0"};

      .edit-mask, .edit-mask-all {
        display: none !important;
      }
    }
  `}function PageHeader(props){const{header,browserSizeMode,mainSizeMode,activePagePart,pageContext,onHeightChange}=props,isDesignMode=jimu_core.E_S.useSelector((state=>{var _a;return(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design})),headerRef=jimu_core.q_G.useRef(null),height=header.height[browserSizeMode]||header.height[mainSizeMode]||page_util.q8,layout=header.layout,viewOnly=!layout[browserSizeMode],builderTheme=pageContext.builderTheme;jimu_core.q_G.useEffect((()=>{let interactble;return headerRef.current&&(interactble=function page_header_bindResizeHandler(headerRef){let dh,initHeight;return interact_min_default()(headerRef).origin("parent").resizable({inertia:!1,edges:{bottom:".resize-handler"},onstart:event=>{event.stopPropagation(),dh=0,initHeight=headerRef.getBoundingClientRect().height,headerRef.style.minHeight="0px"},onmove:event=>{event.stopPropagation();const deltaRect=event.deltaRect;dh+=deltaRect.height,headerRef.style.height=`${initHeight+dh}px`},onend:event=>{event.stopPropagation(),headerRef.style.height=null,headerRef.style.minHeight=null,(0,jimu_for_builder.getAppConfigAction)().editHeaderProperty(`height.${layout_runtime.utils.getCurrentSizeMode()}`,Math.round(initHeight+dh)).exec()}})}(headerRef.current)),()=>{interactble&&interactble.unset()}}),[]);const headerLayoutId=getHeaderLayoutId(),pageContextValue=jimu_core.q_G.useMemo((()=>Object.assign(Object.assign({},pageContext),{isHeader:!0,rootLayoutId:headerLayoutId,viewOnly:viewOnly||isDesignMode&&activePagePart!==jimu_core.xH7.Header})),[pageContext,headerLayoutId,viewOnly,activePagePart,isDesignMode]),handleSizeChange=jimu_core.q_G.useCallback((({width,height})=>{onHeightChange(Math.round(height))}),[onHeightChange]);return(0,jimu_core.Yac)(layout_runtime.PageContext.Provider,{value:pageContextValue},(0,jimu_core.Yac)("div",{className:"header",css:page_header_getStyle(header,height,pageContext.builderTheme,pageContext.theme),ref:el=>{headerRef.current=el}},(0,jimu_core.Yac)("div",{className:"w-100 h-100",css:jimu_core.AHW`
            overflow: auto;
            display: flex;
            position: relative;
            z-index: 0;
            min-height: ${parseFloat(height)}px;
          `},(0,jimu_core.Yac)(layout_entry,{layouts:layout,isPageItem:!0,visible:!0})),!viewOnly&&(0,jimu_core.Yac)("span",{className:"resize-handler"},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("handler",{"d-none":activePagePart!==jimu_core.xH7.Header})})),activePagePart!==jimu_core.xH7.Header&&!viewOnly&&(0,jimu_core.Yac)("div",{className:"edit-mask-all",css:jimu_core.AHW`
              ${maskStyle};
              background: ${activePagePart===jimu_core.xH7.Body?"transparent":jimu_core.PLL.rgba(builderTheme.ref.palette.neutral[500],.6)};
              z-index: 1;
            `,onClick:editBody}),activePagePart===jimu_core.xH7.Body&&(!viewOnly||browserSizeMode===mainSizeMode)&&(0,jimu_core.Yac)("div",{className:"edit-mask justify-content-center align-items-center",css:jimu_core.AHW`
              ${maskStyle};
              background: ${jimu_core.PLL.rgba(builderTheme.ref.palette.neutral[500],.6)};
              z-index: 1;
              display: none;
            `},(0,jimu_core.Yac)(jimu_ui.Button,{className:"edit-btn btn-large border-0",onClick:editHeader},(0,jimu_core.Yac)(edit.x,{size:"m"}),pageContext.formatMessage("editHeader"))),(0,jimu_core.Yac)(jimu_core.cQZ,{targetRef:headerRef,handleHeight:!0,handleWidth:!1,onResize:handleSizeChange})))}try{PageHeader.displayName="PageHeader",PageHeader.__docgenInfo={description:"",displayName:"PageHeader",props:{header:{defaultValue:null,description:"",name:"header",required:!0,type:{name:"IMHeaderJson"}},activePagePart:{defaultValue:null,description:"",name:"activePagePart",required:!0,type:{name:"enum",value:[{value:'"HEADER"'},{value:'"FOOTER"'},{value:'"BODY"'}]}},browserSizeMode:{defaultValue:null,description:"",name:"browserSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},mainSizeMode:{defaultValue:null,description:"",name:"mainSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},pageContext:{defaultValue:null,description:"",name:"pageContext",required:!0,type:{name:"ImmutableObject<PageContextProps>"}},onHeightChange:{defaultValue:null,description:"",name:"onHeightChange",required:!0,type:{name:"(height: number) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/page-header.tsx#PageHeader"]={docgenInfo:PageHeader.__docgenInfo,name:"PageHeader",path:"../jimu-layouts/lib/builder/page-header.tsx#PageHeader"})}catch(__react_docgen_typescript_loader_error){}function page_footer_getStyle(footer,height,builderTheme,theme){var _a,_b;return jimu_core.AHW`
    ${resizeHandlerStyle};
    ${editBtnStyle(builderTheme)};
    display: flex;
    position: relative;
    width: 100%;
    height: auto;
    min-height: ${parseFloat(height)}px;
    overflow: hidden;
    background-color: ${footer.backgroundColor||(null===(_a=theme.comp)||void 0===_a?void 0:_a.Footer.root.vars.bg)||"transparent"};
    background-image: ${footer.backgroundIMage};
    background-position: ${footer.backgroundPosition};
    color: ${null===(_b=theme.comp)||void 0===_b?void 0:_b.Footer.root.vars.color};
    border-top: 1px dashed ${jimu_core.PLL.rgba(builderTheme.ref.palette.white,.12)};
    z-index: 0;

    .resize-handler {
      top: ${-8}px;
      z-index: 1;
      .handler {
        width: 36px;
        height: 4px;
        background: var(--ref-palette-black);
        border: 1px solid var(--ref-palette-white);
        position: absolute;
        left: 50%;
        top: 9px;
        transform: translateX(-50%);
      }
    }

    &:hover {
      .edit-mask {
        display: flex;
      }
    }

    body.lock-layout &,
    body:not(.design-mode) & {
      > .resize-handler {
        display: none !important;
      }
    }
    body:not(.design-mode) & {
      .edit-mask, .edit-mask-all {
        display: none !important;
      }
    }
  `}function PageFooter(props){const{footer,browserSizeMode,mainSizeMode,activePagePart,pageContext,onHeightChange}=props,isDesignMode=jimu_core.E_S.useSelector((state=>{var _a;return(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design})),footerRef=jimu_core.q_G.useRef(null),height=footer.height[browserSizeMode]||footer.height[mainSizeMode]||page_util.kA,layout=footer.layout,viewOnly=!layout[browserSizeMode],builderTheme=pageContext.builderTheme;jimu_core.q_G.useEffect((()=>{let interactble;return footerRef.current&&(interactble=function page_footer_bindResizeHandler(footerRef){let dh=0,initHeight=0,initDeviceHeight=0;const deviceFrame=window.parent.document.querySelector(".device-frame");return interact_min_default()(footerRef).origin("parent").resizable({inertia:!1,edges:{top:".resize-handler"},onstart:event=>{event.stopPropagation(),dh=0,initHeight=footerRef.getBoundingClientRect().height,initDeviceHeight=(null==deviceFrame?void 0:deviceFrame.getBoundingClientRect().height)||0},onmove:event=>{event.stopPropagation();const deltaRect=event.deltaRect;dh+=deltaRect.height,footerRef.style.height=`${initHeight+dh}px`,deviceFrame&&(deviceFrame.style.height=`${initDeviceHeight+dh}px`)},onend:event=>{event.stopPropagation(),footerRef.style.height=null,deviceFrame&&(deviceFrame.style.height=`${initDeviceHeight}px`),(0,jimu_for_builder.getAppConfigAction)().editFooterProperty(`height.${layout_runtime.utils.getCurrentSizeMode()}`,Math.round(initHeight+dh)).exec()}})}(footerRef.current)),()=>{interactble&&interactble.unset()}}),[]);const footerLayoutId=getFooterLayoutId(),pageContextValue=jimu_core.q_G.useMemo((()=>Object.assign(Object.assign({},pageContext),{isFooter:!0,rootLayoutId:footerLayoutId,viewOnly:viewOnly||isDesignMode&&activePagePart!==jimu_core.xH7.Footer})),[pageContext,footerLayoutId,viewOnly,activePagePart,isDesignMode]),handleSizeChange=jimu_core.q_G.useCallback((({width,height})=>{onHeightChange(Math.round(height))}),[onHeightChange]);return(0,jimu_core.Yac)(layout_runtime.PageContext.Provider,{value:pageContextValue},(0,jimu_core.Yac)("div",{className:"footer",css:page_footer_getStyle(footer,height,pageContext.builderTheme,pageContext.theme),ref:el=>{footerRef.current=el}},!viewOnly&&(0,jimu_core.Yac)("span",{className:"resize-handler"},(0,jimu_core.Yac)("div",{className:(0,jimu_core.xWm)("handler",{"d-none":activePagePart!==jimu_core.xH7.Footer})})),(0,jimu_core.Yac)("div",{className:"w-100 h-100",css:jimu_core.AHW`
            overflow: auto;
            display: flex;
            position: relative;
            z-index: 0;
            min-height: ${parseFloat(height)}px;
          `},(0,jimu_core.Yac)(layout_entry,{layouts:layout,isPageItem:!0,visible:!0})),activePagePart!==jimu_core.xH7.Footer&&!viewOnly&&(0,jimu_core.Yac)("div",{className:"edit-mask-all",css:jimu_core.AHW`
              ${maskStyle};
              background: ${activePagePart===jimu_core.xH7.Body?"transparent":jimu_core.PLL.rgba(builderTheme.ref.palette.neutral[500],.6)};
              z-index: 1;
            `,onClick:editBody}),activePagePart===jimu_core.xH7.Body&&(!viewOnly||browserSizeMode===mainSizeMode)&&(0,jimu_core.Yac)("div",{className:"edit-mask justify-content-center align-items-center",css:jimu_core.AHW`
              ${maskStyle};
              background: ${jimu_core.PLL.rgba(builderTheme.ref.palette.neutral[500],.6)};
              z-index: 1;
              display: none;
            `},(0,jimu_core.Yac)(jimu_ui.Button,{className:"edit-btn btn-large border-0",onClick:editFooter},(0,jimu_core.Yac)(edit.x,{size:"m"}),pageContext.formatMessage("editFooter"))),(0,jimu_core.Yac)(jimu_core.cQZ,{targetRef:footerRef,handleHeight:!0,handleWidth:!1,onResize:handleSizeChange})))}try{PageFooter.displayName="PageFooter",PageFooter.__docgenInfo={description:"",displayName:"PageFooter",props:{footer:{defaultValue:null,description:"",name:"footer",required:!0,type:{name:"IMFooterJson"}},activePagePart:{defaultValue:null,description:"",name:"activePagePart",required:!0,type:{name:"enum",value:[{value:'"HEADER"'},{value:'"FOOTER"'},{value:'"BODY"'}]}},browserSizeMode:{defaultValue:null,description:"",name:"browserSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},mainSizeMode:{defaultValue:null,description:"",name:"mainSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},pageContext:{defaultValue:null,description:"",name:"pageContext",required:!0,type:{name:"ImmutableObject<PageContextProps>"}},onHeightChange:{defaultValue:null,description:"",name:"onHeightChange",required:!0,type:{name:"(height: number) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/page-footer.tsx#PageFooter"]={docgenInfo:PageFooter.__docgenInfo,name:"PageFooter",path:"../jimu-layouts/lib/builder/page-footer.tsx#PageFooter"})}catch(__react_docgen_typescript_loader_error){}var controller_panel_util=__webpack_require__("../jimu-layouts/lib/controller-panel/util.ts"),up_double=__webpack_require__("../jimu-icons/svg/outlined/directional/up-double.svg"),up_double_default=__webpack_require__.n(up_double);const{animated:panel_animated,useSpring}=jimu_core.ozl,panel_style=jimu_core.AHW`
  position: relative;
  display: flex;
  background-color: var(--ref-palette-white);
  box-shadow: 0px 0px 10px 1px rgba(0, 0, 0, 0.2);
  .panel-header {
    > .actions > .action-collapse {
      svg {
        transition: transform 0.3s ease-in-out;
      }
      &.collapsed svg {
        transform: rotate(180deg);
      }
    }
  }
  .panel-content {
    position: relative;
    overflow: hidden;

    .widget-content {
      z-index: 0;
    }

    .widget-mask {
      position: absolute;
      background: transparent;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      z-index: 1;
    }
  }
`,panel_shiftOptions={rootBoundary:"viewport",crossAxis:!0},panel_flipOptions={fallbackPlacements:["top-start","bottom-start","right-start","left-start"]};function panel_Panel(props){const{layoutId,layoutItemId,controllerId,minimized,onClick,onToggle,onClose}=props,[mounted,setMounted]=jimu_core.q_G.useState(!1),ref=jimu_core.q_G.useRef(),onCloseRef=jimu_core.JLE.useLatest(onClose),onToggleRef=jimu_core.JLE.useLatest(onToggle),translate=jimu_core.JLE.useTranslation(),isDesignMode=jimu_core.E_S.useSelector((state=>state.appRuntimeInfo.appMode===jimu_core.$0N.Design)),selected=jimu_core.E_S.useSelector((state=>{var _a;const selection=state.appRuntimeInfo.selection;if(!selection)return!1;if(layoutId===selection.layoutId&&layoutItemId===selection.layoutItemId)return!0;return null!=(null===(_a=ref.current)||void 0===_a?void 0:_a.querySelector(`div.builder-layout-item[data-layoutid="${selection.layoutId}"][data-layoutitemid="${selection.layoutItemId}"]`))})),widgetId=jimu_core.E_S.useSelector((state=>state.appConfig.layouts[layoutId].content[layoutItemId].widgetId)),hasEmbeddedLayout=jimu_core.E_S.useSelector((state=>{var _a,_b,_c;const widgetJson=state.appConfig.widgets[widgetId];return(null===(_b=null===(_a=null==widgetJson?void 0:widgetJson.manifest)||void 0===_a?void 0:_a.properties)||void 0===_b?void 0:_b.hasEmbeddedLayout)&&Object.keys(null!==(_c=widgetJson.layouts)&&void 0!==_c?_c:{}).length>0})),isFunctionalWidget=jimu_core.E_S.useSelector((state=>{var _a;const widgetJson=state.appConfig.widgets[widgetId];return(null===(_a=null==widgetJson?void 0:widgetJson.manifest)||void 0===_a?void 0:_a.widgetType)!==jimu_core.xOw.Layout})),supportInlineEditing=jimu_core.E_S.useSelector((state=>{var _a,_b,_c;const widgetJson=state.appConfig.widgets[widgetId];return null!==(_c=null===(_b=null===(_a=null==widgetJson?void 0:widgetJson.manifest)||void 0===_a?void 0:_a.properties)||void 0===_b?void 0:_b.supportInlineEditing)&&void 0!==_c&&_c})),isInlineEditing=jimu_core.E_S.useSelector((state=>{const widgetRuntimeInfo=state.widgetsRuntimeInfo[widgetId];return supportInlineEditing&&(null==widgetRuntimeInfo?void 0:widgetRuntimeInfo.isInlineEditing)})),isOpen=jimu_core.E_S.useSelector((state=>{var _a;const info=null===(_a=state.widgetsRuntimeInfo)||void 0===_a?void 0:_a[widgetId];return(null==info?void 0:info.state)===jimu_core.YGz.Opened})),label=jimu_core.E_S.useSelector((state=>{const widgetJson=state.appConfig.widgets[widgetId];return null==widgetJson?void 0:widgetJson.label}),jimu_core.E_S.shallowEqual),widgetClassLoaded=jimu_core.E_S.useSelector((state=>{var _a;const widgetRuntimeInfo=state.widgetsRuntimeInfo[widgetId];return null!==(_a=null==widgetRuntimeInfo?void 0:widgetRuntimeInfo.isClassLoaded)&&void 0!==_a&&_a})),effect=jimu_core.E_S.useSelector((state=>state.appConfig.controllerPanels[controllerId].effect)),animationObj=jimu_core.q_G.useMemo((()=>{var _a,_b;return(null==effect?void 0:effect.type)&&effect.type!==jimu_core.J6N.None?(0,jimu_core.aTz)(effect.type,{configType:null===(_a=effect.option)||void 0===_a?void 0:_a.configType,direction:null===(_b=effect.option)||void 0===_b?void 0:_b.direction}):null}),[effect]),[effectProps,api]=useSpring((()=>jimu_core._tX),[animationObj]),handleClose=jimu_core.q_G.useCallback((e=>{onCloseRef.current(e,widgetId);const button=document.querySelector(`.widget-controller .avatar-card[data-widgetid='${widgetId}'] button`);if(button)(0,jimu_core.u02)(button);else{const moreButton=document.querySelector(`[data-widgetid='${controllerId}'] .popup-more-button button`);(0,jimu_core.u02)(moreButton)}}),[onCloseRef,widgetId,controllerId]);(0,jimu_ui.useTrapFocusBySelector)(ref,!0,!0,".first-node",".last-virtual-node",mounted&&isOpen);const{viewOnly}=jimu_core.q_G.useContext(layout_runtime.PageContext),isExpressMode=jimu_core.E_S.useSelector((state=>state.appRuntimeInfo.appMode===jimu_core.$0N.Express)),notMainSizeMode=jimu_core.E_S.useSelector((state=>state.browserSizeMode!==state.appConfig.mainSizeMode)),handleClick=jimu_core.q_G.useCallback((e=>{var _a;if(e.stopPropagation(),viewOnly||isExpressMode&&notMainSizeMode)return;const selection=null===(_a=(0,jimu_core.Vp3)().getState().appRuntimeInfo)||void 0===_a?void 0:_a.selection;selection&&selection.layoutId===layoutId&&selection.layoutItemId===layoutItemId||(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged({layoutId,layoutItemId})),null==onClick||onClick(e)}),[isExpressMode,layoutId,layoutItemId,notMainSizeMode,onClick,viewOnly]),handleDoubleClick=jimu_core.q_G.useCallback((e=>{e.stopPropagation();const{browserSizeMode,appConfig:{mainSizeMode}}=(0,jimu_core.Vp3)().getState();!supportInlineEditing||viewOnly||jimu_core.WpD.isExpressMode()&&browserSizeMode!==mainSizeMode||(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.setWidgetIsInlineEditingState(widgetId,!0))}),[supportInlineEditing,viewOnly,widgetId]);let WidgetClass;jimu_core.q_G.useEffect((()=>{isOpen&&!mounted&&(setMounted(!0),jimu_core.SS0.getInstance().loadWidgetClass(widgetId).catch((err=>{console.log(err)}))),isOpen&&!selected&&isDesignMode&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.closeWidget(widgetId))}),[isOpen,selected,widgetId,mounted,isDesignMode]),jimu_core.q_G.useEffect((()=>{isOpen&&!isDesignMode&&null!=animationObj&&api.start(Object.assign(Object.assign({},animationObj.animateProps()),{onRest:()=>{jimu_core.CM0.defer((()=>{ref.current.style.clipPath=null,ref.current.parentElement.style.clipPath=null}))}}))}),[api,isOpen,isDesignMode,animationObj]),mounted&&widgetClassLoaded&&(WidgetClass=jimu_core.SS0.getInstance().getWidgetClass(widgetId));const showMask=isDesignMode&&!isInlineEditing&&isFunctionalWidget&&!hasEmbeddedLayout,theme=(0,jimu_theme.wE)(),layoutItem=(0,jimu_core.Vp3)().getState().appConfig.layouts[layoutId].content[layoutItemId],handleLastVirtualNodeFocus=(0,controller_panel_util.useHandleLastVirtualNodeFocus)(ref.current,"first-node","last-virtual-node"),actions=jimu_core.q_G.useMemo((()=>[{name:"collapse",className:minimized?"first-node action-collapse collapsed":"first-node action-collapse",label:translate(minimized?"expand":"collapse"),icon:up_double_default(),onClick:onToggleRef.current},{name:"close",className:"action-close",label:translate("close"),icon:close_default(),onClick:handleClose}]),[handleClose,minimized,onToggleRef,translate]);return(0,jimu_core.Yac)(panel_animated.div,{className:(0,jimu_core.xWm)("controller-panel flex-column w-100 h-100",{"d-none":!mounted||!isOpen}),css:panel_style,style:null!=animationObj?effectProps:null,onClick:handleClick,onDoubleClick:handleDoubleClick,ref},(0,jimu_core.Yac)(jimu_ui.PanelHeader,{level:2,type:"primary",title:label,actions,moveable:!1}),(0,jimu_core.Yac)("div",{className:"panel-content d-flex flex-grow-1"},!widgetClassLoaded&&(0,jimu_core.Yac)(jimu_ui.Loading,{type:jimu_ui.LoadingType.Donut}),WidgetClass&&(0,jimu_core.Yac)("div",{className:"w-100 h-100 widget-content p-1"},(0,jimu_core.Yac)(jimu_core.tHk,null,(0,jimu_core.Yac)(WidgetClass,{widgetId,layoutId,layoutItemId}),isDesignMode&&(0,jimu_core.Yac)(layout_item_toolbar_LayoutItemToolbar,{layoutId,layoutItem,refElement:ref.current,shiftOptions:panel_shiftOptions,flipOptions:panel_flipOptions,builderTheme:theme,formatMessage:translate,showDefaultTools:!1}))),showMask&&(0,jimu_core.Yac)("div",{className:"widget-mask"}),(0,jimu_core.Yac)("button",{className:"sr-only last-virtual-node",onKeyUp:handleLastVirtualNodeFocus})))}try{panel_Panel.displayName="Panel",panel_Panel.__docgenInfo={description:"",displayName:"Panel",props:{controllerId:{defaultValue:null,description:"",name:"controllerId",required:!0,type:{name:"string"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},minimized:{defaultValue:null,description:"",name:"minimized",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"(e: any, string: any) => void"}},onToggle:{defaultValue:null,description:"",name:"onToggle",required:!0,type:{name:"() => void"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/controller-panel/builder/panel.tsx#Panel"]={docgenInfo:panel_Panel.__docgenInfo,name:"Panel",path:"../jimu-layouts/lib/controller-panel/builder/panel.tsx#Panel"})}catch(__react_docgen_typescript_loader_error){}const{useSpring:use_animation_useSpring}=jimu_core.ozl;function useAnimation(props){const{controllerId}=props,previewId=jimu_core.E_S.useSelector((state=>{var _a;const animationPreview=null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.animationPreview;return(null==animationPreview?void 0:animationPreview.controllerId)===controllerId?animationPreview.id:-1})),effect=jimu_core.E_S.useSelector((state=>state.appConfig.controllerPanels[controllerId].effect)),animationObj=jimu_core.q_G.useMemo((()=>{var _a,_b;return(null==effect?void 0:effect.type)&&effect.type!==jimu_core.J6N.None?(0,jimu_core.aTz)(effect.type,{configType:null===(_a=effect.option)||void 0===_a?void 0:_a.configType,direction:null===(_b=effect.option)||void 0===_b?void 0:_b.direction}):null}),[effect]),[effectProps,api]=use_animation_useSpring((()=>jimu_core._tX),[animationObj]);return jimu_core.q_G.useEffect((()=>{previewId>0&&null!=animationObj&&api.start(Object.assign(Object.assign({},animationObj.animateProps()),{onRest:()=>{(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.clearAnimationPreview())}}))}),[api,previewId,animationObj]),null!=animationObj?effectProps:null}try{useAnimation.displayName="useAnimation",useAnimation.__docgenInfo={description:"",displayName:"useAnimation",props:{controllerId:{defaultValue:null,description:"",name:"controllerId",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/controller-panel/builder/use-animation.tsx#useAnimation"]={docgenInfo:useAnimation.__docgenInfo,name:"useAnimation",path:"../jimu-layouts/lib/controller-panel/builder/use-animation.tsx#useAnimation"})}catch(__react_docgen_typescript_loader_error){}const{animated:layout_animated}=jimu_core.ozl;function ControllerPanelBuilder(props){var _a,_b,_c,_d;const{controllerId,selected,innerSelected,isDesignMode}=props,ref=jimu_core.q_G.useRef(),[isResizing,setIsResizing]=jimu_core.q_G.useState(!1),[size,setSize]=jimu_core.q_G.useState(),[minimized,setMinimized]=jimu_core.q_G.useState(!1),innerLayoutId=jimu_core.E_S.useSelector((state=>{const controllerJson=state.appConfig.widgets[controllerId],layoutName=controllerJson.manifest.layouts[0].name,sizeModeLayouts=controllerJson.layouts[layoutName];return layout_runtime.searchUtils.findLayoutId(sizeModeLayouts,state.browserSizeMode,state.appConfig.mainSizeMode)})),items=jimu_core.E_S.useSelector((state=>{var _a;const layout=state.appConfig.layouts[innerLayoutId];if(!layout)return"";const widgetsJson=state.appConfig.widgets,itemIds=Object.keys(null!==(_a=layout.content)&&void 0!==_a?_a:{}).filter((itemId=>{const layoutItem=layout.content[itemId],widgetJson=widgetsJson[null==layoutItem?void 0:layoutItem.widgetId];return null!=(null==layoutItem?void 0:layoutItem.widgetId)&&!layoutItem.isPending&&!(null==widgetJson?void 0:widgetJson.offPanel)}));return itemIds.sort(),itemIds.join(",")})),hasItemOpened=jimu_core.E_S.useSelector((state=>{var _a,_b;if(isDesignMode)return!1;const widgetsJson=state.appConfig.widgets,openedWidgets=Object.keys(null!==(_a=state.widgetsRuntimeInfo)&&void 0!==_a?_a:{}).filter((widgetId=>{var _a;return state.widgetsRuntimeInfo[widgetId].state===jimu_core.YGz.Opened&&!(null===(_a=widgetsJson[widgetId])||void 0===_a?void 0:_a.offPanel)})),layout=state.appConfig.layouts[innerLayoutId];return Object.keys(null!==(_b=layout.content)&&void 0!==_b?_b:{}).some((itemId=>{const layoutItem=layout.content[itemId];return null!=(null==layoutItem?void 0:layoutItem.widgetId)&&!layoutItem.isPending&&openedWidgets.includes(layoutItem.widgetId)}))})),itemIdList=jimu_core.q_G.useMemo((()=>items.split(",").filter((id=>""!==id))),[items]),panelJson=jimu_core.E_S.useSelector((state=>state.appConfig.controllerPanels[controllerId])),animationStyle=useAnimation({controllerId});jimu_core.q_G.useEffect((()=>{let width,height;const widthRatio=((null==panelJson?void 0:panelJson.position)||"").includes("CENTER")?2:1,heightRatio=((null==panelJson?void 0:panelJson.position)||"").includes("MIDDLE")?2:1,onResizeStart=(_,initWidth,initHeight)=>{width=initWidth,height=initHeight,setIsResizing(!0),setSize({dx:0,dy:0,dw:0,dh:0,width:initWidth,height:initHeight})},onResizing=(_,dx,dy,dw,dh)=>{setSize({dx,dy,dw,dh,width:width+dw*widthRatio,height:height+dh*heightRatio})},onResizeEnd=(_,dx,dy,dw,dh)=>{setIsResizing(!1),function updateControllerStyle(options){const{controllerId,dx,dy,dw,dh,width,height}=options,appConfigAction=(0,jimu_for_builder.getAppConfigAction)();let originStyle=appConfigAction.appConfig.controllerPanels[controllerId];originStyle.widthMode===layout_runtime.LayoutItemSizeModes.Stretch?0!==dw&&(originStyle=0!==dx?layout_runtime.utils.isPercentage(originStyle.left)?originStyle.set("left",`${(parseFloat(originStyle.left)+100*dx/window.innerWidth).toFixed(2)}%`):originStyle.set("left",`${Math.round(parseFloat(originStyle.left)+dx)}px`):layout_runtime.utils.isPercentage(originStyle.right)?originStyle.set("right",`${(parseFloat(originStyle.right)-100*dw/window.innerWidth).toFixed(2)}%`):originStyle.set("right",`${Math.round(parseFloat(originStyle.right)-dw)}px`)):originStyle=layout_runtime.utils.isPercentage(originStyle.width)?originStyle.set("width",`${(100*width/window.innerWidth).toFixed(2)}%`):originStyle.set("width",`${Math.round(width)}px`),originStyle.heightMode===layout_runtime.LayoutItemSizeModes.Stretch?0!==dh&&(originStyle=0!==dy?layout_runtime.utils.isPercentage(originStyle.top)?originStyle.set("top",`${(parseFloat(originStyle.top)+100*dy/window.innerHeight).toFixed(2)}%`):originStyle.set("top",`${Math.round(parseFloat(originStyle.top)+dy)}px`):layout_runtime.utils.isPercentage(originStyle.bottom)?originStyle.set("bottom",`${(parseFloat(originStyle.bottom)-100*dh/window.innerHeight).toFixed(2)}%`):originStyle.set("bottom",`${Math.round(parseFloat(originStyle.bottom)-dh)}px`)):originStyle=layout_runtime.utils.isPercentage(originStyle.height)?originStyle.set("height",`${(100*height/window.innerHeight).toFixed(2)}%`):originStyle.set("height",`${Math.round(height)}px`),appConfigAction.editControllerPanel(controllerId,originStyle).exec()}({controllerId,dx,dy,dw,dh,width:width+dw*widthRatio,height:height+dh*heightRatio})};if(ref.current){bindResizeHandler(interact_min_default()(ref.current).origin("parent"),{layoutItemId:"controller",restrictEdges:!0,onResizeStart,onResizing,onResizeEnd})}return()=>{}}),[controllerId,null==panelJson?void 0:panelJson.position]);const handleClick=jimu_core.q_G.useCallback((e=>{e.stopPropagation()}),[]),toggleMinimized=jimu_core.q_G.useCallback((()=>{setMinimized(!minimized)}),[minimized]),handleClose=jimu_core.q_G.useCallback(((e,widgetId)=>{e.stopPropagation(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged(null)),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.closeWidget(widgetId))}),[]),visible=isDesignMode?selected||innerSelected:hasItemOpened;let mergedStyle=animationStyle;const panelTransform=(0,controller_panel_util.panelTransformStyle)(panelJson);return null!=panelTransform&&(mergedStyle=Object.assign({},{transform:panelTransform},animationStyle)),(0,jimu_core.Yac)(layout_animated.div,{ref,style:mergedStyle,css:(()=>{const theme=(0,jimu_theme.wE)();if(isResizing){let hPos,vPos;return panelJson.widthMode===layout_runtime.LayoutItemSizeModes.Stretch&&(hPos=jimu_core.AHW`
          left: calc(${panelJson.left} + ${size.dx}px);
          right: ${0===size.dx?`calc(${panelJson.right} - ${size.dw}px)`:panelJson.right};
        `),panelJson.heightMode===layout_runtime.LayoutItemSizeModes.Stretch&&(vPos=jimu_core.AHW`
          top: calc(${panelJson.top} + ${size.dy}px);
          bottom: ${0===size.dy?`calc(${panelJson.bottom} - ${size.dh}px)`:panelJson.bottom};
        `),jimu_core.AHW`
        ${(0,controller_panel_util.convertToStyle)(panelJson)};
        display: ${visible?"block":"none"};
        width: ${panelJson.widthMode!==layout_runtime.LayoutItemSizeModes.Stretch?size.width+"px":"auto"};
        height: ${panelJson.heightMode!==layout_runtime.LayoutItemSizeModes.Stretch?size.height+"px":"auto"};
        ${hPos}
        ${vPos}
        border: ${selected?"1px solid var(--sys-color-primary-main)":"none"};
        background: ${selected?jimu_core.PLL.rgba(theme.sys.color.primary.main,.2):"transparent"};
      `}return jimu_core.AHW`
      ${(0,controller_panel_util.convertToStyle)(panelJson)};
      display: ${visible?"block":"none"};
      height: ${minimized?"36px":null==panelJson?void 0:panelJson.height};
      border: ${selected?"1px solid var(--sys-color-primary-main)":"none"};
      transition: height 0.3s ease-in-out;
      background: ${selected?jimu_core.PLL.rgba(theme.sys.color.primary.main,.2):"transparent"};
    `})(),onClick:handleClick,className:"panel-container"},selected&&(0,jimu_core.Yac)(ResizeHandlers,{left:!(null===(_a=null==panelJson?void 0:panelJson.position)||void 0===_a?void 0:_a.includes("LEFT"))||panelJson.widthMode===layout_runtime.LayoutItemSizeModes.Stretch,right:!(null===(_b=null==panelJson?void 0:panelJson.position)||void 0===_b?void 0:_b.includes("RIGHT"))||panelJson.widthMode===layout_runtime.LayoutItemSizeModes.Stretch,top:!(null===(_c=null==panelJson?void 0:panelJson.position)||void 0===_c?void 0:_c.includes("TOP"))||panelJson.heightMode===layout_runtime.LayoutItemSizeModes.Stretch,bottom:!(null===(_d=null==panelJson?void 0:panelJson.position)||void 0===_d?void 0:_d.includes("BOTTOM"))||panelJson.heightMode===layout_runtime.LayoutItemSizeModes.Stretch}),(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,itemIdList.map((itemId=>(0,jimu_core.Yac)(panel_Panel,{key:itemId,controllerId,layoutId:innerLayoutId,layoutItemId:itemId,minimized,onToggle:toggleMinimized,onClose:handleClose})))))}try{ControllerPanelBuilder.displayName="ControllerPanelBuilder",ControllerPanelBuilder.__docgenInfo={description:"",displayName:"ControllerPanelBuilder",props:{controllerId:{defaultValue:null,description:"",name:"controllerId",required:!0,type:{name:"string"}},selected:{defaultValue:null,description:"",name:"selected",required:!0,type:{name:"boolean"}},innerSelected:{defaultValue:null,description:"",name:"innerSelected",required:!0,type:{name:"boolean"}},isDesignMode:{defaultValue:null,description:"",name:"isDesignMode",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/controller-panel/builder/layout.tsx#ControllerPanelBuilder"]={docgenInfo:ControllerPanelBuilder.__docgenInfo,name:"ControllerPanelBuilder",path:"../jimu-layouts/lib/controller-panel/builder/layout.tsx#ControllerPanelBuilder"})}catch(__react_docgen_typescript_loader_error){}function ControllerPanelGroup(props){const{pageId}=props,controllerInfo=jimu_core.E_S.useSelector((state=>(0,controller_panel_util.findPageRelatedControllerIds)(state.appConfig,pageId,state.browserSizeMode))),controllerIds=jimu_core.q_G.useMemo((()=>controllerInfo.split(",").filter((id=>""!==id))),[controllerInfo]),isDesignMode=jimu_core.E_S.useSelector((state=>state.appRuntimeInfo.appMode===jimu_core.$0N.Design)),[controllerId,descendantWidgetId]=jimu_core.E_S.useSelector((state=>{var _a,_b;if(!isDesignMode)return[null,null];const selection=state.appRuntimeInfo.selection;if(!selection)return[null,null];const{layoutId,layoutItemId}=selection,layoutItem=state.appConfig.layouts[layoutId].content[layoutItemId];if((null==layoutItem?void 0:layoutItem.type)===jimu_core.K6q.Widget&&layoutItem.widgetId){const widgetJson=state.appConfig.widgets[layoutItem.widgetId];if("widgets/common/controller/"===(null==widgetJson?void 0:widgetJson.uri)&&(null===(_a=state.appConfig.controllerPanels)||void 0===_a?void 0:_a[layoutItem.widgetId]))return[layoutItem.widgetId,null]}const findParentLayoutInfo=parent=>{var _a,_b,_c,_d,_e,_f,_g,_h;switch(null==parent?void 0:parent.type){case jimu_core.$4y.View:{const viewId=parent.id,sectionId=state.appConfig.views[viewId].parent,sectionJson=state.appConfig.sections[sectionId],layoutInfo=(null===(_b=null===(_a=sectionJson.parent)||void 0===_a?void 0:_a[state.browserSizeMode])||void 0===_b?void 0:_b[0])||(null===(_d=null===(_c=sectionJson.parent)||void 0===_c?void 0:_c[state.appConfig.mainSizeMode])||void 0===_d?void 0:_d[0]),layout=state.appConfig.layouts[null==layoutInfo?void 0:layoutInfo.layoutId];return null==layout?void 0:layout.parent}case jimu_core.$4y.Widget:{const wId=parent.id,wJson=state.appConfig.widgets[wId],layoutInfo=(null===(_f=null===(_e=wJson.parent)||void 0===_e?void 0:_e[state.browserSizeMode])||void 0===_f?void 0:_f[0])||(null===(_h=null===(_g=wJson.parent)||void 0===_g?void 0:_g[state.appConfig.mainSizeMode])||void 0===_h?void 0:_h[0]),layout=state.appConfig.layouts[null==layoutInfo?void 0:layoutInfo.layoutId];return null==layout?void 0:layout.parent}default:return null}};let parentInfo=state.appConfig.layouts[layoutId].parent;for(;parentInfo;){if(parentInfo.type===jimu_core.$4y.Widget){const widgetJson=state.appConfig.widgets[parentInfo.id];if("widgets/common/controller/"===(null==widgetJson?void 0:widgetJson.uri)&&(null===(_b=state.appConfig.controllerPanels)||void 0===_b?void 0:_b[widgetJson.id]))return[parentInfo.id,layoutItem.id]}parentInfo=findParentLayoutInfo(parentInfo)}return[null,null]}),jimu_core.E_S.shallowEqual);return jimu_core.q_G.useEffect((()=>{var _a;if(controllerId){const state=(0,jimu_core.Vp3)().getState(),openedWidgets=Object.keys(null!==(_a=state.widgetsRuntimeInfo)&&void 0!==_a?_a:{}).filter((wid=>{const info=state.widgetsRuntimeInfo[wid];return info.state===jimu_core.YGz.Opened&&info.controllerWidgetId!==controllerId}));openedWidgets.length>0&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.closeWidgets(openedWidgets))}}),[controllerId]),jimu_core.q_G.useEffect((()=>{var _a;const state=(0,jimu_core.Vp3)().getState(),openedWidgets=Object.keys(null!==(_a=state.widgetsRuntimeInfo)&&void 0!==_a?_a:{}).filter((widgetId=>state.widgetsRuntimeInfo[widgetId].state===jimu_core.YGz.Opened));openedWidgets.length>0&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.closeWidgets(openedWidgets))}),[isDesignMode]),(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,controllerIds.map((id=>(0,jimu_core.Yac)(ControllerPanelBuilder,{key:id,isDesignMode,selected:controllerId===id&&null===descendantWidgetId,innerSelected:controllerId===id&&null!=descendantWidgetId,controllerId:id}))))}try{ControllerPanelGroup.displayName="ControllerPanelGroup",ControllerPanelGroup.__docgenInfo={description:"",displayName:"ControllerPanelGroup",props:{pageId:{defaultValue:null,description:"",name:"pageId",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/controller-panel/builder/group.tsx#ControllerPanelGroup"]={docgenInfo:ControllerPanelGroup.__docgenInfo,name:"ControllerPanelGroup",path:"../jimu-layouts/lib/controller-panel/builder/group.tsx#ControllerPanelGroup"})}catch(__react_docgen_typescript_loader_error){}function PageBody(props){const{pageJson,visible,renderedPageId,browserSizeMode,activePagePart,pageContext,headerFooterHeight}=props,[playId,setPlayId]=jimu_core.q_G.useState(0),{previewId,playMode}=jimu_core.E_S.useSelector((state=>function page_body_mapStateToProps(state,pageId){const animationPreview=state.appRuntimeInfo.animationPreview;return(null==animationPreview?void 0:animationPreview.pageId)===pageId?{previewId:animationPreview.id,playMode:animationPreview.playMode}:{previewId:0,playMode:null}}(state,pageJson.id)),jimu_core.E_S.shallowEqual),pageHeight=jimu_core.q_G.useMemo((()=>(0,page_util.IG)(pageJson,headerFooterHeight)),[headerFooterHeight]),layout=pageJson.layout,oneByOneEffect=pageJson.oneByOneEffect&&pageJson.oneByOneEffect.type!==jimu_core.J6N.None?pageJson.oneByOneEffect:null,isDesignMode=jimu_core.E_S.useSelector((state=>{var _a;return null===oneByOneEffect||(null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.appMode)===jimu_core.$0N.Design})),sizeMode=jimu_core.E_S.useSelector((state=>null===oneByOneEffect?null:state.browserSizeMode)),effectRef=jimu_core.q_G.useRef(oneByOneEffect),sizeModeRef=jimu_core.q_G.useRef(sizeMode),visibleRef=jimu_core.q_G.useRef(visible),revert=oneByOneEffect?!visible:null;jimu_core.q_G.useEffect((()=>{effectRef.current=oneByOneEffect})),jimu_core.q_G.useEffect((()=>{isDesignMode&&visibleRef.current||setPlayId((0,jimu_core.RqM)())}),[isDesignMode]),jimu_core.q_G.useEffect((()=>{isDesignMode||sizeModeRef.current===sizeMode||setPlayId((0,jimu_core.RqM)()),sizeModeRef.current=sizeMode}),[sizeMode,isDesignMode]),jimu_core.q_G.useEffect((()=>{!isDesignMode&&visibleRef.current!==visible&&effectRef.current&&setPlayId((0,jimu_core.RqM)()),visibleRef.current=visible}),[visible,isDesignMode]);const viewOnly=!layout[browserSizeMode];let maxWidth;pageJson.mode!==jimu_core.bH$.FitWindow&&pageJson.maxWidth>0&&(maxWidth=pageJson.maxWidth);const pageContextValue=jimu_core.q_G.useMemo((()=>{const state=(0,jimu_core.Vp3)().getState();let rootLayoutId;return pageJson.layout&&(rootLayoutId=layout_runtime.searchUtils.findLayoutId(pageJson.layout,browserSizeMode,state.appConfig.mainSizeMode)),Object.assign(Object.assign({},pageContext),{maxWidth,viewOnly,rootLayoutId,pageId:renderedPageId})}),[pageContext,viewOnly,maxWidth,renderedPageId,pageJson.layout,browserSizeMode]),animationContextValue=jimu_core.q_G.useMemo((()=>({setting:!isDesignMode||previewId>0?oneByOneEffect:null,revert,playId:previewId>0?previewId:playId,oid:pageContextValue.rootLayoutId,playMode,onContextAnimationEnd:()=>{previewId>0?(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.clearAnimationPreview()):setPlayId(-1)}})),[isDesignMode,revert,playId,previewId,oneByOneEffect,playMode,pageContextValue.rootLayoutId]),getStyle=jimu_core.q_G.useCallback((()=>jimu_core.AHW`
      display: ${visible?"flex":"none"};
      position: relative;
      background-color: ${pageJson.bodyBackgroundColor||"transparent"};
      z-index: 1;
      flex: 1 0 auto;
      height: ${pageHeight};

      body:not(.design-mode) & {
        .edit-mask {
          display: none !important;
        }
      }

      .exb-drop-area {
        pointer-events: ${activePagePart!==jimu_core.xH7.Body?"none !important":"auto"}
      }
    `),[visible,pageHeight,activePagePart,pageJson.bodyBackgroundColor]);if(layout)return(0,jimu_core.Yac)(layout_runtime.PageContext.Provider,{key:pageJson.id,value:pageContextValue},(0,jimu_core.Yac)(layout_runtime.PageVisibilityContext.Provider,{value:visible},(0,jimu_core.Yac)("div",{id:pageJson.id,"data-pageid":pageJson.id,className:"page",css:getStyle()},(0,jimu_core.Yac)(jimu_core.e8P.Provider,{value:animationContextValue},(0,jimu_core.Yac)(layout_entry,{layouts:layout,isPageItem:!0,visible,className:"w-100",css:jimu_core.AHW`
                margin: 0 auto;
                background-color: transparent;
                z-index: 0;
              `})),browserSizeMode!==jimu_core.rHp.Small&&(0,jimu_core.Yac)(ControllerPanelGroup,{pageId:pageJson.id}),activePagePart!==jimu_core.xH7.Body&&(0,jimu_core.Yac)("div",{className:"edit-mask",css:jimu_core.AHW`
                ${maskStyle};
                background: ${jimu_core.PLL.rgba(pageContext.theme.ref.palette.neutral[1100],.6)};
                z-index: 1;
              `,onClick:editBody}))))}try{PageBody.displayName="PageBody",PageBody.__docgenInfo={description:"",displayName:"PageBody",props:{pageJson:{defaultValue:null,description:"",name:"pageJson",required:!0,type:{name:"IMPageJson"}},renderedPageId:{defaultValue:null,description:"",name:"renderedPageId",required:!0,type:{name:"string"}},activePagePart:{defaultValue:null,description:"",name:"activePagePart",required:!0,type:{name:"enum",value:[{value:'"HEADER"'},{value:'"FOOTER"'},{value:'"BODY"'}]}},browserSizeMode:{defaultValue:null,description:"",name:"browserSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},pageContext:{defaultValue:null,description:"",name:"pageContext",required:!0,type:{name:"ImmutableObject<PageContextProps>"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},headerFooterHeight:{defaultValue:null,description:"",name:"headerFooterHeight",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/page-body.tsx#PageBody"]={docgenInfo:PageBody.__docgenInfo,name:"PageBody",path:"../jimu-layouts/lib/builder/page-body.tsx#PageBody"})}catch(__react_docgen_typescript_loader_error){}function findActiveScreenIndex(screenGroupId){var _a,_b;let state=(0,jimu_core.Vp3)().getState();window.jimuConfig.isBuilder&&(state=state.appStateInBuilder);const navInfo=null===(_a=state.appRuntimeInfo.screenGroupNavInfos)||void 0===_a?void 0:_a[screenGroupId];return null!==(_b=null==navInfo?void 0:navInfo.activeIndex)&&void 0!==_b?_b:0}const screenMenuItems=[{icon:duplicate_page_default(),title:props=>props.formatMessage("duplicateScreen"),visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout(),onClick:props=>{const{layoutItem}=props,activeScreenIndex=findActiveScreenIndex(layoutItem.screenGroupId),appConfigAction=(0,jimu_for_builder.getAppConfigAction)();appConfigAction.duplicateScreenByIndex(activeScreenIndex,layoutItem.screenGroupId),appConfigAction.exec(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(layoutItem.screenGroupId,activeScreenIndex+1))}},{icon:trash_default(),title:props=>props.formatMessage("deleteScreen"),visible:()=>getAppMode()===jimu_core.$0N.Design&&!isLockLayout(),onClick:props=>{const{layoutItem}=props,activeScreenIndex=findActiveScreenIndex(layoutItem.screenGroupId),appConfigAction=(0,jimu_for_builder.getAppConfigAction)(),total=appConfigAction.appConfig.screenGroups[layoutItem.screenGroupId].screens.length;appConfigAction.removeScreenByIndex(activeScreenIndex,layoutItem.screenGroupId).exec(),activeScreenIndex===total-1&&(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.screenGroupNavInfoChanged(layoutItem.screenGroupId,activeScreenIndex-1))}}],commonMenu=[duplicateMenuItem,floatingMenuItem,pendingMenuItem,deleteMenuItem],layout_service_sectionMenu=[].concat(sectionMenuItems,commonMenu);class RowLayoutService extends jimu_for_builder.BaseLayoutService{removeItemFromOrder(appConfig,layoutInfo){const{layoutId,layoutItemId}=layoutInfo,layoutJson=appConfig.layouts[layoutId];if(!(null==layoutJson?void 0:layoutJson.order))return appConfig;let order=[].concat(layoutJson.order);return order=order.filter((itemId=>itemId!==layoutItemId)),appConfig.setIn(["layouts",layoutId,"order"],order)}afterItemMoved(appConfig,layoutInfo,toLayoutId){let updatedAppConfig=super.afterItemMoved(appConfig,layoutInfo,toLayoutId);return updatedAppConfig=this.removeItemFromOrder(updatedAppConfig,layoutInfo),this.clearEmptyRowInFlowLayout(updatedAppConfig,layoutInfo)}afterItemRemoved(appConfig,layoutInfo){let updatedAppConfig=super.afterItemRemoved(appConfig,layoutInfo);return updatedAppConfig=this.removeItemFromOrder(updatedAppConfig,layoutInfo),this.clearEmptyRowInFlowLayout(updatedAppConfig,layoutInfo)}duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context){const result=super.duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context);let updatedAppConfig=result[0];const newItemId=result[1],layoutJson=updatedAppConfig.layouts[layoutInfo.layoutId],order=[].concat(layoutJson.order),index=order.indexOf(layoutInfo.layoutItemId);return order.splice(index,1,layoutInfo.layoutItemId,newItemId),updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutInfo.layoutId,"order"],order),updatedAppConfig=this.offsetDuplicateItem(updatedAppConfig,layoutInfo.layoutId),[updatedAppConfig,newItemId]}getTocStructure(appConfig,layoutId){var _a;const layoutJson=appConfig.layouts[layoutId],sizeMode=layout_runtime.utils.getCurrentSizeMode();if((null===(_a=null==layoutJson?void 0:layoutJson.order)||void 0===_a?void 0:_a.length)>0){return[].concat(layoutJson.order).filter((itemId=>!layoutJson.content[itemId].isPending)).map((layoutItemId=>{const item=layoutJson.content[layoutItemId];return new jimu_for_builder.ContentServiceWrapper(appConfig,item).toTocNode({layoutId,layoutItemId},sizeMode)}))}return[]}processAfterItemAdded(appConfig,draggingItem,layoutInfo,options){var _a;const{insertIndex,itemRect}=options,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),bbox={left:itemRect.left,width:itemRect.width,height:itemRect.height};return(null===(_a=draggingItem.layoutInfo)||void 0===_a?void 0:_a.layoutId)!==layoutInfo.layoutId&&appConfigAction.editLayoutItemProperty(layoutInfo,"setting.autoProps.height",layout_runtime.LayoutItemSizeModes.Stretch),appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox).adjustOrderOfItem(layoutInfo,insertIndex),appConfigAction.appConfig}getToolItems(appConfig,layoutInfo,type){if("view"===(null==type?void 0:type.toLowerCase()))return viewMenuItems;if("screen"===(null==type?void 0:type.toLowerCase()))return screenMenuItems;return layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo).type===jimu_core.K6q.Section?layout_service_sectionMenu:commonMenu}offsetDuplicateItem(appConfig,layoutId){let updatedAppConfig=appConfig;const layout=appConfig.layouts[layoutId],getValue=(layoutItemId,prop)=>parseInt(updatedAppConfig.layouts[layoutId].content[layoutItemId].bbox[prop],10),updateValue=(layoutItemId,prop,value)=>{updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutId,"content",layoutItemId,"bbox",prop],value)},order=Object.keys(layout.content).sort(((a,b)=>getValue(a,"left")-getValue(b,"left")));let totalWidth=0;for(let i=0;i<order.length;i++)totalWidth+=getValue(order[i],"width");if(updateValue(order[0],"left",0),totalWidth<=12)for(let i=1;i<order.length;i++)updateValue(order[i],"left",getValue(order[i-1],"left")+getValue(order[i-1],"width"));else{const ratio=totalWidth/12;updateValue(order[0],"width",Math.max(1,Math.floor(getValue(order[0],"width")/ratio)));for(let i=1;i<order.length;i++)updateValue(order[i],"left",getValue(order[i-1],"left")+getValue(order[i-1],"width")),updateValue(order[i],"width",Math.max(1,Math.floor(getValue(order[i],"width")/ratio)))}return updatedAppConfig}clearEmptyRowInFlowLayout(appConfig,removedLayoutInfo){var _a,_b,_c;const layout=appConfig.layouts[removedLayoutInfo.layoutId];if((null!==(_b=null===(_a=null==layout?void 0:layout.order)||void 0===_a?void 0:_a.length)&&void 0!==_b?_b:0)>0)return appConfig;const widgetId=layout_runtime.searchUtils.getWidgetIdThatUseTheLayoutId(appConfig,removedLayoutInfo.layoutId);if(widgetId){const widgetJson=appConfig.widgets[widgetId];if("row"===(null===(_c=null==widgetJson?void 0:widgetJson.manifest)||void 0===_c?void 0:_c.name)){const sizeMode=layout_runtime.utils.getCurrentSizeMode(),parentLayoutInfo=jimu_for_builder.widgetService.findParent(appConfig,widgetId,sizeMode);if(parentLayoutInfo){const parentLayoutJson=appConfig.layouts[parentLayoutInfo.layoutId];if((null==parentLayoutJson?void 0:parentLayoutJson.type)===jimu_core.p5K.FlowLayout){return jimu_for_builder.LayoutServiceProvider.getInstance().getServiceByType(parentLayoutJson.type).removeItem(appConfig,parentLayoutInfo,sizeMode,!0,!1)}}}}return appConfig}}const builder_layout_service_sectionMenu=[].concat(sectionMenuItems,gridItemMenu);class GridLayoutService extends jimu_for_builder.BaseLayoutService{beforeItemRemoved(appConfig,layoutInfo){const{layoutId,layoutItemId}=layoutInfo;let layoutJson=appConfig.layouts[layoutId];return layoutJson=detachGridItem(layoutJson,layoutItemId),appConfig.setIn(["layouts",layoutId],layoutJson)}pendItem(appConfig,layoutInfo){let updatedAppConfig=appConfig,layout=updatedAppConfig.layouts[layoutInfo.layoutId];return layout=detachGridItem(layout,layoutInfo.layoutItemId),updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutInfo.layoutId],layout),layout.setting.rootItem===layoutInfo.layoutItemId&&(updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutInfo.layoutId,"setting"],layout.setting.without("rootItem"))),updatedAppConfig=super.pendItem(updatedAppConfig,layoutInfo),updatedAppConfig}duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context){const result=super.duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context);let updatedAppConfig=result[0];const newItemId=result[1],{layoutId,layoutItemId}=layoutInfo;let layout=updatedAppConfig.layouts[layoutId];const layoutItem=layout.content[layoutItemId];if(layoutItem.parent){const parentItem=(0,common_utils.a2)(layout,layoutItem.parent),children=[...parentItem.children],index=children.indexOf(layoutItemId);if(children.splice(index,0,newItemId),layout=updateGridItem(layout,layoutItem.parent,"children",children),layout=updateGridItem(layout,newItemId,"parent",layoutItem.parent),parentItem.gridType===jimu_core.Qwn.Tab)layout=updateSize(layout,newItemId,+layoutItem.bbox.width);else{const halfSize=+layoutItem.bbox.width/2;layout=updateSize(layout,newItemId,halfSize),layout=updateSize(layout,layoutItemId,halfSize)}}else layout=attach(layout,newItemId,layoutItemId,jimu_core.Qwn.Row,!1,!1);return updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutId],layout),[updatedAppConfig,newItemId]}getTocStructure(appConfig,layoutId){var _a;const layoutJson=appConfig.layouts[layoutId],rootItemId=null===(_a=layoutJson.setting)||void 0===_a?void 0:_a.rootItem,rootNode=this.fetchGridNode(appConfig,layoutJson,`${rootItemId}`,layout_runtime.utils.getCurrentSizeMode());return null!=rootNode?[rootNode]:[]}getToolItems(appConfig,layoutInfo,type){if("view"===(null==type?void 0:type.toLowerCase()))return viewMenuItems;if("screen"===(null==type?void 0:type.toLowerCase()))return screenMenuItems;const layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo);return layoutItem.gridType===jimu_core.Qwn.Row||layoutItem.gridType===jimu_core.Qwn.Column?gridRowColTools:layoutItem.gridType===jimu_core.Qwn.Tab?[]:layoutItem.type===jimu_core.K6q.Section?builder_layout_service_sectionMenu:gridItemMenu}processAfterItemAdded(appConfig){return appConfig}translate(id){return jimu_core.Ruy.getIntl().formatMessage({id})}fetchGridNode(appConfig,layout,itemId,browserSizeMode){var _a,_b,_c,_d;const item=null===(_a=layout.content)||void 0===_a?void 0:_a[itemId];if(null==item)return null;const{gridType=jimu_core.Qwn.Plain,children}=item;if(gridType===jimu_core.Qwn.Plain){return new jimu_for_builder.ContentServiceWrapper(appConfig,item).toTocNode({layoutId:layout.id,layoutItemId:itemId},browserSizeMode)}let label;gridType===jimu_core.Qwn.Row?label=null!==(_b=item.label)&&void 0!==_b?_b:this.translate("gridRow"):gridType===jimu_core.Qwn.Column?label=null!==(_c=item.label)&&void 0!==_c?_c:this.translate("gridCol"):gridType===jimu_core.Qwn.Tab&&(label=null!==(_d=item.label)&&void 0!==_d?_d:this.translate("tabs"));let isInTab=!1;if(item.parent){isInTab=layout.content[item.parent].gridType===jimu_core.Qwn.Tab}const editable=isInTab&&(gridType===jimu_core.Qwn.Row||gridType===jimu_core.Qwn.Column),result={label,type:"layoutItem",layoutId:layout.id,layoutItemId:itemId,isLabelReadOnly:!editable};return(null==children?void 0:children.length)>0&&(result.children=[...children].map((itemId=>this.fetchGridNode(appConfig,layout,itemId,browserSizeMode)))),result}}const layout_service_commonMenu=[duplicateMenuItem,floatingMenuItem,pendingMenuItem,deleteMenuItem],widgetMenu=[].concat(fixedItemMenu,layout_service_commonMenu),fixed_layout_builder_layout_service_sectionMenu=[].concat(fixedItemMenu,sectionMenuItems,layout_service_commonMenu);class FixedLayoutService extends jimu_for_builder.BaseLayoutService{removeItemFromOrder(appConfig,layoutInfo){const{layoutId,layoutItemId}=layoutInfo,layoutJson=appConfig.layouts[layoutId];let order=[].concat(layoutJson.order);return order=order.filter((itemId=>itemId!==layoutItemId)),appConfig.setIn(["layouts",layoutId,"order"],order)}afterItemMoved(appConfig,layoutInfo){return this.removeItemFromOrder(appConfig,layoutInfo)}afterItemRemoved(appConfig,layoutInfo){const updatedAppConfig=super.afterItemRemoved(appConfig,layoutInfo);return this.removeItemFromOrder(updatedAppConfig,layoutInfo)}updateBBoxAfterAdd(appConfig,draggingItem,layoutInfo,options){var _a,_b,_c,_d,_e,_f;const{containerRect,itemRect,currentSizeMode}=options;let snapResult=options.snapResult;const draggingLayoutInfo=draggingItem.layoutInfo,layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo);let bbox,setting=(0,jimu_core.J3Z)(null!==(_a=layoutItem.setting)&&void 0!==_a?_a:{});if(null==draggingItem.id&&(null==draggingLayoutInfo?void 0:draggingLayoutInfo.layoutId)===layoutInfo.layoutId){const layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,draggingItem.layoutInfo),originBBox=null==layoutItem?void 0:layoutItem.bbox;if(originBBox){bbox=layout_runtime.utils.replaceBoundingBox(originBBox,snapResult,containerRect).set("width",originBBox.width).set("height",originBBox.height)}else bbox=layout_runtime.utils.replaceBoundingBox(null,snapResult,containerRect)}else if(bbox=layout_runtime.utils.replaceBoundingBox(null,snapResult,containerRect),null==draggingItem.layoutInfo&&layoutItem.type===jimu_core.K6q.Widget&&layoutItem.widgetId){const widgetJson=appConfig.widgets[layoutItem.widgetId];if((!snapResult.width||!snapResult.height)&&(null===(_b=widgetJson.manifest)||void 0===_b?void 0:_b.defaultSize)){const{width,height}=widgetJson.manifest.defaultSize;snapResult=Object.assign(Object.assign({},itemRect),{width,height})}(null===(_d=null===(_c=widgetJson.manifest)||void 0===_c?void 0:_c.defaultSize)||void 0===_d?void 0:_d.autoWidth)&&(setting=setting.setIn(["autoProps","width"],layout_runtime.LayoutItemSizeModes.Auto)),(null===(_f=null===(_e=widgetJson.manifest)||void 0===_e?void 0:_e.defaultSize)||void 0===_f?void 0:_f.autoHeight)&&(setting=setting.setIn(["autoProps","height"],layout_runtime.LayoutItemSizeModes.Auto))}const applyResult=(0,fixed_layout_util.Ov)(bbox,setting,containerRect,itemRect);bbox=applyResult.bbox,setting=applyResult.setting;const layoutJson=appConfig.layouts[layoutInfo.layoutId],isHeader=layoutJson.parent.type===jimu_core.$4y.Header,isFooter=layoutJson.parent.type===jimu_core.$4y.Footer;if(null==draggingItem.layoutInfo&&(isHeader||isFooter)){const containerHeight=isHeader?parseInt(`${appConfig.header.height[currentSizeMode]}`):parseInt(`${appConfig.footer.height[currentSizeMode]}`);bbox=bbox.set("height",layout_runtime.utils.toRatio(Math.min(itemRect.height,containerHeight),containerHeight))}return[bbox,setting]}processAfterItemAdded(appConfig,draggingItem,layoutInfo,options){var _a;const{currentSizeMode,containerRect,itemRect,others}=options,updatedAppConfig=appConfig,{snapResult}=others,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(updatedAppConfig),[bbox,setting]=this.updateBBoxAfterAdd(updatedAppConfig,draggingItem,layoutInfo,{containerRect,itemRect,snapResult,currentSizeMode});if(appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",layout_runtime.utils.isRTL()?(0,fixed_layout_util.fF)(bbox):bbox).editLayoutItemProperty(layoutInfo,"setting",setting),null!=draggingItem.layoutInfo&&draggingItem.layoutInfo.layoutId===layoutInfo.layoutId&&appConfigAction.editLayoutItemProperty(layoutInfo,"setting.vCenter",!1).editLayoutItemProperty(layoutInfo,"setting.hCenter",!1),(null===(_a=draggingItem.layoutInfo)||void 0===_a?void 0:_a.layoutId)!==layoutInfo.layoutId&&appConfigAction.adjustOrderOfItem(layoutInfo,null),updatedAppConfig.useAutoSortInFixedLayout){const sortedLayout=sortLayoutItems(appConfigAction.appConfig.layouts[layoutInfo.layoutId],containerRect,{layoutItemId:layoutInfo.layoutItemId,rect:itemRect});appConfigAction.editLayoutProperty(layoutInfo.layoutId,"order",sortedLayout.order)}return appConfigAction.appConfig}duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context){const result=super.duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context);let updatedAppConfig=result[0];const newItemId=result[1],layoutJson=updatedAppConfig.layouts[layoutInfo.layoutId],order=[].concat(layoutJson.order);return order.push(newItemId),updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutInfo.layoutId,"order"],order),updatedAppConfig=this.offsetDuplicateItem(updatedAppConfig,{layoutId:layoutInfo.layoutId,layoutItemId:newItemId}),[updatedAppConfig,newItemId]}getTocStructure(appConfig,layoutId){var _a;const layoutJson=appConfig.layouts[layoutId],sizeMode=layout_runtime.utils.getCurrentSizeMode();if((null===(_a=null==layoutJson?void 0:layoutJson.order)||void 0===_a?void 0:_a.length)>0){return[].concat(layoutJson.order).filter((itemId=>!layoutJson.content[itemId].isPending)).map((layoutItemId=>{const item=layoutJson.content[layoutItemId];return new jimu_for_builder.ContentServiceWrapper(appConfig,item).toTocNode({layoutId,layoutItemId},sizeMode)}))}return[]}getToolItems(appConfig,layoutInfo,type){if("view"===(null==type?void 0:type.toLowerCase()))return viewMenuItems;if("screen"===(null==type?void 0:type.toLowerCase()))return screenMenuItems;return layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo).type===jimu_core.K6q.Section?fixed_layout_builder_layout_service_sectionMenu:widgetMenu}offsetDuplicateItem(appConfig,layoutInfo){var _a,_b;const{layoutId,layoutItemId}=layoutInfo,layoutItem=appConfig.layouts[layoutId].content[layoutItemId];let{bbox,setting}=layoutItem;const offset=value=>{if(layout_runtime.utils.isPercentage(value))return`${parseFloat(value)+5}%`;const pxValue=parseInt(value,10);return isNaN(pxValue)?value:pxValue+20};return bbox=(null===(_a=null==setting?void 0:setting.autoProps)||void 0===_a?void 0:_a.left)?bbox.set("right",offset(bbox.right)):bbox.set("left",offset(bbox.left)),bbox=(null===(_b=null==setting?void 0:setting.autoProps)||void 0===_b?void 0:_b.top)?bbox.set("bottom",offset(bbox.bottom)):bbox.set("top",offset(bbox.top)),(null==setting?void 0:setting.hCenter)&&(null==setting?void 0:setting.vCenter)&&(setting=setting.set("vCenter",!1)),appConfig.setIn(["layouts",layoutId,"content",layoutItemId,"bbox"],bbox).setIn(["layouts",layoutId,"content",layoutItemId,"setting"],setting)}}const blockMenu=[duplicateMenuItem,sinkingMenuItem,deleteMenuItem],screenGroupMenu=[pendingMenuItem,duplicateMenuItem,deleteMenuItem];class FlowLayoutService extends jimu_for_builder.BaseLayoutService{removeItemFromOrder(appConfig,layoutInfo){const{layoutId,layoutItemId}=layoutInfo,layoutJson=appConfig.layouts[layoutId];let order=[].concat(layoutJson.order);return order=order.filter((itemId=>itemId!==layoutItemId)),appConfig.setIn(["layouts",layoutId,"order"],order)}afterItemMoved(appConfig,layoutInfo){return this.removeItemFromOrder(appConfig,layoutInfo)}afterItemRemoved(appConfig,layoutInfo){const updatedAppConfig=super.afterItemRemoved(appConfig,layoutInfo);return this.removeItemFromOrder(updatedAppConfig,layoutInfo)}duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context){var _a;const result=super.duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context);let updatedAppConfig=result[0];const newItemId=result[1],layoutJson=updatedAppConfig.layouts[layoutInfo.layoutId],order=[].concat(layoutJson.order),index=order.indexOf(layoutInfo.layoutItemId);order.splice(index,1,layoutInfo.layoutItemId,newItemId),updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutInfo.layoutId,"order"],order);return(null===(_a=layoutJson.content[newItemId].setting)||void 0===_a?void 0:_a.isFloating)&&(updatedAppConfig=this.offsetDuplicateItem(updatedAppConfig,{layoutId:layoutInfo.layoutId,layoutItemId:newItemId})),[updatedAppConfig,newItemId]}getTocStructure(appConfig,layoutId){var _a;const layoutJson=appConfig.layouts[layoutId],sizeMode=layout_runtime.utils.getCurrentSizeMode();if((null===(_a=null==layoutJson?void 0:layoutJson.order)||void 0===_a?void 0:_a.length)>0){return[].concat(layoutJson.order).filter((itemId=>!layoutJson.content[itemId].isPending)).map((layoutItemId=>{const item=layoutJson.content[layoutItemId];return new jimu_for_builder.ContentServiceWrapper(appConfig,item).toTocNode({layoutId,layoutItemId},sizeMode)}))}return[]}processAfterItemAdded(appConfig,draggingItem,layoutInfo,options){const{containerRect,itemRect,insertIndex}=options,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig),bbox=layout_runtime.utils.replaceBoundingBox(null,itemRect,containerRect);return appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox).adjustOrderOfItem(layoutInfo,insertIndex),appConfigAction.appConfig}getToolItems(appConfig,layoutInfo,type){if("view"===(null==type?void 0:type.toLowerCase()))return viewMenuItems;if("screen"===(null==type?void 0:type.toLowerCase()))return screenMenuItems;return layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo).type===jimu_core.K6q.ScreenGroup?screenGroupMenu:blockMenu}offsetDuplicateItem(appConfig,layoutInfo){var _a,_b;const{layoutId,layoutItemId}=layoutInfo,layoutItem=appConfig.layouts[layoutId].content[layoutItemId];let{bbox,setting}=layoutItem;const offset=value=>{if(layout_runtime.utils.isPercentage(value))return`${parseFloat(value)+5}%`;const pxValue=parseInt(value,10);return isNaN(pxValue)?value:pxValue+20};return bbox=(null===(_a=null==setting?void 0:setting.autoProps)||void 0===_a?void 0:_a.left)?bbox.set("right",offset(bbox.right)):bbox.set("left",offset(bbox.left)),bbox=(null===(_b=null==setting?void 0:setting.autoProps)||void 0===_b?void 0:_b.top)?bbox.set("bottom",offset(bbox.bottom)):bbox.set("top",offset(bbox.top)),(null==setting?void 0:setting.hCenter)&&(null==setting?void 0:setting.vCenter)&&(setting=setting.set("vCenter",!1)),appConfig.setIn(["layouts",layoutId,"content",layoutItemId,"bbox"],bbox).setIn(["layouts",layoutId,"content",layoutItemId,"setting"],setting)}}const builder_layout_service_commonMenu=[duplicateMenuItem,floatingMenuItem,pendingMenuItem,deleteMenuItem],column_layout_builder_layout_service_sectionMenu=[].concat(sectionMenuItems,builder_layout_service_commonMenu);class ColumnLayoutService extends jimu_for_builder.BaseLayoutService{removeItemFromOrder(appConfig,layoutInfo){const{layoutId,layoutItemId}=layoutInfo,layoutJson=appConfig.layouts[layoutId];let order=[].concat(layoutJson.order);return order=order.filter((itemId=>itemId!==layoutItemId)),appConfig.setIn(["layouts",layoutId,"order"],order)}afterItemMoved(appConfig,layoutInfo){return this.removeItemFromOrder(appConfig,layoutInfo)}afterItemRemoved(appConfig,layoutInfo){const updatedAppConfig=super.afterItemRemoved(appConfig,layoutInfo);return this.removeItemFromOrder(updatedAppConfig,layoutInfo)}duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context){const result=super.duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context);let updatedAppConfig=result[0];const newItemId=result[1],layoutJson=updatedAppConfig.layouts[layoutInfo.layoutId],order=[].concat(layoutJson.order),index=order.indexOf(layoutInfo.layoutItemId);return order.splice(index,1,layoutInfo.layoutItemId,newItemId),updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutInfo.layoutId,"order"],order),[updatedAppConfig,newItemId]}getTocStructure(appConfig,layoutId){var _a;const layoutJson=appConfig.layouts[layoutId],sizeMode=layout_runtime.utils.getCurrentSizeMode();if((null===(_a=null==layoutJson?void 0:layoutJson.order)||void 0===_a?void 0:_a.length)>0){return[].concat(layoutJson.order).filter((itemId=>!layoutJson.content[itemId].isPending)).map((layoutItemId=>{const item=layoutJson.content[layoutItemId];return new jimu_for_builder.ContentServiceWrapper(appConfig,item).toTocNode({layoutId,layoutItemId},sizeMode)}))}return[]}processAfterItemAdded(appConfig,draggingItem,layoutInfo,options){var _a,_b;const{containerRect,itemRect,insertIndex}=options,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig);let bbox=layout_runtime.utils.replaceBoundingBox(null,itemRect,containerRect);bbox=bbox.without("left").without("top").without("right").without("bottom"),appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox).adjustOrderOfItem(layoutInfo,insertIndex);const layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo);if(layoutItem.type===jimu_core.K6q.Widget&&layoutItem.widgetId){(null===(_b=null===(_a=appConfig.widgets[layoutItem.widgetId].manifest)||void 0===_a?void 0:_a.defaultSize)||void 0===_b?void 0:_b.autoHeight)&&appConfigAction.editLayoutItemProperty(layoutInfo,"setting.autoProps.height",layout_runtime.LayoutItemSizeModes.Auto)}return appConfigAction.appConfig}getToolItems(appConfig,layoutInfo,type){if("view"===(null==type?void 0:type.toLowerCase()))return viewMenuItems;if("screen"===(null==type?void 0:type.toLowerCase()))return screenMenuItems;return layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo).type===jimu_core.K6q.Section?column_layout_builder_layout_service_sectionMenu:builder_layout_service_commonMenu}}const accordion_layout_builder_layout_service_commonMenu=[duplicateMenuItem,floatingMenuItem,pendingMenuItem,deleteMenuItem],accordion_layout_builder_layout_service_sectionMenu=[].concat(sectionMenuItems,accordion_layout_builder_layout_service_commonMenu);class AccordionLayoutService extends jimu_for_builder.BaseLayoutService{removeItemFromOrder(appConfig,layoutInfo){const{layoutId,layoutItemId}=layoutInfo,layoutJson=appConfig.layouts[layoutId];let order=[].concat(layoutJson.order);return order=order.filter((itemId=>itemId!==layoutItemId)),appConfig.setIn(["layouts",layoutId,"order"],order)}afterItemMoved(appConfig,layoutInfo){return this.removeItemFromOrder(appConfig,layoutInfo)}afterItemRemoved(appConfig,layoutInfo){const updatedAppconfig=super.afterItemRemoved(appConfig,layoutInfo);return this.removeItemFromOrder(updatedAppconfig,layoutInfo)}duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context){const result=super.duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context);let updatedAppConfig=result[0];const newItemId=result[1],layoutJson=updatedAppConfig.layouts[layoutInfo.layoutId],order=[].concat(layoutJson.order),index=order.indexOf(layoutInfo.layoutItemId);return order.splice(index,1,layoutInfo.layoutItemId,newItemId),updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutInfo.layoutId,"order"],order),[updatedAppConfig,newItemId]}getTocStructure(appConfig,layoutId){var _a;const layoutJson=appConfig.layouts[layoutId],sizeMode=layout_runtime.utils.getCurrentSizeMode();if((null===(_a=null==layoutJson?void 0:layoutJson.order)||void 0===_a?void 0:_a.length)>0){return[].concat(layoutJson.order).filter((itemId=>!layoutJson.content[itemId].isPending)).map((layoutItemId=>{const item=layoutJson.content[layoutItemId];return new jimu_for_builder.ContentServiceWrapper(appConfig,item).toTocNode({layoutId,layoutItemId},sizeMode)}))}return[]}processAfterItemAdded(appConfig,draggingItem,layoutInfo,options){var _a,_b;const{containerRect,itemRect,insertIndex}=options,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig);let bbox=layout_runtime.utils.replaceBoundingBox(null,itemRect,containerRect);bbox=bbox.without("left").without("top").without("right").without("bottom").without("width"),appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox).adjustOrderOfItem(layoutInfo,insertIndex);const layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo);if(layoutItem.type===jimu_core.K6q.Widget&&layoutItem.widgetId){(null===(_b=null===(_a=appConfig.widgets[layoutItem.widgetId].manifest)||void 0===_a?void 0:_a.defaultSize)||void 0===_b?void 0:_b.autoHeight)&&appConfigAction.editLayoutItemProperty(layoutInfo,"setting.autoProps.height",layout_runtime.LayoutItemSizeModes.Auto)}return appConfigAction.appConfig}getToolItems(appConfig,layoutInfo,type){if("view"===(null==type?void 0:type.toLowerCase()))return viewMenuItems;if("screen"===(null==type?void 0:type.toLowerCase()))return screenMenuItems;return layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo).type===jimu_core.K6q.Section?accordion_layout_builder_layout_service_sectionMenu:accordion_layout_builder_layout_service_commonMenu}}const flex_row_layout_builder_layout_service_commonMenu=[duplicateMenuItem,floatingMenuItem,pendingMenuItem,deleteMenuItem],flex_row_layout_builder_layout_service_sectionMenu=[].concat(sectionMenuItems,flex_row_layout_builder_layout_service_commonMenu);class FlexRowLayoutService extends jimu_for_builder.BaseLayoutService{removeItemFromOrder(appConfig,layoutInfo){const{layoutId,layoutItemId}=layoutInfo,layoutJson=appConfig.layouts[layoutId];let order=[].concat(layoutJson.order);return order=order.filter((itemId=>itemId!==layoutItemId)),appConfig.setIn(["layouts",layoutId,"order"],order)}afterItemMoved(appConfig,layoutInfo){return this.removeItemFromOrder(appConfig,layoutInfo)}afterItemRemoved(appConfig,layoutInfo){const updatedAppConfig=super.afterItemRemoved(appConfig,layoutInfo);return this.removeItemFromOrder(updatedAppConfig,layoutInfo)}duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context){const result=super.duplicateItemInSameLayout(appConfig,layoutInfo,sizeMode,context);let updatedAppConfig=result[0];const newItemId=result[1],layoutJson=updatedAppConfig.layouts[layoutInfo.layoutId],order=[].concat(layoutJson.order),index=order.indexOf(layoutInfo.layoutItemId);return order.splice(index,1,layoutInfo.layoutItemId,newItemId),updatedAppConfig=updatedAppConfig.setIn(["layouts",layoutInfo.layoutId,"order"],order),[updatedAppConfig,newItemId]}getTocStructure(appConfig,layoutId){var _a;const layoutJson=appConfig.layouts[layoutId],sizeMode=layout_runtime.utils.getCurrentSizeMode();if((null===(_a=null==layoutJson?void 0:layoutJson.order)||void 0===_a?void 0:_a.length)>0){return[].concat(layoutJson.order).filter((itemId=>!layoutJson.content[itemId].isPending)).map((layoutItemId=>{const item=layoutJson.content[layoutItemId];return new jimu_for_builder.ContentServiceWrapper(appConfig,item).toTocNode({layoutId,layoutItemId},sizeMode)}))}return[]}processAfterItemAdded(appConfig,draggingItem,layoutInfo,options){var _a,_b,_c,_d;const{containerRect,insertIndex,itemRect}=options,appConfigAction=(0,jimu_for_builder.getAppConfigAction)(appConfig);let bbox=layout_runtime.utils.replaceBoundingBox(null,itemRect,containerRect);bbox=bbox.without("left").without("top").without("right").without("bottom"),appConfigAction.editLayoutItemProperty(layoutInfo,"bbox",bbox).adjustOrderOfItem(layoutInfo,insertIndex);const layoutItem=layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo);if(layoutItem.type===jimu_core.K6q.Widget&&layoutItem.widgetId){const widgetJson=appConfig.widgets[layoutItem.widgetId];(null===(_b=null===(_a=widgetJson.manifest)||void 0===_a?void 0:_a.defaultSize)||void 0===_b?void 0:_b.autoHeight)&&appConfigAction.editLayoutItemProperty(layoutInfo,"setting.autoProps.height",layout_runtime.LayoutItemSizeModes.Auto),(null===(_d=null===(_c=widgetJson.manifest)||void 0===_c?void 0:_c.defaultSize)||void 0===_d?void 0:_d.autoWidth)&&appConfigAction.editLayoutItemProperty(layoutInfo,"setting.autoProps.width",layout_runtime.LayoutItemSizeModes.Auto)}return appConfigAction.appConfig}getToolItems(appConfig,layoutInfo,type){if("view"===(null==type?void 0:type.toLowerCase()))return viewMenuItems;if("screen"===(null==type?void 0:type.toLowerCase()))return screenMenuItems;return layout_runtime.searchUtils.findLayoutItem(appConfig,layoutInfo).type===jimu_core.K6q.Section?flex_row_layout_builder_layout_service_sectionMenu:flex_row_layout_builder_layout_service_commonMenu}}jimu_for_builder.LayoutServiceProvider.getInstance().registerService(jimu_core.p5K.RowLayout,new RowLayoutService),jimu_for_builder.LayoutServiceProvider.getInstance().registerService(jimu_core.p5K.GridLayout,new GridLayoutService),jimu_for_builder.LayoutServiceProvider.getInstance().registerService(jimu_core.p5K.FixedLayout,new FixedLayoutService),jimu_for_builder.LayoutServiceProvider.getInstance().registerService(jimu_core.p5K.FlowLayout,new FlowLayoutService),jimu_for_builder.LayoutServiceProvider.getInstance().registerService(jimu_core.p5K.ColumnLayout,new ColumnLayoutService),jimu_for_builder.LayoutServiceProvider.getInstance().registerService(jimu_core.p5K.AccordionLayout,new AccordionLayoutService),jimu_for_builder.LayoutServiceProvider.getInstance().registerService(jimu_core.p5K.FlexRowLayout,new FlexRowLayoutService),(0,layout_runtime.registerLayoutBuilder)(jimu_core.p5K.FixedLayout,builder_layout),(0,layout_runtime.registerLayoutBuilder)(jimu_core.p5K.FlowLayout,flow_layout_builder_layout),(0,layout_runtime.registerLayoutBuilder)(jimu_core.p5K.GridLayout,grid_layout_builder_layout),(0,layout_runtime.registerLayoutBuilder)(jimu_core.p5K.ColumnLayout,column_layout_builder_layout),(0,layout_runtime.registerLayoutBuilder)(jimu_core.p5K.AccordionLayout,accordion_layout_builder_layout),(0,layout_runtime.registerLayoutBuilder)(jimu_core.p5K.FlexRowLayout,flex_row_layout_builder_layout);class page_renderer_PageRenderer extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.updateHeaderHeight=height=>{this.setState({headerHeight:height})},this.updateFooterHeight=height=>{this.setState({footerHeight:height})},this.startPaste=()=>{var _a;const clipboardItem=null===(_a=(0,jimu_core.Vp3)().getState().appRuntimeInfo)||void 0===_a?void 0:_a.clipboard,{activePagePart,pageStatus,currentDialogId,dialogs}=this.props;if(clipboardItem){let targetLayoutId;if(currentDialogId&&dialogs[currentDialogId])targetLayoutId=getDialogLayoutId(currentDialogId);else if(activePagePart===jimu_core.xH7.Header)targetLayoutId=getHeaderLayoutId();else if(activePagePart===jimu_core.xH7.Footer)targetLayoutId=getFooterLayoutId();else{targetLayoutId=function getPageLayoutId(pageId){var _a;const state=(0,jimu_core.Vp3)().getState(),sizeModeLayout=null===(_a=state.appConfig.pages[pageId])||void 0===_a?void 0:_a.layout;return sizeModeLayout?layout_runtime.searchUtils.findLayoutId(sizeModeLayout,state.browserSizeMode,state.appConfig.mainSizeMode):null}(getVisiblePageId(pageStatus))}pasteLayoutItem(clipboardItem,targetLayoutId)}},this.isMac=()=>{var _a,_b;return"macOS"===(null===(_b=null===(_a=window.jimuUA)||void 0===_a?void 0:_a.os)||void 0===_b?void 0:_b.name)},this.clearSelection=e=>{!isDesignMode()&&!isExpressMode()||isResizing()||isDragging()||(e.stopPropagation(),(0,jimu_core.Vp3)().dispatch(jimu_core.tRc.selectionChanged(null)))},this.formatMessage=(id,values)=>this.props.intl?this.props.intl.formatMessage({id,defaultMessage:translations_default.A[id]},values):translations_default.A[id],this.state={headerHeight:0,footerHeight:0},jimu_core.nH3.getInstance().registerExtension({epName:jimu_core.vZE.R6.LayoutTransformer,extension:new layout_transform.I}),jimu_core.nH3.getInstance().registerExtension({epName:jimu_core.vZE.R6.LayoutTransformer,extension:new row_layout_layout_transform.kF}),jimu_core.nH3.getInstance().registerExtension({epName:jimu_core.vZE.R6.LayoutTransformer,extension:new grid_layout_layout_transform.K}),this.isMac()?this.keyBindings={"command+keyv":this.startPaste}:this.keyBindings={"ctrl+keyv":this.startPaste},this.updatePageContext()}componentDidMount(){isDesignMode()&&!document.body.classList.contains("design-mode")&&document.body.classList.add("design-mode"),isLockLayout()&&!document.body.classList.contains("lock-layout")&&document.body.classList.add("lock-layout")}componentDidUpdate(prevProps){var _a;const documentElement=null===(_a=window.document)||void 0===_a?void 0:_a.documentElement;documentElement&&(window.jimuConfig.isInBuilder&&isDesignMode()?documentElement.classList.add("is-in-builder"):documentElement.classList.remove("is-in-builder"));getVisiblePageId(prevProps.pageStatus)!==getVisiblePageId(this.props.pageStatus)&&(this.pageRef.scrollTop=0)}getPageStyle(){const{pageStatus,pages,minHeight}=this.props,pageJson=pages[Object.keys(pageStatus).find((pid=>pageStatus[pid]))];return jimu_core.AHW`
      position: relative;
      margin: 0 auto;
      overflow: hidden;
      z-index: 0;
      height: ${pageJson.mode===jimu_core.bH$.FitWindow?"100%":"auto"};
      min-height: ${minHeight}px;
      .is-dragging {
        z-index: ${layout_runtime.LayoutZIndex.DraggingItem};
        opacity: 0.8;
      }

      body:not(.design-mode) & {
        overflow: auto;
        height: 100%;
      }
    `}updatePageContext(){const{theme}=this.props,pageContext={theme,builderTheme:(0,jimu_theme.__)(),formatMessage:this.formatMessage};if(this.pageContext)for(const prop in pageContext)this.pageContext[prop]!==pageContext[prop]&&(this.pageContext=this.pageContext.set(prop,pageContext[prop]));else this.pageContext=(0,jimu_core.J3Z)(pageContext)}render(){const{pageStatus,pages,headerVisible,footerVisible}=this.props,visiblePageId=getVisiblePageId(pageStatus);return visiblePageId&&(null==pages?void 0:pages[visiblePageId])?(this.updatePageContext(),(0,jimu_core.Yac)("div",{className:"page-renderer d-flex flex-column align-items-center w-100",ref:el=>{this.pageRef=el},css:this.getPageStyle(),"data-testid":"pageRenderer",onClick:this.clearSelection},this.renderDialog(),headerVisible&&this.renderHeader(),Object.keys(pageStatus).map((pId=>this.renderPageBody(pId))),footerVisible&&this.renderFooter(),(0,jimu_core.Yac)(jimu_core.s3S,{bindings:this.keyBindings}))):null}renderHeader(){if(!this.props.header)return null;const{header,browserSizeMode,mainSizeMode,activePagePart}=this.props;return(0,jimu_core.Yac)(PageHeader,{header,activePagePart,browserSizeMode,mainSizeMode,pageContext:this.pageContext,onHeightChange:this.updateHeaderHeight})}renderFooter(){if(!this.props.footer)return null;const{footer,browserSizeMode,mainSizeMode,activePagePart}=this.props;return(0,jimu_core.Yac)(PageFooter,{footer,activePagePart,browserSizeMode,mainSizeMode,pageContext:this.pageContext,onHeightChange:this.updateFooterHeight})}renderPageBody(renderedPageId){const{pages,pageStatus,browserSizeMode,activePagePart}=this.props,pageJson=pages[renderedPageId];if(pageJson&&pageJson.type===jimu_core.g6_.Normal)return(0,jimu_core.Yac)(PageBody,{key:pageJson.id,pageJson,renderedPageId,activePagePart,browserSizeMode,pageContext:this.pageContext,visible:!!pageStatus[pageJson.id],headerFooterHeight:this.state.headerHeight+this.state.footerHeight})}isDialogViewOnly(dialogJson){const{browserSizeMode}=this.props;return!!(browserSizeMode!==jimu_core.rHp.Large&&!dialogJson.layout[browserSizeMode])}renderDialog(){const{currentDialogId,urlDialogJson,splashDialogJson,isSplashClosed,isPageDlgClosed,pageDialogJson,pageDialogId}=this.props,showSplash=!isSplashClosed&&splashDialogJson,showPageDlg=!isPageDlgClosed&&pageDialogJson,showUrlDlg=urlDialogJson?(null==splashDialogJson?void 0:splashDialogJson.id)===urlDialogJson.id||(null==pageDialogJson?void 0:pageDialogJson.id)===urlDialogJson.id?null:urlDialogJson:null;return(0,jimu_core.Yac)(jimu_core.q_G.Fragment,null,showUrlDlg&&(0,jimu_core.Yac)(layout_runtime.PageContext.Provider,{value:Object.assign(Object.assign({},this.pageContext),{dialogId:currentDialogId,isDialog:!0,viewOnly:this.isDialogViewOnly(urlDialogJson),rootLayoutId:getDialogLayoutId(currentDialogId)})},(0,jimu_core.Yac)(jimu_core.W2q,{dialogJson:urlDialogJson})),showPageDlg&&(0,jimu_core.Yac)(layout_runtime.PageContext.Provider,{value:Object.assign(Object.assign({},this.pageContext),{dialogId:pageDialogId,isDialog:!0,viewOnly:this.isDialogViewOnly(pageDialogJson),rootLayoutId:getDialogLayoutId(pageDialogJson.id)})},(0,jimu_core.Yac)(jimu_core.W2q,{dialogJson:pageDialogJson,isOpenByPage:!0})),showSplash&&(0,jimu_core.Yac)(layout_runtime.PageContext.Provider,{value:Object.assign(Object.assign({},this.pageContext),{dialogId:splashDialogJson.id,isDialog:!0,viewOnly:this.isDialogViewOnly(splashDialogJson),rootLayoutId:getDialogLayoutId(splashDialogJson.id)})},(0,jimu_core.Yac)(jimu_core.W2q,{dialogJson:splashDialogJson})))}}page_renderer_PageRenderer.displayName="BuilderPageRenderer";const page_renderer_mapStateToProps=(0,jimu_core.Mz0)([state=>jimu_core.WpD.findViewportSize(state.appConfig,state.browserSizeMode).height,(_,ownProps)=>getVisiblePageId(ownProps.pageStatus),(_,ownProps)=>ownProps.dialogId,state=>state.appRuntimeInfo.currentPageId,state=>state.appConfig.pages,state=>state.appConfig.dialogs,state=>state.appConfig.header,state=>state.appConfig.footer,state=>state.appConfig.mainSizeMode,state=>state.browserSizeMode,state=>{var _a;return null!==(_a=state.appRuntimeInfo.activePagePart)&&void 0!==_a?_a:jimu_core.xH7.Body},state=>state.appRuntimeInfo.clipboard,state=>state.appRuntimeInfo.currentDialogId,state=>{var _a;return null===(_a=state.appRuntimeInfo)||void 0===_a?void 0:_a.dialogInfos},state=>state.appConfig.pages[state.appRuntimeInfo.currentPageId].autoOpenDialogId],((minHeight,pageId,dialogId,currentPageId,pages,dialogs,header,footer,mainSizeMode,browserSizeMode,activePagePart,clipboardItem,currentDialogId,dialogInfos,pageDlgId)=>{var _a,_b;if(!pageId||!pages[pageId])return{};const dialogJson=dialogs[Object.keys(dialogs).find((dlgId=>dialogs[dlgId].isSplash))];return{pages,dialogs,header,footer,headerVisible:!!pages[pageId].header,footerVisible:!!pages[pageId].footer,mainSizeMode,browserSizeMode,minHeight,activePagePart,clipboardItem,currentDialogId,splashDialogJson:dialogJson,isSplashClosed:null===(_a=null==dialogInfos?void 0:dialogInfos[null==dialogJson?void 0:dialogJson.id])||void 0===_a?void 0:_a.isClosed,pageDialogId:pageDlgId,pageDialogJson:dialogs[pageDlgId],isPageDlgClosed:null===(_b=null==dialogInfos?void 0:dialogInfos[currentPageId+"-"+pageDlgId])||void 0===_b?void 0:_b.isClosed,urlDialogJson:dialogs[dialogId]}})),page_renderer=(0,jimu_core.j4T)(jimu_core.E_S.connect(page_renderer_mapStateToProps)((0,jimu_theme.SL)(page_renderer_PageRenderer)));try{page_renderer_PageRenderer.displayName="BuilderPageRenderer",page_renderer_PageRenderer.__docgenInfo={description:"",displayName:"BuilderPageRenderer",props:{intl:{defaultValue:null,description:"",name:"intl",required:!0,type:{name:"IntlShape"}},dialogId:{defaultValue:null,description:"",name:"dialogId",required:!1,type:{name:"string"}},pageStatus:{defaultValue:null,description:"store pages that have been rendered\n\nOnly one page will be visible, all other pages will be hidden",name:"pageStatus",required:!0,type:{name:"ImmutableObject<{ [pageId: string]: boolean; }>"}},pages:{defaultValue:null,description:"",name:"pages",required:!0,type:{name:"ImmutableObject<{ [pageId: string]: PageJson; }>"}},header:{defaultValue:null,description:"",name:"header",required:!0,type:{name:"IMHeaderJson"}},headerVisible:{defaultValue:null,description:"",name:"headerVisible",required:!1,type:{name:"boolean"}},footer:{defaultValue:null,description:"",name:"footer",required:!0,type:{name:"IMFooterJson"}},footerVisible:{defaultValue:null,description:"",name:"footerVisible",required:!1,type:{name:"boolean"}},mainSizeMode:{defaultValue:null,description:"",name:"mainSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},browserSizeMode:{defaultValue:null,description:"",name:"browserSizeMode",required:!0,type:{name:"enum",value:[{value:'"SMALL"'},{value:'"MEDIUM"'},{value:'"LARGE"'}]}},minHeight:{defaultValue:null,description:"",name:"minHeight",required:!0,type:{name:"number"}},activePagePart:{defaultValue:null,description:"",name:"activePagePart",required:!0,type:{name:"enum",value:[{value:'"HEADER"'},{value:'"FOOTER"'},{value:'"BODY"'}]}},clipboardItem:{defaultValue:null,description:"",name:"clipboardItem",required:!0,type:{name:"ClipboardItem"}},dialogs:{defaultValue:null,description:"",name:"dialogs",required:!0,type:{name:"ImmutableObject<{ [dlgId: string]: DialogJson; }>"}},currentDialogId:{defaultValue:null,description:"",name:"currentDialogId",required:!1,type:{name:"string"}},splashDialogJson:{defaultValue:null,description:"",name:"splashDialogJson",required:!0,type:{name:"IMDialogJson"}},isSplashClosed:{defaultValue:null,description:"",name:"isSplashClosed",required:!0,type:{name:"boolean"}},pageDialogId:{defaultValue:null,description:"",name:"pageDialogId",required:!0,type:{name:"string"}},pageDialogJson:{defaultValue:null,description:"",name:"pageDialogJson",required:!0,type:{name:"IMDialogJson"}},isPageDlgClosed:{defaultValue:null,description:"",name:"isPageDlgClosed",required:!0,type:{name:"boolean"}},urlDialogJson:{defaultValue:null,description:"",name:"urlDialogJson",required:!0,type:{name:"IMDialogJson"}},theme:{defaultValue:null,description:"",name:"theme",required:!0,type:{name:"IMThemeVariables"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/page-renderer.tsx#BuilderPageRenderer"]={docgenInfo:BuilderPageRenderer.__docgenInfo,name:"BuilderPageRenderer",path:"../jimu-layouts/lib/builder/page-renderer.tsx#BuilderPageRenderer"})}catch(__react_docgen_typescript_loader_error){}try{pagerenderer.displayName="pagerenderer",pagerenderer.__docgenInfo={description:"",displayName:"pagerenderer",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/page-renderer.tsx#pagerenderer"]={docgenInfo:pagerenderer.__docgenInfo,name:"pagerenderer",path:"../jimu-layouts/lib/builder/page-renderer.tsx#pagerenderer"})}catch(__react_docgen_typescript_loader_error){}var hoist_non_react_statics_cjs=__webpack_require__("../node_modules/hoist-non-react-statics/dist/hoist-non-react-statics.cjs.js"),rnd_decorator_rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};function mapStateToRndWrapperProps(state,ownProps){var _a,_b,_c,_d;const layoutId=ownProps.layoutId,selection=state.appRuntimeInfo.selection,layoutItem=ownProps.layoutItem;let selected=!1,isInlineEditing=!1,supportRepeat=!1,isLayoutWidget=!1;if(layoutItem&&(selected=Boolean(selection&&layoutId===selection.layoutId&&layoutItem.id===selection.layoutItemId),layoutItem.type===jimu_core.K6q.Widget)){const widget=state.appConfig.widgets[layoutItem.widgetId],supportInlineEditing=null===(_b=null===(_a=null==widget?void 0:widget.manifest)||void 0===_a?void 0:_a.properties)||void 0===_b?void 0:_b.supportInlineEditing;if(supportRepeat=null===(_d=null===(_c=null==widget?void 0:widget.manifest)||void 0===_c?void 0:_c.properties)||void 0===_d?void 0:_d.supportRepeat,supportInlineEditing){const widgetRuntimeInfo=state.widgetsRuntimeInfo[layoutItem.widgetId];isInlineEditing=widgetRuntimeInfo&&widgetRuntimeInfo.isInlineEditing}isLayoutWidget=layout_runtime.utils.isWidgetHasEmbeddedLayout(layoutItem.widgetId,state.appConfig)}return{selected,supportRepeat,isInlineEditing,isLayoutWidget}}const emptyFunc=()=>null;function rnd_decorator_withRnd(autoSelect){return WrappedComponent=>{class RndWrapper extends jimu_core.q_G.PureComponent{constructor(props){super(props),this.ref=jimu_core.q_G.createRef()}componentDidMount(){const{layoutId,layoutItemId,layoutItem,onResizeStart,onResizing,onResizeEnd,onDragStart,onDragging,onDragEnd,useDragHandler}=this.props;this.ref.current&&(this.interactable=interact_min_default()(this.ref.current).origin("parent"),this.interactable=bindDragHandler(this.interactable,{layoutId,layoutItemId,useDragHandler,onDragging,onDragStart,onDragEnd,itemType:layoutItem.type,rootLayoutId:()=>this.rootLayoutId,restrict:()=>this.props.restrict}),this.interactable=bindResizeHandler(this.interactable,{layoutItemId,onResizing,onResizeStart,onResizeEnd}))}componentWillUnMount(){this.interactable&&(this.interactable.unset(),this.interactable=null)}getStyle(isInlineEditing){return jimu_core.AHW`
          ${this.aspectRatioStyle()};

          &.dragging {
            opacity: 0.9;
          }

          display: flex;
          position: relative;
          touch-action: ${isInlineEditing?"auto":"none"};
          user-select: ${isInlineEditing?"auto":"none"};
        `}aspectRatioStyle(){const{aspectRatio,forceAspectRatio:keepAspectRatio}=this.props;return keepAspectRatio?jimu_core.AHW`
            & > div.rnd-aspect-ratio-wrapper {
              width: 100%;
              position: relative;
              padding-top: ${100*aspectRatio}%;

              & > div {
                position: absolute !important;
                top: 0;
                left: 0;
                bottom: 0;
                right: 0;
              }
            }
          `:jimu_core.AHW`
          & > .rnd-aspect-ratio-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
          }
        `}render(){return(0,jimu_core.Yac)(layout_runtime.PageContext.Consumer,null,(pageContext=>{this.rootLayoutId=pageContext.rootLayoutId;const _a=this.props,{gridSize,draggable,onResizeStart,onResizing,onResizeEnd,style,className,useDragHandler,children}=_a,otherProps=rnd_decorator_rest(_a,["gridSize","draggable","onResizeStart","onResizing","onResizeEnd","style","className","useDragHandler","children"]),{isInlineEditing}=this.props,mergedClass=(0,jimu_core.xWm)("exb-rnd",className,{"functional-widget":!this.props.isLayoutWidget}),mergedStyle="string"==typeof style?JSON.parse(style):Object.assign({},style);return this.props.forceAspectRatio&&(mergedStyle.height="auto"),(0,jimu_core.Yac)("div",{className:mergedClass,ref:this.ref,css:this.getStyle(isInlineEditing),"data-layoutid":this.props.layoutId,"data-layoutitemid":this.props.layoutItemId,"data-repeatable":this.props.supportRepeat,style:mergedStyle},(0,jimu_core.Yac)("div",{className:"rnd-aspect-ratio-wrapper"},(0,jimu_core.Yac)(WrappedComponent,Object.assign({layoutId:this.props.layoutId,className:"w-100",layoutItemId:this.props.layoutItemId},otherProps))),children)}))}}RndWrapper.defaultProps={left:!0,top:!0,right:!0,bottom:!0,restrict:!1,onResizeStart:emptyFunc,onResizing:emptyFunc,onResizeEnd:emptyFunc,onDragStart:emptyFunc,onDragging:emptyFunc,onDragEnd:emptyFunc};const HoistedComponent=hoist_non_react_statics_cjs(RndWrapper,WrappedComponent);return jimu_core.E_S.connect(mapStateToRndWrapperProps)(HoistedComponent)}}try{rnd_decorator_withRnd.displayName="withRnd",rnd_decorator_withRnd.__docgenInfo={description:"",displayName:"withRnd",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/lib/builder/interactive/rnd-decorator.tsx#withRnd"]={docgenInfo:rnd_decorator_withRnd.__docgenInfo,name:"withRnd",path:"../jimu-layouts/lib/builder/interactive/rnd-decorator.tsx#withRnd"})}catch(__react_docgen_typescript_loader_error){}try{withRnd.displayName="withRnd",withRnd.__docgenInfo={description:"",displayName:"withRnd",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#withRnd"]={docgenInfo:withRnd.__docgenInfo,name:"withRnd",path:"../jimu-layouts/layout-builder.tsx#withRnd"})}catch(__react_docgen_typescript_loader_error){}try{CanvasPane.displayName="CanvasPane",CanvasPane.__docgenInfo={description:"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Applying_styles_and_colors",displayName:"CanvasPane",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#CanvasPane"]={docgenInfo:CanvasPane.__docgenInfo,name:"CanvasPane",path:"../jimu-layouts/layout-builder.tsx#CanvasPane"})}catch(__react_docgen_typescript_loader_error){}try{WidgetRendererInBuilder.displayName="WidgetRendererInBuilder",WidgetRendererInBuilder.__docgenInfo={description:"",displayName:"WidgetRendererInBuilder",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},widgetId:{defaultValue:null,description:"",name:"widgetId",required:!0,type:{name:"string"}},isClassLoaded:{defaultValue:null,description:"",name:"isClassLoaded",required:!0,type:{name:"boolean"}},isInlineEditing:{defaultValue:null,description:"",name:"isInlineEditing",required:!0,type:{name:"boolean"}},isFunctionalWidget:{defaultValue:null,description:"",name:"isFunctionalWidget",required:!0,type:{name:"boolean"}},isInController:{defaultValue:null,description:"",name:"isInController",required:!0,type:{name:"boolean"}},hasEmbeddedLayout:{defaultValue:null,description:"",name:"hasEmbeddedLayout",required:!0,type:{name:"boolean"}},useDragHandler:{defaultValue:null,description:"",name:"useDragHandler",required:!0,type:{name:"boolean"}},widgetState:{defaultValue:null,description:"",name:"widgetState",required:!1,type:{name:"any"}},supportInlineEditing:{defaultValue:null,description:"",name:"supportInlineEditing",required:!0,type:{name:"boolean"}},supportRepeat:{defaultValue:null,description:"",name:"supportRepeat",required:!0,type:{name:"boolean"}},canCrossLayoutBoundary:{defaultValue:null,description:"",name:"canCrossLayoutBoundary",required:!0,type:{name:"boolean"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}},widgetStyle:{defaultValue:null,description:"",name:"widgetStyle",required:!0,type:{name:"any"}},hasExtension:{defaultValue:null,description:"",name:"hasExtension",required:!1,type:{name:"boolean"}},widgetJson:{defaultValue:null,description:"",name:"widgetJson",required:!1,type:{name:"IMWidgetJson"}},onInitResizeHandler:{defaultValue:null,description:"",name:"onInitResizeHandler",required:!1,type:{name:"WidgetInitResizeCallback"}},onInitDragHandler:{defaultValue:null,description:"",name:"onInitDragHandler",required:!1,type:{name:"WidgetInitDragCallback"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#WidgetRendererInBuilder"]={docgenInfo:WidgetRendererInBuilder.__docgenInfo,name:"WidgetRendererInBuilder",path:"../jimu-layouts/layout-builder.tsx#WidgetRendererInBuilder"})}catch(__react_docgen_typescript_loader_error){}try{SectionRendererInBuilder.displayName="SectionRendererInBuilder",SectionRendererInBuilder.__docgenInfo={description:"",displayName:"SectionRendererInBuilder",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},selected:{defaultValue:null,description:"",name:"selected",required:!1,type:{name:"boolean"}},autoScroll:{defaultValue:null,description:"",name:"autoScroll",required:!1,type:{name:"boolean"}},animationPreview:{defaultValue:null,description:"",name:"animationPreview",required:!1,type:{name:"boolean"}},hoverPreview:{defaultValue:null,description:"",name:"hoverPreview",required:!1,type:{name:"boolean"}},playMode:{defaultValue:null,description:"",name:"playMode",required:!1,type:{name:"enum",value:[{value:'"AS_ONE"'},{value:'"ONE_BY_ONE"'}]}},previewId:{defaultValue:null,description:"",name:"previewId",required:!1,type:{name:"number"}},watchViewportVisibility:{defaultValue:null,description:"",name:"watchViewportVisibility",required:!1,type:{name:"boolean"}},sectionId:{defaultValue:null,description:"",name:"sectionId",required:!0,type:{name:"string"}},views:{defaultValue:null,description:"",name:"views",required:!0,type:{name:"ImmutableArray<string>"}},activeView:{defaultValue:null,description:"",name:"activeView",required:!1,type:{name:"IMViewJson"}},rotate:{defaultValue:null,description:"",name:"rotate",required:!1,type:{name:"number"}},sectionStyle:{defaultValue:null,description:"",name:"sectionStyle",required:!0,type:{name:"any"}},navInfo:{defaultValue:null,description:"",name:"navInfo",required:!0,type:{name:"IMSectionNavInfo"}},transition:{defaultValue:null,description:"",name:"transition",required:!1,type:{name:"{ type: string; direction?: string; }"}},autoPlay:{defaultValue:null,description:"",name:"autoPlay",required:!1,type:{name:"boolean"}},interval:{defaultValue:null,description:"",name:"interval",required:!1,type:{name:"number"}},loop:{defaultValue:null,description:"",name:"loop",required:!1,type:{name:"boolean"}},focusable:{defaultValue:null,description:"",name:"focusable",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#SectionRendererInBuilder"]={docgenInfo:SectionRendererInBuilder.__docgenInfo,name:"SectionRendererInBuilder",path:"../jimu-layouts/layout-builder.tsx#SectionRendererInBuilder"})}catch(__react_docgen_typescript_loader_error){}try{ShapeL.displayName="ShapeL",ShapeL.__docgenInfo={description:"",displayName:"ShapeL",props:{pos:{defaultValue:null,description:"",name:"pos",required:!0,type:{name:"enum",value:[{value:'"br"'},{value:'"tr"'},{value:'"tl"'},{value:'"bl"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#ShapeL"]={docgenInfo:ShapeL.__docgenInfo,name:"ShapeL",path:"../jimu-layouts/layout-builder.tsx#ShapeL"})}catch(__react_docgen_typescript_loader_error){}try{ShapeRect.displayName="ShapeRect",ShapeRect.__docgenInfo={description:"",displayName:"ShapeRect",props:{direction:{defaultValue:null,description:"",name:"direction",required:!0,type:{name:"enum",value:[{value:'"h"'},{value:'"v"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#ShapeRect"]={docgenInfo:ShapeRect.__docgenInfo,name:"ShapeRect",path:"../jimu-layouts/layout-builder.tsx#ShapeRect"})}catch(__react_docgen_typescript_loader_error){}try{PageRenderer.displayName="layoutbuilder",PageRenderer.__docgenInfo={description:"",displayName:"layoutbuilder",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#layoutbuilder"]={docgenInfo:layoutbuilder.__docgenInfo,name:"layoutbuilder",path:"../jimu-layouts/layout-builder.tsx#layoutbuilder"})}catch(__react_docgen_typescript_loader_error){}try{LayoutItemToolbar.displayName="LayoutItemToolbar",LayoutItemToolbar.__docgenInfo={description:"",displayName:"LayoutItemToolbar",props:{layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItem:{defaultValue:null,description:"",name:"layoutItem",required:!0,type:{name:"IMLayoutItemJson"}},placement:{defaultValue:null,description:"",name:"placement",required:!1,type:{name:"enum",value:[{value:'"bottom"'},{value:'"left"'},{value:'"right"'},{value:'"top"'},{value:'"bottom-end"'},{value:'"bottom-start"'},{value:'"left-end"'},{value:'"left-start"'},{value:'"right-end"'},{value:'"right-start"'},{value:'"top-end"'},{value:'"top-start"'}]}},refElement:{defaultValue:null,description:"",name:"refElement",required:!0,type:{name:"HTMLElement"}},shiftOptions:{defaultValue:null,description:"",name:"shiftOptions",required:!1,type:{name:"{ mainAxis?: boolean; crossAxis?: boolean; limiter?: { fn: (state: MiddlewareState) => Coords; options?: any; }; rootBoundary?: RootBoundary; elementContext?: ElementContext; altBoundary?: boolean; padding?: Padding; boundary?: Boundary; }"}},flipOptions:{defaultValue:null,description:"",name:"flipOptions",required:!1,type:{name:'{ mainAxis?: boolean; crossAxis?: boolean; rootBoundary?: RootBoundary; elementContext?: ElementContext; altBoundary?: boolean; padding?: Padding; fallbackPlacements?: Placement[]; fallbackStrategy?: "initialPlacement" | "bestFit"; fallbackAxisSideDirection?: "none" | ... 1 more ... | "start"; flipAlignment?: boolea...'}},builderTheme:{defaultValue:null,description:"",name:"builderTheme",required:!0,type:{name:"IMThemeVariables"}},formatMessage:{defaultValue:null,description:"",name:"formatMessage",required:!0,type:{name:"(string: any, values?: any) => string"}},toolItems:{defaultValue:null,description:"",name:"toolItems",required:!1,type:{name:"ToolbarConfig"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#LayoutItemToolbar"]={docgenInfo:LayoutItemToolbar.__docgenInfo,name:"LayoutItemToolbar",path:"../jimu-layouts/layout-builder.tsx#LayoutItemToolbar"})}catch(__react_docgen_typescript_loader_error){}try{addItemToLayout.displayName="addItemToLayout",addItemToLayout.__docgenInfo={description:"Add widget or section to a layout, either dragging from the widget list or dragging an existing one.",displayName:"addItemToLayout",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#addItemToLayout"]={docgenInfo:addItemToLayout.__docgenInfo,name:"addItemToLayout",path:"../jimu-layouts/layout-builder.tsx#addItemToLayout"})}catch(__react_docgen_typescript_loader_error){}try{DropArea.displayName="DropArea",DropArea.__docgenInfo={description:"",displayName:"DropArea",props:{layouts:{defaultValue:null,description:"",name:"layouts",required:!0,type:{name:"IMSizeModeLayoutJson"}},isPlaceholder:{defaultValue:null,description:"",name:"isPlaceholder",required:!1,type:{name:"boolean"}},highlightDragover:{defaultValue:null,description:"",name:"highlightDragover",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"any"}},isRepeat:{defaultValue:null,description:"",name:"isRepeat",required:!1,type:{name:"boolean"}},onToggleDragoverEffect:{defaultValue:null,description:"",name:"onToggleDragoverEffect",required:!1,type:{name:"(isDragover: boolean, draggingItem?: LayoutItemConstructorProps) => void"}},onDragEnter:{defaultValue:null,description:"",name:"onDragEnter",required:!1,type:{name:"(draggingItem: LayoutItemConstructorProps) => void"}},onDragOver:{defaultValue:null,description:"",name:"onDragOver",required:!1,type:{name:"(draggingItem: LayoutItemConstructorProps, draggingElement: HTMLElement, containerRect: DOMRect, itemRect: DOMRect & { ...; }, clientX: number, clientY: number, speed?: number) => void"}},onDragLeave:{defaultValue:null,description:"",name:"onDragLeave",required:!1,type:{name:"(draggingItem: LayoutItemConstructorProps) => void"}},onDrop:{defaultValue:null,description:"",name:"onDrop",required:!1,type:{name:"(draggingItem: LayoutItemConstructorProps, containerRect: DOMRect, itemRect: DOMRect & { handlerRect?: DOMRect; }, clientX: number, clientY: number) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#DropArea"]={docgenInfo:DropArea.__docgenInfo,name:"DropArea",path:"../jimu-layouts/layout-builder.tsx#DropArea"})}catch(__react_docgen_typescript_loader_error){}try{WidgetPlaceholder.displayName="WidgetPlaceholder",WidgetPlaceholder.__docgenInfo={description:"",displayName:"WidgetPlaceholder",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},draggable:{defaultValue:null,description:"",name:"draggable",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},onDoubleClick:{defaultValue:null,description:"",name:"onDoubleClick",required:!1,type:{name:"(e: any, layoutInfo: LayoutInfo) => void"}},autoWidth:{defaultValue:null,description:"",name:"autoWidth",required:!1,type:{name:"boolean"}},layoutId:{defaultValue:null,description:"",name:"layoutId",required:!0,type:{name:"string"}},layoutItemId:{defaultValue:null,description:"",name:"layoutItemId",required:!0,type:{name:"string"}},autoHeight:{defaultValue:null,description:"",name:"autoHeight",required:!1,type:{name:"boolean"}},isInSection:{defaultValue:null,description:"",name:"isInSection",required:!1,type:{name:"boolean"}},showDefaultTools:{defaultValue:null,description:"",name:"showDefaultTools",required:!1,type:{name:"boolean"}},resizable:{defaultValue:null,description:"",name:"resizable",required:!1,type:{name:"boolean"}},selectable:{defaultValue:null,description:"",name:"selectable",required:!1,type:{name:"boolean"}},forbidContextMenu:{defaultValue:null,description:"",name:"forbidContextMenu",required:!1,type:{name:"boolean"}},forbidToolbar:{defaultValue:null,description:"",name:"forbidToolbar",required:!1,type:{name:"boolean"}},trailOrder:{defaultValue:null,description:"",name:"trailOrder",required:!1,type:{name:"number"}},forceAspectRatio:{defaultValue:null,description:"",name:"forceAspectRatio",required:!1,type:{name:"boolean"}},aspectRatio:{defaultValue:null,description:"",name:"aspectRatio",required:!1,type:{name:"number"}},resizeObserver:{defaultValue:null,description:"",name:"resizeObserver",required:!1,type:{name:"ResizeObserver"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../jimu-layouts/layout-builder.tsx#WidgetPlaceholder"]={docgenInfo:WidgetPlaceholder.__docgenInfo,name:"WidgetPlaceholder",path:"../jimu-layouts/layout-builder.tsx#WidgetPlaceholder"})}catch(__react_docgen_typescript_loader_error){}}}]);
//# sourceMappingURL=8979.c930746f.iframe.bundle.js.map