/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.1 */
import{a as v,b as T,c as M,d as m,e as j,f as A,g as F}from"./PJWJ6VO3.js";import{c as f,d,e as l}from"./OQ7XDNQ3.js";import{x as u}from"./DE3BWTYY.js";import{i as h,j as g,w as k,x}from"./KTSGK4OT.js";var I=await $arcgis.l("request");function L(){return!!window.MonacoEnvironment?.getWorkerUrl}var V=new Map;function G(e){L()||(window.MonacoEnvironment={getWorker:async(n,t)=>{let a=V.get(t)??`${e}/code-editor/editor.worker.js`;switch(t){case"json":a=`${e}/code-editor/json.worker.js`;break;case"css":a=`${e}/code-editor/css.worker.js`;break;case"html":a=`${e}/code-editor/html.worker.js`;break;case"typescript":case"javascript":a=`${e}/code-editor/ts.worker.js`;break;case"arcade":a=`${e}/code-editor/arcade.worker.js`;break;case"arcgis-sql-expression":a=`${e}/code-editor/sql-expr.worker.js`;break}if(!x(a)||k(a,globalThis.location.href,!0))return new Worker(a,{name:t});let r=await I(a,{responseType:"text"});return new Worker(URL.createObjectURL(new Blob([r.data],{type:"text/javascript"})))}})}async function z(){return(await E()).getArcadeDiagnosticService()}async function E(){return await import("./2NM5FGOW.js")}async function D(e){let{apiVersion:n,bundles:t,hiddenApiItems:a}=e.toEditorProfileDefinition(),r=await $(e.dictionaryVariables);return{apiVersion:n,bundles:t,variables:r,hiddenApiItems:a?.map(i=>i.toLowerCase())}}async function $(e,n=f.Variable){return await Promise.all(e.map(async t=>{switch(t.type){case"dictionary":return await U(t,n);case"feature":return await C(t,n);default:return S(t,n)}}))}function S(e,n){let{name:t,type:a}=e,r=e.getDescription();return{name:t,description:r,type:a,completion:{label:t,detail:t,insertText:t,insertTextMode:l.asIs,insertTextFormat:d.PlainText,kind:n,documentation:{kind:"markdown",value:r}}}}async function C(e,n){let t=await e.loadSource(),{name:a}=e,r=e.getDescription(),i={label:a,detail:a,insertText:a,insertTextMode:l.asIs,insertTextFormat:d.PlainText,kind:n},s={name:a,description:r,type:"dictionary",properties:[],completion:i};if(!t)return s;let[o,c]=j(t.fields,r,!0);return s.properties=o,i.documentation={kind:"markdown",value:c},s}async function U(e,n){let{name:t,dictionaryVariables:a}=e,r=e.getDescription(),i=a.reduce((s,o)=>{s!==""&&(s+=`  
  
`),s+=`**${o.name}**  
${o.type}`;let c=o.getDescription();return c&&(s+=`  
${c}`),s},r);return{name:t,description:r,type:"dictionary",properties:await $(a,f.Field),completion:{label:t,detail:t,insertText:t,insertTextMode:l.asIs,insertTextFormat:d.PlainText,kind:n,documentation:{kind:"markdown",value:i}}}}async function y(e="en"){let n=P.get(e);if(n)return n;if(!h.has(e))return await y("en");try{let t=await fetch(u(`./assets/arcade-language/profiles/arcade-profiles.t9n.${e}.json`));return t.ok?W(e,await t.json()):e==="en"?null:await y("en")}catch{return null}}var P=new Map;function W(e,n){let t=new Map;return n.forEach(a=>{t.set(a.id,a)}),P.set(e,t),t}async function R(e,n="en"){return(await y(n))?.get(e)??null}function q(e){return!!e&&typeof e=="object"&&"additionalVariables"in e&&Array.isArray(e.additionalVariables)}function K(e){return e?.map(w)}function w(e){switch(e.type){case"dictionary":return{...e,type:e.type,properties:K(e.properties)};case"array":return{...e,type:e.type,elementType:{type:"number",name:"number"}};default:return{...e,type:e.type}}}async function O(e,n="en"){if(!m(e))return;let t=await R(e.id,n);if(!t)return;let a={bundles:[...t.bundles],variables:[],hiddenApiItems:e.hiddenApiItems?.map(r=>r.toLowerCase())};return t.variables.forEach(r=>{if(e.disabledVariables?.includes(r.name))return;let i=e.definitions[r.name];switch(r.type){case"dictionary":return a.variables.push(w({...r,type:r.type,properties:Array.isArray(i)?[...i]:r.properties}));case"feature":case"voxel":return v(i)?a.variables.push({...r,type:"feature",definition:i}):void 0;case"featureSet":return T(i)?a.variables.push({...r,type:r.type,definition:i}):void 0;case"featureSetCollection":return M(i)?a.variables.push({...r,type:r.type,definition:i}):void 0;default:return a.variables.push(w(r))}}),q(e)&&a.variables.push(...e.additionalVariables??[]),a}var b=class extends F{constructor(){super("arcade",{apiPath:"./assets/arcade-language/api",apiPrefix:"arcade-api.t9n."})}async setProfileForModel(n,t,a={locale:"en"}){m(t)&&(t=await O(t,a.locale));let r=await g(a.locale,u("./assets/editor-profile/t9n"),"messages.");if(!r)throw new Error(`Failed to load the language bundle for ${a.locale}`);this.disposeForModel(n);let i=this._getApiKey(n),s=new A(t,r);this._modelToProfileMap.set(i,s);let o=await D(s);this.updateApiContextForModel(n,{locale:a.locale,profile:o,snippets:a.snippets})}},p=new b,Y={setProfileForModel:p.setProfileForModel.bind(p),getApiLibraryForModel:p.getApiLibraryForModel.bind(p)};export{G as a,z as b,E as c,p as d};
