/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.1 */
import{b as K,c as f,d as y,e as m}from"./OQ7XDNQ3.js";import{a as q,b as z,c as H,d as _}from"./SRQHJXGF.js";import{b as R,c as B}from"./GUY5ZCFS.js";import{x as O}from"./DE3BWTYY.js";import{l as G,p as A,q as U,t as S,u as P}from"./KTSGK4OT.js";import{Gl as $,Pl as V}from"./FBJBUUZK.js";var[v,be,ge,we,Ce]=await $arcgis.l(["layers/FeatureLayer","request","portal/PortalItem","WebMap","WebScene"]);async function X(t,e){try{let i=await t,r=new Map,n=new Map,o=[],s=fe(e);return i.forEach(u=>{let l=[];u.items.forEach(a=>ye(l,n,r,s,a)),l.length&&o.push({...u,items:l})}),{categories:o,functionDefinitions:r,constantDefinitions:n}}catch(i){return console.error(i),{categories:[],functionDefinitions:new Map,constantDefinitions:new Map}}}function fe(t){let{profile:{apiVersion:e,bundles:i,hiddenApiItems:r=[]}={}}=t,n=Y(e),o=Array.isArray(i)&&i.length>0?new Set(["core",...i]):void 0;return s=>_e(n,s.sinceVersion)&&(!o||o.has(s.bundle))&&!r.includes(s.name)}function ye(t,e,i,r,n){if(Array.isArray(n)){n.forEach(o=>Q(t,i,r,o));return}n.type==="constant"?me(t,e,r,n):Q(t,i,r,n)}function Q(t,e,i,r){if(!i(r))return;r.disableDocumentation||t.push(r);let{completion:{label:n}}=r,o=n.toLowerCase(),s=e.get(o);s||(s={type:"functionDefinition",key:o,overloads:[]},e.set(o,s)),s.overloads.push(r)}function me(t,e,i,r){if(!i(r))return;t.push(r);let{completion:{label:n}}=r,o=n.toLowerCase();e.set(o,r);let[s,u]=r.completion.label.split(".");if(!u)return;let l=s.toLowerCase(),a=e.get(l);a||(a={type:"namespace",key:l,members:[],completion:{label:s,detail:s,insertText:s,insertTextMode:m.adjustIndentation,insertTextFormat:y.PlainText,kind:f.Enum}},e.set(l,a));let h=structuredClone(r);h.name=u,h.completion.label=u,h.completion.insertText=u,h.completion.kind=f.Constant,a.members.push(h),a.completion.documentation=a.members.reduce((d,W)=>(d.value=`${d.value}${d.value?`

`:""}**${W.completion.label}**: ${W.description}`,d),{kind:K.Markdown,value:""})}function Y(t){if(!t||typeof t!="string")return null;let e=t.split(".").map(n=>Number.parseInt(n));if(e.some(Number.isNaN))return console.error("Invalid API version string",t),null;let[i,r]=e.slice(0,2);return{major:i,minor:r}}function _e(t,e){if(!t)return!0;let i=Y(e);return i?t.major>i.major?!1:t.minor===void 0||i.minor===void 0?!0:i.minor<=t.minor:!0}function se(t){return!!t&&typeof t=="object"&&"declaredClass"in t&&typeof t.declaredClass=="string"&&t.declaredClass.startsWith("esri.layers.")&&x(t)&&"queryFeatures"in t&&typeof t.queryFeatures=="function"}function De(t){return!!t&&typeof t=="object"&&"allLayers"in t&&"allTables"in t&&typeof t.allLayers=="object"&&typeof t.allTables=="object"}function oe(t){return!!t&&typeof t=="object"&&"declaredClass"in t&&typeof t.declaredClass=="string"&&(t.declaredClass==="esri.Map"||t.declaredClass==="esri.WebMap"||t.declaredClass==="esri.WebScene")}function Se(t){return!!t&&typeof t=="object"&&"loadAll"in t&&typeof t.loadAll=="function"}function ae(t){return!!t&&typeof t=="object"&&"portalItem"in t&&t.portalItem!=null}function le(t){return!!t&&typeof t=="object"&&"portalItem"in t&&t.portalItem!=null}function x(t){return!!t&&typeof t=="object"&&"fields"in t&&Array.isArray(t.fields)}function I(t){return!!t&&typeof t=="object"&&"url"in t&&typeof t.url=="string"}function ve(t){return I(t)&&/\/(?:featureserver|mapserver)(?:\/|$)/iu.test(t.url??"")}function Xe(t){return I(t)||x(t)||le(t)}function Ye(t){return I(t)||x(t)||le(t)}function Ze(t){return ae(t)||oe(t)||ve(t)}function Z(t){return!!t&&typeof t=="object"&&"declaredClass"in t&&t.declaredClass==="esri.layers.support.Subtype"}function L(t){return!!t&&typeof t=="object"&&"declaredClass"in t&&t.declaredClass==="esri.layers.support.CodedValueDomain"}function Fe(t){return!!t&&typeof t=="object"&&"declaredClass"in t&&t.declaredClass==="esri.layers.support.InheritedDomain"}function Je(t){return!!t&&typeof t=="object"&&"id"in t&&typeof t.id=="string"&&"definitions"in t&&typeof t.definitions=="object"&&!Array.isArray(t.definitions)}function F(t){return!!t&&typeof t=="object"&&"title"in t&&typeof t.title=="string"}function Te(t){return!!t&&typeof t=="object"&&"url"in t&&typeof t.url=="string"}function pe(t){return!!t&&typeof t=="object"&&"layerId"in t&&typeof t.layerId=="number"}function j(t){return!!t&&typeof t=="object"&&"typeIdField"in t&&"types"in t}function J(t){return!!t&&typeof t=="object"&&"getFieldDomain"in t&&typeof t.getFieldDomain=="function"}function b(t){return!!t&&typeof t=="object"&&"subtypeField"in t}function Me(t){return b(t)&&"subtypes"in t}function xe(t){return!!t&&typeof t=="object"&&"portalItem"in t}function Ie(t){return pe(t)&&"relationships"in t&&"url"in t&&Array.isArray(t.relationships)&&typeof t.url=="string"}function Ae(t){return!!t&&typeof t=="object"&&"isTable"in t&&typeof t.isTable=="boolean"}function Pe(t){return!!t&&typeof t=="object"&&"load"in t&&typeof t.load=="function"}async function ce(t){if(!t)return null;let e;return x(t)?e=t:e=new v(t),Pe(e)&&await e.load(),e}async function $e(t){t+="/layers";let e=await be(t,{responseType:"json",query:{f:"json"}}),i=t.endsWith("MapServer/layers")?"data":"query",r=ee(e.data?.layers,i),n=ee(e.data?.tables,i);return{layers:r,tables:n}}function ee(t,e){return t?t.filter(i=>{switch(i.type){case"Feature Layer":case"Oriented Imagery Layer":case"Catalog Layer":case"Table":return(i.capabilities?i.capabilities.toLowerCase().split(",").map(r=>r.trim()):[]).includes(e);default:return!1}}):[]}async function Ve(t,e){let i=new v({url:`${t.url}/${e.relatedTableId}`});return await i.load(),i}function ue(t){return(e,i)=>{if(e.type==="oid")return-1;if(i.type==="oid")return 1;if(b(t)){if(e.name===t.subtypeField)return-1;if(i.name===t.subtypeField)return 1}if(j(t)){if(e.name===t.typeIdField)return-1;if(i.name===t.typeIdField)return 1}return e.name.localeCompare(i.name,"en",{sensitivity:"base"})}}function te(t,e){return t?.every(i=>i.domains?.[e.name]?.type==="inherited")??!1}var Le=/^[a-z_$][a-z0-9_$]*$/giu;function he(t,e=!0){return t.match(Le)?`${e?".":""}${t}`:`["${t}"]`}function de(t,e){return t?`${t}${he(e)}`:e}function ie(t){return xe(t)?t.portalItem:null}function et(t,e,i=!1){let r=e,n=[],o=[];return H(t).forEach(s=>{r&&(r+=`  
  
`),r+=`**${s.name}** (${s.alias})  
${s.type}`,s.description&&(r+=`  
'${s.description}`);let u=z(s),l=he(s.name,!1),a=_(s);if(n.push({name:s.name,description:a,type:u,completion:{label:s.name,detail:a,insertText:l,insertTextMode:m.asIs,insertTextFormat:y.PlainText,kind:f.Field}}),i){if(!s.alias||s.alias.toLowerCase()===s.name.toLowerCase())return;let h=`**${s.alias}**  
${s.type}`;s.description&&(h+=`  
'${s.description}`),o.push({name:s.alias,description:s.name,type:u,completion:{label:s.alias,detail:s.name,insertText:l,insertTextMode:m.asIs,insertTextFormat:y.PlainText,kind:f.Field,documentation:{kind:"markdown",value:h}}})}}),[[...n,...o],r]}var T=class{constructor(e,i,r){this._profile=e,this._label=i,this.description=r,this.filterDescription=!1}getLabel(){return this._label==null?"":typeof this._label=="string"?U(this._label):A(this._profile?.intlStrings[this._label.code],this._label.formatValues)}getDescription(){return this.description==null?"":typeof this.description=="string"?this.description:A(this._profile?.intlStrings[this.description.code],this.description.formatValues)}passFilter(e){return!e||e.test(this.getLabel())?!0:this.filterDescription&&e.test(this.getDescription())}},g=class extends T{constructor(e){super(e.profile,e.label,e.description??e.declaration?.description),this.declaration=e.declaration??{},this.name=e.declaration?.name??"",this.snippet=e.snippet??"",this.nonInteractive=e.nonInteractive??!1,this.filterDescription=e.filterDescription??!1,this.icon=e.icon}},p=class extends g{constructor(e){super(e),this.type="text",this.isCollection=!1,this.type=e.declaration?.type??"text"}getDescription(){return this.description==null?this._profile?.intlStrings[this.type.toLowerCase()]??"":super.getDescription()}toProfileVariableDefinition(){return{type:this.type,name:"",...this.declaration}}},E=class extends g{constructor(e){super(e),this.type="array",this.isCollection=!1,this.elementType=e.declaration?.elementType??{type:"number",name:"number"}}getDescription(){return this.description==null?this._profile?.intlStrings[this.type.toLowerCase()]??"":super.getDescription()}toProfileVariableDefinition(){return{type:this.type,elementType:this.elementType,name:"",...this.declaration}}},w=class extends g{constructor(e,i){super(i),this.owner=e,this.isCollection=!0,this._loaded=!0,this.variables=[]}get breadcrumb(){if(this.owner){let e=this.owner.breadcrumb;return e?`${e} / ${this.name}`:this.name}return this.name}get loaded(){return this._loaded}get informationUrl(){return null}get informationType(){return""}},c=class extends T{constructor(e,i,r=[],n=!1){super(e,i),this.variables=r,this.isHeader=n,this.type="group",this.isCollection=!0}passFilter(){return!0}},C=class t extends w{constructor(e,i){super(e,i),this.type="dictionary",this.dictionaryVariables=[],this.loadPropertyDeclarations(i.declaration?.properties),this.snippet&&this.dictionaryVariables.length&&(this.variables=[new c(this._profile,this.snippet,this.dictionaryVariables)])}async loadSource(){}loadPropertyDeclarations(e){this.dictionaryVariables=this.createVariableInstances(e),this.variables=this.dictionaryVariables}createVariableInstances(e){if(!Array.isArray(e))return[];let i=[];return e.forEach(r=>{let n=this.createVariableInstance(r);n&&i.push(n)}),i}createVariableInstance(e){let i=de(this.snippet,e.name);switch(e.type){case"number":case"text":case"boolean":case"date":case"dateOnly":case"time":case"geometry":case"knowledgeGraph":return new p({profile:this._profile,declaration:e,label:i,snippet:i});case"feature":return new k(this,{profile:this._profile,declaration:e,label:i,snippet:i});case"featureSet":return new D(this,{profile:this._profile,declaration:e,label:i,snippet:i},[new p({profile:this._profile,label:i,description:"",snippet:i})]);case"featureSetCollection":return new N(this,{profile:this._profile,declaration:e,label:i,snippet:i});case"dictionary":return new t(this,{profile:this._profile,declaration:e,label:i,snippet:i});case"array":return new E({profile:this._profile,declaration:e,label:i,snippet:i});default:return console.error("Editor profile: Invalid profile variable",e),null}}toProfileVariableDefinition(){return{type:this.type,name:"",...this.declaration,properties:this.dictionaryVariables.map(e=>e.toProfileVariableDefinition())}}},M=class extends w{constructor(e,i,r){super(e,i),this.relationshipsProperties=r,this._source=null,this._loaded=!1,this._definition=i.declaration?.definition}get title(){return F(this._source)?this._source.title??"":""}get url(){return Te(this._source)?this._source.url??"":""}get informationUrl(){return!this.loaded||!this.url?null:pe(this._source)?`${this.url}/${this._source.layerId}`:this.url}get informationType(){return this._profile?.intlStrings.layer??"layer"}async loadSource(){return S(this._loadPromise)&&P(this._loadPromise)?await this._loadPromise:(this._loadPromise=this._loadSource(),await this._loadPromise)}_getValueSnippet(e){return this.type==="feature"?de(this.snippet,e.name):e.name}_getSubtypeOrDomainNameSnippet(e){return this.type!=="feature"?null:b(this._source)&&e.name===this._source.subtypeField?`SubtypeName(${this.snippet})`:`DomainName(${this.snippet}, "${e.name}")`}_getFieldProperty(e){let i=this._getDomainDictionary(e);if(i)return i;let r=this._getValueSnippet(e);return new p({profile:this._profile,label:r,description:_(e),snippet:r,icon:q(e),filterDescription:!0})}_getDomainDictionary(e){return J(this._source)?b(this._source)&&this._source.subtypeField?this._getSubtypeDomainDictionary(e):j(this._source)&&this._source.typeIdField?this._getFeatureTypeDomainDictionary(e):this._getFieldDomainDictionary(e):null}_getSubtypeDomainDictionary(e){if(!b(this._source))return null;if(!Me(this._source))return e.name===this._source.subtypeField?null:this._getFieldDomainDictionary(e);if(e.name===this._source.subtypeField){let n=this._createDomainDictionary(e);return n.icon="subtype",n.variables.push(this._getTypeOrSubtypeDomainGroup(this._source.subtypes,e)),n}if(te(this._source.subtypes,e))return this._getFieldDomainDictionary(e);let i=this._getDomainValuesGroup(this._source.subtypes,e);if(!i)return null;let r=this._createDomainDictionary(e);return r.variables.push(i),r}_getFeatureTypeDomainDictionary(e){if(!j(this._source))return null;if(e.name===this._source.typeIdField){let n=this._createDomainDictionary(e);return n.variables.push(this._getTypeOrSubtypeDomainGroup(this._source.types,e)),n}if(te(this._source.types,e))return this._getFieldDomainDictionary(e);let i=this._getDomainValuesGroup(this._source.types,e);if(!i)return null;let r=this._createDomainDictionary(e);return r.variables.push(i),r}_getFieldDomainDictionary(e){if(!J(this._source))return null;let i=this._source.getFieldDomain(e.name);if(!L(i))return null;let r=this._getCodedValueDomainGroup(i,{code:"domainvalues"}),n=this._createDomainDictionary(e);return n.variables.push(r),n}_getTypeOrSubtypeDomainGroup(e,i){if(L(i.domain))return this._getCodedValueDomainGroup(i.domain,{code:"subtypes"});let r=e?.map(n=>{let o=Z(n)?n.code:n.id;return new p({profile:this._profile,label:`${o}`,description:n.name,snippet:`"${o}"`})})??[];return new c(this._profile,{code:"subtypes"},r)}_getCodedValueDomainGroup(e,i){let r=e.codedValues.map(n=>new p({profile:this._profile,label:`${n.code}`,description:n.name,snippet:`"${n.code}"`,filterDescription:!0}));return new c(this._profile,i,r)}_getDomainValuesGroup(e,i){let r=[];return!e||e.length===0||(e.forEach(n=>{let o=n.domains?.[i.name];if(!o||Fe(o)||!L(o))return;let s=_(i),u=this._getCodedValueDomainGroup(o,{code:"domainvaluesfortypeformat",formatValues:{fieldName:s,typeName:n.name}}),l=Z(n)?n.code:n.id,a=`${l}`,h=`"${l}""`,d=new C(this,{profile:this._profile,label:a,snippet:h,description:n.name,declaration:{name:s}});d.variables=[u],r.push(d)}),!r.length)?null:new c(this._profile,{code:"domainvaluesbysubtypes"},r)}_createDomainDictionary(e){let i=this._getValueSnippet(e),r=_(e),n=new C(this,{profile:this._profile,label:i,description:r,snippet:i,icon:"form-dropdown",declaration:{name:e.name}}),o=new c(this._profile,r,[new p({profile:this._profile,label:i,description:"",snippet:i})]);n.variables=[o];let s=this._getSubtypeOrDomainNameSnippet(e);return s&&o.variables.push(new p({profile:this._profile,label:s,description:"",snippet:s})),n}async _getRelationshipsProperty(){if(!this.relationshipsProperties?.exposeRelationships||!this._profile?.supportFeatureSetFunctions)return null;let e=this._source;if(!Ie(e))return null;let i=new c(this._profile,{code:"relationships"}),r=await Promise.all(e.relationships?.map(async n=>{let o=await Ve(e,n);if(!se(o)||n.relatedTableId===this.relationshipsProperties?.sourceTableId)return null;let s=`FeatureSetByRelationshipName(${this.snippet}, "${n.name}")`;return new D(this,{profile:this._profile,declaration:{definition:o},label:o.title,description:"",nonInteractive:!0},[new p({profile:this._profile,label:s,description:"",snippet:s})],{exposeRelationships:!0,sourceTableId:e.layerId})})??[]);return i.variables=r.filter(S),i.variables.length?i:null}},k=class extends M{constructor(e,i){super(e,i,{exposeRelationships:!0}),this.type="feature"}get title(){return F(this._source)?this._source.title??"":{code:"feature"}}async _loadSource(){if(this.loaded)return this._source;try{if(this._source=await ce(this._definition),!this._source)throw new Error("Invalid definition");let e=F(this._source)?this._source.title??"":"";this.variables.push(new c(this._profile,e,[new p({profile:this._profile,label:this.snippet,description:"",snippet:this.snippet})]));let i=new c(this._profile,{code:"values"});if(this.variables.push(i),Ae(this._source)&&!this._source.isTable){let n=`Geometry(${this.snippet})`,o=new p({profile:this._profile,declaration:{name:n},label:n,description:"Geometry",snippet:n,icon:"shapes",filterDescription:!0});i.variables.push(o)}this._source.fields.sort(ue(this._source)).forEach(n=>{i.variables.push(this._getFieldProperty(n))});let r=await this._getRelationshipsProperty();r&&this.variables.push(r)}catch(e){console.error("Error with definition",e,this._definition),this._source=null}finally{this._loaded=!0}return this._source}toProfileVariableDefinition(){return{type:this.type,name:"",...this.declaration,definition:this._definition}}},D=class extends M{constructor(e,i,r=[],n){super(e,i,n),this.featureSetSnippets=r,this.type="featureSet"}get title(){return F(this._source)?this._source.title??"":{code:"featureset"}}async _loadSource(){if(this.loaded)return this._source;try{if(this._source=await ce(this._definition),!this._source)throw new Error("Invalid definition");this.variables.push(new c(this._profile,this.title,this.featureSetSnippets,!0));let e=new c(this._profile,{code:"fields"});this.variables.push(e),e.variables=this._source.fields.sort(ue(this._source)).map(r=>this._getFieldProperty(r));let i=await this._getRelationshipsProperty();i&&this.variables.push(i)}catch(e){console.error("Error with definition",e,this._definition),this._source=null}finally{this._loaded=!0}return this._source}toProfileVariableDefinition(){return{type:this.type,name:"",...this.declaration,definition:this._definition}}},N=class extends w{constructor(e,i){super(e,i),this.type="featureSetCollection",this._featureSetCollections=null,this._loaded=!1,this._definition=i.declaration?.definition}get informationUrl(){return!this.loaded||!this._featureSetCollections?null:typeof this._featureSetCollections.source!="string"?R(ie(this._featureSetCollections.source)):null}get informationType(){if(!this.loaded||!this._featureSetCollections)return"";if(typeof this._featureSetCollections.source=="string")return this._profile?.intlStrings.featureservice??"featureservice";switch(this._featureSetCollections.source.declaredClass){case"esri.WebMap":return this._profile?.intlStrings.webmap??"webmap";case"esri.WebScene":return this._profile?.intlStrings.webscene??"webscene";default:return this._profile?.intlStrings.map??"map"}}async loadSource(){return S(this._loadPromise)&&P(this._loadPromise)?await this._loadPromise:(this._loadPromise=this._loadSource(),await this._loadPromise)}async _loadSource(){if(this.loaded)return this._featureSetCollections;try{if(this._featureSetCollections=await this._featureSetCollectionsFromDefinition(),!this._featureSetCollections)throw new Error("Invalid definition");let e=typeof this._featureSetCollections.source=="string"?{code:this._featureSetCollections.source.endsWith("FeatureServer")?"featureservice":"mapservice"}:{code:"webmapformat",formatValues:{webMapTitle:ie(this._featureSetCollections.source)?.title||"Untitled map"}},i=new c(this._profile,e,[new p({profile:this._profile,label:this.snippet,description:"",snippet:this.snippet})]),r=new c(this._profile,{code:"layers"},this._featureSetCollections.layers),n=new c(this._profile,{code:"tables"},this._featureSetCollections.tables);this.variables.push(i,r,n)}catch(e){console.error("Error with definition",e,this._definition),this._featureSetCollections=null}finally{this._loaded=!0}return this._featureSetCollections}async _featureSetCollectionsFromDefinition(){return this._definition?oe(this._definition)?await this._featureSetCollectionFromMap(this._definition):I(this._definition)?await this._featureSetCollectionFromUrl(this._definition.url):ae(this._definition)?await this._featureSetCollectionFromPortalItem(this._definition.portalItem):null:null}async _featureSetCollectionFromMap(e){return Se(e)&&await e.loadAll(),await Promise.all(e.tables.map(async i=>await i.load())),{layers:this._convertWebMapLayersToVariables(e.layers),tables:this._convertWebMapLayersToVariables(e.tables,!0),source:e}}async _featureSetCollectionFromPortalItem(e){let i=new ge(e);switch(await i.load(),i.type){case"Web Map":{let r=new we({portalItem:i});return await this._featureSetCollectionFromMap(r)}case"Web Scene":{let r=new Ce({portalItem:i});return await this._featureSetCollectionFromMap(r)}case"Feature Service":return await this._featureSetCollectionFromUrl(i.url);default:return console.error("Unsupported portal item",e),null}}async _featureSetCollectionFromUrl(e){let i=e?.replace(/\/featureserver\/[0-9]*/iu,"/FeatureServer");if(i=i?.replace(/\/mapserver\/[0-9]*/iu,"/MapServer"),i=i?.split("?")[0],!i)return null;let r=await $e(i),n=Promise.all(r.layers.map(async l=>{let a=new v({url:`${i}/${l.id}`});return await a.load(),this._createFeatureSetVariable(a)})),o=Promise.all(r.tables.map(async l=>{let a=new v({url:`${i}/${l.id}`});return await a.load(),this._createFeatureSetVariable(a)})),[s,u]=await Promise.all([n,o]);return{layers:s,tables:u,source:i}}_convertWebMapLayersToVariables(e,i=!1){let r=[];return e.toArray().reverse().forEach(n=>{if(se(n)){r.push(this._createFeatureSetVariable(n,!0));return}if(De(n)){let o=i?this._convertWebMapLayersToVariables(n.allTables,!0):this._convertWebMapLayersToVariables(n.allLayers);r.push(...o)}}),r}_createFeatureSetVariable(e,i=!1){return new D(this,{profile:this._profile,declaration:{name:e.title??"",definition:e},label:i?e.title:e.sourceJSON.name??e.title,description:"",nonInteractive:!0},this._makeFeatureSetSnippets(e,i))}_makeFeatureSetSnippets(e,i=!1){if(!this._profile?.supportFeatureSetFunctions)return[];if(i){let r=`FeatureSetById(${this.snippet}, "${e.id}")`,n=`FeatureSetByName(${this.snippet}, "${e.title}")`;return[new p({profile:this._profile,label:r,description:"",snippet:r}),new p({profile:this._profile,label:n,description:"",snippet:n})]}else{let r=`FeatureSetById(${this.snippet}, "${e.layerId}")`;return[new p({profile:this._profile,label:r,description:"",snippet:r})]}}toProfileVariableDefinition(){return{type:this.type,name:"",...this.declaration,definition:this._definition}}},re=class extends C{constructor(e,i,r="en"){super(void 0,{profile:null,declaration:{properties:[]}}),this.definition=e,this.intlStrings=i,this.locale=r,this.variables=[],this._profile=this,this.loadPropertyDeclarations(e?.variables)}get supportFeatureSetFunctions(){return this.definition?.bundles?.includes("data-access")??!1}toEditorProfileDefinition(){return{...this.definition,variables:this.dictionaryVariables.map(e=>e.toProfileVariableDefinition())}}},je={locale:"en"},ne=class{constructor(e,i){this.languageId=e,this._apiConfig=i,this._onDidChange=new $,this._modelToProfileMap=new Map,this._modelToApiContextMap=new Map,this._localeToApiLibraryPromiseMap=new Map,this._onModelContextDidChange=new $,this._onDidModelContextChangeTimeout=-1,this.workerHost={getApiLibrary:async r=>await this.getApiLibrary(r)},B().then(r=>{r.onWillDisposeModel(n=>{this.disposeForModel(n.uri)})})}_fireModelContextDidChange(e){this._onDidModelContextChangeTimeout===-1&&(this._onDidModelContextChangeTimeout=window.setTimeout(()=>{this._onDidModelContextChangeTimeout=-1,this._onModelContextDidChange.fire(e)},0))}_getApiKey(e){return V.isUri(e)||(e=V.parse(e)),e.toString()}get onDidChange(){return this._onDidChange.event}disposeForModel(e){let i=this._getApiKey(e);this._modelToProfileMap.delete(i),this._modelToApiContextMap.delete(i)&&this._fireModelContextDidChange(i)}getEditorProfileForModel(e){return this._modelToProfileMap.get(this._getApiKey(e))}getApiContextForModel(e){return this._modelToApiContextMap.get(this._getApiKey(e))??je}updateApiContextForModel(e,i){let r=this._getApiKey(e),n=this._modelToApiContextMap.get(r)??{};this._modelToApiContextMap.set(r,{...n,...i}),this._fireModelContextDidChange(r)}get onModelContextDidChange(){return this._onModelContextDidChange.event}async getApiLibraryForModel(e){let i=this.getApiContextForModel(e),r=this.getApiLibrary(i.locale??"en");return(await X(r,i)).categories}async fetchApiLibrary(e){try{let{apiPath:i,apiPrefix:r}=this._apiConfig,n=O(`${i}/${r}${e}.json`),o=await fetch(n);return o.ok?await o.json():[]}catch{return[]}}async getApiLibrary(e){let i=G(e);return this._localeToApiLibraryPromiseMap.has(i)||this._localeToApiLibraryPromiseMap.set(i,this.fetchApiLibrary(i)),await this._localeToApiLibraryPromiseMap.get(i)??[]}};export{Xe as a,Ye as b,Ze as c,Je as d,et as e,re as f,ne as g};
