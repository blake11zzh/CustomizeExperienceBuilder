/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
*/
import e from"../../../../../core/Error.js";import{getMetersPerVerticalUnitForSR as t,getMetersPerUnitForSR as o}from"../../../../../core/unitUtils.js";import{isLoadedSharedTemplate as n,isSharedPresetTemplate as r,isSharedFeatureTemplate as s}from"../../../../templateUtils.js";import{createPresetServiceEdit as i,createFeatureServiceEdit as a}from"../../support/createServiceEdit.js";import l from"../../../../../geometry/Polygon.js";import{isPoint as u,isPolygon as f}from"../../../../../geometry/support/jsonUtils.js";function p({edits:t,mode:o,relationships:l,shape:f,templatePart:p},c=""){if(null===p)return;const{template:m}=p;if(!n(m))throw new e("shared-template:template-not-loaded","A template part's template must be loaded before use");if(r(m)){if(!u(f))throw new e("shared-template:invalid-geometry","Preset templates must have a point geometry");i({geometry:f,template:m,edits:t,relationships:l,rotation:0,mode:o,tag:c})}else s(m)&&a({geometry:f,template:m,edits:t,relationships:l,tag:c})}function c(e,t){if(!e||!f(e))return null;if(!t.hasZ&&!t.hasM)return e;let o=null,n=null;const r=t.hasZ&&t.hasM?3:2;switch(t.type){case"point":o=t.hasZ?t.z:null,n=t.hasM?t.m:null;break;case"polygon":case"polyline":{const e="polygon"===t.type?t.rings:t.paths;for(const s of e)for(const e of s)t.hasZ&&(null===o||e[2]>o)&&(o=e[2]),t.hasM&&(null===n||e[r]>n)&&(n=e[r])}break;case"multipoint":for(const e of t.points)t.hasZ&&(null===o||e[2]>o)&&(o=e[2]),t.hasM&&(null===n||e[r]>n)&&(n=e[r]);break;default:return e}const s=Z(e.rings,t.hasZ,t.hasM,o,n);return new l({rings:s,spatialReference:e.spatialReference,hasZ:t.hasZ,hasM:t.hasM})}function m(e){let n=1;if(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid){n=t(e.spatialReference)/o(e.spatialReference)}return n}function h(e){let t=!1;return void 0!==e.byNumber&&(t=!0===e.byNumber),t}function d(e){let t=0;return void 0!==e.count&&(t=e.count),t}function g(e,t){let o=0;return t?void 0!==e.proportional&&(o=e.proportional):void 0!==e.distanceValue&&(o=e.distanceValue),t&&(o/=100),o}function y(e){return!0===e.isProportional}function v(e){return!1!==e.createUnique}function b(e){let t=0;return void 0!==e.offsetDistance&&(t=e.offsetDistance),void 0!==e.side&&1===e.side&&(t*=-1),t}function M(e){return!0===e.vertexBeforeOffset}function Z(e,t,o,n,r){const s=[];for(const i of e)s.push(j(i,t,o,n,r));return s}function j(e,t,o,n,r){const s=[];for(const i of e){const e=[i[0],i[1]];t&&(e[2]=n),o&&(e[t?3:2]=r),s.push(e)}return s}export{c as correctZandMFollowingBuffer,m as getHeightUnitCorrectionFactor,p as makeFeatureFromGroupPart,h as readByNumber,d as readCount,g as readDistance,y as readIsProportional,v as readIsUnique,b as readOffsetDistance,M as readVertexBeforeOffset};
