/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import t from"../../../../core/Accessor.js";import r from"../../../../core/Collection.js";import s from"../../../../core/ReactiveMap.js";import{property as o}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/RandomLCG.js";import{subclass as a}from"../../../../core/accessorSupport/decorators/subclass.js";import{SketchHandlerMixin as i}from"../../mixins/SketchHandlerMixin.js";let c=class extends(i(t)){constructor(e){super(e),this.savedGraphics=new r,this.type="data-capture",this.pendingGraphics=new s}get collectionId(){return this.viewModel.collectionId}handleCreate(e){const{state:t,graphic:r,tool:s}=e,o=r?.geometry;if("complete"!==t||!r||!o)return;const{collectionId:a,viewModel:{dataCaptureLayer:i,currentBestFeature:c,imageGeometryField:d,oiObjectIdField:n},pendingGraphics:l}=this;c&&d&&a&&n&&(p(r,o,d,n,c,l,a,i),this.viewModel.emit("after-data-capture-complete",{pendingGraphics:l.get(a)?.toArray()??null}),this.viewModel.sketch?.create(s))}handleDelete(e){const{dataCaptureLayer:t}=this.viewModel;if(!t)return;const{graphics:r}=e;this.pendingGraphics.get(t.id)?.removeMany(r),this.savedGraphics.removeMany(r),this.viewModel.deleteDataCaptureFeatures(d(r))}handleDestroy(){const{dataCaptureLayer:e}=this.viewModel;e&&(this.viewModel.stopDataCapture(e.id),this.savedGraphics.removeAll(),this.pendingGraphics=null)}handleUpdate(e){const{toolEventInfo:t,state:r,graphics:s}=e;if(t)this.viewModel.sketch?.undo();else switch(r){case"complete":this.viewModel.emit("deselect-data-capture-features",{graphics:s});break;case"start":this.viewModel.emit("select-data-capture-features",{graphics:s})}}};function p(e,t,s,o,a,i,c,p){e.sourceLayer=p,e.attributes=e.attributes??{},e.attributes[s]=btoa(JSON.stringify(t.toJSON())),e.attributes[o]=a.attributes.objectId,i.has(c)||i.set(c,new r);i.get(c).add(e)}function d(e){return e.map((({attributes:e,sourceLayer:t})=>{const r=t?.objectIdField;return r?e[r]:null})).filter(Boolean)}e([o()],c.prototype,"collectionId",null),e([o()],c.prototype,"savedGraphics",void 0),e([o()],c.prototype,"type",void 0),e([o()],c.prototype,"pendingGraphics",void 0),c=e([a("esri.widgets.OrientedImageryViewer.adapters.sketch.DataCaptureAdapter")],c);const n=c;export{n as default};
