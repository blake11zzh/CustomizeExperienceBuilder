/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See LICENSE.md for details.
 * v4.32.1
 */
import{r as t,c as i,g as s,h as e,H as a,a as h}from"./p-ccd1c88c.js";import{I as o,D as n,M as r,$ as c,q as l}from"./p-247471b0.js";import{x as d,n as m,Z as u,k as g,f,p,M as b,W as C,O as v,r as x}from"./p-33adbadb.js";import{C as y}from"./p-e3e7b132.js";import{c as M,d as k}from"./p-13fd0548.js";import{g as w,s as I}from"./p-0a7e5e35.js";import{s as L}from"./p-19e9f8db.js";import{A as O}from"./p-258dc913.js";import{i as E}from"./p-7f5c1ec3.js";import{W as N}from"./p-5a099bb2.js";const B="tab",j="arcgis-charts-rtl";function A(t,i){const s=new Set;let e=i;return t?.forEach(((t,a)=>{const h=t.getChartId();(s.has(h)||void 0===h||""===h)&&(t.setChartId(`Chart_${Date.now()}_${a}`),i===h&&(e=t.getChartId())),s.add(h)})),e}function D(t,i,s){return t?.filter((t=>d(s,t.getConfig())&&t.getLayer()?.id===i))??[]}function S(t,i){const s=t,e=s?.charts?.findIndex((t=>t.id===i.getChartId()));s?.charts&&void 0!==e&&e>-1?s.charts[e]=i.getConfig():s&&function(t,i){const s=t;s?.charts?s.charts.push(i.getConfig()):s&&(s.charts=[i.getConfig()])}(t,i)}const T=class{constructor(s){t(this,s),this.arcgisChartsConfigNewChart=i(this,"arcgisChartsConfigNewChart",7),this.arcgisChartsConfigSelectedChartChange=i(this,"arcgisChartsConfigSelectedChartChange",7),this.arcgisChartsConfigModelListChange=i(this,"arcgisChartsConfigModelListChange",7),this.arcgisChartsConfigChartViewChartClose=i(this,"arcgisChartsConfigChartViewChartClose",7),this.arcgisChartsConfigPopoverOpenChange=i(this,"arcgisChartsConfigPopoverOpenChange",7),this.arcgisChartsConfigPanelNumberChange=i(this,"arcgisChartsConfigPanelNumberChange",7),this.supportedChartTypes=[N.BarSeries,N.BoxPlotSeries,N.LineSeries,N.PieSeries,N.HistogramSeries,N.ScatterSeries],this.chartDataProcessComplete=t=>{const{chartData:i,model:s}=t.detail,e=this.getModel(this.selectedChartId),a=s?.isSameChartAs(e);if(a)switch(e?.getChartType()){case N.HistogramSeries:case N.PieSeries:this.chartData=i;break;case N.ScatterSeries:{const t=i,{dataItems:s,r2:e}=t;let a=e;Number.isFinite(e)||(a=void 0),this.r2=a,this.calculatedDataMinMaxBounds=this.getDataExtent(s);break}case N.LineSeries:{const{dataItems:t,timeIntervalInfo:s}=i;o(e)&&(void 0!==s?.timeIntervalSize&&e.getTimeIntervalSize()!==s?.timeIntervalSize&&e.setTimeIntervalSize(s?.timeIntervalSize),void 0!==s?.timeIntervalUnits&&e.getTimeIntervalUnits()!==s?.timeIntervalUnits&&e.setTimeIntervalUnits(s?.timeIntervalUnits)),this.calculatedDataMinMaxBounds=this.getDataExtent(t);break}}},this.getDataExtent=t=>{const i=this.getModel(this.selectedChartId)?.getConfig();let s=[];if(void 0!==i&&void 0!==t){const e=m({chartConfig:i,chartData:t}),{minY:a,maxY:h,minX:o,maxX:n}=e;s=[{isXAxis:!0,minimum:o,maximum:n},{isXAxis:!1,minimum:a,maximum:h}]}return s},this.updateAxesBoundsInAppState=t=>{t?.forEach((t=>{const{isXAxis:i,maximum:s,minimum:e}=t,a=this.getModel(this.selectedChartId);if(void 0!==a&&n(a)&&void 0!==this.selectedChartId){const t=new O(a,i),h=w({chartId:this.selectedChartId,isXAxis:i,isLogarithmic:t.getLogarithmic()}),o=I.chartAxesBoundDataMap;void 0===o[this.selectedChartId]&&(o[this.selectedChartId]={});const n=o[this.selectedChartId]?.[h],r={defaultMinBound:n?.defaultMinBound===n?.currMinBound?e:n?.defaultMinBound,currMinBound:e,defaultMaxBound:n?.defaultMaxBound===n?.currMaxBound?s:n?.defaultMaxBound,currMaxBound:s};E(n,r)||void 0===this.selectedChartId||void 0===o?.[this.selectedChartId]||(o[this.selectedChartId][h]=r)}}))},this.chartAxesMinMaxChange=t=>{const{bounds:i,model:s}=t.detail,e=this.getModel(this.selectedChartId),a=s?.isSameChartAs(e),h=e?.getChartType();if(a)switch(h){case N.BarSeries:case N.BoxPlotSeries:case N.LineSeries:case N.HistogramSeries:case N.ScatterSeries:this.calculatedMinMaxBounds=i,this.updateAxesBoundsInAppState(i)}},this.chartSeriesColorChange=t=>{const{data:i,model:s}=t.detail,e=this.getModel(this.selectedChartId),a=s?.isSameChartAs(e);if(a)switch(e?.getChartType()){case N.BarSeries:case N.BoxPlotSeries:case N.LineSeries:case N.HistogramSeries:this.seriesColor=i;break;case N.PieSeries:{const t=new Map([[0,i]]);this.seriesColor=t;break}}},this.chartNoRenderPropChange=t=>{const{propName:i,value:s,model:e}=t.detail,a=this.modelList.find((t=>e?.isSameChartAs(t)));if(a)switch(i){case"rotation":"boolean"==typeof s&&c(a)&&a.setRotatedState(s);break;case"legendPosition":"string"==typeof s&&r(a)&&a.setLegendPosition(s);break;case"legendVisibility":"boolean"==typeof s&&r(a)&&a.setLegendVisibility(s)}},this.chartLegendItemVisibilityChange=async t=>{const{legendItemVisibility:i,model:s}=t.detail,e=this.modelList.find((t=>s?.isSameChartAs(t)));e?.setSeriesVisibility(i),n(e)&&((null===e.getMinYBound()||Number.isNaN(e.getMinYBound()))&&await e.setMinYBound(null),(null===e.getMaxYBound()||Number.isNaN(e.getMaxYBound()))&&await e.setMaxYBound(null),o(e)&&((null===e.getMinXBound()||Number.isNaN(e.getMinXBound()))&&await e.setMinXBound(null),(null===e.getMaxXBound()||Number.isNaN(e.getMaxXBound()))&&await e.setMaxXBound(null)))},this.onSelectChartTypeChange=t=>{this.currentChartTypeText="",this.calculatedDataMinMaxBounds=void 0,this.calculatedMinMaxBounds=void 0,this.removeSelectChartTypePopover();const{selectedChartType:i,layerId:s}=t.target;void 0!==i&&this.arcgisChartsConfigNewChart.emit({key:"key",chartType:i,layerId:s})},this.getPlacement=()=>{let t;if(void 0!==this.popoverPlacement)t=this.popoverPlacement;else{const i=this.modelList?.filter((t=>d(L,t.getConfig()))).length,s=2;t=Number(i)<=s?"bottom":"top"}return t},this.onBackFlow=()=>{this.panelNumber-=1},this.onAddChartClick=t=>{const{referenceElement:i,layerId:s}=t.detail;this.setupSelectChartTypePopover(i,s),this.addSelectChartTypePopover()},this.setupSelectChartTypePopover=(t,i)=>{void 0===this.selectChartTypePopover&&(this.selectChartTypePopover=u(x.SelectChartTypePopover,{onSelectChartTypeChange:this.onSelectChartTypeChange,popoverClose:this.onAddChartClose})),void 0!==this.selectChartTypePopover&&(this.selectChartTypePopover.layerId=i,this.selectChartTypePopover.popoverReferenceElement=t,this.selectChartTypePopover.popoverPlacement=this.getPlacement())},this.addSelectChartTypePopover=()=>{void 0!==this.selectChartTypePopover&&(document.body.contains(this.selectChartTypePopover)||(this.selectChartTypePopover.open=!0,document.body.appendChild(this.selectChartTypePopover),this.arcgisChartsConfigPopoverOpenChange.emit({open:!0})))},this.removeSelectChartTypePopover=()=>{this.selectChartTypePopover?.remove(),this.selectChartTypePopover=void 0,this.arcgisChartsConfigPopoverOpenChange.emit({open:!1})},this.clearPartialModels=()=>{this.modelList=this.modelList.filter((t=>!g(t.getConfig())))},this.onAddChartClose=()=>{this.removeSelectChartTypePopover()},this.onViewChartDelete=t=>{const{chartId:i}=t.detail,s=this.modelList.find((t=>t.getChartId()===i)),e=this.layerList.find((t=>t.id===s?.getLayer()?.id));this.modelList=[...this.modelList.filter((t=>t.getChartId()!==i))],e&&this.syncChartsToLayers&&function(t,i){const s=t;if(s?.charts){const t=s.charts.findIndex((t=>t.id===i));t>-1&&s.charts.splice(t,1)}}(e,i)},this.onViewChartsSelect=t=>{this.selectedChartId===t.detail.chartId&&this.arcgisChartsConfigSelectedChartChange.emit({key:"key",model:this.getModel(this.selectedChartId)}),this.selectedChartId=t.detail.chartId},this.onViewChartsEdit=t=>{this.onViewChartsSelect(t),this.panelNumber=1},this.onViewChartClose=()=>{this.open=!1,this.removeSelectChartTypePopover(),this.selectChartTypePopover=void 0,this.arcgisChartsConfigChartViewChartClose.emit()},this.createTooltip=t=>{const i=t.target;switch(this.tooltip=M(i),i.icon){case"configure":this.tooltip.innerHTML=this.strings.data;break;case"graph-bar-stacked":case"graph-line-series":case"box-chart-series":this.tooltip.innerHTML=this.strings.series;break;case"graph-pie-slice":this.tooltip.innerHTML=this.strings.slices;break;case"graph-axis":this.tooltip.innerHTML=this.strings.axes;break;case"graph-guides":this.tooltip.innerHTML=this.strings.guides;break;case"palette":this.tooltip.innerHTML=this.strings.format;break;case"text":this.tooltip.innerHTML=this.strings.general;break;default:this.tooltip.innerHTML=""}document.body.appendChild(this.tooltip)},this.destroyTooltip=()=>{k(this.tooltip)},this.onModelConfigChange=t=>{if(this.syncChartsToLayers){const i=t.target;S(i?.getLayer(),i)}this.updatesOccurred=this.updatesOccurred+1},this.modelList=[],this.layerList=[],this.selectedChartId=void 0,this.activeLayerId=void 0,this.disableEditing=!1,this.syncChartsToLayers=!1,this.timeZone=void 0,this.headerTitle=void 0,this.open=void 0,this.chartData=void 0,this.r2=void 0,this.calculatedDataMinMaxBounds=void 0,this.calculatedMinMaxBounds=void 0,this.seriesColor=void 0,this.popoverPlacement=void 0,this.usePopupTemplateFieldsInfo=void 0,this.panelNumber=0,this.modelLoading=void 0,this.filterBySelection=void 0,this.selectedPanel=void 0,this.currentChartTypeText=void 0,this.updatesOccurred=0}async layerListChange(){const t=[],i=this.layerList.map((t=>t.id.toString())),s=[...this.modelList.filter((t=>i.includes(t.getLayer()?.id??"")))];for(let i of this.layerList??[]){if("sublayer"===i.type){const t=await i.createFeatureLayer();if(!t)continue;i=t}const s=i;for(const e of s.charts??[]){const s=await l({layer:i,chartType:f(e.series),config:e});void 0!==s&&t.push(s)}}A(t),t.forEach((t=>{void 0===s.find((i=>i.isSameChartAs(t)))&&s.push(t)})),this.modelList=s}async modelListChange(t,i){this.selectedChartId=A(t,this.selectedChartId),i.forEach((t=>{t.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)})),t.forEach((t=>{t.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}));const s=this.getModel(this.selectedChartId);var e;this.currentChartTypeText=void 0!==s?.getChartType()?await p(s.getChartType()):"",this.syncChartsToLayers&&(e=t,this.layerList.forEach((t=>{e.forEach((i=>{t?.id===i.getLayer()?.id&&S(t,i)}))}))),this.arcgisChartsConfigModelListChange.emit({modelList:t})}async selectedChartIdChange(t){void 0===this.selectedChartId&&(this.panelNumber=0),this.selectedPanel=y.Data,this.seriesColor=void 0;const i=this.getModel(t);this.currentChartTypeText=void 0!==i?.getChartType()?await p(i.getChartType()):"",void 0!==t&&t!==I.selectedChartId&&(I.selectedChartId=t),this.arcgisChartsConfigSelectedChartChange.emit({key:"key",model:i})}panelNumberChange(t){0===t?this.clearPartialModels():1===t&&(this.arcgisChartsConfigPopoverOpenChange.emit({open:!1}),this.removeSelectChartTypePopover(),this.selectChartTypePopover=void 0),this.arcgisChartsConfigPanelNumberChange.emit({panelNumber:t,modelList:this.modelList})}async setFocus(){this.chartsListFlowItem?.setFocus()}connectedCallback(){this.addChartEventListeners()}async componentWillLoad(){({strings:this.strings,direction:this.direction}=await b(this.hostElement,s("."))),await this.layerListChange()}disconnectedCallback(){this.clearPartialModels(),this.removeSelectChartTypePopover(),this.removeChartEventListeners(),this.selectChartTypePopover=void 0}renderViewCharts(){return function(t){const{modelList:i,layerList:s,activeLayerId:e,disableEditing:a}=t,h=new Map;return i?.forEach((t=>{const i=t.getLayer();i&&h.set(i.id,i)})),a||s.forEach((t=>h.set(t.id,t))),Array.from(h.values()).filter((t=>!e||t.id===e))}({modelList:this.modelList,layerList:this.layerList,activeLayerId:this.activeLayerId,disableEditing:this.disableEditing}).map((t=>e("arcgis-charts-config-view-charts",{key:t.id,noGroup:void 0!==this.activeLayerId,modelList:D(this.modelList,t.id.toString(),this.supportedChartTypes),selectedChartId:this.selectedChartId??"",layer:t,disableEditing:this.disableEditing,onArcgisChartsConfigViewChartSelect:this.onViewChartsSelect,onArcgisChartsConfigViewChartEdit:this.onViewChartsEdit,onArcgisChartsConfigViewChartDelete:this.onViewChartDelete,onArcgisChartsConfigViewChartAddChart:this.onAddChartClick})))}render(){return e(a,{key:"2bf1e9ed56494c3e591040c06d0ffa825322ff8e",class:{[j]:"rtl"===this.direction}},!1!==this.open?e("calcite-flow",{dir:this.direction},e("calcite-flow-item",{key:"charts-list",selected:0===this.panelNumber||this.disableEditing,heading:this.headerTitle??this.strings.defaultHeaderTitle,closable:!0,onCalciteFlowItemClose:this.onViewChartClose,ref:t=>{this.chartsListFlowItem=t}},this.renderViewCharts()),this.renderTabs()):null)}addChartEventListeners(){document.addEventListener(C.DataProcessComplete,this.chartDataProcessComplete),document.addEventListener(C.AxesMinMaxChange,this.chartAxesMinMaxChange),document.addEventListener(C.SeriesColorChange,this.chartSeriesColorChange),document.addEventListener(C.NoRenderPropChange,this.chartNoRenderPropChange),document.addEventListener(C.LegendItemVisibilityChange,this.chartLegendItemVisibilityChange)}removeChartEventListeners(){document.removeEventListener(C.DataProcessComplete,this.chartDataProcessComplete),document.removeEventListener(C.AxesMinMaxChange,this.chartAxesMinMaxChange),document.removeEventListener(C.SeriesColorChange,this.chartSeriesColorChange),document.removeEventListener(C.NoRenderPropChange,this.chartNoRenderPropChange),document.removeEventListener(C.LegendItemVisibilityChange,this.chartLegendItemVisibilityChange)}renderTabs(){const t=this.getModel(this.selectedChartId);return e("calcite-flow-item",{key:"chart-edit",selected:this.panelNumber>=1&&!this.disableEditing,onCalciteFlowItemBack:this.onBackFlow,heading:this.strings[this.selectedPanel??y.Data],description:""!==this.currentChartTypeText?v(this.strings.pageFlowTitle,{chartName:t?.getTitleText()??this.currentChartTypeText,layerName:t?.getLayer()?.title??""}):""},void 0!==t?.getChartType()?e("calcite-action-bar",{class:"tab-bar",layout:"horizontal",expandDisabled:!0,dir:this.direction},e("calcite-action",{class:B,icon:"configure",scale:"s",alignment:"center",active:this.selectedPanel===y.Data||void 0===this.selectedPanel,onClick:()=>{this.selectedPanel=y.Data},onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip,text:"",textEnabled:!1}),t?.getChartType()===N.BarSeries?e("calcite-action",{class:B,icon:"graph-bar-stacked",scale:"s",alignment:"center",active:this.selectedPanel===y.Series,onClick:()=>{this.selectedPanel=y.Series},onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip,text:"",textEnabled:!1}):null,t?.getChartType()===N.LineSeries?e("calcite-action",{class:B,icon:"graph-line-series",scale:"s",alignment:"center",active:this.selectedPanel===y.Series,onClick:()=>{this.selectedPanel=y.Series},onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip,text:"",textEnabled:!1}):null,t?.getChartType()===N.BoxPlotSeries?e("calcite-action",{class:B,icon:"box-chart-series",scale:"s",alignment:"center",active:this.selectedPanel===y.Series,onClick:()=>{this.selectedPanel=y.Series},onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip,text:"",textEnabled:!1}):null,t?.getChartType()===N.PieSeries?e("calcite-action",{class:B,icon:"graph-pie-slice",scale:"s",alignment:"center",active:this.selectedPanel===y.Slices,onClick:()=>{this.selectedPanel=y.Slices},onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip,text:"",textEnabled:!1}):null,t?.getChartType()!==N.PieSeries?e("calcite-action",{class:B,icon:"graph-axis",scale:"s",alignment:"center",active:this.selectedPanel===y.Axes,onClick:()=>{this.selectedPanel=y.Axes},onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip,text:"",textEnabled:!1}):null,t?.getChartType()!==N.PieSeries?e("calcite-action",{class:B,icon:"graph-guides",scale:"s",alignment:"center",active:this.selectedPanel===y.Guides,onClick:()=>{this.selectedPanel=y.Guides},onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip,text:"",textEnabled:!1}):null,e("calcite-action",{class:B,icon:"palette",scale:"s",alignment:"center",active:this.selectedPanel===y.Format,onClick:()=>{this.selectedPanel=y.Format},onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip,text:"",textEnabled:!1}),e("calcite-action",{class:B,icon:"text",scale:"s",alignment:"center",active:this.selectedPanel===y.General,onClick:()=>{this.selectedPanel=y.General},onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip,text:"",textEnabled:!1})):null,this.renderChartUIComponent())}renderChartUIComponent(){const t=this.getModel(this.selectedChartId),i=t?.getLayer();let s=null;if(void 0!==t&&!this.modelLoading&&!this.disableEditing)switch(t?.getChartType()){case"barSeries":s=e("arcgis-charts-config-bar-chart",{model:t,timeZone:this.timeZone,usePopupTemplateFieldsInfo:this.usePopupTemplateFieldsInfo,layer:i,page:this.selectedPanel??y.Data,calculatedMinMaxBounds:this.calculatedMinMaxBounds,seriesColor:this.seriesColor});break;case"lineSeries":s=e("arcgis-charts-config-line-chart",{model:t,timeZone:this.timeZone,usePopupTemplateFieldsInfo:this.usePopupTemplateFieldsInfo,layer:i,page:this.selectedPanel??y.Data,calculatedDataMinMaxBounds:this.calculatedDataMinMaxBounds,calculatedMinMaxBounds:this.calculatedMinMaxBounds,seriesColor:this.seriesColor});break;case"pieSeries":s=e("arcgis-charts-config-pie-chart",{model:t,usePopupTemplateFieldsInfo:this.usePopupTemplateFieldsInfo,layer:i,chartData:this.chartData,page:this.selectedPanel??y.Data,calculatedMinMaxBounds:this.calculatedMinMaxBounds,seriesColor:this.seriesColor,filterBySelection:this.filterBySelection});break;case"histogramSeries":s=e("arcgis-charts-config-histogram",{model:t,usePopupTemplateFieldsInfo:this.usePopupTemplateFieldsInfo,layer:i,page:this.selectedPanel??y.Data,chartData:this.chartData,calculatedMinMaxBounds:this.calculatedMinMaxBounds,seriesColor:this.seriesColor});break;case"scatterSeries":s=e("arcgis-charts-config-scatter-plot",{model:t,usePopupTemplateFieldsInfo:this.usePopupTemplateFieldsInfo,layer:i,page:this.selectedPanel??y.Data,r2:this.r2,calculatedDataMinMaxBounds:this.calculatedDataMinMaxBounds,calculatedMinMaxBounds:this.calculatedMinMaxBounds});break;case"boxPlotSeries":s=e("arcgis-charts-config-box-plot",{model:t,usePopupTemplateFieldsInfo:this.usePopupTemplateFieldsInfo,layer:i,page:this.selectedPanel??y.Data,calculatedMinMaxBounds:this.calculatedMinMaxBounds,seriesColor:this.seriesColor})}return s}getModel(t){return this.modelList?.find((i=>i.getChartId()===t))}static get assetsDirs(){return["assets"]}get hostElement(){return h(this)}static get watchers(){return{layerList:["layerListChange"],modelList:["modelListChange"],selectedChartId:["selectedChartIdChange"],panelNumber:["panelNumberChange"]}}};T.style=":host{display:flex;flex-direction:column;flex:1 1 auto;overflow:hidden}.label{display:flex;margin-left:1rem;margin-bottom:0.5rem;justify-content:space-between}.text{display:flex;margin-left:1rem;width:calc(100% - 1.5rem);height:2rem;margin-bottom:0.5rem;justify-content:space-between}.field-list{max-height:50vh;overflow-y:scroll}.row{padding:0.5rem 0.5rem}.bin-count-container{display:flex;width:calc(100% - 1rem);padding:0.5rem}.bin-count-slider{margin-left:1rem;width:calc(90% - 1rem)}.bin-count-input{margin-left:1rem;height:2rem;width:2rem}.bin-row{padding:0.5rem 0 0.5rem 0.5rem}.tab-bar{display:flex}.tab{flex:1;height:2.5rem}:host(.arcgis-charts-rtl) .label{margin-left:0rem;margin-right:1rem}:host(.arcgis-charts-rtl) .text{margin-left:0rem;margin-right:1rem}:host(.arcgis-charts-rtl) .bin-count-slider{margin-left:0rem;margin-right:1rem}:host(.arcgis-charts-rtl) .bin-count-input{margin-left:0rem;margin-right:1rem}";export{T as A}