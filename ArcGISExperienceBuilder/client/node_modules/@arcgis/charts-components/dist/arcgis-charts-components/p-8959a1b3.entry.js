/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See LICENSE.md for details.
 * v4.32.1
 */
import{r as i,c as t,g as s,h as e,H as a,a as c}from"./p-ccd1c88c.js";import{R as h,M as l,aa as r,C as n,Z as o,r as d,a5 as f,u as b,af as g,ag as m}from"./p-33adbadb.js";import{t as u,r as p}from"./p-247471b0.js";import{P as C}from"./p-e3e7b132.js";import{l as v,c as y,d as k,s as w,U as x}from"./p-13fd0548.js";import{d as j}from"./p-1da73821.js";import{i as I}from"./p-ff76a05d.js";import{t as S}from"./p-1383309b.js";import"./p-d49d148b.js";import"./p-a2f87a76.js";import"./p-76417cef.js";const P="label",M="arcgis-charts-rtl",N=class{constructor(s){i(this,s),this.arcgisChartsConfigPieChartDataNumericFieldValidate=t(this,"arcgisChartsConfigPieChartDataNumericFieldValidate",7),this.arcgisChartsConfigDataChangeError=t(this,"arcgisChartsConfigDataChangeError",7),this.pieChartPopover=null,this.onSortOrderSelect=()=>{this.contentKind=C.sortOrder,this.setupPopover()},this.onCategorySelect=()=>{this.contentKind=C.category,this.setupPopover()},this.onAddNumericFields=()=>{this.contentKind=C.numericFields,this.setupPopover()},this.onRemoveNumericField=async i=>{const t=i.target.value;await this.model.setNumericFields(this.model.getNumericFields().filter((i=>i!==t)))},this.onPieChartDataChange=async i=>{try{if(null!==i.detail&&void 0!==i.detail?.value){const{contentKind:t}=i.detail,s=[...i.detail.value];switch(t){case C.aggregation:await this.model.setAggregationType(s[0]!==h.NoAggregation?s[0]:"");break;case C.category:{const i=s[0]?.trim()||"";this.updateMode(i);const t=this.model.getNumericFields();t.length>1&&i!==v&&await this.model.setNumericFields([t[0]]),await this.model.setCategory(i),this.model.setColorMatch(!0);break}case C.numericFields:s.length>1&&(this.updateMode(v),await this.model.setCategory(v)),await this.model.setNumericFields(s);break;case C.sortOrder:this.model.setSortOrder(s[0])}}}catch(i){throw this.arcgisChartsConfigDataChangeError.emit({error:i,model:this.model}),i}this.updatesOccurred=this.updatesOccurred+1},this.onShowDataLabelsChange=i=>{this.model.setDataLabelsVisibility(i.target.checked)},this.onModelConfigChange=()=>{this.updatesOccurred=this.updatesOccurred+1},this.popoverClose=i=>{this.pieChartPopover===i?.target&&this.removePieChartDataPopover()},this.model=void 0,this.layerFieldsInfo=void 0,this.open=!0,this.updatesOccurred=0}modelChange(i,t){t?.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange),i?.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}disconnectedCallback(){this.removePieChartDataPopover(),this.model.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}async componentWillLoad(){({strings:this.strings,direction:this.direction}=await l(this.hostElement,s("."))),this.modelChange(this.model),this.onModelConfigChange()}renderSorting(){return e("arcgis-charts-config-field-select",{label:this.strings[this.model.getSortOrder()],ref:i=>{this.sortOrderElement=i},onClick:this.onSortOrderSelect})}renderCategory(){const i=this.getCorrectedCategoryValue();return e("arcgis-charts-config-field-select",{label:i,ref:i=>{this.categoryElement=i},onClick:this.onCategorySelect})}renderNumericFields(i){const t=r(this.layerFieldsInfo),s=[];for(let e=0;e<i.length;e+=1)i[e]!==t&&s.push(this.buildNumericFieldItem(i[e]));return e("calcite-list",{label:"",class:"field-list",ref:i=>{this.numericFieldsElement=i}},s)}buildNumericFieldItem(i){return e("calcite-list-item",{label:n(this.layerFieldsInfo,i),value:i,key:i,closable:!0,onCalciteListItemClose:this.onRemoveNumericField})}render(){const i=this.renderCategory(),t=this.renderSorting(),s=this.renderNumericFields([...this.model.getNumericFields()]);return e(a,{key:"71c159378eacd2102b08dedb9f490be7a0d61a16",class:{[M]:"rtl"===this.direction}},e("calcite-label",{key:"a4257387596421399c45874db20d7b4113afe2f9",class:P},this.strings.category,i),[e("calcite-label",{key:"fe2ce6294d26d51237ca0e37b25e6260bd4f2b30",class:P},this.strings.numericFields,s),e("div",{key:"0ff966420080f20ec8234ba8667cd95839fffb9f",class:"fab"},e("calcite-fab",{key:"3471ebb056b44ee0dece3f44dc68a095f6c347d0",appearance:"outline-fill",kind:"neutral",scale:"m",label:this.strings.selectNumericFields,"text-enabled":!0,text:this.strings.selectNumericFields,icon:"plus",onClick:this.onAddNumericFields}))],e("calcite-label",{key:"e954a0fb8a21d2f5ba855524bbbab292113f6763",class:P,layout:"inline-space-between"},this.strings.showDataLabels,e("calcite-switch",{key:"211743ae23fe12a013d4d05b111b262678f5fe61",checked:this.model.getDataLabelsVisibility(),onCalciteSwitchChange:this.onShowDataLabelsChange})),e("calcite-label",{key:"e53374c316407695d6dd52883eec9f86c6d4cf5d",class:P},this.strings.sortOrder,t))}updateMode(i){const t=i!==v&&""!==i.trim();this.model.setMode(t?u.Category:u.Fields)}setupPopover(){this.removePieChartDataPopover();const i={layerFieldsInfo:[...this.layerFieldsInfo],onPieChartDataChange:this.onPieChartDataChange,popoverClose:this.popoverClose};if(this.pieChartPopover=o(d.PieChartDataPopover,i),null!==this.pieChartPopover){switch(this.contentKind){case C.category:this.pieChartPopover.referenceElement=this.categoryElement,this.pieChartPopover.headingTitle=this.strings.categoryHeader,this.pieChartPopover.selectedContent=this.model.getCategory();break;case C.numericFields:this.pieChartPopover.referenceElement=this.numericFieldsElement,this.pieChartPopover.headingTitle=this.strings.numericFieldsMultipleHeader,this.pieChartPopover.selectedContent=this.model.getNumericFields();break;case C.sortOrder:this.pieChartPopover.referenceElement=this.sortOrderElement,this.pieChartPopover.headingTitle=this.strings.sortOrderHeader,this.pieChartPopover.selectedContent=this.model.getSortOrder()}this.pieChartPopover.contentKind=this.contentKind,this.pieChartPopover.open=!0,this.addPopover()}}addPopover(){document.body.contains(this.pieChartPopover)||null===this.pieChartPopover||document.body.appendChild(this.pieChartPopover)}getCorrectedCategoryValue(){return this.model.getCategory()===v||""===this.model.getCategory().trim()?"":n(this.layerFieldsInfo,this.model.getCategory())}removePieChartDataPopover(){null!==this.pieChartPopover&&(this.pieChartPopover.open=!1,this.pieChartPopover=f(this.pieChartPopover))}static get assetsDirs(){return["assets"]}get hostElement(){return c(this)}static get watchers(){return{model:["modelChange"]}}};N.style=":host{display:flex;flex-direction:column;width:var(--arcgis-charts-config-calcite-block-default-width);margin:var(--arcgis-charts-config-calcite-block-default-margin);margin-top:var(--arcgis-charts-top-section-margin)}.label,.disabled-label{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.text{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);width:calc(100% - 1.5rem);height:2rem;margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.field-list{max-height:50vh;overflow-y:auto}.disabled-label{pointer-events:none}.fab{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:1.5rem;justify-content:center}:host(.arcgis-chart-rtl) .text{margin-left:0rem;margin-right:var(--arcgis-charts-config-margin-minor)}";const $="section-label",_="label",L="slice-list",D=class{constructor(s){i(this,s),this.arcgisChartsConfigPieChartSlicesPopoverChange=t(this,"arcgisChartsConfigPieChartSlicesPopoverChange",7),this.arcgisChartsConfigPopoverOpenChange=t(this,"arcgisChartsConfigPopoverOpenChange",7),this.slicesPopover=null,this.onDonutSizeSliderChange=j((()=>{Number.isInteger(this.donutSizeSliderElement.value)&&this.model.setInnerRadiusSize(this.donutSizeSliderElement.value??g)}),x.SliderTimer),this.onGroupingThresholdSliderChange=j((()=>{const i=this.groupingThresholdSliderElement.value;Number.isNaN(i)?this.model.setGroupingThreshold(0):(this.groupingThresholdElement.value=i.toString(),this.groupingThresholdSliderElement.value=i,this.model.setGroupingThreshold(i))}),x.SliderTimer),this.onGroupingThresholdChange=i=>{let t=Number.parseInt(i.target.value);t>100?t=100:t<0&&(t=0),Number.isNaN(t)?this.model.setGroupingThreshold(0):(this.groupingThresholdElement.value=t.toString(),this.model.setGroupingThreshold(t),this.groupingThresholdSliderElement.value=t)},this.onLabelCharacterLimitChange=i=>{let t=Number.parseInt(i.target.value);t<1&&(t=1),Number.isNaN(t)?this.model.setLabelCharacterLimit(null):(this.labelCharacterLimitElement.value=t.toString(),this.model.setLabelCharacterLimit(t))},this.onDecimalPlacesChange=i=>{let t=Number.parseInt(i.target.value);t<0?t=0:t>20&&(t=20),Number.isNaN(t)?this.model.setDecimalPlaces(0):(this.decimalPlacesElement.value=t.toString(),this.model.setDecimalPlaces(t))},this.onDisplayTypeChange=i=>{this.model.setDisplayType(i.target.selectedItem.value)},this.resetSlicesOriginal=()=>{this.configSliceOpen=!1,this.selectedSliceId=void 0,this.model.setColorMatch(!0),this.model.resetSlices()},this.sliceNameChange=i=>{if(null!==i.detail||void 0!==i.detail){const t=i.detail?.name,s=this.model.getSlices()?.findIndex((i=>i.sliceId===this.selectedSliceId)),e=this.model.getSliceGrouping();null!=s&&s>=0?this.model.setSliceName(t,s):e?.sliceId===this.selectedSliceId&&void 0!==e&&this.model.setSliceGrouping({...e,label:t})}},this.sliceColorChange=i=>{if(null!=i.detail){const{color:t}=i.detail,s=this.model.getSlices()?.findIndex((i=>i.sliceId===this.selectedSliceId)),e=this.model.getSliceGrouping();null!=s&&s>=0?(this.model.setColorMatch(!1),this.model.setSliceColor(t,s)):e?.sliceId===this.selectedSliceId&&void 0!==e&&(this.model.setColorMatch(!1),this.model.setSliceGrouping({...e,fillSymbol:{...e.fillSymbol,type:b.SFS,color:t}}))}},this.onCalciteListOrderChange=i=>{if(null!=i.detail){const{newIndex:t,oldIndex:s}=i.detail;this.model.moveSeries(s,t)}},this.slicesPopoverClose=()=>{this.selectedSliceId=void 0,this.configSliceOpen=!1},this.slicesPopoverChange=i=>{this.arcgisChartsConfigPieChartSlicesPopoverChange.emit({open:i,element:this.slicesPopover})},this.openSlicesPopover=i=>{const t=i.target,s="calcite-list-item"===t.localName?t:t.parentNode;this.configSliceOpen=this.selectedSliceId!==s.value||!this.configSliceOpen,this.selectedSliceId=this.configSliceOpen?s.value===this.model.getSliceGrouping()?.sliceId?this.model.getSliceGrouping()?.sliceId:s.value:void 0},this.onModelConfigChange=()=>{this.updatesOccurred=this.updatesOccurred+1},this.openChange=i=>{this.arcgisChartsConfigPopoverOpenChange.emit(i.detail)},this.createTooltip=i=>{this.tooltip=y(i.target),this.tooltip.innerHTML=this.strings.groupingInfo,document.body.appendChild(this.tooltip)},this.destroyTooltip=()=>{k(this.tooltip)},this.model=void 0,this.configSliceOpen=!1,this.popoverPlacement="leading",this.chartData=void 0,this.selectedSliceId=void 0,this.updatesOccurred=0}modelChange(i,t){t?.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange),i?.addEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}selectedSliceIdChange(){if(!I(this.selectedSliceId)&&this.configSliceOpen){if(this.setupSlicesPopover(),null!==this.slicesPopover){const i=this.model.getSlices(),t=this.model.getSliceGrouping();if(this.selectedSliceId===t?.sliceId)this.slicesPopover.selectedName=t?.label,this.slicesPopover.selectedColor=t?.fillSymbol?.color;else if(void 0!==i){const t=i.findIndex((i=>i.sliceId===this.selectedSliceId));this.slicesPopover.selectedName=this.model.getSliceName(t),this.slicesPopover.selectedColor=this.model.getSliceColor(t)}this.slicesPopover.open||(this.slicesPopover.open=!0)}this.addSlicesPopover()}}removeSlicesPopover(){null!=this.slicesPopover&&(this.slicesPopover.open=!1,this.slicesPopover.selectedName=void 0,this.slicesPopover.selectedColor=void 0,this.slicesPopover=f(this.slicesPopover)),this.slicesPopoverChange(!1)}async componentWillLoad(){({strings:this.strings}=await l(this.hostElement,s("."))),this.modelChange(this.model),this.onModelConfigChange()}disconnectedCallback(){this.removeSlicesPopover(),this.model.removeEventListener("arcgisChartsModelConfigChange",this.onModelConfigChange)}buildSliceListItem(){let i="#CCCCCC",t="minus-square";const s=[];let a=this.model.getSlices();const c=this.chartData?.dataItems;c&&(a=a?.filter((i=>-1!==c?.findIndex((t=>t.arcgis_charts_slice_id===i.sliceId))))),a?.forEach((a=>{if(void 0!==a.fillSymbol?.color){t="square-f";const[s,e,c,h]=[...a.fillSymbol.color];i=`rgba(${s},${e},${c},${h/255})`}if(void 0!==a&&!this.model.getGroupedSliceIds().includes(a.sliceId)){let c=a.sliceId;c===m.emptySliceId?c=this.strings.emptySlice:c===m.nullSliceId&&(c=this.strings.nullSlice),s?.push(e("calcite-list-item",{key:a.sliceId,label:a.label??a.sliceId,description:c,value:a.sliceId,selected:this.selectedSliceId===a.sliceId,onClick:this.openSlicesPopover},e("calcite-icon",{slot:"content-end",icon:t,style:{color:i}})))}}));const h=this.model.getSliceGrouping();if(void 0!==h?.fillSymbol?.color){t="square-f";const[s,e,a,c]=[...h.fillSymbol.color];i=`rgba(${s},${e},${a},${c/255})`}return this.model.getGroupedSliceIds().length>0&&s?.push(e("calcite-list-item",{key:h?.sliceId,label:h?.label??h?.sliceId??"",description:this.strings.groupedSlices,value:h?.sliceId??"",selected:this.selectedSliceId===h?.sliceId,onClick:this.openSlicesPopover},e("calcite-icon",{slot:"content-end",icon:t,style:{color:i}}))),s}buildGroupedSlicesListItem(){let i="#CCCCCC",t="minus-square";const s=[];return this.model.getSlices()?.forEach((a=>{if(void 0!==a.fillSymbol?.color){t="square-f";const[s,e,c,h]=[...a.fillSymbol.color];i=`rgba(${s},${e},${c},${h/255})`}void 0!==a&&this.model.getGroupedSliceIds().includes(a.sliceId)&&s?.push(e("calcite-list-item",{key:a.sliceId,label:a.label??a.sliceId,description:a.sliceId,value:a.sliceId,selected:this.selectedSliceId===a.sliceId,onClick:this.openSlicesPopover},e("calcite-icon",{slot:"content-end",icon:t,style:{color:i}})))})),s}buildSliceList(){return e("calcite-list",{label:"",class:L,selectionMode:"single",selectionAppearance:"border",onCalciteListOrderChange:this.onCalciteListOrderChange},this.buildSliceListItem())}buildGroupedSliceList(){return e("calcite-list",{label:"",class:L,selectionMode:"single",selectionAppearance:"border",onCalciteListOrderChange:this.onCalciteListOrderChange},this.buildGroupedSlicesListItem())}render(){return e(a,{key:"293ddf3eb0fc2a0f6ddee6d6d7d67f83a581eddc"},e("div",{key:"33736708d4bf2fd7ab4f2daea0250348000f0091",class:$},this.strings.settings),e("calcite-label",{key:"b460ef6df43c4fa27874da0627067cc9da9be74c",class:_},this.strings.shape,e("calcite-slider",{key:"4d2a71ed4ff75b3490872ac514d2662504ee6f70",labelHandles:!1,min:0,max:100,step:1,snap:!0,value:this.model.getInnerRadiusSize()??g,onCalciteSliderChange:this.onDonutSizeSliderChange,ref:i=>{this.donutSizeSliderElement=i}})),e("div",{key:"55b78f6fbaae0f57e5ac7ff8cda76d037fe5224f",class:"pie-donut-labels-container"},e("calcite-label",{key:"2be88abd27cb7dd021ec4a50572a1062fa68f1a1",class:_},this.strings.pie),e("calcite-label",{key:"3ebc0cb1e920ea29098a3985707b014eb0fb21cf",class:_},this.strings.donut)),e("calcite-label",{key:"30ade5368a4b77b8c437403885e05f2ef1a47cf0",class:_},e("div",{key:"692439e410c9d1ae400b14535511b03a6f5d4472",class:"grouping-label-container"},e("div",{key:"d9731959878d99243a0595d5bd217676cb265e16"},this.strings.groupingPercent),e("calcite-icon",{key:"3c1d5035d3f130efc26ae9dd983cdd1b1b4fac34",icon:"information",scale:"s",flipRtl:!0,onMouseOver:this.createTooltip,onMouseOut:this.destroyTooltip})),e("div",{key:"0055f28f084b6786d9975ab003d8acda8972933c",class:"slider-input-container"},e("calcite-slider",{key:"d8984e35a7e76fc265b80d7ebc7153411a4af28f",labelHandles:!1,min:0,max:50,step:1,snap:!0,value:S(w(this.model.getGroupingThreshold()??0)),onCalciteSliderChange:this.onGroupingThresholdSliderChange,ref:i=>{this.groupingThresholdSliderElement=i}}),e("calcite-input",{key:"af4d17930b74105701c70bd659f13a30eb8b05a0",class:"number-input",type:"number",min:0,max:100,step:1,suffixText:"%",value:w(this.model.getGroupingThreshold()??0),onCalciteInputInput:this.onGroupingThresholdChange,ref:i=>{this.groupingThresholdElement=i,this.groupingThresholdElement.addEventListener("click",(i=>{i.stopPropagation()}))}}))),e("div",{key:"9b59c69fac201710189b16ff7165c0f8f78ca566",class:$},this.strings.labels),e("calcite-label",{key:"8b00f14ac794850d5d17d8b3810f1ee03d27f1ab",class:_},this.strings.labelCharacterLimit,e("calcite-input",{key:"c4fa9c3397c4e11350cb2508b8347d79e41b8658",type:"number",min:1,step:1,value:w(this.model.getLabelCharacterLimit()),onCalciteInputInput:this.onLabelCharacterLimitChange,ref:i=>{this.labelCharacterLimitElement=i}})),e("calcite-label",{key:"6d43bcb7ba905e78457f2f87cd78a29b4fdc3c56",class:_},this.strings.decimalPlaces,e("calcite-input",{key:"df34a75495d81b26be2afc05bdce1fd5b1e3d490",type:"number",min:0,max:20,step:1,value:w(this.model.getDecimalPlaces()),onCalciteInputInput:this.onDecimalPlacesChange,ref:i=>{this.decimalPlacesElement=i}})),e("calcite-label",{key:"504bd5145c4f3da5388ae41f9887cae7469b5490",class:_},this.strings.display,e("calcite-radio-button-group",{key:"abbcc323977b72eaa00283be8f7ef7f861b090a9",class:"radio-group",name:"display",layout:"vertical",onCalciteRadioButtonGroupChange:this.onDisplayTypeChange},e("calcite-label",{key:"402b87bd856dc1b81298d3be73aba87e05df9a66",layout:"inline"},e("calcite-radio-button",{key:"252d104dcf622fac9099913dec3f1c4c6f97c33c",value:p.Value,checked:this.model.getDisplayType()===p.Value}),this.strings.value),e("calcite-label",{key:"eb97a15177a32a39c6837e7bc80ca9258aa87af6",layout:"inline"},e("calcite-radio-button",{key:"df37ae7085998b12708b1395e90c60f57b7d747b",value:p.Percentage,checked:this.model.getDisplayType()===p.Percentage}),this.strings.percentage),e("calcite-label",{key:"acd24bb6ebf731490a84854e50cb328dfdc42475",layout:"inline"},e("calcite-radio-button",{key:"fe31aa327b130225544b0cbfd88c50c053ae8004",value:p.Both,checked:this.model.getDisplayType()===p.Both}),this.strings.both))),e("div",{key:"cce8d301acb22ef81d523e376319b014b0a27102",class:$},this.strings.slices,e("calcite-button",{key:"25e0ff6b850ffcfff2b2ec105d3343e2a2c21b44",onClick:this.resetSlicesOriginal,disabled:!this.model.resetAvailable(),appearance:"transparent",iconEnd:"reset"},this.strings.reset)),this.buildSliceList(),e("div",{key:"1a8965ba5c7a444779f4b2eb5b78b5a05180de20",class:$},this.strings.groupedSlices),this.buildGroupedSliceList())}setupSlicesPopover(){null===this.slicesPopover&&void 0!==this.hostElement&&(this.slicesPopover=o(d.PieChartSlicesPopover,{referenceElement:this.hostElement,placement:this.popoverPlacement,sliceNameChange:this.sliceNameChange,sliceColorChange:this.sliceColorChange,openChange:this.openChange,popoverClose:this.slicesPopoverClose}))}addSlicesPopover(){null==this.slicesPopover||document.body.contains(this.slicesPopover)||document.body.appendChild(this.slicesPopover),this.slicesPopoverChange(!0)}static get assetsDirs(){return["assets"]}get hostElement(){return c(this)}static get watchers(){return{model:["modelChange"],selectedSliceId:["selectedSliceIdChange"]}}};D.style=":host{display:flex;flex-direction:column;width:var(--arcgis-charts-config-calcite-block-default-width);margin:var(--arcgis-charts-config-calcite-block-default-margin)}.section-label{display:flex;margin:var(--arcgis-charts-config-margin-major) var(--arcgis-charts-config-margin-minor);justify-content:space-between;align-items:center;font-weight:var(--calcite-font-weight-medium);font-size:var(--calcite-font-size-0)}.label{display:flex;margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-minor);justify-content:space-between}.label .grouping-label-container{display:flex;justify-content:space-between}.label .slider-input-container{display:flex}.label .slider-input-container calcite-slider{--calcite-label-margin-bottom:var(--arcgis-charts-intra-section-margin) !important;margin-right:var(--arcgis-charts-config-margin-minor);flex-grow:1}.label .slider-input-container .number-input{width:8rem}.slice-list{margin-left:var(--arcgis-charts-config-margin-minor);margin-right:var(--arcgis-charts-config-margin-minor);margin-bottom:var(--arcgis-charts-config-margin-major)}.radio-group{margin-top:var(--arcgis-charts-config-margin-minor)}.pie-donut-labels-container{display:flex;justify-content:space-between;margin-top:calc(var(--arcgis-charts-config-margin-minor) * -3)}";export{N as arcgis_charts_config_pie_chart_data,D as arcgis_charts_config_pie_chart_slices}